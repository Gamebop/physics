/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["PhysicsComponents"] = factory();
	else
		root["PhysicsComponents"] = factory();
})(self, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/backends/jolt/backend.mjs":
/*!***************************************!*\
  !*** ./src/backends/jolt/backend.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JoltBackend: () => (/* binding */ JoltBackend)\n/* harmony export */ });\n/* harmony import */ var jolt_physics_package_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jolt-physics/package.json */ \"./node_modules/jolt-physics/package.json\");\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _physics_math_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../physics/math.mjs */ \"./src/physics/math.mjs\");\n/* harmony import */ var _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commands-buffer.mjs */ \"./src/backends/jolt/commands-buffer.mjs\");\n/* harmony import */ var _operators_cleaner_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./operators/cleaner.mjs */ \"./src/backends/jolt/operators/cleaner.mjs\");\n/* harmony import */ var _operators_creator_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./operators/creator.mjs */ \"./src/backends/jolt/operators/creator.mjs\");\n/* harmony import */ var _operators_drawer_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./operators/drawer.mjs */ \"./src/backends/jolt/operators/drawer.mjs\");\n/* harmony import */ var _operators_listener_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./operators/listener.mjs */ \"./src/backends/jolt/operators/listener.mjs\");\n/* harmony import */ var _operators_modifier_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./operators/modifier.mjs */ \"./src/backends/jolt/operators/modifier.mjs\");\n/* harmony import */ var _operators_querier_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./operators/querier.mjs */ \"./src/backends/jolt/operators/querier.mjs\");\n/* harmony import */ var _operators_tracker_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./operators/tracker.mjs */ \"./src/backends/jolt/operators/tracker.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass JoltBackend {\r\n    constructor(messenger, data) {\r\n        // // TODO\r\n        // // add webworker\r\n        // if (!window || !window.Jolt) return;\r\n\r\n        const config = {\r\n            // Physics Settings\r\n            // https://jrouwe.github.io/JoltPhysics/struct_physics_settings.html\r\n            baumgarte: 0.2,\r\n            bodyPairCacheCosMaxDeltaRotationDiv2: 0.9998476951563912,\r\n            bodyPairCacheMaxDeltaPositionSq: Math.sqrt(0.001),\r\n            contactNormalCosMaxDeltaRotation: 0.9961946980917455,\r\n            contactPointPreserveLambdaMaxDistSq: Math.sqrt(0.01),\r\n            deterministicSimulation: true,\r\n            linearCastMaxPenetration: 0.25,\r\n            linearCastThreshold: 0.75,\r\n            manifoldToleranceSq: 1.0e-6,\r\n            maxInFlightBodyPairs: 16384,\r\n            maxPenetrationDistance: 0.2,\r\n            minVelocityForRestitution: 1,\r\n            numPositionSteps: 2,\r\n            numVelocitySteps: 10,\r\n            penetrationSlop: 0.02,\r\n            pointVelocitySleepThreshold: 0.03,\r\n            speculativeContactDistance: 0.02,\r\n            stepListenerBatchesPerJob: 1,\r\n            stepListenersBatchSize: 8,\r\n            timeBeforeSleep: 0.5,\r\n            // for debugging\r\n            constraintWarmStart: true,\r\n            useBodyPairContactCache: true,\r\n            useManifoldReduction: true,\r\n            useLargeIslandSplitter: true,\r\n            allowSleeping: true,\r\n            checkActiveEdges: true,\r\n            // contact events\r\n            charContactEventsEnabled: true,\r\n            vehicleContactEventsEnabled: false,\r\n            contactEventsEnabled: true,\r\n            contactAddedEventsEnabled: true,\r\n            contactPersistedEventsEnabled: false,\r\n            contactRemovedEventsEnabled: true,\r\n            contactPoints: true,\r\n            contactPointsAveraged: true,\r\n            broadPhaseLayers: [ _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_NON_MOVING, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_MOVING ],\r\n            // object layer vs object layer\r\n            objectLayerPairs: [\r\n                [ _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_NON_MOVING, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_MOVING ],\r\n                [ _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_MOVING, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_MOVING ]\r\n            ],\r\n            // which object layer should collide with what broad phase layers\r\n            mapObjectToBroadPhaseLayer: {\r\n                OBJ_LAYER_NON_MOVING: [ _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_MOVING ],\r\n                OBJ_LAYER_MOVING: [ _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_NON_MOVING, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_MOVING ]\r\n            },\r\n            ...data.config\r\n        };\r\n        this._config = config;\r\n        this._time = 0;\r\n\r\n        // Transform filters to bit values\r\n        this._filterLayers = new Map();\r\n        // this._filterToBits(config);\r\n\r\n        // Jolt data\r\n        this.Jolt = null;\r\n        this._joltInterface = null;\r\n        this._physicsSystem = null;\r\n        this._bodyInterface = null;\r\n        this._bpFilter = null;\r\n        this._objFilter = null;\r\n        this._bodyFilter = null;\r\n        this._shapeFilter = null;\r\n        this._bodyList = null;\r\n        this._groupFilterTables = [];\r\n\r\n        const loadJolt = async () => {\r\n            const module = await import(/* webpackIgnore: true */ data.glueUrl);\r\n            module.default({\r\n                locateFile: () => {\r\n                    return data.wasmUrl;\r\n                }\r\n            }).then(Jolt => {\r\n                this.Jolt = Jolt;\r\n\r\n                // Util\r\n                (0,_physics_math_mjs__WEBPACK_IMPORTED_MODULE_3__.extendJoltMath)(Jolt);\r\n\r\n                // Physics operators\r\n                this._creator = new _operators_creator_mjs__WEBPACK_IMPORTED_MODULE_6__.Creator(this);\r\n                this._modifier = new _operators_modifier_mjs__WEBPACK_IMPORTED_MODULE_9__.Modifier(this);\r\n                this._cleaner = new _operators_cleaner_mjs__WEBPACK_IMPORTED_MODULE_5__.Cleaner(this);\r\n                this._querier = new _operators_querier_mjs__WEBPACK_IMPORTED_MODULE_10__.Querier(this);\r\n                this._tracker = new _operators_tracker_mjs__WEBPACK_IMPORTED_MODULE_11__.Tracker(Jolt);\r\n                this._drawer = new _operators_drawer_mjs__WEBPACK_IMPORTED_MODULE_7__.Drawer(Jolt);\r\n                \r\n                const listener = new _operators_listener_mjs__WEBPACK_IMPORTED_MODULE_8__.Listener(this);\r\n\r\n                if (config.contactEventsEnabled) {\r\n                    listener.initEvents(config);\r\n                }\r\n\r\n                this._listener = listener;\r\n\r\n                this._outBuffer = new _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__.CommandsBuffer({ ...this._config, commandsBufferSize: 2000 });\r\n\r\n                this._stepTime = 0;\r\n                this._steps = 0;\r\n\r\n                this._responseMessage = {\r\n                    buffer: null,\r\n                    inBuffer: null,\r\n                    softBodies: [],\r\n                    origin: 'physics-worker'\r\n                };\r\n\r\n                this._dispatcher = messenger;\r\n                this._inBuffer = null;\r\n                this._fatalError = false;\r\n\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n                    this._perfIndex = null;\r\n                }\r\n\r\n                this._exposeConstants();\r\n            });\r\n        }\r\n        loadJolt();\r\n    }\r\n\r\n    set joltInterface(joltInterface) {\r\n        this._joltInterface = joltInterface;\r\n    }\r\n\r\n    get joltInterface() {\r\n        return this._joltInterface;\r\n    }\r\n\r\n    get physicsSystem() {\r\n        return this._physicsSystem;\r\n    }\r\n    set physicsSystem(system) {\r\n        this._physicsSystem = system;\r\n        this._bodyInterface = system.GetBodyInterface();\r\n    }\r\n\r\n    get groupFilterTables() {\r\n        return this._groupFilterTables;\r\n    }\r\n\r\n    get bodyInterface() {\r\n        return this._bodyInterface;\r\n    }\r\n\r\n    get inBuffer() {\r\n        return this._inBuffer;\r\n    }\r\n\r\n    get outBuffer() {\r\n        return this._outBuffer;\r\n    }\r\n\r\n    get config() {\r\n        return this._config;\r\n    }\r\n\r\n    get tracker() {\r\n        return this._tracker;\r\n    }\r\n\r\n    get creator() {\r\n        return this._creator;\r\n    }\r\n\r\n    get listener() {\r\n        return this._listener;\r\n    }\r\n\r\n    get querier() {\r\n        return this._querier;\r\n    }\r\n\r\n    get bpFilter() {\r\n        return this._bpFilter;\r\n    }\r\n\r\n    set bpFilter(filter) {\r\n        this._bpFilter = filter;\r\n    }\r\n\r\n    get objFilter() {\r\n        return this._objFilter;\r\n    }\r\n\r\n    set objFilter(filter) {\r\n        this._objFilter = filter;\r\n    }\r\n\r\n    get bodyFilter() {\r\n        return this._bodyFilter;\r\n    }\r\n\r\n    set bodyFilter(filter) {\r\n        this._bodyFilter = filter;\r\n    }\r\n\r\n    get shapeFilter() {\r\n        return this._shapeFilter;\r\n    }\r\n\r\n    set shapeFilter(filter) {\r\n        this._shapeFilter = filter;\r\n    }\r\n\r\n    get bodyList() {\r\n        return this._bodyList;\r\n    }\r\n\r\n    set bodyList(list) {\r\n        this._bodyList = list;\r\n    }\r\n\r\n    step(data) {\r\n        if (this._fatalError) return;\r\n        \r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            this._stepTime = performance.now();\r\n            this._perfIndex = data.perfIndex;\r\n        }\r\n        \r\n        const { buffer, meshBuffers, dt } = data;\r\n        const outBuffer = this._outBuffer;\r\n        let inBuffer = this._inBuffer;\r\n\r\n        if (data.inBuffer) {\r\n            outBuffer.buffer = data.inBuffer;\r\n        }\r\n\r\n        let ok = true;\r\n        if (buffer) {\r\n            if (!inBuffer) {\r\n                inBuffer = this._inBuffer = new _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__.CommandsBuffer();\r\n            }\r\n            \r\n            inBuffer.buffer = buffer;\r\n\r\n            // If commands buffer is provided, then execute commands, before stepping\r\n            try {\r\n                ok = ok && this._executeCommands(meshBuffers);\r\n            } catch (e) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n                ok = false;\r\n            }\r\n        }\r\n\r\n        if (!inBuffer) {\r\n            // The physics world is empty, as no commands were ever received yet,\r\n            // so nothing to report and no reason to step the physics.\r\n            return;\r\n        }\r\n\r\n        // potentially step physics system, update motion states\r\n        ok = ok && this._stepPhysics(dt);\r\n\r\n        // write the collected contact events\r\n        this._listener.write(outBuffer);\r\n\r\n        // write dynamic transforms to update entities\r\n        ok = ok && this._writeIsometry(outBuffer);\r\n\r\n        // write virtual characters state\r\n        ok = ok && this._writeCharacters(outBuffer);\r\n\r\n        // write debug draw data\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            // Write debug draw data\r\n            ok = ok && this._drawer.write(this._tracker);\r\n        }     \r\n\r\n        // report sim results to frontend\r\n        ok = ok && this._send();\r\n\r\n        if (!ok) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error('Backend fatal error :(');\r\n            this._fatalError = true;\r\n        }\r\n    }\r\n\r\n    overrideContacts(listener, overrides) {\r\n        this._listener.overrideContacts(listener, overrides);\r\n    }\r\n\r\n    getBitValue(name) {\r\n        const layers = this._filterLayers;\r\n\r\n        if (!layers.has(name)) {\r\n            layers.set(name, layers.size ? 1 << layers.size - 1 : 0);\r\n        }\r\n\r\n        return layers.get(name);\r\n    }\r\n\r\n    destroy() {\r\n        const Jolt = this.Jolt;\r\n\r\n        this._creator.destroy();\r\n        this._creator = null;\r\n\r\n        this._modifier.destroy();\r\n        this._modifier = null;\r\n\r\n        this._cleaner.destroy();\r\n        this._cleaner = null;\r\n\r\n        this._querier.destroy();\r\n        this._querier = null;\r\n\r\n        this._tracker.destroy();\r\n        this._tracker = null;\r\n\r\n        this._dispatcher = null;\r\n\r\n        if (this._charUpdateSettings) {\r\n            Jolt.destroy(this._charUpdateSettings);\r\n            this._charUpdateSettings = null;\r\n        }\r\n\r\n        if (this._joltInterface) {\r\n            Jolt.destroy(this._joltInterface);\r\n            this._joltInterface = null;\r\n        }\r\n\r\n        const tables = this._groupFilterTables;\r\n        const len = tables.length;\r\n        if (len > 0) {\r\n            for (let i = 0; i < len; i++) {\r\n                const table = tables[i];\r\n                Jolt.destroy(table);\r\n            }\r\n            tables.length = 0;\r\n        }\r\n\r\n        Jolt.destroy(this._bodyList);\r\n        this._bodyList = null;\r\n\r\n        this._inBuffer?.destroy();\r\n        this._inBuffer = null;\r\n\r\n        this._outBuffer?.destroy();\r\n        this._outBuffer = null;\r\n\r\n        this.Jolt = null;\r\n    }\r\n\r\n    _stepPhysics(dt) {\r\n        const config = this._config;\r\n        const fixedStep = config.fixedStep;\r\n        const subSteps = config.subSteps;\r\n        const jolt = this._joltInterface;\r\n\r\n        let time = this._time;\r\n        let stepped = false;\r\n        let ok = true;\r\n\r\n        time += dt;\r\n\r\n        while (ok && time >= fixedStep) {\r\n            try {\r\n                // update characters before stepping\r\n                ok = this._updateCharacters(fixedStep);\r\n                // step the physics world\r\n                ok && jolt.Step(fixedStep, subSteps);\r\n                this._steps++;\r\n                stepped = true;\r\n            } catch (e) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n                ok = false;\r\n            }\r\n\r\n            time -= fixedStep;\r\n        }\r\n\r\n        if (ok && config.useMotionStates) {\r\n            ok = this._updateMotionStates(time / fixedStep, stepped);\r\n        }\r\n\r\n        this._time = time;\r\n\r\n        return ok;\r\n    }\r\n\r\n    _updateMotionStates(alpha, stepped) {\r\n        const Jolt = this.Jolt;\r\n        const tracker = this._tracker;\r\n        const system = this._physicsSystem;\r\n        const characters = tracker.character;\r\n        const dynamicType = Jolt.EBodyType_RigidBody;\r\n\r\n        // active dynamic and active kinematic\r\n        const numActiveBodies = system.GetNumActiveBodies(dynamicType);\r\n        if (numActiveBodies > 0) {\r\n            const bodyList = this._bodyList;\r\n\r\n            bodyList.clear();\r\n            system.GetActiveBodies(dynamicType, bodyList);\r\n            \r\n            for (let i = 0; i < numActiveBodies; i++) {\r\n                const bodyID = bodyList.at(i);\r\n                const body = system.GetBodyLockInterface().TryGetBody(bodyID);\r\n                if (Jolt.getPointer(body) === 0) {\r\n                    continue;\r\n                }\r\n\r\n                const ms = body.motionState;\r\n                if (ms) {\r\n                    ms.compute(alpha, stepped);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (const char of characters) {\r\n            const ms = char.motionState;\r\n            if (ms) {\r\n                const ok = ms.compute(alpha, stepped);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && !ok) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _updateCharacters(fixedStep) {\r\n        const Jolt = this.Jolt;\r\n        const characters = this._tracker.character;\r\n        if (characters.size === 0) return true;\r\n\r\n        const movingBPFilter = this._bpFilter;\r\n        const movingLayerFilter = this._objFilter;\r\n        const bodyFilter = this._bodyFilter;\r\n        const shapeFilter = this._shapeFilter;\r\n        let updateSettings = this._charUpdateSettings;\r\n\r\n        try {\r\n            if (!updateSettings) {\r\n                updateSettings = this._charUpdateSettings = new Jolt.ExtendedUpdateSettings();\r\n            }\r\n            const allocator = this._joltInterface.GetTempAllocator();\r\n    \r\n            characters.forEach(char => {\r\n                char.ExtendedUpdate(\r\n                    fixedStep,\r\n                    char.GetUp(),\r\n                    updateSettings,\r\n                    movingBPFilter,\r\n                    movingLayerFilter,\r\n                    bodyFilter,\r\n                    shapeFilter,\r\n                    allocator\r\n                );\r\n                char.UpdateGroundVelocity();\r\n            });\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _executeCommands(meshBuffers) {\r\n        const cb = this._inBuffer;\r\n        const creator = this._creator;\r\n        const modifier = this._modifier;\r\n        const querier = this._querier;\r\n        const cleaner = this._cleaner;\r\n        const count = cb.commandsCount;\r\n\r\n        let ok = true;\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const operator = cb.readOperator();\r\n\r\n            switch (operator) {\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_CREATOR:\r\n                    ok = ok && creator.create(meshBuffers);\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_MODIFIER:\r\n                    ok = ok && modifier.modify();\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_QUERIER:\r\n                    ok = ok && querier.query();\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_CLEANER:\r\n                    ok = ok && cleaner.clean();\r\n                    break;\r\n\r\n                default:\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(`Invalid operator: ${ operator }`);\r\n                    return false;\r\n            }\r\n        }\r\n\r\n        // Reset the cursors, so we can start from the buffer beginning on\r\n        // the next step request\r\n        cb.reset();\r\n\r\n        return ok;\r\n    }\r\n\r\n    _writeIsometry(cb) {\r\n        // Report transforms of dynamic bodies and vertex positions of soft bodies\r\n        const Jolt = this.Jolt;\r\n        const system = this._physicsSystem;\r\n        const activeRigidBodiesCount = system.GetNumActiveBodies(Jolt.EBodyType_RigidBody);\r\n        const activeSoftBodiesCount = system.GetNumActiveBodies(Jolt.EBodyType_SoftBody);\r\n\r\n        let ok = true;\r\n\r\n        if (activeRigidBodiesCount > 0) {\r\n            ok = this._writeRigidBodiesIsometry(activeRigidBodiesCount, system, cb);\r\n        }\r\n\r\n        if (activeSoftBodiesCount > 0) {\r\n            ok = ok && this._writeSoftBodiesVertices(activeSoftBodiesCount, system, cb);\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    _writeCharacters(cb) {\r\n        const Jolt = this.Jolt;\r\n        const tracker = this._tracker;\r\n        const characters = tracker.character;\r\n        const count = characters.size;\r\n\r\n        if (count === 0)\r\n            return true;\r\n\r\n        const useMotionStates = this._config.useMotionStates;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.COMPONENT_SYSTEM_CHAR);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CMD_UPDATE_TRANSFORMS);\r\n        cb.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n        try {\r\n            characters.forEach(char => {\r\n                const index = tracker.getPCID(Jolt.getPointer(char));\r\n                const isSupported = char.IsSupported();\r\n                const state = char.GetGroundState();\r\n                const linVel = char.GetLinearVelocity();\r\n                const groundVelocity = char.GetGroundVelocity();\r\n                const groundNormal = char.GetGroundNormal();\r\n                const isTooSteep = char.IsSlopeTooSteep(groundNormal);\r\n\r\n                cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n                const ms = char.motionState;\r\n                if (useMotionStates && ms) {\r\n                    cb.write(ms.position, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                    cb.write(ms.rotation, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                } else {\r\n                    cb.write(char.GetPosition(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(char.GetRotation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n\r\n                cb.write(linVel, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                cb.write(isSupported, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                cb.write(state, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT8, false);\r\n\r\n                if (isSupported) {\r\n                    const groundID = char.GetGroundBodyID();\r\n                    const bodyLockInterface = this._physicsSystem.GetBodyLockInterface();\r\n                    let bodyGround = bodyLockInterface.TryGetBody(groundID);\r\n                    if (Jolt.getPointer(bodyGround) === 0) {\r\n                        bodyGround = null;\r\n                    }\r\n                    cb.write(!!bodyGround, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                    if (bodyGround) {\r\n                        const groundIdx = tracker.getPCID(Jolt.getPointer(bodyGround));\r\n                        cb.write(groundIdx, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n                    }\r\n\r\n                    cb.write(isTooSteep, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                    cb.write(groundVelocity, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(groundNormal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n            });\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _send() {\r\n        const dispatcher = this._dispatcher;\r\n        const msg = this._responseMessage;\r\n        const outBuffer = this._outBuffer;\r\n        const buffer = outBuffer.buffer;\r\n        const drawer = this._drawer;\r\n        const debugDraw = !!(drawer && drawer.dirty);\r\n        const useSAB = this._config.useSAB;\r\n\r\n        outBuffer.reset();\r\n        // this._querier.reset();\r\n        this._listener.reset();\r\n\r\n        if (debugDraw) {\r\n            msg.drawViews = drawer.data;\r\n        } else {\r\n            msg.drawViews = null;\r\n        }\r\n\r\n        msg.buffer = buffer.byteLength > 0 ? buffer : null;\r\n        msg.steps = this._steps;\r\n\r\n        // TODO\r\n        // refactor\r\n\r\n        const buffers = [];\r\n\r\n        // If we are in a web worker, we need to detach the incoming buffer,\r\n        // so it is available for write in main thread\r\n        if (typeof importScripts === 'function') {\r\n            const inBuffer = this._inBuffer;\r\n            const ib = inBuffer.buffer;\r\n            if (ib.byteLength > 0) {\r\n                msg.inBuffer = ib;\r\n                if (!useSAB) {\r\n                    buffers.push(ib);\r\n                }\r\n            } else {\r\n                msg.inBuffer = null;\r\n            }\r\n        }\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            msg.perfIndex = this._perfIndex;\r\n            msg.time = performance.now() - this._stepTime;\r\n        }\r\n\r\n        if (debugDraw) {\r\n            buffers.push(...drawer.buffers);\r\n        }\r\n\r\n        if (!useSAB && buffer.byteLength > 0) {\r\n            buffers.push(buffer);\r\n        }\r\n        \r\n        dispatcher.respond(msg, buffers);\r\n        \r\n        if (debugDraw) {\r\n            drawer.reset();\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    \r\n\r\n    // _filterToBits(config) {\r\n    //     const filterLayers = this._filterLayers;\r\n    //     const pairs = config.layerPairs;\r\n    //     for (let i = 0, end = pairs.length; i < end; i++) {\r\n    //         const pair = pairs[i];\r\n    //         pair[0] = this.getBitValue(pair[0]);\r\n    //         pair[1] = this.getBitValue(pair[1]);\r\n    //     }\r\n\r\n    //     const layers = [];\r\n    //     filterLayers.forEach(key => {\r\n    //         layers.push(key);\r\n    //     });\r\n\r\n    //     config.layers = layers;\r\n    // }\r\n\r\n    _exposeConstants() {\r\n        const Jolt = this.Jolt;\r\n        const dispatcher = this._dispatcher;\r\n        const msg = this._responseMessage;\r\n\r\n        msg.constants = [\r\n            'JOLT_VERSION', jolt_physics_package_json__WEBPACK_IMPORTED_MODULE_0__.version,\r\n\r\n            'JOLT_MOTION_TYPE_STATIC', Jolt.EMotionType_Static,\r\n            'JOLT_MOTION_TYPE_DYNAMIC', Jolt.EMotionType_Dynamic,\r\n            'JOLT_MOTION_TYPE_KINEMATIC', Jolt.EMotionType_Kinematic,\r\n\r\n            'JOLT_OMP_CALCULATE_INERTIA', Jolt.EOverrideMassProperties_CalculateInertia,\r\n            'JOLT_OMP_CALCULATE_MASS_AND_INERTIA', Jolt.EOverrideMassProperties_CalculateMassAndInertia,\r\n            'JOLT_OMP_MASS_AND_INERTIA_PROVIDED', Jolt.EOverrideMassProperties_MassAndInertiaProvided,\r\n\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_X', Jolt.EAllowedDOFs_TranslationX,\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_Y', Jolt.EAllowedDOFs_TranslationY,\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_Z', Jolt.EAllowedDOFs_TranslationZ,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_X', Jolt.EAllowedDOFs_RotationX,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_Y', Jolt.EAllowedDOFs_RotationY,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_Z', Jolt.EAllowedDOFs_RotationZ,\r\n            'JOLT_ALLOWED_DOFS_PLANE_2D', Jolt.EAllowedDOFs_Plane2D,\r\n            'JOLT_ALLOWED_DOFS_ALL', Jolt.EAllowedDOFs_All,\r\n\r\n            'JOLT_MOTION_QUALITY_DISCRETE', Jolt.EMotionQuality_Discrete,\r\n            'JOLT_MOTION_QUALITY_LINEAR_CAST', Jolt.EMotionQuality_LinearCast,\r\n\r\n            'JOLT_BFM_IGNORE_BACK_FACES', Jolt.EBackFaceMode_IgnoreBackFaces,\r\n            'JOLT_BFM_COLLIDE_BACK_FACES', Jolt.EBackFaceMode_CollideWithBackFaces,\r\n            \r\n            'JOLT_GROUND_STATE_ON_GROUND', Jolt.EGroundState_OnGround,\r\n            'JOLT_GROUND_STATE_ON_STEEP_GROUND', Jolt.EGroundState_OnSteepGround,\r\n            'JOLT_GROUND_STATE_NOT_SUPPORTED', Jolt.EGroundState_NotSupported,\r\n            'JOLT_GROUND_STATE_IN_AIR', Jolt.EGroundState_InAir,\r\n\r\n            'JOLT_TRANSMISSION_AUTO', Jolt.ETransmissionMode_Auto,\r\n            'JOLT_TRANSMISSION_MANUAL', Jolt.ETransmissionMode_Manual,\r\n\r\n            'JOLT_SPRING_MODE_FREQUENCY', Jolt.ESpringMode_FrequencyAndDamping,\r\n            'JOLT_SPRING_MODE_STIFFNESS', Jolt.ESpringMode_StiffnessAndDamping,\r\n        ];\r\n\r\n        dispatcher.respond(msg, []);\r\n\r\n        msg.constants = null;\r\n    }\r\n\r\n    _writeRigidBodiesIsometry(count, system, cb) {\r\n        const Jolt = this.Jolt;\r\n        const useMotionStates = this._config.useMotionStates;\r\n        const bodyList = this._bodyList;\r\n        const tracker = this._tracker;\r\n\r\n        try {\r\n            bodyList.clear();\r\n            system.GetActiveBodies(Jolt.EBodyType_RigidBody, bodyList);\r\n\r\n            for (let i = 0; i < count; i++) {\r\n                const bodyID = bodyList.at(i);\r\n                const body = system.GetBodyLockInterface().TryGetBody(bodyID);\r\n                const pointer = Jolt.getPointer(body);\r\n                if (pointer === 0) {\r\n                    continue;\r\n                }\r\n\r\n                cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.COMPONENT_SYSTEM_BODY);\r\n                cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CMD_UPDATE_TRANSFORMS);\r\n\r\n                const index = tracker.getPCID(Jolt.getPointer(body));\r\n                cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n                const ms = body.motionState;\r\n                if (useMotionStates && ms) {\r\n                    cb.write(ms.position, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                    cb.write(ms.rotation, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                } else {\r\n                    cb.write(body.GetPosition(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(body.GetRotation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n\r\n                cb.write(body.GetLinearVelocity(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                cb.write(body.GetAngularVelocity(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n\r\n                // If it is a vehicle, write wheels isometry as well\r\n                if (body.isVehicle) {\r\n                    const data = tracker.constraintMap.get(index);\r\n                    const constraint = data.constraint;\r\n                    const wheelsCount = constraint.wheelsCount;\r\n                    const modifier = this._modifier;\r\n\r\n                    const jv1 = modifier.joltVec3_1;\r\n                    const jv2 = modifier.joltVec3_2;\r\n\r\n                    jv1.Set(0, 1, 0);\r\n                    jv2.Set(1, 0, 0);\r\n\r\n                    for (let i = 0; i < wheelsCount; i++) {\r\n                        const transform = constraint.GetWheelLocalTransform(i, jv1, jv2);\r\n\r\n                        cb.write(transform.GetTranslation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                        cb.write(transform.GetRotation().GetQuaternion(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    }\r\n                }\r\n            }\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _writeSoftBodiesVertices(count, system, cb) {\r\n        const Jolt = this.Jolt;\r\n        const bodyList = this._bodyList;\r\n        const tracker = this._tracker;\r\n\r\n        try {\r\n            bodyList.clear();\r\n            system.GetActiveBodies(Jolt.EBodyType_SoftBody, bodyList);\r\n\r\n            for (let i = 0; i < count; i++) {\r\n                const bodyID = bodyList.at(i);\r\n                const body = system.GetBodyLockInterface().TryGetBody(bodyID);\r\n                const pointer = Jolt.getPointer(body);\r\n                if (pointer === 0) {\r\n                    continue;\r\n                }\r\n\r\n                cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.COMPONENT_SYSTEM_SOFT_BODY);\r\n                cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CMD_UPDATE_TRANSFORMS);\r\n\r\n                const index = tracker.getPCID(pointer);\r\n                cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n                const vertices = Jolt.castObject(body.GetMotionProperties(), Jolt.SoftBodyMotionProperties).GetVertices();\r\n                const count = vertices.size();\r\n\r\n                cb.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n                for (let i = 0; i < count; i++) {\r\n                    cb.write(vertices.at(i).mPosition, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9iYWNrZW5kLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWlEO0FBQ2pEO0FBU3FEO0FBQ0w7QUFDUTtBQUNEO0FBQ0w7QUFDQTtBQUNGO0FBQ0k7QUFDQTtBQUNGO0FBQ0E7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsdUZBQW1CLEVBQUUsbUZBQWU7QUFDcEU7QUFDQTtBQUNBLGtCQUFrQix3RkFBb0IsRUFBRSxvRkFBZ0I7QUFDeEQsa0JBQWtCLG9GQUFnQixFQUFFLG9GQUFnQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsbUZBQWU7QUFDdkQsb0NBQW9DLHVGQUFtQixFQUFFLG1GQUFlO0FBQ3hFLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlFQUFjO0FBQzlCO0FBQ0E7QUFDQSxvQ0FBb0MsMkRBQU87QUFDM0MscUNBQXFDLDZEQUFRO0FBQzdDLG9DQUFvQywyREFBTztBQUMzQyxvQ0FBb0MsNERBQU87QUFDM0Msb0NBQW9DLDREQUFPO0FBQzNDLG1DQUFtQyx5REFBTTtBQUN6QztBQUNBLHFDQUFxQyw2REFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxnRUFBYyxHQUFHLDJDQUEyQztBQUNsRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IscURBQUs7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBSztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwwQkFBMEI7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsZ0VBQWM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2QsZ0JBQWdCLHFEQUFLLFFBQVEscURBQUs7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUs7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUssUUFBUSxxREFBSztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsU0FBUztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkLGdCQUFnQixxREFBSyxRQUFRLHFEQUFLO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixxQkFBcUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4RkFBMEI7QUFDM0QsZ0NBQWdDLHlGQUFxQjtBQUNyRDtBQUNBO0FBQ0EsZ0NBQWdDLHVGQUFtQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx1RkFBbUI7QUFDbkQsZ0NBQWdDLFdBQVc7QUFDM0MsdURBQXVELDBGQUFzQjtBQUM3RTtBQUNBO0FBQ0EsVUFBVTtBQUNWLFlBQVkscURBQUssUUFBUSxxREFBSztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUN1QjtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvYmFja2VuZC5tanM/ZDEyNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgam9sdEluZm8gZnJvbSBcImpvbHQtcGh5c2ljcy9wYWNrYWdlLmpzb25cIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgICBCUF9MQVlFUl9NT1ZJTkcsXHJcbiAgICBCUF9MQVlFUl9OT05fTU9WSU5HLFxyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIEJVRkZFUl9XUklURV9VSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UOCwgQlVGRkVSX1dSSVRFX1ZFQzMyLFxyXG4gICAgQ01EX1VQREFURV9UUkFOU0ZPUk1TLCBDT01QT05FTlRfU1lTVEVNX0JPRFksIENPTVBPTkVOVF9TWVNURU1fQ0hBUiwgQ09NUE9ORU5UX1NZU1RFTV9TT0ZUX0JPRFksXHJcbiAgICBPQkpfTEFZRVJfTU9WSU5HLFxyXG4gICAgT0JKX0xBWUVSX05PTl9NT1ZJTkcsXHJcbiAgICBPUEVSQVRPUl9DTEVBTkVSLCBPUEVSQVRPUl9DUkVBVE9SLCBPUEVSQVRPUl9NT0RJRklFUiwgT1BFUkFUT1JfUVVFUklFUlxyXG59IGZyb20gXCIuLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcbmltcG9ydCB7IGV4dGVuZEpvbHRNYXRoIH0gZnJvbSBcIi4uLy4uL3BoeXNpY3MvbWF0aC5tanNcIjtcclxuaW1wb3J0IHsgQ29tbWFuZHNCdWZmZXIgfSBmcm9tIFwiLi9jb21tYW5kcy1idWZmZXIubWpzXCI7XHJcbmltcG9ydCB7IENsZWFuZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvY2xlYW5lci5tanNcIjtcclxuaW1wb3J0IHsgQ3JlYXRvciB9IGZyb20gXCIuL29wZXJhdG9ycy9jcmVhdG9yLm1qc1wiO1xyXG5pbXBvcnQgeyBEcmF3ZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvZHJhd2VyLm1qc1wiO1xyXG5pbXBvcnQgeyBMaXN0ZW5lciB9IGZyb20gXCIuL29wZXJhdG9ycy9saXN0ZW5lci5tanNcIjtcclxuaW1wb3J0IHsgTW9kaWZpZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvbW9kaWZpZXIubWpzXCI7XHJcbmltcG9ydCB7IFF1ZXJpZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvcXVlcmllci5tanNcIjtcclxuaW1wb3J0IHsgVHJhY2tlciB9IGZyb20gXCIuL29wZXJhdG9ycy90cmFja2VyLm1qc1wiO1xyXG5cclxuY2xhc3MgSm9sdEJhY2tlbmQge1xyXG4gICAgY29uc3RydWN0b3IobWVzc2VuZ2VyLCBkYXRhKSB7XHJcbiAgICAgICAgLy8gLy8gVE9ET1xyXG4gICAgICAgIC8vIC8vIGFkZCB3ZWJ3b3JrZXJcclxuICAgICAgICAvLyBpZiAoIXdpbmRvdyB8fCAhd2luZG93LkpvbHQpIHJldHVybjtcclxuXHJcbiAgICAgICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAvLyBQaHlzaWNzIFNldHRpbmdzXHJcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9zdHJ1Y3RfcGh5c2ljc19zZXR0aW5ncy5odG1sXHJcbiAgICAgICAgICAgIGJhdW1nYXJ0ZTogMC4yLFxyXG4gICAgICAgICAgICBib2R5UGFpckNhY2hlQ29zTWF4RGVsdGFSb3RhdGlvbkRpdjI6IDAuOTk5ODQ3Njk1MTU2MzkxMixcclxuICAgICAgICAgICAgYm9keVBhaXJDYWNoZU1heERlbHRhUG9zaXRpb25TcTogTWF0aC5zcXJ0KDAuMDAxKSxcclxuICAgICAgICAgICAgY29udGFjdE5vcm1hbENvc01heERlbHRhUm90YXRpb246IDAuOTk2MTk0Njk4MDkxNzQ1NSxcclxuICAgICAgICAgICAgY29udGFjdFBvaW50UHJlc2VydmVMYW1iZGFNYXhEaXN0U3E6IE1hdGguc3FydCgwLjAxKSxcclxuICAgICAgICAgICAgZGV0ZXJtaW5pc3RpY1NpbXVsYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgIGxpbmVhckNhc3RNYXhQZW5ldHJhdGlvbjogMC4yNSxcclxuICAgICAgICAgICAgbGluZWFyQ2FzdFRocmVzaG9sZDogMC43NSxcclxuICAgICAgICAgICAgbWFuaWZvbGRUb2xlcmFuY2VTcTogMS4wZS02LFxyXG4gICAgICAgICAgICBtYXhJbkZsaWdodEJvZHlQYWlyczogMTYzODQsXHJcbiAgICAgICAgICAgIG1heFBlbmV0cmF0aW9uRGlzdGFuY2U6IDAuMixcclxuICAgICAgICAgICAgbWluVmVsb2NpdHlGb3JSZXN0aXR1dGlvbjogMSxcclxuICAgICAgICAgICAgbnVtUG9zaXRpb25TdGVwczogMixcclxuICAgICAgICAgICAgbnVtVmVsb2NpdHlTdGVwczogMTAsXHJcbiAgICAgICAgICAgIHBlbmV0cmF0aW9uU2xvcDogMC4wMixcclxuICAgICAgICAgICAgcG9pbnRWZWxvY2l0eVNsZWVwVGhyZXNob2xkOiAwLjAzLFxyXG4gICAgICAgICAgICBzcGVjdWxhdGl2ZUNvbnRhY3REaXN0YW5jZTogMC4wMixcclxuICAgICAgICAgICAgc3RlcExpc3RlbmVyQmF0Y2hlc1BlckpvYjogMSxcclxuICAgICAgICAgICAgc3RlcExpc3RlbmVyc0JhdGNoU2l6ZTogOCxcclxuICAgICAgICAgICAgdGltZUJlZm9yZVNsZWVwOiAwLjUsXHJcbiAgICAgICAgICAgIC8vIGZvciBkZWJ1Z2dpbmdcclxuICAgICAgICAgICAgY29uc3RyYWludFdhcm1TdGFydDogdHJ1ZSxcclxuICAgICAgICAgICAgdXNlQm9keVBhaXJDb250YWN0Q2FjaGU6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZU1hbmlmb2xkUmVkdWN0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB1c2VMYXJnZUlzbGFuZFNwbGl0dGVyOiB0cnVlLFxyXG4gICAgICAgICAgICBhbGxvd1NsZWVwaW5nOiB0cnVlLFxyXG4gICAgICAgICAgICBjaGVja0FjdGl2ZUVkZ2VzOiB0cnVlLFxyXG4gICAgICAgICAgICAvLyBjb250YWN0IGV2ZW50c1xyXG4gICAgICAgICAgICBjaGFyQ29udGFjdEV2ZW50c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIHZlaGljbGVDb250YWN0RXZlbnRzRW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbnRhY3RFdmVudHNFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250YWN0QWRkZWRFdmVudHNFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250YWN0UGVyc2lzdGVkRXZlbnRzRW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbnRhY3RSZW1vdmVkRXZlbnRzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgICAgY29udGFjdFBvaW50czogdHJ1ZSxcclxuICAgICAgICAgICAgY29udGFjdFBvaW50c0F2ZXJhZ2VkOiB0cnVlLFxyXG4gICAgICAgICAgICBicm9hZFBoYXNlTGF5ZXJzOiBbIEJQX0xBWUVSX05PTl9NT1ZJTkcsIEJQX0xBWUVSX01PVklORyBdLFxyXG4gICAgICAgICAgICAvLyBvYmplY3QgbGF5ZXIgdnMgb2JqZWN0IGxheWVyXHJcbiAgICAgICAgICAgIG9iamVjdExheWVyUGFpcnM6IFtcclxuICAgICAgICAgICAgICAgIFsgT0JKX0xBWUVSX05PTl9NT1ZJTkcsIE9CSl9MQVlFUl9NT1ZJTkcgXSxcclxuICAgICAgICAgICAgICAgIFsgT0JKX0xBWUVSX01PVklORywgT0JKX0xBWUVSX01PVklORyBdXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIC8vIHdoaWNoIG9iamVjdCBsYXllciBzaG91bGQgY29sbGlkZSB3aXRoIHdoYXQgYnJvYWQgcGhhc2UgbGF5ZXJzXHJcbiAgICAgICAgICAgIG1hcE9iamVjdFRvQnJvYWRQaGFzZUxheWVyOiB7XHJcbiAgICAgICAgICAgICAgICBPQkpfTEFZRVJfTk9OX01PVklORzogWyBCUF9MQVlFUl9NT1ZJTkcgXSxcclxuICAgICAgICAgICAgICAgIE9CSl9MQVlFUl9NT1ZJTkc6IFsgQlBfTEFZRVJfTk9OX01PVklORywgQlBfTEFZRVJfTU9WSU5HIF1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLi4uZGF0YS5jb25maWdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLl90aW1lID0gMDtcclxuXHJcbiAgICAgICAgLy8gVHJhbnNmb3JtIGZpbHRlcnMgdG8gYml0IHZhbHVlc1xyXG4gICAgICAgIHRoaXMuX2ZpbHRlckxheWVycyA9IG5ldyBNYXAoKTtcclxuICAgICAgICAvLyB0aGlzLl9maWx0ZXJUb0JpdHMoY29uZmlnKTtcclxuXHJcbiAgICAgICAgLy8gSm9sdCBkYXRhXHJcbiAgICAgICAgdGhpcy5Kb2x0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9qb2x0SW50ZXJmYWNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9waHlzaWNzU3lzdGVtID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9ib2R5SW50ZXJmYWNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9icEZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fb2JqRmlsdGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9ib2R5RmlsdGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9zaGFwZUZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fYm9keUxpc3QgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2dyb3VwRmlsdGVyVGFibGVzID0gW107XHJcblxyXG4gICAgICAgIGNvbnN0IGxvYWRKb2x0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2R1bGUgPSBhd2FpdCBpbXBvcnQoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyBkYXRhLmdsdWVVcmwpO1xyXG4gICAgICAgICAgICBtb2R1bGUuZGVmYXVsdCh7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGVGaWxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEud2FzbVVybDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbihKb2x0ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuSm9sdCA9IEpvbHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXRpbFxyXG4gICAgICAgICAgICAgICAgZXh0ZW5kSm9sdE1hdGgoSm9sdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGh5c2ljcyBvcGVyYXRvcnNcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0b3IgPSBuZXcgQ3JlYXRvcih0aGlzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vZGlmaWVyID0gbmV3IE1vZGlmaWVyKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2xlYW5lciA9IG5ldyBDbGVhbmVyKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcXVlcmllciA9IG5ldyBRdWVyaWVyKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhY2tlciA9IG5ldyBUcmFja2VyKEpvbHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZHJhd2VyID0gbmV3IERyYXdlcihKb2x0KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgTGlzdGVuZXIodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5jb250YWN0RXZlbnRzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmluaXRFdmVudHMoY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lciA9IGxpc3RlbmVyO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX291dEJ1ZmZlciA9IG5ldyBDb21tYW5kc0J1ZmZlcih7IC4uLnRoaXMuX2NvbmZpZywgY29tbWFuZHNCdWZmZXJTaXplOiAyMDAwIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBUaW1lID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZU1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGluQnVmZmVyOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvZnRCb2RpZXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbjogJ3BoeXNpY3Mtd29ya2VyJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyID0gbWVzc2VuZ2VyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5CdWZmZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZmF0YWxFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZXJmSW5kZXggPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2V4cG9zZUNvbnN0YW50cygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9hZEpvbHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgam9sdEludGVyZmFjZShqb2x0SW50ZXJmYWNlKSB7XHJcbiAgICAgICAgdGhpcy5fam9sdEludGVyZmFjZSA9IGpvbHRJbnRlcmZhY2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGpvbHRJbnRlcmZhY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvbHRJbnRlcmZhY2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHBoeXNpY3NTeXN0ZW0oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BoeXNpY3NTeXN0ZW07XHJcbiAgICB9XHJcbiAgICBzZXQgcGh5c2ljc1N5c3RlbShzeXN0ZW0pIHtcclxuICAgICAgICB0aGlzLl9waHlzaWNzU3lzdGVtID0gc3lzdGVtO1xyXG4gICAgICAgIHRoaXMuX2JvZHlJbnRlcmZhY2UgPSBzeXN0ZW0uR2V0Qm9keUludGVyZmFjZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBncm91cEZpbHRlclRhYmxlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBGaWx0ZXJUYWJsZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJvZHlJbnRlcmZhY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JvZHlJbnRlcmZhY2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGluQnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbkJ1ZmZlcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3V0QnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbmZpZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0cmFja2VyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90cmFja2VyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjcmVhdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBsaXN0ZW5lcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHF1ZXJpZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJpZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJwRmlsdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9icEZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYnBGaWx0ZXIoZmlsdGVyKSB7XHJcbiAgICAgICAgdGhpcy5fYnBGaWx0ZXIgPSBmaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG9iakZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb2JqRmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBvYmpGaWx0ZXIoZmlsdGVyKSB7XHJcbiAgICAgICAgdGhpcy5fb2JqRmlsdGVyID0gZmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib2R5RmlsdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ib2R5RmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBib2R5RmlsdGVyKGZpbHRlcikge1xyXG4gICAgICAgIHRoaXMuX2JvZHlGaWx0ZXIgPSBmaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNoYXBlRmlsdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zaGFwZUZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc2hhcGVGaWx0ZXIoZmlsdGVyKSB7XHJcbiAgICAgICAgdGhpcy5fc2hhcGVGaWx0ZXIgPSBmaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJvZHlMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ib2R5TGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYm9keUxpc3QobGlzdCkge1xyXG4gICAgICAgIHRoaXMuX2JvZHlMaXN0ID0gbGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBzdGVwKGRhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy5fZmF0YWxFcnJvcikgcmV0dXJuO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RlcFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICAgICAgdGhpcy5fcGVyZkluZGV4ID0gZGF0YS5wZXJmSW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHsgYnVmZmVyLCBtZXNoQnVmZmVycywgZHQgfSA9IGRhdGE7XHJcbiAgICAgICAgY29uc3Qgb3V0QnVmZmVyID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGxldCBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyO1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5pbkJ1ZmZlcikge1xyXG4gICAgICAgICAgICBvdXRCdWZmZXIuYnVmZmVyID0gZGF0YS5pbkJ1ZmZlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgaWYgKGJ1ZmZlcikge1xyXG4gICAgICAgICAgICBpZiAoIWluQnVmZmVyKSB7XHJcbiAgICAgICAgICAgICAgICBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyID0gbmV3IENvbW1hbmRzQnVmZmVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGluQnVmZmVyLmJ1ZmZlciA9IGJ1ZmZlcjtcclxuXHJcbiAgICAgICAgICAgIC8vIElmIGNvbW1hbmRzIGJ1ZmZlciBpcyBwcm92aWRlZCwgdGhlbiBleGVjdXRlIGNvbW1hbmRzLCBiZWZvcmUgc3RlcHBpbmdcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgdGhpcy5fZXhlY3V0ZUNvbW1hbmRzKG1lc2hCdWZmZXJzKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFpbkJ1ZmZlcikge1xyXG4gICAgICAgICAgICAvLyBUaGUgcGh5c2ljcyB3b3JsZCBpcyBlbXB0eSwgYXMgbm8gY29tbWFuZHMgd2VyZSBldmVyIHJlY2VpdmVkIHlldCxcclxuICAgICAgICAgICAgLy8gc28gbm90aGluZyB0byByZXBvcnQgYW5kIG5vIHJlYXNvbiB0byBzdGVwIHRoZSBwaHlzaWNzLlxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBwb3RlbnRpYWxseSBzdGVwIHBoeXNpY3Mgc3lzdGVtLCB1cGRhdGUgbW90aW9uIHN0YXRlc1xyXG4gICAgICAgIG9rID0gb2sgJiYgdGhpcy5fc3RlcFBoeXNpY3MoZHQpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSB0aGUgY29sbGVjdGVkIGNvbnRhY3QgZXZlbnRzXHJcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIud3JpdGUob3V0QnVmZmVyKTtcclxuXHJcbiAgICAgICAgLy8gd3JpdGUgZHluYW1pYyB0cmFuc2Zvcm1zIHRvIHVwZGF0ZSBlbnRpdGllc1xyXG4gICAgICAgIG9rID0gb2sgJiYgdGhpcy5fd3JpdGVJc29tZXRyeShvdXRCdWZmZXIpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSB2aXJ0dWFsIGNoYXJhY3RlcnMgc3RhdGVcclxuICAgICAgICBvayA9IG9rICYmIHRoaXMuX3dyaXRlQ2hhcmFjdGVycyhvdXRCdWZmZXIpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSBkZWJ1ZyBkcmF3IGRhdGFcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIC8vIFdyaXRlIGRlYnVnIGRyYXcgZGF0YVxyXG4gICAgICAgICAgICBvayA9IG9rICYmIHRoaXMuX2RyYXdlci53cml0ZSh0aGlzLl90cmFja2VyKTtcclxuICAgICAgICB9ICAgICBcclxuXHJcbiAgICAgICAgLy8gcmVwb3J0IHNpbSByZXN1bHRzIHRvIGZyb250ZW5kXHJcbiAgICAgICAgb2sgPSBvayAmJiB0aGlzLl9zZW5kKCk7XHJcblxyXG4gICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKCdCYWNrZW5kIGZhdGFsIGVycm9yIDooJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZhdGFsRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZUNvbnRhY3RzKGxpc3RlbmVyLCBvdmVycmlkZXMpIHtcclxuICAgICAgICB0aGlzLl9saXN0ZW5lci5vdmVycmlkZUNvbnRhY3RzKGxpc3RlbmVyLCBvdmVycmlkZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJpdFZhbHVlKG5hbWUpIHtcclxuICAgICAgICBjb25zdCBsYXllcnMgPSB0aGlzLl9maWx0ZXJMYXllcnM7XHJcblxyXG4gICAgICAgIGlmICghbGF5ZXJzLmhhcyhuYW1lKSkge1xyXG4gICAgICAgICAgICBsYXllcnMuc2V0KG5hbWUsIGxheWVycy5zaXplID8gMSA8PCBsYXllcnMuc2l6ZSAtIDEgOiAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBsYXllcnMuZ2V0KG5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuSm9sdDtcclxuXHJcbiAgICAgICAgdGhpcy5fY3JlYXRvci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fY3JlYXRvciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX21vZGlmaWVyLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9tb2RpZmllciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2NsZWFuZXIuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuX2NsZWFuZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9xdWVyaWVyLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9xdWVyaWVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fdHJhY2tlci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fdHJhY2tlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2hhclVwZGF0ZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9jaGFyVXBkYXRlU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFyVXBkYXRlU2V0dGluZ3MgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2pvbHRJbnRlcmZhY2UpIHtcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRJbnRlcmZhY2UpO1xyXG4gICAgICAgICAgICB0aGlzLl9qb2x0SW50ZXJmYWNlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRhYmxlcyA9IHRoaXMuX2dyb3VwRmlsdGVyVGFibGVzO1xyXG4gICAgICAgIGNvbnN0IGxlbiA9IHRhYmxlcy5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGxlbiA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGFibGUgPSB0YWJsZXNbaV07XHJcbiAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kodGFibGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRhYmxlcy5sZW5ndGggPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2JvZHlMaXN0KTtcclxuICAgICAgICB0aGlzLl9ib2R5TGlzdCA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2luQnVmZmVyPy5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5faW5CdWZmZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9vdXRCdWZmZXI/LmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9vdXRCdWZmZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLkpvbHQgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIF9zdGVwUGh5c2ljcyhkdCkge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuX2NvbmZpZztcclxuICAgICAgICBjb25zdCBmaXhlZFN0ZXAgPSBjb25maWcuZml4ZWRTdGVwO1xyXG4gICAgICAgIGNvbnN0IHN1YlN0ZXBzID0gY29uZmlnLnN1YlN0ZXBzO1xyXG4gICAgICAgIGNvbnN0IGpvbHQgPSB0aGlzLl9qb2x0SW50ZXJmYWNlO1xyXG5cclxuICAgICAgICBsZXQgdGltZSA9IHRoaXMuX3RpbWU7XHJcbiAgICAgICAgbGV0IHN0ZXBwZWQgPSBmYWxzZTtcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG5cclxuICAgICAgICB0aW1lICs9IGR0O1xyXG5cclxuICAgICAgICB3aGlsZSAob2sgJiYgdGltZSA+PSBmaXhlZFN0ZXApIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBjaGFyYWN0ZXJzIGJlZm9yZSBzdGVwcGluZ1xyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl91cGRhdGVDaGFyYWN0ZXJzKGZpeGVkU3RlcCk7XHJcbiAgICAgICAgICAgICAgICAvLyBzdGVwIHRoZSBwaHlzaWNzIHdvcmxkXHJcbiAgICAgICAgICAgICAgICBvayAmJiBqb2x0LlN0ZXAoZml4ZWRTdGVwLCBzdWJTdGVwcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGVwcysrO1xyXG4gICAgICAgICAgICAgICAgc3RlcHBlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgICAgIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRpbWUgLT0gZml4ZWRTdGVwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9rICYmIGNvbmZpZy51c2VNb3Rpb25TdGF0ZXMpIHtcclxuICAgICAgICAgICAgb2sgPSB0aGlzLl91cGRhdGVNb3Rpb25TdGF0ZXModGltZSAvIGZpeGVkU3RlcCwgc3RlcHBlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl90aW1lID0gdGltZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIF91cGRhdGVNb3Rpb25TdGF0ZXMoYWxwaGEsIHN0ZXBwZWQpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSB0aGlzLl90cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuX3BoeXNpY3NTeXN0ZW07XHJcbiAgICAgICAgY29uc3QgY2hhcmFjdGVycyA9IHRyYWNrZXIuY2hhcmFjdGVyO1xyXG4gICAgICAgIGNvbnN0IGR5bmFtaWNUeXBlID0gSm9sdC5FQm9keVR5cGVfUmlnaWRCb2R5O1xyXG5cclxuICAgICAgICAvLyBhY3RpdmUgZHluYW1pYyBhbmQgYWN0aXZlIGtpbmVtYXRpY1xyXG4gICAgICAgIGNvbnN0IG51bUFjdGl2ZUJvZGllcyA9IHN5c3RlbS5HZXROdW1BY3RpdmVCb2RpZXMoZHluYW1pY1R5cGUpO1xyXG4gICAgICAgIGlmIChudW1BY3RpdmVCb2RpZXMgPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHlMaXN0ID0gdGhpcy5fYm9keUxpc3Q7XHJcblxyXG4gICAgICAgICAgICBib2R5TGlzdC5jbGVhcigpO1xyXG4gICAgICAgICAgICBzeXN0ZW0uR2V0QWN0aXZlQm9kaWVzKGR5bmFtaWNUeXBlLCBib2R5TGlzdCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUFjdGl2ZUJvZGllczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBib2R5SUQgPSBib2R5TGlzdC5hdChpKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBzeXN0ZW0uR2V0Qm9keUxvY2tJbnRlcmZhY2UoKS5UcnlHZXRCb2R5KGJvZHlJRCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSm9sdC5nZXRQb2ludGVyKGJvZHkpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbXMgPSBib2R5Lm1vdGlvblN0YXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbXMuY29tcHV0ZShhbHBoYSwgc3RlcHBlZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgY2hhciBvZiBjaGFyYWN0ZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1zID0gY2hhci5tb3Rpb25TdGF0ZTtcclxuICAgICAgICAgICAgaWYgKG1zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvayA9IG1zLmNvbXB1dGUoYWxwaGEsIHN0ZXBwZWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhb2spIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF91cGRhdGVDaGFyYWN0ZXJzKGZpeGVkU3RlcCkge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgY2hhcmFjdGVycyA9IHRoaXMuX3RyYWNrZXIuY2hhcmFjdGVyO1xyXG4gICAgICAgIGlmIChjaGFyYWN0ZXJzLnNpemUgPT09IDApIHJldHVybiB0cnVlO1xyXG5cclxuICAgICAgICBjb25zdCBtb3ZpbmdCUEZpbHRlciA9IHRoaXMuX2JwRmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IG1vdmluZ0xheWVyRmlsdGVyID0gdGhpcy5fb2JqRmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IGJvZHlGaWx0ZXIgPSB0aGlzLl9ib2R5RmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IHNoYXBlRmlsdGVyID0gdGhpcy5fc2hhcGVGaWx0ZXI7XHJcbiAgICAgICAgbGV0IHVwZGF0ZVNldHRpbmdzID0gdGhpcy5fY2hhclVwZGF0ZVNldHRpbmdzO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXVwZGF0ZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVTZXR0aW5ncyA9IHRoaXMuX2NoYXJVcGRhdGVTZXR0aW5ncyA9IG5ldyBKb2x0LkV4dGVuZGVkVXBkYXRlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBhbGxvY2F0b3IgPSB0aGlzLl9qb2x0SW50ZXJmYWNlLkdldFRlbXBBbGxvY2F0b3IoKTtcclxuICAgIFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXJzLmZvckVhY2goY2hhciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjaGFyLkV4dGVuZGVkVXBkYXRlKFxyXG4gICAgICAgICAgICAgICAgICAgIGZpeGVkU3RlcCxcclxuICAgICAgICAgICAgICAgICAgICBjaGFyLkdldFVwKCksXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2V0dGluZ3MsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92aW5nQlBGaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92aW5nTGF5ZXJGaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgYm9keUZpbHRlcixcclxuICAgICAgICAgICAgICAgICAgICBzaGFwZUZpbHRlcixcclxuICAgICAgICAgICAgICAgICAgICBhbGxvY2F0b3JcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBjaGFyLlVwZGF0ZUdyb3VuZFZlbG9jaXR5KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfZXhlY3V0ZUNvbW1hbmRzKG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjcmVhdG9yID0gdGhpcy5fY3JlYXRvcjtcclxuICAgICAgICBjb25zdCBtb2RpZmllciA9IHRoaXMuX21vZGlmaWVyO1xyXG4gICAgICAgIGNvbnN0IHF1ZXJpZXIgPSB0aGlzLl9xdWVyaWVyO1xyXG4gICAgICAgIGNvbnN0IGNsZWFuZXIgPSB0aGlzLl9jbGVhbmVyO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gY2IuY29tbWFuZHNDb3VudDtcclxuXHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yID0gY2IucmVhZE9wZXJhdG9yKCk7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIE9QRVJBVE9SX0NSRUFUT1I6XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBjcmVhdG9yLmNyZWF0ZShtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBPUEVSQVRPUl9NT0RJRklFUjpcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIG1vZGlmaWVyLm1vZGlmeSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgT1BFUkFUT1JfUVVFUklFUjpcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIHF1ZXJpZXIucXVlcnkoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIE9QRVJBVE9SX0NMRUFORVI6XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBjbGVhbmVyLmNsZWFuKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYEludmFsaWQgb3BlcmF0b3I6ICR7IG9wZXJhdG9yIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJlc2V0IHRoZSBjdXJzb3JzLCBzbyB3ZSBjYW4gc3RhcnQgZnJvbSB0aGUgYnVmZmVyIGJlZ2lubmluZyBvblxyXG4gICAgICAgIC8vIHRoZSBuZXh0IHN0ZXAgcmVxdWVzdFxyXG4gICAgICAgIGNiLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVJc29tZXRyeShjYikge1xyXG4gICAgICAgIC8vIFJlcG9ydCB0cmFuc2Zvcm1zIG9mIGR5bmFtaWMgYm9kaWVzIGFuZCB2ZXJ0ZXggcG9zaXRpb25zIG9mIHNvZnQgYm9kaWVzXHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuSm9sdDtcclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLl9waHlzaWNzU3lzdGVtO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZVJpZ2lkQm9kaWVzQ291bnQgPSBzeXN0ZW0uR2V0TnVtQWN0aXZlQm9kaWVzKEpvbHQuRUJvZHlUeXBlX1JpZ2lkQm9keSk7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlU29mdEJvZGllc0NvdW50ID0gc3lzdGVtLkdldE51bUFjdGl2ZUJvZGllcyhKb2x0LkVCb2R5VHlwZV9Tb2Z0Qm9keSk7XHJcblxyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVSaWdpZEJvZGllc0NvdW50ID4gMCkge1xyXG4gICAgICAgICAgICBvayA9IHRoaXMuX3dyaXRlUmlnaWRCb2RpZXNJc29tZXRyeShhY3RpdmVSaWdpZEJvZGllc0NvdW50LCBzeXN0ZW0sIGNiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVTb2Z0Qm9kaWVzQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgdGhpcy5fd3JpdGVTb2Z0Qm9kaWVzVmVydGljZXMoYWN0aXZlU29mdEJvZGllc0NvdW50LCBzeXN0ZW0sIGNiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDaGFyYWN0ZXJzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuSm9sdDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gdGhpcy5fdHJhY2tlcjtcclxuICAgICAgICBjb25zdCBjaGFyYWN0ZXJzID0gdHJhY2tlci5jaGFyYWN0ZXI7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBjaGFyYWN0ZXJzLnNpemU7XHJcblxyXG4gICAgICAgIGlmIChjb3VudCA9PT0gMClcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZU1vdGlvblN0YXRlcyA9IHRoaXMuX2NvbmZpZy51c2VNb3Rpb25TdGF0ZXM7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoQ09NUE9ORU5UX1NZU1RFTV9DSEFSKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX1VQREFURV9UUkFOU0ZPUk1TKTtcclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXJzLmZvckVhY2goY2hhciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoY2hhcikpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNTdXBwb3J0ZWQgPSBjaGFyLklzU3VwcG9ydGVkKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGNoYXIuR2V0R3JvdW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpblZlbCA9IGNoYXIuR2V0TGluZWFyVmVsb2NpdHkoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZFZlbG9jaXR5ID0gY2hhci5HZXRHcm91bmRWZWxvY2l0eSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdW5kTm9ybWFsID0gY2hhci5HZXRHcm91bmROb3JtYWwoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzVG9vU3RlZXAgPSBjaGFyLklzU2xvcGVUb29TdGVlcChncm91bmROb3JtYWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbXMgPSBjaGFyLm1vdGlvblN0YXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZU1vdGlvblN0YXRlcyAmJiBtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKG1zLnBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShtcy5yb3RhdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGNoYXIuR2V0UG9zaXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGNoYXIuR2V0Um90YXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGxpblZlbCwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoaXNTdXBwb3J0ZWQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShzdGF0ZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdW5kSUQgPSBjaGFyLkdldEdyb3VuZEJvZHlJRCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlMb2NrSW50ZXJmYWNlID0gdGhpcy5fcGh5c2ljc1N5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBib2R5R3JvdW5kID0gYm9keUxvY2tJbnRlcmZhY2UuVHJ5R2V0Qm9keShncm91bmRJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihib2R5R3JvdW5kKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5R3JvdW5kID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoISFib2R5R3JvdW5kLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChib2R5R3JvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZElkeCA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoYm9keUdyb3VuZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShncm91bmRJZHgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGlzVG9vU3RlZXAsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZ3JvdW5kVmVsb2NpdHksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShncm91bmROb3JtYWwsIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9zZW5kKCkge1xyXG4gICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9kaXNwYXRjaGVyO1xyXG4gICAgICAgIGNvbnN0IG1zZyA9IHRoaXMuX3Jlc3BvbnNlTWVzc2FnZTtcclxuICAgICAgICBjb25zdCBvdXRCdWZmZXIgPSB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gb3V0QnVmZmVyLmJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBkcmF3ZXIgPSB0aGlzLl9kcmF3ZXI7XHJcbiAgICAgICAgY29uc3QgZGVidWdEcmF3ID0gISEoZHJhd2VyICYmIGRyYXdlci5kaXJ0eSk7XHJcbiAgICAgICAgY29uc3QgdXNlU0FCID0gdGhpcy5fY29uZmlnLnVzZVNBQjtcclxuXHJcbiAgICAgICAgb3V0QnVmZmVyLnJlc2V0KCk7XHJcbiAgICAgICAgLy8gdGhpcy5fcXVlcmllci5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMuX2xpc3RlbmVyLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIGlmIChkZWJ1Z0RyYXcpIHtcclxuICAgICAgICAgICAgbXNnLmRyYXdWaWV3cyA9IGRyYXdlci5kYXRhO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1zZy5kcmF3Vmlld3MgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbXNnLmJ1ZmZlciA9IGJ1ZmZlci5ieXRlTGVuZ3RoID4gMCA/IGJ1ZmZlciA6IG51bGw7XHJcbiAgICAgICAgbXNnLnN0ZXBzID0gdGhpcy5fc3RlcHM7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyByZWZhY3RvclxyXG5cclxuICAgICAgICBjb25zdCBidWZmZXJzID0gW107XHJcblxyXG4gICAgICAgIC8vIElmIHdlIGFyZSBpbiBhIHdlYiB3b3JrZXIsIHdlIG5lZWQgdG8gZGV0YWNoIHRoZSBpbmNvbWluZyBidWZmZXIsXHJcbiAgICAgICAgLy8gc28gaXQgaXMgYXZhaWxhYmxlIGZvciB3cml0ZSBpbiBtYWluIHRocmVhZFxyXG4gICAgICAgIGlmICh0eXBlb2YgaW1wb3J0U2NyaXB0cyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zdCBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyO1xyXG4gICAgICAgICAgICBjb25zdCBpYiA9IGluQnVmZmVyLmJ1ZmZlcjtcclxuICAgICAgICAgICAgaWYgKGliLmJ5dGVMZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBtc2cuaW5CdWZmZXIgPSBpYjtcclxuICAgICAgICAgICAgICAgIGlmICghdXNlU0FCKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVycy5wdXNoKGliKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1zZy5pbkJ1ZmZlciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbXNnLnBlcmZJbmRleCA9IHRoaXMuX3BlcmZJbmRleDtcclxuICAgICAgICAgICAgbXNnLnRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHRoaXMuX3N0ZXBUaW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRlYnVnRHJhdykge1xyXG4gICAgICAgICAgICBidWZmZXJzLnB1c2goLi4uZHJhd2VyLmJ1ZmZlcnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF1c2VTQUIgJiYgYnVmZmVyLmJ5dGVMZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlcnMucHVzaChidWZmZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBkaXNwYXRjaGVyLnJlc3BvbmQobXNnLCBidWZmZXJzKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZGVidWdEcmF3KSB7XHJcbiAgICAgICAgICAgIGRyYXdlci5yZXNldCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgLy8gX2ZpbHRlclRvQml0cyhjb25maWcpIHtcclxuICAgIC8vICAgICBjb25zdCBmaWx0ZXJMYXllcnMgPSB0aGlzLl9maWx0ZXJMYXllcnM7XHJcbiAgICAvLyAgICAgY29uc3QgcGFpcnMgPSBjb25maWcubGF5ZXJQYWlycztcclxuICAgIC8vICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gcGFpcnMubGVuZ3RoOyBpIDwgZW5kOyBpKyspIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgcGFpciA9IHBhaXJzW2ldO1xyXG4gICAgLy8gICAgICAgICBwYWlyWzBdID0gdGhpcy5nZXRCaXRWYWx1ZShwYWlyWzBdKTtcclxuICAgIC8vICAgICAgICAgcGFpclsxXSA9IHRoaXMuZ2V0Qml0VmFsdWUocGFpclsxXSk7XHJcbiAgICAvLyAgICAgfVxyXG5cclxuICAgIC8vICAgICBjb25zdCBsYXllcnMgPSBbXTtcclxuICAgIC8vICAgICBmaWx0ZXJMYXllcnMuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgLy8gICAgICAgICBsYXllcnMucHVzaChrZXkpO1xyXG4gICAgLy8gICAgIH0pO1xyXG5cclxuICAgIC8vICAgICBjb25maWcubGF5ZXJzID0gbGF5ZXJzO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIF9leHBvc2VDb25zdGFudHMoKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuSm9sdDtcclxuICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fZGlzcGF0Y2hlcjtcclxuICAgICAgICBjb25zdCBtc2cgPSB0aGlzLl9yZXNwb25zZU1lc3NhZ2U7XHJcblxyXG4gICAgICAgIG1zZy5jb25zdGFudHMgPSBbXHJcbiAgICAgICAgICAgICdKT0xUX1ZFUlNJT04nLCBqb2x0SW5mby52ZXJzaW9uLFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfTU9USU9OX1RZUEVfU1RBVElDJywgSm9sdC5FTW90aW9uVHlwZV9TdGF0aWMsXHJcbiAgICAgICAgICAgICdKT0xUX01PVElPTl9UWVBFX0RZTkFNSUMnLCBKb2x0LkVNb3Rpb25UeXBlX0R5bmFtaWMsXHJcbiAgICAgICAgICAgICdKT0xUX01PVElPTl9UWVBFX0tJTkVNQVRJQycsIEpvbHQuRU1vdGlvblR5cGVfS2luZW1hdGljLFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfT01QX0NBTENVTEFURV9JTkVSVElBJywgSm9sdC5FT3ZlcnJpZGVNYXNzUHJvcGVydGllc19DYWxjdWxhdGVJbmVydGlhLFxyXG4gICAgICAgICAgICAnSk9MVF9PTVBfQ0FMQ1VMQVRFX01BU1NfQU5EX0lORVJUSUEnLCBKb2x0LkVPdmVycmlkZU1hc3NQcm9wZXJ0aWVzX0NhbGN1bGF0ZU1hc3NBbmRJbmVydGlhLFxyXG4gICAgICAgICAgICAnSk9MVF9PTVBfTUFTU19BTkRfSU5FUlRJQV9QUk9WSURFRCcsIEpvbHQuRU92ZXJyaWRlTWFzc1Byb3BlcnRpZXNfTWFzc0FuZEluZXJ0aWFQcm92aWRlZCxcclxuXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19UUkFOU0xBVElPTl9YJywgSm9sdC5FQWxsb3dlZERPRnNfVHJhbnNsYXRpb25YLFxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfVFJBTlNMQVRJT05fWScsIEpvbHQuRUFsbG93ZWRET0ZzX1RyYW5zbGF0aW9uWSxcclxuICAgICAgICAgICAgJ0pPTFRfQUxMT1dFRF9ET0ZTX1RSQU5TTEFUSU9OX1onLCBKb2x0LkVBbGxvd2VkRE9Gc19UcmFuc2xhdGlvblosXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19ST1RBVElPTl9YJywgSm9sdC5FQWxsb3dlZERPRnNfUm90YXRpb25YLFxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfUk9UQVRJT05fWScsIEpvbHQuRUFsbG93ZWRET0ZzX1JvdGF0aW9uWSxcclxuICAgICAgICAgICAgJ0pPTFRfQUxMT1dFRF9ET0ZTX1JPVEFUSU9OX1onLCBKb2x0LkVBbGxvd2VkRE9Gc19Sb3RhdGlvblosXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19QTEFORV8yRCcsIEpvbHQuRUFsbG93ZWRET0ZzX1BsYW5lMkQsXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19BTEwnLCBKb2x0LkVBbGxvd2VkRE9Gc19BbGwsXHJcblxyXG4gICAgICAgICAgICAnSk9MVF9NT1RJT05fUVVBTElUWV9ESVNDUkVURScsIEpvbHQuRU1vdGlvblF1YWxpdHlfRGlzY3JldGUsXHJcbiAgICAgICAgICAgICdKT0xUX01PVElPTl9RVUFMSVRZX0xJTkVBUl9DQVNUJywgSm9sdC5FTW90aW9uUXVhbGl0eV9MaW5lYXJDYXN0LFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfQkZNX0lHTk9SRV9CQUNLX0ZBQ0VTJywgSm9sdC5FQmFja0ZhY2VNb2RlX0lnbm9yZUJhY2tGYWNlcyxcclxuICAgICAgICAgICAgJ0pPTFRfQkZNX0NPTExJREVfQkFDS19GQUNFUycsIEpvbHQuRUJhY2tGYWNlTW9kZV9Db2xsaWRlV2l0aEJhY2tGYWNlcyxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICdKT0xUX0dST1VORF9TVEFURV9PTl9HUk9VTkQnLCBKb2x0LkVHcm91bmRTdGF0ZV9Pbkdyb3VuZCxcclxuICAgICAgICAgICAgJ0pPTFRfR1JPVU5EX1NUQVRFX09OX1NURUVQX0dST1VORCcsIEpvbHQuRUdyb3VuZFN0YXRlX09uU3RlZXBHcm91bmQsXHJcbiAgICAgICAgICAgICdKT0xUX0dST1VORF9TVEFURV9OT1RfU1VQUE9SVEVEJywgSm9sdC5FR3JvdW5kU3RhdGVfTm90U3VwcG9ydGVkLFxyXG4gICAgICAgICAgICAnSk9MVF9HUk9VTkRfU1RBVEVfSU5fQUlSJywgSm9sdC5FR3JvdW5kU3RhdGVfSW5BaXIsXHJcblxyXG4gICAgICAgICAgICAnSk9MVF9UUkFOU01JU1NJT05fQVVUTycsIEpvbHQuRVRyYW5zbWlzc2lvbk1vZGVfQXV0byxcclxuICAgICAgICAgICAgJ0pPTFRfVFJBTlNNSVNTSU9OX01BTlVBTCcsIEpvbHQuRVRyYW5zbWlzc2lvbk1vZGVfTWFudWFsLFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfU1BSSU5HX01PREVfRlJFUVVFTkNZJywgSm9sdC5FU3ByaW5nTW9kZV9GcmVxdWVuY3lBbmREYW1waW5nLFxyXG4gICAgICAgICAgICAnSk9MVF9TUFJJTkdfTU9ERV9TVElGRk5FU1MnLCBKb2x0LkVTcHJpbmdNb2RlX1N0aWZmbmVzc0FuZERhbXBpbmcsXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgZGlzcGF0Y2hlci5yZXNwb25kKG1zZywgW10pO1xyXG5cclxuICAgICAgICBtc2cuY29uc3RhbnRzID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVSaWdpZEJvZGllc0lzb21ldHJ5KGNvdW50LCBzeXN0ZW0sIGNiKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuSm9sdDtcclxuICAgICAgICBjb25zdCB1c2VNb3Rpb25TdGF0ZXMgPSB0aGlzLl9jb25maWcudXNlTW90aW9uU3RhdGVzO1xyXG4gICAgICAgIGNvbnN0IGJvZHlMaXN0ID0gdGhpcy5fYm9keUxpc3Q7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX3RyYWNrZXI7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGJvZHlMaXN0LmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHN5c3RlbS5HZXRBY3RpdmVCb2RpZXMoSm9sdC5FQm9keVR5cGVfUmlnaWRCb2R5LCBib2R5TGlzdCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlJRCA9IGJvZHlMaXN0LmF0KGkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYm9keSA9IHN5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpLlRyeUdldEJvZHkoYm9keUlEKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ZXIgPSBKb2x0LmdldFBvaW50ZXIoYm9keSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocG9pbnRlciA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlT3BlcmF0b3IoQ09NUE9ORU5UX1NZU1RFTV9CT0RZKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfVVBEQVRFX1RSQU5TRk9STVMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihib2R5KSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zID0gYm9keS5tb3Rpb25TdGF0ZTtcclxuICAgICAgICAgICAgICAgIGlmICh1c2VNb3Rpb25TdGF0ZXMgJiYgbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShtcy5wb3NpdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUobXMucm90YXRpb24sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShib2R5LkdldFBvc2l0aW9uKCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShib2R5LkdldFJvdGF0aW9uKCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShib2R5LkdldExpbmVhclZlbG9jaXR5KCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGJvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiBpdCBpcyBhIHZlaGljbGUsIHdyaXRlIHdoZWVscyBpc29tZXRyeSBhcyB3ZWxsXHJcbiAgICAgICAgICAgICAgICBpZiAoYm9keS5pc1ZlaGljbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdHJhY2tlci5jb25zdHJhaW50TWFwLmdldChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uc3RyYWludCA9IGRhdGEuY29uc3RyYWludDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB3aGVlbHNDb3VudCA9IGNvbnN0cmFpbnQud2hlZWxzQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZXIgPSB0aGlzLl9tb2RpZmllcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QganYxID0gbW9kaWZpZXIuam9sdFZlYzNfMTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBqdjIgPSBtb2RpZmllci5qb2x0VmVjM18yO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBqdjEuU2V0KDAsIDEsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGp2Mi5TZXQoMSwgMCwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBjb25zdHJhaW50LkdldFdoZWVsTG9jYWxUcmFuc2Zvcm0oaSwganYxLCBqdjIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUodHJhbnNmb3JtLkdldFRyYW5zbGF0aW9uKCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUodHJhbnNmb3JtLkdldFJvdGF0aW9uKCkuR2V0UXVhdGVybmlvbigpLCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVTb2Z0Qm9kaWVzVmVydGljZXMoY291bnQsIHN5c3RlbSwgY2IpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IGJvZHlMaXN0ID0gdGhpcy5fYm9keUxpc3Q7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX3RyYWNrZXI7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGJvZHlMaXN0LmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHN5c3RlbS5HZXRBY3RpdmVCb2RpZXMoSm9sdC5FQm9keVR5cGVfU29mdEJvZHksIGJvZHlMaXN0KTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYm9keUlEID0gYm9keUxpc3QuYXQoaSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBib2R5ID0gc3lzdGVtLkdldEJvZHlMb2NrSW50ZXJmYWNlKCkuVHJ5R2V0Qm9keShib2R5SUQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlciA9IEpvbHQuZ2V0UG9pbnRlcihib2R5KTtcclxuICAgICAgICAgICAgICAgIGlmIChwb2ludGVyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX1NPRlRfQk9EWSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX1VQREFURV9UUkFOU0ZPUk1TKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRyYWNrZXIuZ2V0UENJRChwb2ludGVyKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdmVydGljZXMgPSBKb2x0LmNhc3RPYmplY3QoYm9keS5HZXRNb3Rpb25Qcm9wZXJ0aWVzKCksIEpvbHQuU29mdEJvZHlNb3Rpb25Qcm9wZXJ0aWVzKS5HZXRWZXJ0aWNlcygpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSB2ZXJ0aWNlcy5zaXplKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKHZlcnRpY2VzLmF0KGkpLm1Qb3NpdGlvbiwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBKb2x0QmFja2VuZCB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/backend.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/commands-buffer.mjs":
/*!***********************************************!*\
  !*** ./src/backends/jolt/commands-buffer.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CommandsBuffer: () => (/* binding */ CommandsBuffer)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\nclass CommandsBuffer {\r\n    constructor(config) {\r\n        if (config) {\r\n            let Buffer;\r\n            if (config.useSharedArrayBuffer) {\r\n                Buffer = SharedArrayBuffer;\r\n            } else {\r\n                Buffer = ArrayBuffer;\r\n            }\r\n            this._buffer = new Buffer(config.commandsBufferSize);\r\n            this._view = new DataView(this._buffer);\r\n            this._allowGrowth = config.allowCommandsBufferResize;\r\n        } else {\r\n            this._allowGrowth = true;\r\n        }\r\n\r\n        // First 2 bytes are for commands count, so we start from 2\r\n        this._bytesOffset = _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        this._commandsCount = 0;\r\n        this._dirty = false;\r\n        this._meshBuffers = [];\r\n    }\r\n\r\n    get buffer() {\r\n        return this._buffer;\r\n    }\r\n\r\n    set buffer(b) {\r\n        this._buffer = b;\r\n        this._view = new DataView(b);\r\n    }\r\n\r\n    get dirty() {\r\n        return this._dirty;\r\n    }\r\n\r\n    get flag() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    get commandsCount() {\r\n        return this._view.getUint16(0);\r\n    }\r\n\r\n    get meshBuffers() {\r\n        return this._meshBuffers;\r\n    }\r\n\r\n    writeJoltVec32(vec) {\r\n        this.writeFloat32(vec.GetX());\r\n        this.writeFloat32(vec.GetY());\r\n        this.writeFloat32(vec.GetZ());\r\n        if (vec.GetW) {\r\n            this.writeFloat32(vec.GetW());\r\n        }\r\n    }\r\n\r\n    readVec(vec) {\r\n        vec.x = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n        vec.y = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n        vec.z = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n    }\r\n\r\n    readQuat(quat) {\r\n        this.readVec(quat);\r\n        quat.w = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n    }\r\n\r\n    ignoreFlag() {\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n    }\r\n\r\n    reserveOffset(method) {\r\n        const offset = this._bytesOffset;\r\n        this[method](0);\r\n        return offset;\r\n    }\r\n\r\n    writeReserved(value, offset, method) {\r\n        this[method](value, offset);\r\n    }    \r\n\r\n    updateBuffer(buffer) {\r\n        if (this._buffer.byteLength !== buffer.byteLength) {\r\n            this._buffer = buffer;\r\n            this._view = new DataView(buffer);\r\n        }\r\n    }\r\n\r\n    read(method) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT8 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_INT32,\r\n            `Invalid write command method: ${ method }`\r\n        );\r\n\r\n        return this[method]();\r\n    }\r\n\r\n    /**\r\n     * Writes value to buffer. Skips flag for uint8 values.\r\n     */\r\n    write(value, method, addFlag = true) {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL || \r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_FLOAT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT8 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT16 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_INT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_PLANE,\r\n                `Invalid write command method: ${ method }`\r\n            );\r\n        }\r\n\r\n        if (value == null) {\r\n            this.writeUint8(0);\r\n        } else {\r\n            if (addFlag) this.writeUint8(1);\r\n            this[method](value);\r\n        }\r\n    }\r\n\r\n    readCommand() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} command Number in [0-255] range specifying a command variant for backend\r\n     */\r\n    writeCommand(command) {\r\n        this._increment();\r\n        this.writeUint8(command);\r\n        this._dirty = true;\r\n    }\r\n\r\n    readOperator() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    writeOperator(operator) {\r\n        this.writeUint8(operator);\r\n    }\r\n\r\n    writeVector32(vector) {\r\n        this.writeFloat32(vector.x);\r\n        this.writeFloat32(vector.y);\r\n        this.writeFloat32(vector.z);\r\n        if (vector.w !== undefined) {\r\n            this.writeFloat32(vector.w);\r\n        }\r\n    }\r\n\r\n    readFloat32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getFloat32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeFloat32(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setFloat32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setFloat32(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint8() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint8(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeUint8(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setUint8(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint8(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint16() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint16(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeUint16(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setUint16(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint16(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    writeUint32(value, offset) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE)) return;\r\n            this._view.setUint32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint32(offset, value);\r\n        }\r\n    }\r\n\r\n    readInt32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return null;\r\n        }\r\n        const value = this._view.getInt32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkInt(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    writeInt32(value, offset) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkInt(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE)) return;\r\n            this._view.setInt32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setInt32(offset, value);\r\n        }\r\n    }    \r\n\r\n    readBool() {\r\n        return this.readUint8() ? true : false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Boolean} value \r\n     */\r\n    writeBool(value) {\r\n        this.writeUint8(value ? 1 : 0);\r\n    }\r\n\r\n    writePlane(plane) {\r\n        this.writeVector32(plane.normal);\r\n        this.writeFloat32(plane.distance);\r\n    }\r\n\r\n    addBuffer(buffer) {\r\n        this._meshBuffers.push(buffer);\r\n    }\r\n\r\n    skip(bytes, size) {\r\n        this._bytesOffset += (bytes * size);\r\n    }\r\n\r\n    reset() {\r\n        this._commandsCount = 0;\r\n        this._bytesOffset = _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        this._dirty = false;\r\n    }\r\n\r\n    destroy() {\r\n        this._view = null;\r\n        this._buffer = null;\r\n    }\r\n\r\n    _increment() {\r\n        this._view.setUint16(0, ++this._commandsCount);\r\n    }\r\n\r\n    _canWrite(increment) {\r\n        if (this._isOutsideBounds(increment)) {\r\n            if (this._allowGrowth) {\r\n                this._resize();\r\n            } else {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: reached capacity limits. Not allowed to grow.' +\r\n                    ' Consider using \"allowCommandsBufferResize\" option or allocate a larger buffer' +\r\n                    ' using \"commandsBufferSize\". Current buffer' +\r\n                    ' size (bytes):', this._buffer.byteLength);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _resize(increment) {\r\n        const old = this._buffer;\r\n        const currentSize = old.byteLength;\r\n        const addendum = increment ? increment : currentSize * 0.5;\r\n        const buffer = new old.constructor(currentSize + addendum);\r\n\r\n        new Uint8Array(buffer).set(new Uint8Array(old));\r\n\r\n        this._buffer = buffer;\r\n        this._view = new DataView(buffer);\r\n    }\r\n\r\n    _isOutsideBounds(increment) {\r\n        if ((this._bytesOffset + increment) > this._buffer.byteLength) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9jb21tYW5kcy1idWZmZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFnRDtBQVdLO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0VBQVc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsdUZBQW1CO0FBQzdDLDBCQUEwQix1RkFBbUI7QUFDN0MsMEJBQTBCLHVGQUFtQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1RkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDhFQUFVO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHFEQUFLLFFBQVEscURBQUs7QUFDMUIsdUJBQXVCLG9GQUFnQjtBQUN2Qyx1QkFBdUIsdUZBQW1CO0FBQzFDLHVCQUF1QixxRkFBaUI7QUFDeEMsdUJBQXVCLHNGQUFrQjtBQUN6Qyx1QkFBdUIsc0ZBQWtCO0FBQ3pDLHVCQUF1QixxRkFBaUI7QUFDeEMsOENBQThDLFFBQVE7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBSztBQUNqQixZQUFZLHFEQUFLO0FBQ2pCLDJCQUEy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QUFRLHFEQUFLLFFBQVEscURBQUssb0RBQW9ELE9BQU87QUFDckYsNkJBQTZCLDhFQUFVO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxREFBSyxRQUFRLHFEQUFLLDhEQUE4RCxPQUFPO0FBQy9GO0FBQ0EsZ0NBQWdDLDhFQUFVO0FBQzFDO0FBQ0EsaUNBQWlDLDhFQUFVO0FBQzNDLFVBQVU7QUFDVixZQUFZLHFEQUFLLFFBQVEscURBQUssNkNBQTZDLDhFQUFVO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0VBQVc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2QsZ0JBQWdCLHFEQUFLLFFBQVEscURBQUs7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9jb21tYW5kcy1idWZmZXIubWpzPzE3MDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9waHlzaWNzL2RlYnVnLm1qcyc7XHJcbmltcG9ydCB7XHJcbiAgICBGTE9BVDMyX1NJWkUsIFVJTlQzMl9TSVpFLCBVSU5UMTZfU0laRSwgVUlOVDhfU0laRSxcclxuICAgIEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgQlVGRkVSX1dSSVRFX1VJTlQxNixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsIEJVRkZFUl9XUklURV9WRUMzMiwgQlVGRkVSX1dSSVRFX1VJTlQ4LFxyXG4gICAgQlVGRkVSX1JFQURfQk9PTCwgQlVGRkVSX1JFQURfRkxPQVQzMiwgQlVGRkVSX1JFQURfVUlOVDgsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UMTYsIEJVRkZFUl9SRUFEX1VJTlQzMiwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgXHJcbiAgICBCVUZGRVJfV1JJVEVfUExBTkUsXHJcbiAgICBJTlQzMl9TSVpFLFxyXG4gICAgQlVGRkVSX1JFQURfSU5UMzIsXHJcbiAgICBCVUZGRVJfV1JJVEVfSU5UMzJcclxufSBmcm9tICcuLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzJztcclxuXHJcbmNsYXNzIENvbW1hbmRzQnVmZmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xyXG4gICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgbGV0IEJ1ZmZlcjtcclxuICAgICAgICAgICAgaWYgKGNvbmZpZy51c2VTaGFyZWRBcnJheUJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgICAgQnVmZmVyID0gU2hhcmVkQXJyYXlCdWZmZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBCdWZmZXIgPSBBcnJheUJ1ZmZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBuZXcgQnVmZmVyKGNvbmZpZy5jb21tYW5kc0J1ZmZlclNpemUpO1xyXG4gICAgICAgICAgICB0aGlzLl92aWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuX2J1ZmZlcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2FsbG93R3Jvd3RoID0gY29uZmlnLmFsbG93Q29tbWFuZHNCdWZmZXJSZXNpemU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fYWxsb3dHcm93dGggPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRmlyc3QgMiBieXRlcyBhcmUgZm9yIGNvbW1hbmRzIGNvdW50LCBzbyB3ZSBzdGFydCBmcm9tIDJcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCA9IFVJTlQxNl9TSVpFO1xyXG4gICAgICAgIHRoaXMuX2NvbW1hbmRzQ291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fbWVzaEJ1ZmZlcnMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGJ1ZmZlcihiKSB7XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gYjtcclxuICAgICAgICB0aGlzLl92aWV3ID0gbmV3IERhdGFWaWV3KGIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkaXJ0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGlydHk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZsYWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVhZFVpbnQ4KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbW1hbmRzQ291bnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXcuZ2V0VWludDE2KDApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtZXNoQnVmZmVycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWVzaEJ1ZmZlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVKb2x0VmVjMzIodmVjKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFgoKSk7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFkoKSk7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFooKSk7XHJcbiAgICAgICAgaWYgKHZlYy5HZXRXKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHZlYy5HZXRXKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkVmVjKHZlYykge1xyXG4gICAgICAgIHZlYy54ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHZlYy55ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHZlYy56ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRRdWF0KHF1YXQpIHtcclxuICAgICAgICB0aGlzLnJlYWRWZWMocXVhdCk7XHJcbiAgICAgICAgcXVhdC53ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlnbm9yZUZsYWcoKSB7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDhfU0laRTtcclxuICAgIH1cclxuXHJcbiAgICByZXNlcnZlT2Zmc2V0KG1ldGhvZCkge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuX2J5dGVzT2Zmc2V0O1xyXG4gICAgICAgIHRoaXNbbWV0aG9kXSgwKTtcclxuICAgICAgICByZXR1cm4gb2Zmc2V0O1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlUmVzZXJ2ZWQodmFsdWUsIG9mZnNldCwgbWV0aG9kKSB7XHJcbiAgICAgICAgdGhpc1ttZXRob2RdKHZhbHVlLCBvZmZzZXQpO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICB1cGRhdGVCdWZmZXIoYnVmZmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoICE9PSBidWZmZXIuYnl0ZUxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZChtZXRob2QpIHtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KFxyXG4gICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9SRUFEX0JPT0wgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9GTE9BVDMyIHx8XHJcbiAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1JFQURfVUlOVDggfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9VSU5UMTYgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9VSU5UMzIgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9JTlQzMixcclxuICAgICAgICAgICAgYEludmFsaWQgd3JpdGUgY29tbWFuZCBtZXRob2Q6ICR7IG1ldGhvZCB9YFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzW21ldGhvZF0oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdyaXRlcyB2YWx1ZSB0byBidWZmZXIuIFNraXBzIGZsYWcgZm9yIHVpbnQ4IHZhbHVlcy5cclxuICAgICAqL1xyXG4gICAgd3JpdGUodmFsdWUsIG1ldGhvZCwgYWRkRmxhZyA9IHRydWUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1dSSVRFX0JPT0wgfHwgXHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9GTE9BVDMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9VSU5UOCB8fFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfV1JJVEVfVUlOVDE2IHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9VSU5UMzIgfHxcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1dSSVRFX0lOVDMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9WRUMzMiB8fFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9QTEFORSxcclxuICAgICAgICAgICAgICAgIGBJbnZhbGlkIHdyaXRlIGNvbW1hbmQgbWV0aG9kOiAkeyBtZXRob2QgfWBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVVaW50OCgwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoYWRkRmxhZykgdGhpcy53cml0ZVVpbnQ4KDEpO1xyXG4gICAgICAgICAgICB0aGlzW21ldGhvZF0odmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkQ29tbWFuZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWFkVWludDgoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbW1hbmQgTnVtYmVyIGluIFswLTI1NV0gcmFuZ2Ugc3BlY2lmeWluZyBhIGNvbW1hbmQgdmFyaWFudCBmb3IgYmFja2VuZFxyXG4gICAgICovXHJcbiAgICB3cml0ZUNvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgIHRoaXMuX2luY3JlbWVudCgpO1xyXG4gICAgICAgIHRoaXMud3JpdGVVaW50OChjb21tYW5kKTtcclxuICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZE9wZXJhdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRVaW50OCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlT3BlcmF0b3Iob3BlcmF0b3IpIHtcclxuICAgICAgICB0aGlzLndyaXRlVWludDgob3BlcmF0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmVjdG9yMzIodmVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjdG9yLngpO1xyXG4gICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHZlY3Rvci55KTtcclxuICAgICAgICB0aGlzLndyaXRlRmxvYXQzMih2ZWN0b3Iueik7XHJcbiAgICAgICAgaWYgKHZlY3Rvci53ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjdG9yLncpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkRmxvYXQzMigpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmIHRoaXMuX2lzT3V0c2lkZUJvdW5kcyhGTE9BVDMyX1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldEZsb2F0MzIodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja0Zsb2F0KHZhbHVlLCBgR290IGludmFsaWQgdmFsdWUgZnJvbSBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSBGTE9BVDMyX1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlRmxvYXQzMih2YWx1ZSwgb2Zmc2V0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYW5Xcml0ZShGTE9BVDMyX1NJWkUpKSByZXR1cm47XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrRmxvYXQodmFsdWUsIGBUcnlpbmcgdG8gd3JpdGUgaW52YWxpZCB2YWx1ZSB0byBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRGbG9hdDMyKHRoaXMuX2J5dGVzT2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IEZMT0FUMzJfU0laRTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoID49IChvZmZzZXQgKyBGTE9BVDMyX1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRGbG9hdDMyKG9mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkVWludDgoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDhfU0laRSkpIHtcclxuICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogQWJvcnRpbmcgcmVhZCBvdXRzaWRlIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3ZpZXcuZ2V0VWludDgodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1VpbnQodmFsdWUsIGBHb3QgaW52YWxpZCB2YWx1ZSBmcm9tIGJ1ZmZlcjogJHsgdmFsdWUgfWApO1xyXG4gICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IFVJTlQ4X1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlVWludDgodmFsdWUsIG9mZnNldCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoVUlOVDhfU0laRSkpIHJldHVybjtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuY2hlY2tVaW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDgodGhpcy5fYnl0ZXNPZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDhfU0laRTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoID49IChvZmZzZXQgKyBVSU5UOF9TSVpFKSwgJ1RyeWluZyB0byB3cml0ZSBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDgob2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlYWRVaW50MTYoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDE2X1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldFVpbnQxNih0aGlzLl9ieXRlc09mZnNldCk7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDE2X1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlVWludDE2KHZhbHVlLCBvZmZzZXQpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbldyaXRlKFVJTlQxNl9TSVpFKSkgcmV0dXJuO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1VpbnQodmFsdWUsIGBUcnlpbmcgdG8gd3JpdGUgaW52YWxpZCB2YWx1ZSB0byBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYodGhpcy5fYnl0ZXNPZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDE2X1NJWkU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmFzc2VydCh0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCA+PSAob2Zmc2V0ICsgVUlOVDE2X1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYob2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlYWRVaW50MzIoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDMyX1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldFVpbnQzMih0aGlzLl9ieXRlc09mZnNldCk7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDMyX1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVWludDMyKHZhbHVlLCBvZmZzZXQpIHtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuY2hlY2tVaW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoVUlOVDMyX1NJWkUpKSByZXR1cm47XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDMyKHRoaXMuX2J5dGVzT2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IFVJTlQzMl9TSVpFO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5hc3NlcnQodGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGggPj0gKG9mZnNldCArIFVJTlQzMl9TSVpFKSwgJ1RyeWluZyB0byB3cml0ZSBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDMyKG9mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkSW50MzIoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoSU5UMzJfU0laRSkpIHtcclxuICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogQWJvcnRpbmcgcmVhZCBvdXRzaWRlIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3ZpZXcuZ2V0SW50MzIodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja0ludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gSU5UMzJfU0laRTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KSB7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrSW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoSU5UMzJfU0laRSkpIHJldHVybjtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRJbnQzMih0aGlzLl9ieXRlc09mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSBJTlQzMl9TSVpFO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5hc3NlcnQodGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGggPj0gKG9mZnNldCArIElOVDMyX1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRJbnQzMihvZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIHJlYWRCb29sKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRVaW50OCgpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlIFxyXG4gICAgICovXHJcbiAgICB3cml0ZUJvb2wodmFsdWUpIHtcclxuICAgICAgICB0aGlzLndyaXRlVWludDgodmFsdWUgPyAxIDogMCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVQbGFuZShwbGFuZSkge1xyXG4gICAgICAgIHRoaXMud3JpdGVWZWN0b3IzMihwbGFuZS5ub3JtYWwpO1xyXG4gICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHBsYW5lLmRpc3RhbmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRCdWZmZXIoYnVmZmVyKSB7XHJcbiAgICAgICAgdGhpcy5fbWVzaEJ1ZmZlcnMucHVzaChidWZmZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNraXAoYnl0ZXMsIHNpemUpIHtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSAoYnl0ZXMgKiBzaXplKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICB0aGlzLl9jb21tYW5kc0NvdW50ID0gMDtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCA9IFVJTlQxNl9TSVpFO1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl92aWV3ID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9idWZmZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIF9pbmNyZW1lbnQoKSB7XHJcbiAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYoMCwgKyt0aGlzLl9jb21tYW5kc0NvdW50KTtcclxuICAgIH1cclxuXHJcbiAgICBfY2FuV3JpdGUoaW5jcmVtZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzT3V0c2lkZUJvdW5kcyhpbmNyZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9hbGxvd0dyb3d0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzaXplKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogcmVhY2hlZCBjYXBhY2l0eSBsaW1pdHMuIE5vdCBhbGxvd2VkIHRvIGdyb3cuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgJyBDb25zaWRlciB1c2luZyBcImFsbG93Q29tbWFuZHNCdWZmZXJSZXNpemVcIiBvcHRpb24gb3IgYWxsb2NhdGUgYSBsYXJnZXIgYnVmZmVyJyArXHJcbiAgICAgICAgICAgICAgICAgICAgJyB1c2luZyBcImNvbW1hbmRzQnVmZmVyU2l6ZVwiLiBDdXJyZW50IGJ1ZmZlcicgK1xyXG4gICAgICAgICAgICAgICAgICAgICcgc2l6ZSAoYnl0ZXMpOicsIHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3Jlc2l6ZShpbmNyZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBvbGQgPSB0aGlzLl9idWZmZXI7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFNpemUgPSBvbGQuYnl0ZUxlbmd0aDtcclxuICAgICAgICBjb25zdCBhZGRlbmR1bSA9IGluY3JlbWVudCA/IGluY3JlbWVudCA6IGN1cnJlbnRTaXplICogMC41O1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBvbGQuY29uc3RydWN0b3IoY3VycmVudFNpemUgKyBhZGRlbmR1bSk7XHJcblxyXG4gICAgICAgIG5ldyBVaW50OEFycmF5KGJ1ZmZlcikuc2V0KG5ldyBVaW50OEFycmF5KG9sZCkpO1xyXG5cclxuICAgICAgICB0aGlzLl9idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgdGhpcy5fdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIF9pc091dHNpZGVCb3VuZHMoaW5jcmVtZW50KSB7XHJcbiAgICAgICAgaWYgKCh0aGlzLl9ieXRlc09mZnNldCArIGluY3JlbWVudCkgPiB0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBDb21tYW5kc0J1ZmZlciB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/commands-buffer.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/motion-state.mjs":
/*!********************************************!*\
  !*** ./src/backends/jolt/motion-state.mjs ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MotionState: () => (/* binding */ MotionState)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\nconst v1 = { x: 0, y: 0, z: 0 };\r\nconst q1 = { x: 0, y: 0, z: 0, w: 1 };\r\nconst q2 = { x: 0, y: 0, z: 0, w: 1 };\r\n\r\nclass MotionState {\r\n    constructor(body) {\r\n        this._body = body;\r\n\r\n        this._updatePosition(body);\r\n        this._updateRotation(body);\r\n    }\r\n\r\n    compute(alpha, stepped) {\r\n        const body = this._body;\r\n        const position = this._position;\r\n        const op = this._oldPos;\r\n        const cp = this._currentPos;\r\n        \r\n        try {\r\n            if (stepped) {\r\n                const bp = body.GetPosition();\r\n                op.x = cp.x; op.y = cp.y; op.z = cp.z;\r\n                cp.x = bp.GetX(); cp.y = bp.GetY(); cp.z = bp.GetZ();\r\n            }\r\n\r\n            v1.x = cp.x * alpha;\r\n            v1.y = cp.y * alpha;\r\n            v1.z = cp.z * alpha;\r\n\r\n            position.x = v1.x;\r\n            position.y = v1.y;\r\n            position.z = v1.z;\r\n\r\n            v1.x = op.x * (1 - alpha);\r\n            v1.y = op.y * (1 - alpha);\r\n            v1.z = op.z * (1 - alpha);\r\n\r\n            position.x += v1.x;\r\n            position.y += v1.y;\r\n            position.z += v1.z;\r\n\r\n            if (!body.isCharacter) {\r\n                const r = this._rotation;\r\n                const cr = this._currentRot;\r\n                const or = this._oldRot;\r\n\r\n                if (stepped) {\r\n                    const br = body.GetRotation();\r\n                    or.x = cr.x; or.y = cr.y; or.z = cr.z; or.w = cr.w;\r\n                    cr.x = br.GetX(); cr.y = br.GetY(); cr.z = br.GetZ(); cr.w = br.GetW();\r\n                }\r\n\r\n                let q2x = cr.x;\r\n                let q2y = cr.y;\r\n                let q2z = cr.z;\r\n                let q2w = cr.w;\r\n\r\n                let dot = r.x * q2x + r.y * q2y + r.z * q2z + r.w * q2w;\r\n                if (dot < 0) {\r\n                    q2x = -q2x;\r\n                    q2y = -q2y;\r\n                    q2z = -q2z;\r\n                    q2w = -q2w;\r\n                    dot = -dot;\r\n                }\r\n\r\n                const theta = Math.acos(dot);\r\n                if (theta > 0.0001) {\r\n                    const invst = 1 / Math.sin(theta);\r\n                    const c0 = Math.sin((1 - alpha) * theta) * invst;\r\n                    const c1 = Math.sin(alpha * theta) * invst;\r\n                    r.x = c0 * or.x + c1 * q2x;\r\n                    r.y = c0 * or.y + c1 * q2y;\r\n                    r.z = c0 * or.z + c1 * q2z;\r\n                    r.w = c0 * or.w + c1 * q2w;\r\n                } else {\r\n                    r.x = r.x;\r\n                    r.y = r.y;\r\n                    r.z = r.z;\r\n                    r.w = r.w;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    get position() {\r\n        return this._position;\r\n    }\r\n\r\n    get rotation() {\r\n        return this._rotation;\r\n    }\r\n\r\n    _updatePosition(body) {\r\n        const bodyPos = body.GetPosition();\r\n        const p = { x: bodyPos.GetX(), y: bodyPos.GetY(), z: bodyPos.GetZ() };\r\n\r\n        this._position = p;\r\n        this._currentPos = { x: p.x, y: p.y, z: p.z };\r\n        this._oldPos = { x: p.x, y: p.y, z: p.z };\r\n    }\r\n\r\n    _updateRotation(body) {\r\n        const bodyRot = body.GetRotation();\r\n        const r = { x: bodyRot.GetX(), y: bodyRot.GetY(), z: bodyRot.GetZ(), w: bodyRot.GetW() };\r\n\r\n        this._rotation = r;\r\n        this._currentRot = { x: r.x, y: r.y, z: r.z, w: r.w };\r\n        this._oldRot = { x: r.x, y: r.y, z: r.z, w: r.w };\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9tb3Rpb24tc3RhdGUubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQWdEO0FBQ2hEO0FBQ0EsYUFBYTtBQUNiLGFBQWE7QUFDYixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGFBQWE7QUFDMUMsa0NBQWtDLGtCQUFrQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxhQUFhLGFBQWE7QUFDM0Qsc0NBQXNDLGtCQUFrQixrQkFBa0I7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLFlBQVkscURBQUssUUFBUSxxREFBSztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9iYWNrZW5kcy9qb2x0L21vdGlvbi1zdGF0ZS5tanM/MTg1NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY29uc3QgdjEgPSB7IHg6IDAsIHk6IDAsIHo6IDAgfTtcclxuY29uc3QgcTEgPSB7IHg6IDAsIHk6IDAsIHo6IDAsIHc6IDEgfTtcclxuY29uc3QgcTIgPSB7IHg6IDAsIHk6IDAsIHo6IDAsIHc6IDEgfTtcclxuXHJcbmNsYXNzIE1vdGlvblN0YXRlIHtcclxuICAgIGNvbnN0cnVjdG9yKGJvZHkpIHtcclxuICAgICAgICB0aGlzLl9ib2R5ID0gYm9keTtcclxuXHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUG9zaXRpb24oYm9keSk7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUm90YXRpb24oYm9keSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcHV0ZShhbHBoYSwgc3RlcHBlZCkge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9ib2R5O1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5fcG9zaXRpb247XHJcbiAgICAgICAgY29uc3Qgb3AgPSB0aGlzLl9vbGRQb3M7XHJcbiAgICAgICAgY29uc3QgY3AgPSB0aGlzLl9jdXJyZW50UG9zO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChzdGVwcGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBicCA9IGJvZHkuR2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIG9wLnggPSBjcC54OyBvcC55ID0gY3AueTsgb3AueiA9IGNwLno7XHJcbiAgICAgICAgICAgICAgICBjcC54ID0gYnAuR2V0WCgpOyBjcC55ID0gYnAuR2V0WSgpOyBjcC56ID0gYnAuR2V0WigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2MS54ID0gY3AueCAqIGFscGhhO1xyXG4gICAgICAgICAgICB2MS55ID0gY3AueSAqIGFscGhhO1xyXG4gICAgICAgICAgICB2MS56ID0gY3AueiAqIGFscGhhO1xyXG5cclxuICAgICAgICAgICAgcG9zaXRpb24ueCA9IHYxLng7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uLnkgPSB2MS55O1xyXG4gICAgICAgICAgICBwb3NpdGlvbi56ID0gdjEuejtcclxuXHJcbiAgICAgICAgICAgIHYxLnggPSBvcC54ICogKDEgLSBhbHBoYSk7XHJcbiAgICAgICAgICAgIHYxLnkgPSBvcC55ICogKDEgLSBhbHBoYSk7XHJcbiAgICAgICAgICAgIHYxLnogPSBvcC56ICogKDEgLSBhbHBoYSk7XHJcblxyXG4gICAgICAgICAgICBwb3NpdGlvbi54ICs9IHYxLng7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uLnkgKz0gdjEueTtcclxuICAgICAgICAgICAgcG9zaXRpb24ueiArPSB2MS56O1xyXG5cclxuICAgICAgICAgICAgaWYgKCFib2R5LmlzQ2hhcmFjdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5fcm90YXRpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjciA9IHRoaXMuX2N1cnJlbnRSb3Q7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvciA9IHRoaXMuX29sZFJvdDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3RlcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJyID0gYm9keS5HZXRSb3RhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9yLnggPSBjci54OyBvci55ID0gY3IueTsgb3IueiA9IGNyLno7IG9yLncgPSBjci53O1xyXG4gICAgICAgICAgICAgICAgICAgIGNyLnggPSBici5HZXRYKCk7IGNyLnkgPSBici5HZXRZKCk7IGNyLnogPSBici5HZXRaKCk7IGNyLncgPSBici5HZXRXKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHEyeCA9IGNyLng7XHJcbiAgICAgICAgICAgICAgICBsZXQgcTJ5ID0gY3IueTtcclxuICAgICAgICAgICAgICAgIGxldCBxMnogPSBjci56O1xyXG4gICAgICAgICAgICAgICAgbGV0IHEydyA9IGNyLnc7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGRvdCA9IHIueCAqIHEyeCArIHIueSAqIHEyeSArIHIueiAqIHEyeiArIHIudyAqIHEydztcclxuICAgICAgICAgICAgICAgIGlmIChkb3QgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcTJ4ID0gLXEyeDtcclxuICAgICAgICAgICAgICAgICAgICBxMnkgPSAtcTJ5O1xyXG4gICAgICAgICAgICAgICAgICAgIHEyeiA9IC1xMno7XHJcbiAgICAgICAgICAgICAgICAgICAgcTJ3ID0gLXEydztcclxuICAgICAgICAgICAgICAgICAgICBkb3QgPSAtZG90O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gTWF0aC5hY29zKGRvdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhldGEgPiAwLjAwMDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnZzdCA9IDEgLyBNYXRoLnNpbih0aGV0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYzAgPSBNYXRoLnNpbigoMSAtIGFscGhhKSAqIHRoZXRhKSAqIGludnN0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGMxID0gTWF0aC5zaW4oYWxwaGEgKiB0aGV0YSkgKiBpbnZzdDtcclxuICAgICAgICAgICAgICAgICAgICByLnggPSBjMCAqIG9yLnggKyBjMSAqIHEyeDtcclxuICAgICAgICAgICAgICAgICAgICByLnkgPSBjMCAqIG9yLnkgKyBjMSAqIHEyeTtcclxuICAgICAgICAgICAgICAgICAgICByLnogPSBjMCAqIG9yLnogKyBjMSAqIHEyejtcclxuICAgICAgICAgICAgICAgICAgICByLncgPSBjMCAqIG9yLncgKyBjMSAqIHEydztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgci54ID0gci54O1xyXG4gICAgICAgICAgICAgICAgICAgIHIueSA9IHIueTtcclxuICAgICAgICAgICAgICAgICAgICByLnogPSByLno7XHJcbiAgICAgICAgICAgICAgICAgICAgci53ID0gci53O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwb3NpdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHJvdGF0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yb3RhdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBfdXBkYXRlUG9zaXRpb24oYm9keSkge1xyXG4gICAgICAgIGNvbnN0IGJvZHlQb3MgPSBib2R5LkdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgY29uc3QgcCA9IHsgeDogYm9keVBvcy5HZXRYKCksIHk6IGJvZHlQb3MuR2V0WSgpLCB6OiBib2R5UG9zLkdldFooKSB9O1xyXG5cclxuICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHA7XHJcbiAgICAgICAgdGhpcy5fY3VycmVudFBvcyA9IHsgeDogcC54LCB5OiBwLnksIHo6IHAueiB9O1xyXG4gICAgICAgIHRoaXMuX29sZFBvcyA9IHsgeDogcC54LCB5OiBwLnksIHo6IHAueiB9O1xyXG4gICAgfVxyXG5cclxuICAgIF91cGRhdGVSb3RhdGlvbihib2R5KSB7XHJcbiAgICAgICAgY29uc3QgYm9keVJvdCA9IGJvZHkuR2V0Um90YXRpb24oKTtcclxuICAgICAgICBjb25zdCByID0geyB4OiBib2R5Um90LkdldFgoKSwgeTogYm9keVJvdC5HZXRZKCksIHo6IGJvZHlSb3QuR2V0WigpLCB3OiBib2R5Um90LkdldFcoKSB9O1xyXG5cclxuICAgICAgICB0aGlzLl9yb3RhdGlvbiA9IHI7XHJcbiAgICAgICAgdGhpcy5fY3VycmVudFJvdCA9IHsgeDogci54LCB5OiByLnksIHo6IHIueiwgdzogci53IH07XHJcbiAgICAgICAgdGhpcy5fb2xkUm90ID0geyB4OiByLngsIHk6IHIueSwgejogci56LCB3OiByLncgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgTW90aW9uU3RhdGUgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/motion-state.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/cleaner.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/cleaner.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Cleaner: () => (/* binding */ Cleaner)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Cleaner {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n    }\r\n\r\n    clean() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_DESTROY_BODY:\r\n                ok = this._destroyBody(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_DESTROY_SHAPE:\r\n                ok = this._destroyShape(cb);\r\n                break;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        this._backend = null;\r\n    }\r\n\r\n    _destroyBody(cb) {\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n        const bodyInterface = backend.bodyInterface;\r\n        const physicsSystem = backend.physicsSystem;\r\n\r\n        const body = tracker.getBodyByPCID(index);\r\n\r\n        if (!body) {\r\n            // Body could have been destroyed already. For example:\r\n            // Disable parent, then manually disable child. The body\r\n            // would get destroyed when parent was disabled. The\r\n            // command for destroy would be issued again, when child is\r\n            // disabled.\r\n            return true;\r\n        }\r\n\r\n        if (body.debugDrawData) {\r\n            Jolt.destroy(body.triContext);\r\n            body.triContext = null;\r\n            body.debugDrawData = null;\r\n        }\r\n\r\n        tracker.stopTrackingBody(body);\r\n\r\n        if (body.motionState) {\r\n            body.motionState = null;\r\n        }\r\n\r\n        const constraints = body.constraints;\r\n        if (constraints) {\r\n            const constraintMap = tracker.constraintMap;\r\n            for (let i = 0, end = constraints.length; i < end; i++) {\r\n                const index = constraints[i];\r\n                const data = constraintMap.get(index);\r\n                const constraint = data.constraint;\r\n                const listener = constraint.listener; // vehicle\r\n                \r\n                constraintMap.delete(index);\r\n                if (listener && Jolt.getPointer(listener) !== 0) {\r\n                    physicsSystem.RemoveStepListener(listener);\r\n                    Jolt.destroy(listener);\r\n                    constraint.listener = null;\r\n                }\r\n                if (Jolt.getPointer(constraint) !== 0) {\r\n                    physicsSystem.RemoveConstraint(constraint);\r\n                }\r\n            }\r\n            body.constraints = null;\r\n\r\n            body.linked?.forEach(linkedBody => {\r\n                if (Jolt.getPointer(linkedBody) !== 0) {\r\n                    bodyInterface.ActivateBody(linkedBody.GetID());\r\n                }\r\n                linkedBody.linked.delete(body);\r\n            });\r\n            body.linked = null;\r\n        }\r\n\r\n        const id = body.GetID();\r\n        bodyInterface.RemoveBody(id);\r\n        bodyInterface.DestroyBody(id);\r\n\r\n        return true;\r\n    }\r\n\r\n    _destroyShape(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n        const shapeNumber = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const shape = tracker.shapeMap.get(shapeNumber);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !shape) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn('Trying to destroy a shape that has already been destroyed');\r\n            return false;\r\n        }\r\n\r\n        Jolt.destroy(shape);\r\n\r\n        tracker.shapeMap.delete(shapeNumber);\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvY2xlYW5lci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXlIO0FBQ3RFO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvRkFBZ0I7QUFDakM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHFGQUFpQjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsc0ZBQWtCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsU0FBUztBQUMvRDtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0Msc0ZBQWtCO0FBQ3REO0FBQ0E7QUFDQSxZQUFZLHFEQUFLO0FBQ2pCLFlBQVkscURBQUs7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvb3BlcmF0b3JzL2NsZWFuZXIubWpzP2MzOTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQlVGRkVSX1JFQURfVUlOVDMyLCBDTURfREVTVFJPWV9CT0RZLCBDTURfREVTVFJPWV9TSEFQRSB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcblxyXG5jbGFzcyBDbGVhbmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGJhY2tlbmQpIHtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gYmFja2VuZDtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhbigpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX2JhY2tlbmQuaW5CdWZmZXI7XHJcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IGNiLnJlYWRDb21tYW5kKCk7XHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0RFU1RST1lfQk9EWTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fZGVzdHJveUJvZHkoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9ERVNUUk9ZX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9kZXN0cm95U2hhcGUoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfZGVzdHJveUJvZHkoY2IpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBiYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgYm9keUludGVyZmFjZSA9IGJhY2tlbmQuYm9keUludGVyZmFjZTtcclxuICAgICAgICBjb25zdCBwaHlzaWNzU3lzdGVtID0gYmFja2VuZC5waHlzaWNzU3lzdGVtO1xyXG5cclxuICAgICAgICBjb25zdCBib2R5ID0gdHJhY2tlci5nZXRCb2R5QnlQQ0lEKGluZGV4KTtcclxuXHJcbiAgICAgICAgaWYgKCFib2R5KSB7XHJcbiAgICAgICAgICAgIC8vIEJvZHkgY291bGQgaGF2ZSBiZWVuIGRlc3Ryb3llZCBhbHJlYWR5LiBGb3IgZXhhbXBsZTpcclxuICAgICAgICAgICAgLy8gRGlzYWJsZSBwYXJlbnQsIHRoZW4gbWFudWFsbHkgZGlzYWJsZSBjaGlsZC4gVGhlIGJvZHlcclxuICAgICAgICAgICAgLy8gd291bGQgZ2V0IGRlc3Ryb3llZCB3aGVuIHBhcmVudCB3YXMgZGlzYWJsZWQuIFRoZVxyXG4gICAgICAgICAgICAvLyBjb21tYW5kIGZvciBkZXN0cm95IHdvdWxkIGJlIGlzc3VlZCBhZ2Fpbiwgd2hlbiBjaGlsZCBpc1xyXG4gICAgICAgICAgICAvLyBkaXNhYmxlZC5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYm9keS5kZWJ1Z0RyYXdEYXRhKSB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveShib2R5LnRyaUNvbnRleHQpO1xyXG4gICAgICAgICAgICBib2R5LnRyaUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICBib2R5LmRlYnVnRHJhd0RhdGEgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHJhY2tlci5zdG9wVHJhY2tpbmdCb2R5KGJvZHkpO1xyXG5cclxuICAgICAgICBpZiAoYm9keS5tb3Rpb25TdGF0ZSkge1xyXG4gICAgICAgICAgICBib2R5Lm1vdGlvblN0YXRlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gYm9keS5jb25zdHJhaW50cztcclxuICAgICAgICBpZiAoY29uc3RyYWludHMpIHtcclxuICAgICAgICAgICAgY29uc3QgY29uc3RyYWludE1hcCA9IHRyYWNrZXIuY29uc3RyYWludE1hcDtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGVuZCA9IGNvbnN0cmFpbnRzLmxlbmd0aDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnN0cmFpbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGNvbnN0cmFpbnRNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBkYXRhLmNvbnN0cmFpbnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ZW5lciA9IGNvbnN0cmFpbnQubGlzdGVuZXI7IC8vIHZlaGljbGVcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgY29uc3RyYWludE1hcC5kZWxldGUoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyICYmIEpvbHQuZ2V0UG9pbnRlcihsaXN0ZW5lcikgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBwaHlzaWNzU3lzdGVtLlJlbW92ZVN0ZXBMaXN0ZW5lcihsaXN0ZW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50Lmxpc3RlbmVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoY29uc3RyYWludCkgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBwaHlzaWNzU3lzdGVtLlJlbW92ZUNvbnN0cmFpbnQoY29uc3RyYWludCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYm9keS5jb25zdHJhaW50cyA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBib2R5LmxpbmtlZD8uZm9yRWFjaChsaW5rZWRCb2R5ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIobGlua2VkQm9keSkgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBib2R5SW50ZXJmYWNlLkFjdGl2YXRlQm9keShsaW5rZWRCb2R5LkdldElEKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGlua2VkQm9keS5saW5rZWQuZGVsZXRlKGJvZHkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYm9keS5saW5rZWQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaWQgPSBib2R5LkdldElEKCk7XHJcbiAgICAgICAgYm9keUludGVyZmFjZS5SZW1vdmVCb2R5KGlkKTtcclxuICAgICAgICBib2R5SW50ZXJmYWNlLkRlc3Ryb3lCb2R5KGlkKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2Rlc3Ryb3lTaGFwZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBzaGFwZU51bWJlciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBzaGFwZSA9IHRyYWNrZXIuc2hhcGVNYXAuZ2V0KHNoYXBlTnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhc2hhcGUpIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignVHJ5aW5nIHRvIGRlc3Ryb3kgYSBzaGFwZSB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gZGVzdHJveWVkJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveShzaGFwZSk7XHJcblxyXG4gICAgICAgIHRyYWNrZXIuc2hhcGVNYXAuZGVsZXRlKHNoYXBlTnVtYmVyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IENsZWFuZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/cleaner.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/creator.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/creator.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Creator: () => (/* binding */ Creator)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../motion-state.mjs */ \"./src/backends/jolt/motion-state.mjs\");\n\r\n\r\n\r\n\r\nclass Creator {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n\r\n        this.createPhysicsSystem();\r\n    }\r\n\r\n    create(meshBuffers) {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_BODY:\r\n                ok = this._createBody(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_SOFT_BODY:\r\n                ok = this._createSoftBody(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_GROUPS:\r\n                ok = this._createGroups(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_CONSTRAINT:\r\n                ok = this._createConstraint(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_CHAR:\r\n                ok = this._createCharacter(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_SHAPE:\r\n                ok = this._createShape(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_VEHICLE:\r\n                ok = this._createVehicle(cb);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Invalid command: ${ command }`);\r\n                return false;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    createPhysicsSystem() {\r\n        const backend = this._backend;\r\n        const config = backend.config;\r\n        // const layerPairs = config.layerPairs;\r\n        // const layers = config.layers;\r\n        // const layers = config.objectLayers;\r\n        // const layersCount = layers.length;\r\n        const Jolt = backend.Jolt;\r\n\r\n        this._joltVec3 = new Jolt.Vec3();\r\n        this._joltVec3_2 = new Jolt.Vec3();\r\n        this._joltQuat = new Jolt.Quat();\r\n\r\n        const bpMap = new Map();\r\n\r\n        const pairs = config.objectLayerPairs;\r\n        const pairsCount = pairs.length;\r\n        const objectFilter = new Jolt.ObjectLayerPairFilterTable(pairsCount);\r\n        for (let i = 0; i < pairsCount; i++) {\r\n            const pair = pairs[i];\r\n            objectFilter.EnableCollision(pair[0], pair[1]);\r\n        }\r\n\r\n        const bpLayers = config.broadPhaseLayers;\r\n        const bpLayerCount = bpLayers.length;\r\n        const bpInterface = new Jolt.BroadPhaseLayerInterfaceTable(pairsCount, bpLayerCount);\r\n        for (let i = 0; i < bpLayerCount; i++) {\r\n            const id = bpLayers[i];\r\n            const bpLayer = new Jolt.BroadPhaseLayer(id);\r\n            bpMap.set(id, bpLayer);\r\n        }\r\n\r\n        // Map object layers to broadphase layers\r\n        let objLayerCount = 0;\r\n        for (const [objLayer, bpLayers] of Object.entries(config.mapObjectToBroadPhaseLayer)) {\r\n            objLayerCount++;\r\n            for (let i = 0; i < bpLayers.length; i++) {\r\n                bpInterface.MapObjectToBroadPhaseLayer(objLayer, bpMap.get(bpLayers[i]));\r\n            }\r\n        }\r\n        // Broadphase layers have been copied to the bpInterface, so we can destroy those\r\n        bpMap.forEach(bpLayer => {\r\n            Jolt.destroy(bpLayer);\r\n        });\r\n        bpMap.clear();\r\n\r\n        const settings = new Jolt.JoltSettings();\r\n        settings.mObjectLayerPairFilter = objectFilter;\r\n        settings.mBroadPhaseLayerInterface = bpInterface;\r\n        settings.mObjectVsBroadPhaseLayerFilter = new Jolt.ObjectVsBroadPhaseLayerFilterTable(settings.mBroadPhaseLayerInterface, bpLayerCount, settings.mObjectLayerPairFilter, objLayerCount);\r\n        const joltInterface = new Jolt.JoltInterface(settings);\r\n        Jolt.destroy(settings);\r\n\r\n        const physicsSystem = joltInterface.GetPhysicsSystem();\r\n        const systemSettings = physicsSystem.GetPhysicsSettings();\r\n        \r\n        systemSettings.mBaumgarte = config.baumgarte;\r\n        systemSettings.mBodyPairCacheCosMaxDeltaRotationDiv2 = config.bodyPairCacheCosMaxDeltaRotationDiv2;\r\n        systemSettings.mBodyPairCacheMaxDeltaPositionSq = config.bodyPairCacheMaxDeltaPositionSq;\r\n        systemSettings.mContactNormalCosMaxDeltaRotation = config.contactNormalCosMaxDeltaRotation;\r\n        systemSettings.mContactPointPreserveLambdaMaxDistSq = config.contactPointPreserveLambdaMaxDistSq;\r\n        systemSettings.mDeterministicSimulation = config.deterministicSimulation;\r\n        systemSettings.mLinearCastMaxPenetration = config.linearCastMaxPenetration;\r\n        systemSettings.mLinearCastThreshold = config.linearCastThreshold;\r\n        systemSettings.mManifoldToleranceSq = config.manifoldToleranceSq;\r\n        systemSettings.mMaxInFlightBodyPairs = config.maxInFlightBodyPairs;\r\n        systemSettings.mMaxPenetrationDistance = config.maxPenetrationDistance;\r\n        systemSettings.mMinVelocityForRestitution = config.minVelocityForRestitution;\r\n        systemSettings.mNumPositionSteps = config.numPositionSteps;\r\n        systemSettings.mNumVelocitySteps = config.numVelocitySteps;\r\n        systemSettings.mPenetrationSlop = config.penetrationSlop;\r\n        systemSettings.mPointVelocitySleepThreshold = config.pointVelocitySleepThreshold;\r\n        systemSettings.mSpeculativeContactDistance = config.speculativeContactDistance;\r\n        systemSettings.mStepListenerBatchesPerJob = config.stepListenerBatchesPerJob;\r\n        systemSettings.mStepListenersBatchSize = config.stepListenersBatchSize;\r\n        systemSettings.mTimeBeforeSleep = config.timeBeforeSleep;\r\n\r\n        systemSettings.mConstraintWarmStart = config.constraintWarmStart;\r\n        systemSettings.mUseBodyPairContactCache = config.useBodyPairContactCache;\r\n        systemSettings.mUseManifoldReduction = config.useManifoldReduction;\r\n        systemSettings.mUseLargeIslandSplitter = config.useLargeIslandSplitter;\r\n        systemSettings.mAllowSleeping = config.allowSleeping;\r\n        systemSettings.mCheckActiveEdges = config.checkActiveEdges;\r\n\r\n        physicsSystem.SetPhysicsSettings(systemSettings);\r\n        \r\n        backend.joltInterface = joltInterface;\r\n        backend.physicsSystem = physicsSystem;\r\n\r\n        backend.bpFilter = new Jolt.DefaultBroadPhaseLayerFilter(joltInterface.GetObjectVsBroadPhaseLayerFilter(), 1);\r\n        backend.objFilter = new Jolt.DefaultObjectLayerFilter(joltInterface.GetObjectLayerPairFilter(), 1);\r\n        backend.bodyFilter = new Jolt.BodyFilter();\r\n        backend.shapeFilter = new Jolt.ShapeFilter();\r\n        backend.bodyList = new Jolt.BodyIDVector();\r\n    }\r\n\r\n    createShapeSettings(shape, ...attr) {\r\n        const Jolt = this._backend.Jolt;\r\n\r\n        switch (shape) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_BOX:\r\n                return new Jolt.BoxShapeSettings(attr[0] /* half extent */, attr[1] /* convex radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_SPHERE:\r\n                return new Jolt.SphereShapeSettings(attr[0] /* radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CAPSULE:\r\n                return new Jolt.CapsuleShapeSettings(attr[0] /* half height */, attr[1] /* radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CYLINDER:\r\n                return new Jolt.CylinderShapeSettings(attr[0] /* half height */, attr[1] /* radius */, attr[2] /* convex radius */);\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warnOnce(`Unrecognized shape: ${ shape }`);\r\n                return null;\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        Jolt.destroy(this._joltVec3);\r\n        Jolt.destroy(this._joltQuat);\r\n    }\r\n\r\n    // TODO\r\n    // convert creation methods to static\r\n\r\n    _createShape(cb, meshBuffers) {\r\n        // shape number\r\n        const num = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, meshBuffers);\r\n        if (!shapeSettings)\r\n            return false;\r\n\r\n        const shape = shapeSettings.Create().Get();\r\n\r\n        this._backend.tracker.shapeMap.set(num, shape);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createBody(cb, meshBuffers) {\r\n        const backend = this._backend;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n        const Jolt = backend.Jolt;\r\n\r\n        // ------------ SHAPE PROPS ----------------\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, meshBuffers);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n        \r\n        const shape = shapeSettings.Create().Get();\r\n\r\n        // ------------ BODY PROPS ----------------\r\n\r\n        // PCID\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        // position\r\n        jv.FromBuffer(cb);\r\n\r\n        // rotation\r\n        jq.FromBuffer(cb);\r\n\r\n        // motion type\r\n        const motionType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        // use motion state\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        // object layer\r\n        // const layer = cb.read(BUFFER_READ_UINT16);\r\n        // const objectLayer = backend.getBitValue(layer);\r\n        const objectLayer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const bodyCreationSettings = new Jolt.BodyCreationSettings(shape, jv, jq, motionType, objectLayer);\r\n\r\n        bodyCreationSettings.mLinearVelocity = jv.FromBuffer(cb);\r\n        bodyCreationSettings.mAngularVelocity = jv.FromBuffer(cb);\r\n        bodyCreationSettings.mMaxLinearVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mMaxAngularVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mRestitution = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mLinearDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mGravityFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mInertiaMultiplier = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mAllowedDOFs = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        bodyCreationSettings.mAllowDynamicOrKinematic = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mIsSensor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mMotionQuality = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        bodyCreationSettings.mAllowSleeping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        \r\n        // collision group\r\n        const group = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // collision sub group\r\n        const subGroup = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // debug draw\r\n        const debugDraw = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n\r\n        if (group !== null && subGroup !== null) {\r\n            const table = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!table, `Trying to set a filter group that does not exist: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((subGroup <= table?.maxIndex), `Trying to set sub group that is over the filter group table size: ${ subGroup }`);\r\n                if (!ok) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            const mCollisionGroup = bodyCreationSettings.mCollisionGroup;\r\n            mCollisionGroup.SetGroupFilter(table);\r\n            mCollisionGroup.SetGroupID(group);\r\n            mCollisionGroup.SetSubGroupID(subGroup);\r\n        }\r\n\r\n        // override mass properties\r\n        const selectedMethod = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (selectedMethod !== Jolt.EOverrideMassProperties_CalculateMassAndInertia) {\r\n            bodyCreationSettings.mOverrideMassProperties = selectedMethod;\r\n\r\n            const mass = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(mass, `invalid mass: ${ mass }`);\r\n                if (!ok) return false;\r\n            }\r\n            bodyCreationSettings.mMassPropertiesOverride.mMass = mass;\r\n\r\n            if (selectedMethod === Jolt.EOverrideMassProperties_MassAndInertiaProvided) {\r\n                jv.FromBuffer(cb);\r\n                jq.FromBuffer(cb);\r\n\r\n                const m4 = Jolt.Mat44.sRotationTranslation(jq, jv);\r\n                bodyCreationSettings.mMassPropertiesOverride.mInertia = m4;\r\n                Jolt.destroy(m4);\r\n            }\r\n        }\r\n\r\n        const bodyInterface = backend.bodyInterface;\r\n        const body = bodyInterface.CreateBody(bodyCreationSettings);\r\n        bodyInterface.AddBody(body.GetID(), Jolt.Activate);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            body.debugDraw = debugDraw;\r\n        }\r\n\r\n        // Destroy shape settings after body is created:\r\n        Jolt.destroy(shapeSettings);\r\n        Jolt.destroy(bodyCreationSettings);\r\n\r\n        if (backend.config.useMotionStates) {\r\n            if (useMotionState && (motionType === Jolt.EMotionType_Dynamic || motionType === Jolt.EMotionType_Kinematic)) {\r\n                body.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(body);\r\n            }\r\n        }\r\n\r\n        backend.tracker.add(body, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createSoftBody(cb, meshBuffers) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n\r\n        // ------------ SHAPE PROPS ----------------\r\n\r\n        const shapeSettings = Creator.createSoftBodyShapeSettings(cb, meshBuffers, Jolt);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n        \r\n        // ------------ BODY PROPS ----------------\r\n\r\n        // PCID\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(index, `invalid body index: ${ index }`);\r\n            if (!ok) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // position\r\n        jv.FromBuffer(cb);\r\n\r\n        // rotation\r\n        jq.FromBuffer(cb);\r\n\r\n        // const objectLayer = backend.getBitValue(layer);\r\n        const bodyCreationSettings = new Jolt.SoftBodyCreationSettings(shapeSettings, jv, jq);\r\n\r\n        // collision group\r\n        const group = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // collision sub group\r\n        const subGroup = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        bodyCreationSettings.mObjectLayer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        bodyCreationSettings.mNumIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        bodyCreationSettings.mLinearDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mMaxLinearVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mRestitution = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mPressure = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mGravityFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mUpdatePosition = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mMakeRotationIdentity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mAllowSleeping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        \r\n        // debug draw\r\n        const debugDraw = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n\r\n        if (group !== null && subGroup !== null) {\r\n            const table = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(group, `Invalid filter group: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(subGroup, `Invalid filter group: ${ subGroup }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!table, `Trying to set a filter group that does not exist: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((subGroup <= table?.maxIndex), `Trying to set sub group that is over the filter group table size: ${ subGroup }`);\r\n                if (!ok) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            const mCollisionGroup = bodyCreationSettings.mCollisionGroup;\r\n            mCollisionGroup.SetGroupFilter(table);\r\n            mCollisionGroup.SetGroupID(group);\r\n            mCollisionGroup.SetSubGroupID(subGroup);\r\n        }\r\n\r\n        const bodyInterface = backend.bodyInterface;\r\n        const body = bodyInterface.CreateSoftBody(bodyCreationSettings);\r\n        bodyInterface.AddBody(body.GetID(), Jolt.Activate);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            body.debugDraw = debugDraw;\r\n        }\r\n\r\n        // Destroy shape settings after body is created:\r\n        Jolt.destroy(bodyCreationSettings);\r\n\r\n        backend.tracker.add(body, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createVehicle(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n        const physicsSystem = backend.physicsSystem;\r\n        const jv = this._joltVec3;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const isWheeled = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL || type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_MOTORCYCLE;\r\n\r\n        try {\r\n            const destroySettings = (list) => {\r\n                for (let i = 0; i < list.length; i++) {\r\n                    Jolt.destroy(list[i]);\r\n                }\r\n            };\r\n\r\n            const updateCurve = (curve) => {\r\n                curve.Clear();\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                for (let i = 0; i < count; i++) {\r\n                    curve.AddPoint(\r\n                        cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n                        cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32)\r\n                    );\r\n                }\r\n            };\r\n\r\n            const updateGears = (gears) => {\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                gears.clear();\r\n                for (let i = 0; i < count; i++) {\r\n                    gears.push_back(cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32));\r\n                }\r\n            }\r\n\r\n            const updateWheel = (wheel) => {\r\n                wheel.mPosition = jv.FromBuffer(cb);\r\n                wheel.mSuspensionForcePoint = jv.FromBuffer(cb);\r\n                wheel.mSuspensionDirection = jv.FromBuffer(cb);\r\n                wheel.mSteeringAxis = jv.FromBuffer(cb);\r\n                wheel.mWheelUp = jv.FromBuffer(cb);\r\n                wheel.mWheelForward = jv.FromBuffer(cb);\r\n                wheel.mSuspensionMinLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mSuspensionMaxLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mSuspensionPreloadLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mRadius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mWidth = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mEnableSuspensionForcePoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n                const spring = wheel.mSuspensionSpring;\r\n                spring.mMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                spring.mFrequency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                spring.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                spring.mDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                // longitudinal friction\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    updateCurve(wheel.mLongitudinalFriction);\r\n                }\r\n\r\n                // lateral friction\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    updateCurve(wheel.mLateralFriction);\r\n                }                    \r\n\r\n                if (isWheeled) {\r\n                    wheel.mInertia = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxSteerAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxBrakeTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxHandBrakeTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                }\r\n            }\r\n\r\n            // general\r\n            const constraintSettings = new Jolt.VehicleConstraintSettings();\r\n            constraintSettings.mNumVelocityStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            constraintSettings.mNumPositionStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            constraintSettings.mUp = jv.FromBuffer(cb);\r\n            constraintSettings.mForward = jv.FromBuffer(cb);\r\n            constraintSettings.mMaxPitchRollAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n            // controller\r\n            let controllerSettings;\r\n            if (isWheeled) {\r\n                controllerSettings = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL ?\r\n                    new Jolt.WheeledVehicleControllerSettings() :\r\n                    new Jolt.MotorcycleControllerSettings()\r\n            } else {\r\n                constraintSettings = new Jolt.TrackedVehicleControllerSettings();\r\n            }\r\n\r\n            // engine\r\n            const engine = controllerSettings.mEngine;\r\n            engine.mMaxTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mMinRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mMaxRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mInertia = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n            if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                updateCurve(engine.mNormalizedTorque);\r\n            }\r\n\r\n            // transmission\r\n            const transmission = controllerSettings.mTransmission;\r\n            transmission.mMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            transmission.mSwitchTime = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mClutchReleaseTime = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mSwitchLatency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mShiftUpRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mShiftDownRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mClutchStrength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            updateGears(transmission.mGearRatios);\r\n            updateGears(transmission.mReverseGearRatios);\r\n    \r\n            // wheels\r\n            const wheelsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            const mWheels = constraintSettings.mWheels;\r\n            const Wheel = isWheeled ? Jolt.WheelSettingsWV : Jolt.WheelSettingsTV;\r\n            mWheels.clear();\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                const wheel = new Wheel();\r\n                updateWheel(wheel);\r\n                mWheels.push_back(wheel);\r\n            }\r\n\r\n            if (!isWheeled) {\r\n                // get tracks and map wheels\r\n                const tracksCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                for (let t = 0; t < tracksCount; t++) {\r\n                    const track = controllerSettings.get_mTracks(t);\r\n                    const twc = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32); // track wheels count\r\n\r\n                    // Make the last wheel in the track to be a driven wheel (connected to engine)\r\n                    track.mDrivenWheel = twc - 1;\r\n\r\n                    for (let i = 0; i < twc; i++) {\r\n                        track.mWheels.push_back(cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32));\r\n                    }\r\n                }\r\n            }\r\n\r\n            const diffs = [];\r\n            if (isWheeled) {\r\n                // differentials\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                if (count > 0) {\r\n                    const differentials = controllerSettings.mDifferentials;\r\n\r\n                    for (let i = 0; i < count; i++) {\r\n                        const settings = new Jolt.VehicleDifferentialSettings();\r\n\r\n                        settings.mLeftWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_INT32);\r\n                        settings.mRightWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_INT32);\r\n                        settings.mDifferentialRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mLeftRightSplit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mLimitedSlipRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mEngineTorqueRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                        diffs.push(settings);\r\n                        differentials.push_back(settings);\r\n                    }\r\n                }\r\n\r\n                controllerSettings.mDifferentialLimitedSlipRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                if (type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                    controllerSettings.mMaxLeanAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringConstant = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringIntegrationCoefficient = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringIntegrationCoefficientDecay = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSmoothingFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                }\r\n            }\r\n\r\n            // anti roll bars\r\n            const barsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            const mAntiRollBars = constraintSettings.mAntiRollBars;\r\n            const bars = [];\r\n            for (let i = 0; i < barsCount; i++) {\r\n                const bar = new Jolt.VehicleAntiRollBar();\r\n\r\n                bar.mLeftWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                bar.mRightWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                bar.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                bars.push(bar);\r\n                mAntiRollBars.push_back(bar);\r\n            }\r\n\r\n            constraintSettings.mController = controllerSettings;\r\n\r\n            // constraint\r\n            const body = tracker.getBodyByPCID(index);\r\n            const constraint = new Jolt.VehicleConstraint(body, constraintSettings);\r\n            const castType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            const layer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n            // For backend to write wheels isometry\r\n            body.isVehicle = true;\r\n\r\n            // wheels contact tester\r\n            let tester;\r\n            switch (castType) {\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_RAY: {\r\n                    jv.FromBuffer(cb);\r\n                    const maxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterRay(layer, jv, maxAngle);\r\n                    break;\r\n                }\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_SPHERE: {\r\n                    jv.FromBuffer(cb);\r\n                    const maxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    const radius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterCastSphere(layer, radius, jv, maxAngle);\r\n                    break;\r\n                }\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_CYLINDER: {\r\n                    const fraction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterCastCylinder(layer, fraction);\r\n                    break;\r\n                }\r\n                default:\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized cast type: ${ castType }`);\r\n                    return false;\r\n            }\r\n            constraint.SetVehicleCollisionTester(tester);\r\n\r\n            // events\r\n            if (backend.config.vehicleContactEventsEnabled) {\r\n                backend.listener.initVehicleEvents(constraint);\r\n            }\r\n            \r\n            physicsSystem.AddConstraint(constraint);\r\n            \r\n            const listener = new Jolt.VehicleConstraintStepListener(constraint);\r\n            physicsSystem.AddStepListener(listener);\r\n\r\n            // add references for Cleaner operator\r\n            body.constraints = [index];\r\n            constraint.listener = listener;\r\n\r\n            let Controller;\r\n            if (isWheeled) {\r\n                Controller = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL ? \r\n                    Jolt.WheeledVehicleController : \r\n                    Jolt.MotorcycleController;\r\n            } else {\r\n                Controller = Jolt.TrackedVehicleController;\r\n            }\r\n            constraint.controller = Jolt.castObject(constraint.GetController(), Controller);\r\n            constraint.wheelsCount = wheelsCount;\r\n\r\n            tracker.addConstraint(index, constraint, body);\r\n\r\n            destroySettings(diffs);\r\n            destroySettings(bars);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _createGroups(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const groupsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(groupsCount, `Invalid filter groups count: ${ groupsCount }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(groupsCount > 0, `Invalid filter groups count: ${ groupsCount }`);\r\n            if (!ok)\r\n                return false\r\n        }\r\n        \r\n        for (let i = 0; i < groupsCount; i++) {\r\n            const subGroupsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32)\r\n            const table = new Jolt.GroupFilterTable(subGroupsCount);\r\n            backend.groupFilterTables.push(table);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(subGroupsCount, `Invalid sub group count: ${ subGroupsCount }`);\r\n                if (!ok)\r\n                    return false;\r\n                table.maxIndex = subGroupsCount - 1; // for debug test in debug mode when creating a body\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _createShapeSettings(cb, meshBuffers) {\r\n        const Jolt = this._backend.Jolt;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n        const shapeType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        // scale\r\n        const useScale = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        let sx, sy, sz\r\n        if (useScale) {\r\n            sx = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sz = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            \r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sx, `Invalid scale X: ${ sx }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sy, `Invalid scale Y: ${ sy }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sz, `Invalid scale Z: ${ sz }`);\r\n                if (!ok) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n\r\n        let settings, hh, r, cr;\r\n        switch (shapeType) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_BOX:\r\n                jv.FromBuffer(cb, true);\r\n                cr = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(cr, `invalid convex radius: ${ cr }`);\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, jv, cr);\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CAPSULE:\r\n                hh = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(hh, `invalid half height: ${ hh }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((sx === sy) && (sy === sz), `Capsule shape scale must be uniform: ${ sx }, ${ sy }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, hh, r);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CYLINDER:\r\n                hh = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                cr = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(hh, `invalid half height: ${ hh }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(cr, `invalid convex radius: ${ cr }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(sx === sz, `Cylinder shape scale must be uniform in XZ plane: ${ sx }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, hh, r, cr);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_SPHERE:\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((sx === sy) && (sy === sz), `Sphere shape scale must be uniform: ${ sx }, ${ sy }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, r);\r\n                break;\r\n\r\n            // intentional fall-through\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_MESH:\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CONVEX_HULL:\r\n                settings = Creator.createMeshShapeSettings(cb, meshBuffers, shapeType);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_STATIC_COMPOUND:\r\n                settings = this._createStaticCompoundShapeSettings(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_HEIGHTFIELD:\r\n                settings = this._createHeightFieldSettings(cb, meshBuffers);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn('Invalid shape type', shapeType);\r\n                return null;\r\n        }\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_STATIC_COMPOUND) {\r\n            const compoundSettings = new Jolt.StaticCompoundShapeSettings();\r\n    \r\n            for (let i = 0, end = settings.length; i < end; i += 3) {\r\n                const childSettings = settings[i];\r\n                const pos = settings[i + 1];\r\n                const rot = settings[i + 2];\r\n    \r\n                jv.Set(pos.x, pos.y, pos.z);\r\n                jq.Set(rot.x, rot.y, rot.z, rot.w);\r\n    \r\n                compoundSettings.AddShape(jv, jq, childSettings);\r\n            }\r\n\r\n            settings = compoundSettings;\r\n        }\r\n        \r\n        const isCompoundChild = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        if (!isCompoundChild) {\r\n            const density = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(density, `Invalid density value: ${ density }`);\r\n                if (!ok)\r\n                    return null;\r\n            }\r\n            settings.mDensity = density;\r\n        }\r\n\r\n        // shape offset\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            jv.FromBuffer(cb);\r\n            jq.FromBuffer(cb);\r\n\r\n            settings = new Jolt.RotatedTranslatedShapeSettings(jv, jq, settings);\r\n        }\r\n\r\n        // center of mass offset\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            jv.FromBuffer(cb);\r\n\r\n            settings = new Jolt.OffsetCenterOfMassShapeSettings(jv, settings);\r\n        }\r\n\r\n        if (useScale) {\r\n            jv.Set(sx, sy, sz);\r\n            settings = new Jolt.ScaledShapeSettings(settings, jv);\r\n        }\r\n\r\n        return settings;\r\n    } \r\n\r\n    _createStaticCompoundShapeSettings(cb, meshBuffers) {\r\n        const childrenCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const children = [];\r\n\r\n        for (let i = 0; i < childrenCount; i++) {\r\n            const settings = this._createShapeSettings(cb, meshBuffers);\r\n            if (!settings) return null;\r\n\r\n            const pos = {};\r\n            const rot = {};\r\n            \r\n            cb.readVec(pos);\r\n            cb.readQuat(rot);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = true;\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkVec(pos, `Invalid static compound child position vector`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkQuat(rot, `Invalid static compound child quaternion`);\r\n                return null;\r\n            }\r\n\r\n            children.push(settings, pos, rot);\r\n        }\r\n\r\n        return children;\r\n    }\r\n\r\n    _createHeightFieldSettings(cb, meshBuffers) {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!meshBuffers, `Missing buffers to generate a HeightField shape: ${ meshBuffers }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(meshBuffers.length > 0, `Invalid buffers to generate HeightField shape: ${ meshBuffers }`);\r\n            if (!ok) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const Jolt = this._backend.Jolt;\r\n        const jv = this._joltVec3;\r\n        const buffer = meshBuffers.shift();\r\n        const samples = new Float32Array(buffer);\r\n        const size = samples.length;\r\n\r\n        const settings = new Jolt.HeightFieldShapeSettings();\r\n        settings.mOffset = jv.FromBuffer(cb);\r\n        settings.mScale = jv.FromBuffer(cb);\r\n        settings.mSampleCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mBlockSize = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mBitsPerSample = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mActiveEdgeCosThresholdAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mHeightSamples.resize(size);\r\n\r\n        // Convert the height samples into a Float32Array\r\n        const heightSamples = new Float32Array(Jolt.HEAPF32.buffer, Jolt.getPointer(settings.mHeightSamples.data()), size);\r\n\r\n        for (let i = 0, end = heightSamples.length; i < end; i++) {\r\n            const height = samples[i];\r\n            heightSamples[i] = height >=0 ? height : Jolt.HeightFieldShapeConstantValues.prototype.cNoCollisionValue;\r\n        }\r\n\r\n        return settings;\r\n    }\r\n\r\n    _createConstraint(cb) {\r\n        const jv = this._joltVec3;\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n        const physicsSystem = backend.physicsSystem;\r\n\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idx1 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idx2 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const body1 = tracker.getBodyByPCID(idx1);\r\n        const body2 = tracker.getBodyByPCID(idx2);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!body1, `Unable to locate body to add constraint to: ${ idx1 }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!body2, `Unable to locate body to add constraint to: ${ idx2 }`);\r\n            if (!ok) return false;\r\n        }\r\n\r\n        // TODO\r\n        // refactor to own methods\r\n\r\n        let settings;\r\n        switch (type) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_FIXED:\r\n                settings = new Jolt.FixedConstraintSettings();\r\n                if (cb.flag) settings.mAutoDetectPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n                if (!settings.mAutoDetectPoint) {\r\n                    if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                    if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                }\r\n                if (cb.flag) settings.mAxisX1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY2 = jv.FromBuffer(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_POINT:\r\n                settings = new Jolt.PointConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_DISTANCE:\r\n                settings = new Jolt.DistanceConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mMinDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb, Jolt);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_HINGE:\r\n                settings = new Jolt.HingeConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHingeAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHingeAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mLimitsMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitsMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb, Jolt);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb, Jolt);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SLIDER:\r\n                settings = new Jolt.SliderConstraintSettings();\r\n                if (cb.flag) settings.mAutoDetectPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n                if (!settings.mAutoDetectPoint) {\r\n                    if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                    if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                }\r\n                if (cb.flag) settings.mSliderAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mSliderAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mLimitsMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitsMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionForce = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb, Jolt);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb, Jolt);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_CONE:\r\n                settings = new Jolt.ConeConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SWING_TWIST:\r\n                settings = new Jolt.SwingTwistConstraintSettings();\r\n                if (cb.flag) settings.mPosition1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPlaneAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPosition2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPlaneAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mPlaneHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mTwistMinAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mTwistMaxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const swingMotorSettings = this._createMotorSettings(cb, Jolt);\r\n                    settings.mSwingMotorSettings = swingMotorSettings;\r\n                    Jolt.destroy(swingMotorSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const twistMotorSettings = this._createMotorSettings(cb, Jolt);\r\n                    settings.mTwistMotorSettings = twistMotorSettings;\r\n                    Jolt.destroy(twistMotorSettings);\r\n                }\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SIX_DOF:\r\n                settings = new Jolt.SixDOFConstraintSettings();\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                        const min = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        const max = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY, min, max);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX, min, max);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ, min, max);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }                \r\n                if (cb.flag) settings.mPosition1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPosition2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mMaxFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb, Jolt);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb, Jolt);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized constraint type: ${ type }`);\r\n                return false;\r\n        }\r\n\r\n        if (cb.flag) settings.mNumVelocityStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (cb.flag) settings.mNumPositionStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (cb.flag) {\r\n            const space = (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8) === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SPACE_WORLD) ? Jolt.EConstraintSpace_WorldSpace : Jolt.EConstraintSpace_LocalToBodyCOM;\r\n            settings.mSpace = space;\r\n        }\r\n\r\n        const constraint = settings.Create(body1, body2);\r\n\r\n        if (!body1.constraints) {\r\n            body1.constraints = [];\r\n            body1.linked = new Set();\r\n        }\r\n\r\n        if (!body2.constraints) {\r\n            body2.constraints = [];\r\n            body2.linked = new Set();\r\n        }\r\n\r\n        body1.constraints.push(index);\r\n        body2.constraints.push(index);\r\n\r\n        body1.linked.add(body2);\r\n        body2.linked.add(body1);\r\n\r\n        tracker.addConstraint(index, constraint, body1, body2);\r\n\r\n        physicsSystem.AddConstraint(constraint);\r\n        \r\n        return true;\r\n    }\r\n\r\n    _createSpringSettings(cb, Jolt) {\r\n        const springSettings = new Jolt.SpringSettings();\r\n        const mode = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8) : _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SPRING_MODE_FREQUENCY;\r\n        springSettings.mMode = (mode === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SPRING_MODE_FREQUENCY) ? \r\n            Jolt.ESpringMode_FrequencyAndDamping : Jolt.ESpringMode_StiffnessAndDamping;\r\n        if (cb.flag) springSettings.mFrequency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) springSettings.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) springSettings.mDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        return springSettings;\r\n    }\r\n\r\n    _createMotorSettings(cb, Jolt) {\r\n        const motorSettings = new Jolt.MotorSettings();\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            const springsSettings = this._createSpringSettings(cb, Jolt);\r\n            motorSettings.mSpringSettings = springsSettings;\r\n            Jolt.destroy(springsSettings);\r\n        }\r\n        if (cb.flag) motorSettings.mMinForceLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMaxForceLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMinTorqueLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMaxTorqueLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        return motorSettings;\r\n    }\r\n\r\n    _createCharacter(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const listener = backend.listener;\r\n        const charEvents = backend.config.charContactEventsEnabled;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n        const settings = new Jolt.CharacterVirtualSettings();\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, null);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n\r\n        const shape = shapeSettings.Create().Get();\r\n        \r\n        settings.mShape = shape;\r\n\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        jv.FromBuffer(cb);\r\n        settings.mUp = jv;\r\n\r\n        jv.FromBuffer(cb);\r\n        const distance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        const plane = new Jolt.Plane(jv, distance);\r\n        settings.mSupportingVolume = plane;\r\n        Jolt.destroy(plane);\r\n\r\n        settings.mMaxSlopeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMass = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxStrength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        jv.FromBuffer(cb);\r\n        settings.mShapeOffset = jv;\r\n        settings.mBackFaceMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mPredictiveContactDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxCollisionIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mMaxConstraintIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mMinTimeRemaining = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mCollisionTolerance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mCharacterPadding = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxNumHits = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mHitReductionCosMaxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mPenetrationRecoverySpeed = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        jv.FromBuffer(cb);\r\n        jq.FromBuffer(cb);\r\n\r\n        if (charEvents && !listener.charListener) {\r\n            listener.initCharacterEvents();\r\n        }\r\n\r\n        const character = new Jolt.CharacterVirtual(settings, jv, jq, backend.physicsSystem);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            character.debugDraw = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        }        \r\n\r\n        if (backend.config.useMotionStates && useMotionState) {\r\n            character.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(character);\r\n        }\r\n\r\n        if (charEvents) {\r\n            character.SetListener(listener.charListener);\r\n        }\r\n\r\n        // for motion state\r\n        character.isCharacter = true;\r\n\r\n        // for shape reset\r\n        character.originalShape = shape;\r\n\r\n        backend.tracker.add(character, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    static createMeshShapeSettings(cb, meshBuffers, shapeType) {\r\n        const Jolt = this._backend.Jolt;\r\n        const {\r\n            base, stride, numIndices, triCount, positions, indices\r\n        } = Creator.readMeshBuffers(cb, meshBuffers);\r\n\r\n        // TODO:\r\n        // add support for duplicate vertices test\r\n\r\n        const p = positions;\r\n        let i1, i2, i3;\r\n        let settings;\r\n\r\n        if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CONVEX_HULL) {\r\n            const cache = new Set();\r\n            const jv = this._joltVec3;\r\n\r\n            settings = new Jolt.ConvexHullShapeSettings();\r\n\r\n            for (let i = 0; i < numIndices; i++) {\r\n                const index = indices[i] * stride;\r\n                const x = p[index];\r\n                const y = p[index + 1];\r\n                const z = p[index + 2];\r\n\r\n                // deduplicate verts\r\n                const str = `${x}:${y}:${z}`;\r\n                if (!cache.has(str)) {\r\n                    cache.add(str);\r\n                    \r\n                    jv.Set(x, y, z);\r\n                    settings.mPoints.push_back(jv);\r\n                }\r\n            }\r\n        } else if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_MESH) {\r\n            const triangles = new Jolt.TriangleList();\r\n    \r\n            triangles.resize(triCount);\r\n            \r\n            let v1, v2, v3;\r\n            for (let i = 0; i < triCount; i++) {\r\n                i1 = indices[base + i * 3] * stride;\r\n                i2 = indices[base + i * 3 + 1] * stride;\r\n                i3 = indices[base + i * 3 + 2] * stride;\r\n    \r\n                const t = triangles.at(i);\r\n                \r\n                v1 = t.get_mV(0);\r\n                v2 = t.get_mV(1);\r\n                v3 = t.get_mV(2);\r\n    \r\n                v1.x = p[i1]; v1.y = p[i1 + 1]; v1.z = p[i1 + 2];\r\n                v2.x = p[i2]; v2.y = p[i2 + 1]; v2.z = p[i2 + 2];\r\n                v3.x = p[i3]; v3.y = p[i3 + 1]; v3.z = p[i3 + 2];\r\n            }\r\n\r\n            settings = new Jolt.MeshShapeSettings(triangles);\r\n        }\r\n        \r\n        return settings;\r\n    }\r\n\r\n    static createSoftBodyShapeSettings(cb, meshBuffers, Jolt) {\r\n        // scale\r\n        const useScale = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        let sx = 1;\r\n        let sy = 1;\r\n        let sz = 1;\r\n        if (useScale) {\r\n            sx = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sz = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            \r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sx, `Invalid scale X: ${ sx }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sy, `Invalid scale Y: ${ sy }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sz, `Invalid scale Z: ${ sz }`);\r\n                if (!ok) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n\r\n        const {\r\n            base, vertexCount, triCount, positions, indices\r\n        } = Creator.readMeshBuffers(cb, meshBuffers);\r\n        \r\n        const settings = new Jolt.SoftBodySharedSettings();\r\n        \r\n        // Create vertices\r\n        const cache = new Set();\r\n        const jf = new Jolt.Float3();\r\n        const v = new Jolt.SoftBodySharedSettingsVertex();\r\n        for (let i = 0; i < vertexCount; i++) {\r\n            const i3 = i * 3;\r\n            const x = positions[i3];\r\n            const y = positions[i3 + 1];\r\n            const z = positions[i3 + 2];\r\n\r\n            // deduplicate verts\r\n            const str = `${x}:${y}:${z}`;\r\n            if (!cache.has(str)) {\r\n                cache.add(str);\r\n                \r\n                jf.x = x * sx;\r\n                jf.y = y * sy;\r\n                jf.z = z * sz;\r\n                v.mPosition = jf;\r\n\r\n                settings.mVertices.push_back(v);\r\n            }\r\n        }\r\n\r\n        const width = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const length = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const compliance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        const fixedCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const rowVerts = width + 1;\r\n        const colVerts = length + 1;\r\n        \r\n        // Create edges\r\n        const edge = new Jolt.SoftBodySharedSettingsEdge(0, 0, compliance);\r\n        const constraints = settings.mEdgeConstraints;\r\n        let v0, v1;\r\n        for (let y = 0; y < colVerts; y++) {\r\n            for (let x = 0; x < rowVerts; x++) {\r\n                v0 = y + x * colVerts;\r\n                edge.set_mVertex(0, v0);\r\n\r\n                if (y < length) {\r\n                    edge.set_mVertex(1, v0 + 1);\r\n                    constraints.push_back(edge);\r\n                }\r\n                if (x < width) {\r\n                    edge.set_mVertex(1, v0 + colVerts);\r\n                    constraints.push_back(edge);\r\n                }\r\n                if (y < length && x < width) {\r\n                    v1 = v0 + colVerts + 1;\r\n                    edge.set_mVertex(1, v1);\r\n                    constraints.push_back(edge);\r\n                    edge.set_mVertex(0, v0 + 1);\r\n                    edge.set_mVertex(1, v1 - 1);\r\n                    constraints.push_back(edge);\r\n                }\r\n            }\r\n        }\r\n        settings.CalculateEdgeLengths();\r\n\r\n        // Fixed verts\r\n        for (let i = 0; i < fixedCount; i++) {\r\n            const fixedIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            settings.mVertices.at(fixedIndex).mInvMass = 0;\r\n        }\r\n\r\n        // Create faces\r\n        const face = new Jolt.SoftBodySharedSettingsFace(0, 0, 0, 0);\r\n        let i1, i2, i3;\r\n        for (let i = 0; i < triCount; i++) {\r\n            i1 = indices[base + i * 3];\r\n            i2 = indices[base + i * 3 + 1];\r\n            i3 = indices[base + i * 3 + 2];\r\n\r\n            face.set_mVertex(0, i1);\r\n            face.set_mVertex(1, i2);\r\n            face.set_mVertex(2, i3);\r\n            settings.AddFace(face);\r\n        }\r\n\r\n        settings.Optimize();\r\n\r\n        Jolt.destroy(edge);\r\n        Jolt.destroy(face);\r\n        Jolt.destroy(jf);\r\n        Jolt.destroy(v);\r\n\r\n        return settings;\r\n    }\r\n\r\n    static readMeshBuffers(cb, meshBuffers) {\r\n        const base = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const offset = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const stride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const vertexCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const numIndices = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idxLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idxOffset = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(base, `Invalid buffer base to generate mesh/hull: ${ base }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(offset, `Invalid positions buffer offset to generate mesh/hull: ${ offset }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(stride, `Invalid positions buffer stride to generate mesh/hull: ${ stride }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(numIndices, `Invalid indices count to generate mesh/hull: ${ numIndices }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!meshBuffers, `No mesh buffers to generate a mesh/hull: ${ meshBuffers }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(meshBuffers.length > 1, `Invalid buffers to generate mesh/hull: ${ meshBuffers }`);\r\n            if (!ok) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const posBuffer = meshBuffers.shift();\r\n        const idxBuffer = meshBuffers.shift();\r\n        \r\n        const positions = new Float32Array(posBuffer, offset); // vertex positions\r\n        const arrayConstructor = numIndices > 65535 ? Uint32Array : Uint16Array;\r\n        const indices = new arrayConstructor(idxBuffer, idxOffset, idxLength);\r\n        const triCount = Math.floor(numIndices / 3);\r\n\r\n        return { base, stride, vertexCount, numIndices, triCount, positions, indices };\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvY3JlYXRvci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVl3RDtBQUNMO0FBQ0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtRkFBZTtBQUNoQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsd0ZBQW9CO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixxRkFBaUI7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHlGQUFxQjtBQUN0QztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsbUZBQWU7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG9GQUFnQjtBQUNqQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsc0ZBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFLLFFBQVEscURBQUssNEJBQTRCLFNBQVM7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdCQUFnQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixrQkFBa0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHFCQUFxQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0JBQWdCO0FBQ3hDLHVDQUF1QyxzRkFBa0I7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGNBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHFGQUFpQjtBQUM5QywrQkFBK0Isc0ZBQWtCO0FBQ2pELCtCQUErQixxRkFBaUI7QUFDaEQsb0NBQW9DLHNGQUFrQjtBQUN0RCxtQ0FBbUMsc0ZBQWtCO0FBQ3JELGtDQUFrQyxzRkFBa0I7QUFDcEQsa0NBQWtDLHNGQUFrQjtBQUNwRDtBQUNBLFlBQVkscURBQUs7QUFDakIscUJBQXFCLHFEQUFLLGdFQUFnRSxNQUFNO0FBQ2hHLHVCQUF1QixxREFBSyw4RUFBOEUsUUFBUTtBQUNsSCx1QkFBdUIscURBQUssOEVBQThFLFFBQVE7QUFDbEgsdUJBQXVCLHFEQUFLLHdFQUF3RSxZQUFZO0FBQ2hILHVCQUF1QixxREFBSyxvRUFBb0UsYUFBYTtBQUM3Ryx1QkFBdUIscURBQUssMkVBQTJFLGFBQWE7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRDtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDbUI7QUFDbkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9iYWNrZW5kcy9qb2x0L29wZXJhdG9ycy9jcmVhdG9yLm1qcz8yMzg3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBCVUZGRVJfUkVBRF9CT09MLCBCVUZGRVJfUkVBRF9GTE9BVDMyLCBCVUZGRVJfUkVBRF9JTlQzMiwgQlVGRkVSX1JFQURfVUlOVDE2LFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDMyLCBCVUZGRVJfUkVBRF9VSU5UOCwgQ01EX0NSRUFURV9CT0RZLCBDTURfQ1JFQVRFX0NIQVIsXHJcbiAgICBDTURfQ1JFQVRFX0NPTlNUUkFJTlQsIENNRF9DUkVBVEVfR1JPVVBTLCBDTURfQ1JFQVRFX1NIQVBFLCBDTURfQ1JFQVRFX1NPRlRfQk9EWSxcclxuICAgIENNRF9DUkVBVEVfVkVISUNMRSwgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1gsIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9ZLCBcclxuICAgIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aLCBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWCwgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1ksXHJcbiAgICBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWiwgQ09OU1RSQUlOVF9TUEFDRV9XT1JMRCwgQ09OU1RSQUlOVF9UWVBFX0NPTkUsIENPTlNUUkFJTlRfVFlQRV9ESVNUQU5DRSxcclxuICAgIENPTlNUUkFJTlRfVFlQRV9GSVhFRCwgQ09OU1RSQUlOVF9UWVBFX0hJTkdFLCBDT05TVFJBSU5UX1RZUEVfUE9JTlQsIENPTlNUUkFJTlRfVFlQRV9TSVhfRE9GLFxyXG4gICAgQ09OU1RSQUlOVF9UWVBFX1NMSURFUiwgQ09OU1RSQUlOVF9UWVBFX1NXSU5HX1RXSVNULCBTSEFQRV9CT1gsIFNIQVBFX0NBUFNVTEUsIFNIQVBFX0NPTlZFWF9IVUxMLFxyXG4gICAgU0hBUEVfQ1lMSU5ERVIsIFNIQVBFX0hFSUdIVEZJRUxELCBTSEFQRV9NRVNILCBTSEFQRV9TUEhFUkUsIFNIQVBFX1NUQVRJQ19DT01QT1VORCwgXHJcbiAgICBTUFJJTkdfTU9ERV9GUkVRVUVOQ1ksIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSLCBWRUhJQ0xFX0NBU1RfVFlQRV9SQVksIFZFSElDTEVfQ0FTVF9UWVBFX1NQSEVSRSxcclxuICAgIFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFLCBWRUhJQ0xFX1RZUEVfV0hFRUxcclxufSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBNb3Rpb25TdGF0ZSB9IGZyb20gXCIuLi9tb3Rpb24tc3RhdGUubWpzXCI7XHJcblxyXG5jbGFzcyBDcmVhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKGJhY2tlbmQpIHtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gYmFja2VuZDtcclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGVQaHlzaWNzU3lzdGVtKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlKG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9iYWNrZW5kLmluQnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjYi5yZWFkQ29tbWFuZCgpO1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfQk9EWTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlQm9keShjYiwgbWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfU09GVF9CT0RZOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jcmVhdGVTb2Z0Qm9keShjYiwgbWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfR1JPVVBTOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jcmVhdGVHcm91cHMoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfQ09OU1RSQUlOVDpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlQ29uc3RyYWludChjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NSRUFURV9DSEFSOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jcmVhdGVDaGFyYWN0ZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfU0hBUEU6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2NyZWF0ZVNoYXBlKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NSRUFURV9WRUhJQ0xFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jcmVhdGVWZWhpY2xlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgSW52YWxpZCBjb21tYW5kOiAkeyBjb21tYW5kIH1gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVQaHlzaWNzU3lzdGVtKCkge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGJhY2tlbmQuY29uZmlnO1xyXG4gICAgICAgIC8vIGNvbnN0IGxheWVyUGFpcnMgPSBjb25maWcubGF5ZXJQYWlycztcclxuICAgICAgICAvLyBjb25zdCBsYXllcnMgPSBjb25maWcubGF5ZXJzO1xyXG4gICAgICAgIC8vIGNvbnN0IGxheWVycyA9IGNvbmZpZy5vYmplY3RMYXllcnM7XHJcbiAgICAgICAgLy8gY29uc3QgbGF5ZXJzQ291bnQgPSBsYXllcnMubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcblxyXG4gICAgICAgIHRoaXMuX2pvbHRWZWMzID0gbmV3IEpvbHQuVmVjMygpO1xyXG4gICAgICAgIHRoaXMuX2pvbHRWZWMzXzIgPSBuZXcgSm9sdC5WZWMzKCk7XHJcbiAgICAgICAgdGhpcy5fam9sdFF1YXQgPSBuZXcgSm9sdC5RdWF0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGJwTWFwID0gbmV3IE1hcCgpO1xyXG5cclxuICAgICAgICBjb25zdCBwYWlycyA9IGNvbmZpZy5vYmplY3RMYXllclBhaXJzO1xyXG4gICAgICAgIGNvbnN0IHBhaXJzQ291bnQgPSBwYWlycy5sZW5ndGg7XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0RmlsdGVyID0gbmV3IEpvbHQuT2JqZWN0TGF5ZXJQYWlyRmlsdGVyVGFibGUocGFpcnNDb3VudCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWlyc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgcGFpciA9IHBhaXJzW2ldO1xyXG4gICAgICAgICAgICBvYmplY3RGaWx0ZXIuRW5hYmxlQ29sbGlzaW9uKHBhaXJbMF0sIHBhaXJbMV0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYnBMYXllcnMgPSBjb25maWcuYnJvYWRQaGFzZUxheWVycztcclxuICAgICAgICBjb25zdCBicExheWVyQ291bnQgPSBicExheWVycy5sZW5ndGg7XHJcbiAgICAgICAgY29uc3QgYnBJbnRlcmZhY2UgPSBuZXcgSm9sdC5Ccm9hZFBoYXNlTGF5ZXJJbnRlcmZhY2VUYWJsZShwYWlyc0NvdW50LCBicExheWVyQ291bnQpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnBMYXllckNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBicExheWVyc1tpXTtcclxuICAgICAgICAgICAgY29uc3QgYnBMYXllciA9IG5ldyBKb2x0LkJyb2FkUGhhc2VMYXllcihpZCk7XHJcbiAgICAgICAgICAgIGJwTWFwLnNldChpZCwgYnBMYXllcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBNYXAgb2JqZWN0IGxheWVycyB0byBicm9hZHBoYXNlIGxheWVyc1xyXG4gICAgICAgIGxldCBvYmpMYXllckNvdW50ID0gMDtcclxuICAgICAgICBmb3IgKGNvbnN0IFtvYmpMYXllciwgYnBMYXllcnNdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZy5tYXBPYmplY3RUb0Jyb2FkUGhhc2VMYXllcikpIHtcclxuICAgICAgICAgICAgb2JqTGF5ZXJDb3VudCsrO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJwTGF5ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBicEludGVyZmFjZS5NYXBPYmplY3RUb0Jyb2FkUGhhc2VMYXllcihvYmpMYXllciwgYnBNYXAuZ2V0KGJwTGF5ZXJzW2ldKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQnJvYWRwaGFzZSBsYXllcnMgaGF2ZSBiZWVuIGNvcGllZCB0byB0aGUgYnBJbnRlcmZhY2UsIHNvIHdlIGNhbiBkZXN0cm95IHRob3NlXHJcbiAgICAgICAgYnBNYXAuZm9yRWFjaChicExheWVyID0+IHtcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KGJwTGF5ZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJwTWFwLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbmV3IEpvbHQuSm9sdFNldHRpbmdzKCk7XHJcbiAgICAgICAgc2V0dGluZ3MubU9iamVjdExheWVyUGFpckZpbHRlciA9IG9iamVjdEZpbHRlcjtcclxuICAgICAgICBzZXR0aW5ncy5tQnJvYWRQaGFzZUxheWVySW50ZXJmYWNlID0gYnBJbnRlcmZhY2U7XHJcbiAgICAgICAgc2V0dGluZ3MubU9iamVjdFZzQnJvYWRQaGFzZUxheWVyRmlsdGVyID0gbmV3IEpvbHQuT2JqZWN0VnNCcm9hZFBoYXNlTGF5ZXJGaWx0ZXJUYWJsZShzZXR0aW5ncy5tQnJvYWRQaGFzZUxheWVySW50ZXJmYWNlLCBicExheWVyQ291bnQsIHNldHRpbmdzLm1PYmplY3RMYXllclBhaXJGaWx0ZXIsIG9iakxheWVyQ291bnQpO1xyXG4gICAgICAgIGNvbnN0IGpvbHRJbnRlcmZhY2UgPSBuZXcgSm9sdC5Kb2x0SW50ZXJmYWNlKHNldHRpbmdzKTtcclxuICAgICAgICBKb2x0LmRlc3Ryb3koc2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBjb25zdCBwaHlzaWNzU3lzdGVtID0gam9sdEludGVyZmFjZS5HZXRQaHlzaWNzU3lzdGVtKCk7XHJcbiAgICAgICAgY29uc3Qgc3lzdGVtU2V0dGluZ3MgPSBwaHlzaWNzU3lzdGVtLkdldFBoeXNpY3NTZXR0aW5ncygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1CYXVtZ2FydGUgPSBjb25maWcuYmF1bWdhcnRlO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Cb2R5UGFpckNhY2hlQ29zTWF4RGVsdGFSb3RhdGlvbkRpdjIgPSBjb25maWcuYm9keVBhaXJDYWNoZUNvc01heERlbHRhUm90YXRpb25EaXYyO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Cb2R5UGFpckNhY2hlTWF4RGVsdGFQb3NpdGlvblNxID0gY29uZmlnLmJvZHlQYWlyQ2FjaGVNYXhEZWx0YVBvc2l0aW9uU3E7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUNvbnRhY3ROb3JtYWxDb3NNYXhEZWx0YVJvdGF0aW9uID0gY29uZmlnLmNvbnRhY3ROb3JtYWxDb3NNYXhEZWx0YVJvdGF0aW9uO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Db250YWN0UG9pbnRQcmVzZXJ2ZUxhbWJkYU1heERpc3RTcSA9IGNvbmZpZy5jb250YWN0UG9pbnRQcmVzZXJ2ZUxhbWJkYU1heERpc3RTcTtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tRGV0ZXJtaW5pc3RpY1NpbXVsYXRpb24gPSBjb25maWcuZGV0ZXJtaW5pc3RpY1NpbXVsYXRpb247XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUxpbmVhckNhc3RNYXhQZW5ldHJhdGlvbiA9IGNvbmZpZy5saW5lYXJDYXN0TWF4UGVuZXRyYXRpb247XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUxpbmVhckNhc3RUaHJlc2hvbGQgPSBjb25maWcubGluZWFyQ2FzdFRocmVzaG9sZDtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTWFuaWZvbGRUb2xlcmFuY2VTcSA9IGNvbmZpZy5tYW5pZm9sZFRvbGVyYW5jZVNxO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1NYXhJbkZsaWdodEJvZHlQYWlycyA9IGNvbmZpZy5tYXhJbkZsaWdodEJvZHlQYWlycztcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTWF4UGVuZXRyYXRpb25EaXN0YW5jZSA9IGNvbmZpZy5tYXhQZW5ldHJhdGlvbkRpc3RhbmNlO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1NaW5WZWxvY2l0eUZvclJlc3RpdHV0aW9uID0gY29uZmlnLm1pblZlbG9jaXR5Rm9yUmVzdGl0dXRpb247XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubU51bVBvc2l0aW9uU3RlcHMgPSBjb25maWcubnVtUG9zaXRpb25TdGVwcztcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTnVtVmVsb2NpdHlTdGVwcyA9IGNvbmZpZy5udW1WZWxvY2l0eVN0ZXBzO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1QZW5ldHJhdGlvblNsb3AgPSBjb25maWcucGVuZXRyYXRpb25TbG9wO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Qb2ludFZlbG9jaXR5U2xlZXBUaHJlc2hvbGQgPSBjb25maWcucG9pbnRWZWxvY2l0eVNsZWVwVGhyZXNob2xkO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1TcGVjdWxhdGl2ZUNvbnRhY3REaXN0YW5jZSA9IGNvbmZpZy5zcGVjdWxhdGl2ZUNvbnRhY3REaXN0YW5jZTtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tU3RlcExpc3RlbmVyQmF0Y2hlc1BlckpvYiA9IGNvbmZpZy5zdGVwTGlzdGVuZXJCYXRjaGVzUGVySm9iO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1TdGVwTGlzdGVuZXJzQmF0Y2hTaXplID0gY29uZmlnLnN0ZXBMaXN0ZW5lcnNCYXRjaFNpemU7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVRpbWVCZWZvcmVTbGVlcCA9IGNvbmZpZy50aW1lQmVmb3JlU2xlZXA7XHJcblxyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Db25zdHJhaW50V2FybVN0YXJ0ID0gY29uZmlnLmNvbnN0cmFpbnRXYXJtU3RhcnQ7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVVzZUJvZHlQYWlyQ29udGFjdENhY2hlID0gY29uZmlnLnVzZUJvZHlQYWlyQ29udGFjdENhY2hlO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Vc2VNYW5pZm9sZFJlZHVjdGlvbiA9IGNvbmZpZy51c2VNYW5pZm9sZFJlZHVjdGlvbjtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tVXNlTGFyZ2VJc2xhbmRTcGxpdHRlciA9IGNvbmZpZy51c2VMYXJnZUlzbGFuZFNwbGl0dGVyO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1BbGxvd1NsZWVwaW5nID0gY29uZmlnLmFsbG93U2xlZXBpbmc7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUNoZWNrQWN0aXZlRWRnZXMgPSBjb25maWcuY2hlY2tBY3RpdmVFZGdlcztcclxuXHJcbiAgICAgICAgcGh5c2ljc1N5c3RlbS5TZXRQaHlzaWNzU2V0dGluZ3Moc3lzdGVtU2V0dGluZ3MpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGJhY2tlbmQuam9sdEludGVyZmFjZSA9IGpvbHRJbnRlcmZhY2U7XHJcbiAgICAgICAgYmFja2VuZC5waHlzaWNzU3lzdGVtID0gcGh5c2ljc1N5c3RlbTtcclxuXHJcbiAgICAgICAgYmFja2VuZC5icEZpbHRlciA9IG5ldyBKb2x0LkRlZmF1bHRCcm9hZFBoYXNlTGF5ZXJGaWx0ZXIoam9sdEludGVyZmFjZS5HZXRPYmplY3RWc0Jyb2FkUGhhc2VMYXllckZpbHRlcigpLCAxKTtcclxuICAgICAgICBiYWNrZW5kLm9iakZpbHRlciA9IG5ldyBKb2x0LkRlZmF1bHRPYmplY3RMYXllckZpbHRlcihqb2x0SW50ZXJmYWNlLkdldE9iamVjdExheWVyUGFpckZpbHRlcigpLCAxKTtcclxuICAgICAgICBiYWNrZW5kLmJvZHlGaWx0ZXIgPSBuZXcgSm9sdC5Cb2R5RmlsdGVyKCk7XHJcbiAgICAgICAgYmFja2VuZC5zaGFwZUZpbHRlciA9IG5ldyBKb2x0LlNoYXBlRmlsdGVyKCk7XHJcbiAgICAgICAgYmFja2VuZC5ib2R5TGlzdCA9IG5ldyBKb2x0LkJvZHlJRFZlY3RvcigpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVNoYXBlU2V0dGluZ3Moc2hhcGUsIC4uLmF0dHIpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5fYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHNoYXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQk9YOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2x0LkJveFNoYXBlU2V0dGluZ3MoYXR0clswXSAvKiBoYWxmIGV4dGVudCAqLywgYXR0clsxXSAvKiBjb252ZXggcmFkaXVzICovKTtcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfU1BIRVJFOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2x0LlNwaGVyZVNoYXBlU2V0dGluZ3MoYXR0clswXSAvKiByYWRpdXMgKi8pO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9DQVBTVUxFOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2x0LkNhcHN1bGVTaGFwZVNldHRpbmdzKGF0dHJbMF0gLyogaGFsZiBoZWlnaHQgKi8sIGF0dHJbMV0gLyogcmFkaXVzICovKTtcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ1lMSU5ERVI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvbHQuQ3lsaW5kZXJTaGFwZVNldHRpbmdzKGF0dHJbMF0gLyogaGFsZiBoZWlnaHQgKi8sIGF0dHJbMV0gLyogcmFkaXVzICovLCBhdHRyWzJdIC8qIGNvbnZleCByYWRpdXMgKi8pO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy53YXJuT25jZShgVW5yZWNvZ25pemVkIHNoYXBlOiAkeyBzaGFwZSB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fam9sdFZlYzMpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0UXVhdCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ET1xyXG4gICAgLy8gY29udmVydCBjcmVhdGlvbiBtZXRob2RzIHRvIHN0YXRpY1xyXG5cclxuICAgIF9jcmVhdGVTaGFwZShjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICAvLyBzaGFwZSBudW1iZXJcclxuICAgICAgICBjb25zdCBudW0gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgaWYgKCFzaGFwZVNldHRpbmdzKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVTZXR0aW5ncy5DcmVhdGUoKS5HZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fYmFja2VuZC50cmFja2VyLnNoYXBlTWFwLnNldChudW0sIHNoYXBlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZUJvZHkoY2IsIG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBqcSA9IHRoaXMuX2pvbHRRdWF0O1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcblxyXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLSBTSEFQRSBQUk9QUyAtLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgaWYgKCFzaGFwZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZVNldHRpbmdzLkNyZWF0ZSgpLkdldCgpO1xyXG5cclxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0gQk9EWSBQUk9QUyAtLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIC8vIFBDSURcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgLy8gcG9zaXRpb25cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuXHJcbiAgICAgICAgLy8gcm90YXRpb25cclxuICAgICAgICBqcS5Gcm9tQnVmZmVyKGNiKTtcclxuXHJcbiAgICAgICAgLy8gbW90aW9uIHR5cGVcclxuICAgICAgICBjb25zdCBtb3Rpb25UeXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcblxyXG4gICAgICAgIC8vIHVzZSBtb3Rpb24gc3RhdGVcclxuICAgICAgICBjb25zdCB1c2VNb3Rpb25TdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgIC8vIG9iamVjdCBsYXllclxyXG4gICAgICAgIC8vIGNvbnN0IGxheWVyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIC8vIGNvbnN0IG9iamVjdExheWVyID0gYmFja2VuZC5nZXRCaXRWYWx1ZShsYXllcik7XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0TGF5ZXIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgYm9keUNyZWF0aW9uU2V0dGluZ3MgPSBuZXcgSm9sdC5Cb2R5Q3JlYXRpb25TZXR0aW5ncyhzaGFwZSwganYsIGpxLCBtb3Rpb25UeXBlLCBvYmplY3RMYXllcik7XHJcblxyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1MaW5lYXJWZWxvY2l0eSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1Bbmd1bGFyVmVsb2NpdHkgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWF4TGluZWFyVmVsb2NpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYXhBbmd1bGFyVmVsb2NpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1GcmljdGlvbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubVJlc3RpdHV0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTGluZWFyRGFtcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUFuZ3VsYXJEYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tR3Jhdml0eUZhY3RvciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUluZXJ0aWFNdWx0aXBsaWVyID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dlZERPRnMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dEeW5hbWljT3JLaW5lbWF0aWMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1Jc1NlbnNvciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU1vdGlvblF1YWxpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dTbGVlcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gY29sbGlzaW9uIGdyb3VwXHJcbiAgICAgICAgY29uc3QgZ3JvdXAgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpIDogbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY29sbGlzaW9uIHN1YiBncm91cFxyXG4gICAgICAgIGNvbnN0IHN1Ykdyb3VwID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKSA6IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGRlYnVnIGRyYXdcclxuICAgICAgICBjb25zdCBkZWJ1Z0RyYXcgPSBEZWJ1Zy5kZXYgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChncm91cCAhPT0gbnVsbCAmJiBzdWJHcm91cCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCB0YWJsZSA9IGJhY2tlbmQuZ3JvdXBGaWx0ZXJUYWJsZXNbZ3JvdXBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuYXNzZXJ0KCEhdGFibGUsIGBUcnlpbmcgdG8gc2V0IGEgZmlsdGVyIGdyb3VwIHRoYXQgZG9lcyBub3QgZXhpc3Q6ICR7IGdyb3VwIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KChzdWJHcm91cCA8PSB0YWJsZT8ubWF4SW5kZXgpLCBgVHJ5aW5nIHRvIHNldCBzdWIgZ3JvdXAgdGhhdCBpcyBvdmVyIHRoZSBmaWx0ZXIgZ3JvdXAgdGFibGUgc2l6ZTogJHsgc3ViR3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgbUNvbGxpc2lvbkdyb3VwID0gYm9keUNyZWF0aW9uU2V0dGluZ3MubUNvbGxpc2lvbkdyb3VwO1xyXG4gICAgICAgICAgICBtQ29sbGlzaW9uR3JvdXAuU2V0R3JvdXBGaWx0ZXIodGFibGUpO1xyXG4gICAgICAgICAgICBtQ29sbGlzaW9uR3JvdXAuU2V0R3JvdXBJRChncm91cCk7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRTdWJHcm91cElEKHN1Ykdyb3VwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG92ZXJyaWRlIG1hc3MgcHJvcGVydGllc1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTWV0aG9kID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgaWYgKHNlbGVjdGVkTWV0aG9kICE9PSBKb2x0LkVPdmVycmlkZU1hc3NQcm9wZXJ0aWVzX0NhbGN1bGF0ZU1hc3NBbmRJbmVydGlhKSB7XHJcbiAgICAgICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1PdmVycmlkZU1hc3NQcm9wZXJ0aWVzID0gc2VsZWN0ZWRNZXRob2Q7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtYXNzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0UG9zaXRpdmUobWFzcywgYGludmFsaWQgbWFzczogJHsgbWFzcyB9YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU1hc3NQcm9wZXJ0aWVzT3ZlcnJpZGUubU1hc3MgPSBtYXNzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkTWV0aG9kID09PSBKb2x0LkVPdmVycmlkZU1hc3NQcm9wZXJ0aWVzX01hc3NBbmRJbmVydGlhUHJvdmlkZWQpIHtcclxuICAgICAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAganEuRnJvbUJ1ZmZlcihjYik7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbTQgPSBKb2x0Lk1hdDQ0LnNSb3RhdGlvblRyYW5zbGF0aW9uKGpxLCBqdik7XHJcbiAgICAgICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWFzc1Byb3BlcnRpZXNPdmVycmlkZS5tSW5lcnRpYSA9IG00O1xyXG4gICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KG00KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYm9keUludGVyZmFjZSA9IGJhY2tlbmQuYm9keUludGVyZmFjZTtcclxuICAgICAgICBjb25zdCBib2R5ID0gYm9keUludGVyZmFjZS5DcmVhdGVCb2R5KGJvZHlDcmVhdGlvblNldHRpbmdzKTtcclxuICAgICAgICBib2R5SW50ZXJmYWNlLkFkZEJvZHkoYm9keS5HZXRJRCgpLCBKb2x0LkFjdGl2YXRlKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBib2R5LmRlYnVnRHJhdyA9IGRlYnVnRHJhdztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERlc3Ryb3kgc2hhcGUgc2V0dGluZ3MgYWZ0ZXIgYm9keSBpcyBjcmVhdGVkOlxyXG4gICAgICAgIEpvbHQuZGVzdHJveShzaGFwZVNldHRpbmdzKTtcclxuICAgICAgICBKb2x0LmRlc3Ryb3koYm9keUNyZWF0aW9uU2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBpZiAoYmFja2VuZC5jb25maWcudXNlTW90aW9uU3RhdGVzKSB7XHJcbiAgICAgICAgICAgIGlmICh1c2VNb3Rpb25TdGF0ZSAmJiAobW90aW9uVHlwZSA9PT0gSm9sdC5FTW90aW9uVHlwZV9EeW5hbWljIHx8IG1vdGlvblR5cGUgPT09IEpvbHQuRU1vdGlvblR5cGVfS2luZW1hdGljKSkge1xyXG4gICAgICAgICAgICAgICAgYm9keS5tb3Rpb25TdGF0ZSA9IG5ldyBNb3Rpb25TdGF0ZShib2R5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYmFja2VuZC50cmFja2VyLmFkZChib2R5LCBpbmRleCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9jcmVhdGVTb2Z0Qm9keShjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzM7XHJcbiAgICAgICAgY29uc3QganEgPSB0aGlzLl9qb2x0UXVhdDtcclxuXHJcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tIFNIQVBFIFBST1BTIC0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGVTZXR0aW5ncyA9IENyZWF0b3IuY3JlYXRlU29mdEJvZHlTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycywgSm9sdCk7XHJcbiAgICAgICAgaWYgKCFzaGFwZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tIEJPRFkgUFJPUFMgLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAvLyBQQ0lEXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoaW5kZXgsIGBpbnZhbGlkIGJvZHkgaW5kZXg6ICR7IGluZGV4IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBwb3NpdGlvblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAvLyByb3RhdGlvblxyXG4gICAgICAgIGpxLkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBvYmplY3RMYXllciA9IGJhY2tlbmQuZ2V0Qml0VmFsdWUobGF5ZXIpO1xyXG4gICAgICAgIGNvbnN0IGJvZHlDcmVhdGlvblNldHRpbmdzID0gbmV3IEpvbHQuU29mdEJvZHlDcmVhdGlvblNldHRpbmdzKHNoYXBlU2V0dGluZ3MsIGp2LCBqcSk7XHJcblxyXG4gICAgICAgIC8vIGNvbGxpc2lvbiBncm91cFxyXG4gICAgICAgIGNvbnN0IGdyb3VwID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKSA6IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGNvbGxpc2lvbiBzdWIgZ3JvdXBcclxuICAgICAgICBjb25zdCBzdWJHcm91cCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMikgOiBudWxsO1xyXG5cclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tT2JqZWN0TGF5ZXIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU51bUl0ZXJhdGlvbnMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUxpbmVhckRhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYXhMaW5lYXJWZWxvY2l0eSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubVJlc3RpdHV0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tRnJpY3Rpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1QcmVzc3VyZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUdyYXZpdHlGYWN0b3IgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1VcGRhdGVQb3NpdGlvbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU1ha2VSb3RhdGlvbklkZW50aXR5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dTbGVlcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gZGVidWcgZHJhd1xyXG4gICAgICAgIGNvbnN0IGRlYnVnRHJhdyA9IERlYnVnLmRldiA/IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKGdyb3VwICE9PSBudWxsICYmIHN1Ykdyb3VwICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gYmFja2VuZC5ncm91cEZpbHRlclRhYmxlc1tncm91cF07XHJcblxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoZ3JvdXAsIGBJbnZhbGlkIGZpbHRlciBncm91cDogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1VpbnQoc3ViR3JvdXAsIGBJbnZhbGlkIGZpbHRlciBncm91cDogJHsgc3ViR3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoISF0YWJsZSwgYFRyeWluZyB0byBzZXQgYSBmaWx0ZXIgZ3JvdXAgdGhhdCBkb2VzIG5vdCBleGlzdDogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoKHN1Ykdyb3VwIDw9IHRhYmxlPy5tYXhJbmRleCksIGBUcnlpbmcgdG8gc2V0IHN1YiBncm91cCB0aGF0IGlzIG92ZXIgdGhlIGZpbHRlciBncm91cCB0YWJsZSBzaXplOiAkeyBzdWJHcm91cCB9YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtQ29sbGlzaW9uR3JvdXAgPSBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQ29sbGlzaW9uR3JvdXA7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRHcm91cEZpbHRlcih0YWJsZSk7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRHcm91cElEKGdyb3VwKTtcclxuICAgICAgICAgICAgbUNvbGxpc2lvbkdyb3VwLlNldFN1Ykdyb3VwSUQoc3ViR3JvdXApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYm9keUludGVyZmFjZSA9IGJhY2tlbmQuYm9keUludGVyZmFjZTtcclxuICAgICAgICBjb25zdCBib2R5ID0gYm9keUludGVyZmFjZS5DcmVhdGVTb2Z0Qm9keShib2R5Q3JlYXRpb25TZXR0aW5ncyk7XHJcbiAgICAgICAgYm9keUludGVyZmFjZS5BZGRCb2R5KGJvZHkuR2V0SUQoKSwgSm9sdC5BY3RpdmF0ZSk7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgYm9keS5kZWJ1Z0RyYXcgPSBkZWJ1Z0RyYXc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBEZXN0cm95IHNoYXBlIHNldHRpbmdzIGFmdGVyIGJvZHkgaXMgY3JlYXRlZDpcclxuICAgICAgICBKb2x0LmRlc3Ryb3koYm9keUNyZWF0aW9uU2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBiYWNrZW5kLnRyYWNrZXIuYWRkKGJvZHksIGluZGV4KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZVZlaGljbGUoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBiYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgcGh5c2ljc1N5c3RlbSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBjb25zdCBpc1doZWVsZWQgPSB0eXBlID09PSBWRUhJQ0xFX1RZUEVfV0hFRUwgfHwgdHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEU7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlc3Ryb3lTZXR0aW5ncyA9IChsaXN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kobGlzdFtpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVDdXJ2ZSA9IChjdXJ2ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY3VydmUuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VydmUuQWRkUG9pbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlR2VhcnMgPSAoZ2VhcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgZ2VhcnMuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGdlYXJzLnB1c2hfYmFjayhjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlV2hlZWwgPSAod2hlZWwpID0+IHtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1Qb3NpdGlvbiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubVN1c3BlbnNpb25Gb3JjZVBvaW50ID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tU3VzcGVuc2lvbkRpcmVjdGlvbiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubVN0ZWVyaW5nQXhpcyA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubVdoZWVsVXAgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1XaGVlbEZvcndhcmQgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1TdXNwZW5zaW9uTWluTGVuZ3RoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1TdXNwZW5zaW9uTWF4TGVuZ3RoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1TdXNwZW5zaW9uUHJlbG9hZExlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tUmFkaXVzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1XaWR0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tRW5hYmxlU3VzcGVuc2lvbkZvcmNlUG9pbnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZyA9IHdoZWVsLm1TdXNwZW5zaW9uU3ByaW5nO1xyXG4gICAgICAgICAgICAgICAgc3ByaW5nLm1Nb2RlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgICAgICBzcHJpbmcubUZyZXF1ZW5jeSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBzcHJpbmcubVN0aWZmbmVzcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBzcHJpbmcubURhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGxvbmdpdHVkaW5hbCBmcmljdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDdXJ2ZSh3aGVlbC5tTG9uZ2l0dWRpbmFsRnJpY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGxhdGVyYWwgZnJpY3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ3VydmUod2hlZWwubUxhdGVyYWxGcmljdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwubUluZXJ0aWEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLm1Bbmd1bGFyRGFtcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwubU1heFN0ZWVyQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLm1NYXhCcmFrZVRvcnF1ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwubU1heEhhbmRCcmFrZVRvcnF1ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGdlbmVyYWxcclxuICAgICAgICAgICAgY29uc3QgY29uc3RyYWludFNldHRpbmdzID0gbmV3IEpvbHQuVmVoaWNsZUNvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICBjb25zdHJhaW50U2V0dGluZ3MubU51bVZlbG9jaXR5U3RlcHNPdmVycmlkZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDE2KTtcclxuICAgICAgICAgICAgY29uc3RyYWludFNldHRpbmdzLm1OdW1Qb3NpdGlvblN0ZXBzT3ZlcnJpZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncy5tVXAgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgY29uc3RyYWludFNldHRpbmdzLm1Gb3J3YXJkID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncy5tTWF4UGl0Y2hSb2xsQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29udHJvbGxlclxyXG4gICAgICAgICAgICBsZXQgY29udHJvbGxlclNldHRpbmdzO1xyXG4gICAgICAgICAgICBpZiAoaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyU2V0dGluZ3MgPSB0eXBlID09PSBWRUhJQ0xFX1RZUEVfV0hFRUwgP1xyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBKb2x0LldoZWVsZWRWZWhpY2xlQ29udHJvbGxlclNldHRpbmdzKCkgOlxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBKb2x0Lk1vdG9yY3ljbGVDb250cm9sbGVyU2V0dGluZ3MoKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3RyYWludFNldHRpbmdzID0gbmV3IEpvbHQuVHJhY2tlZFZlaGljbGVDb250cm9sbGVyU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZW5naW5lXHJcbiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IGNvbnRyb2xsZXJTZXR0aW5ncy5tRW5naW5lO1xyXG4gICAgICAgICAgICBlbmdpbmUubU1heFRvcnF1ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGVuZ2luZS5tTWluUlBNID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgZW5naW5lLm1NYXhSUE0gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBlbmdpbmUubUluZXJ0aWEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBlbmdpbmUubUFuZ3VsYXJEYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVDdXJ2ZShlbmdpbmUubU5vcm1hbGl6ZWRUb3JxdWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB0cmFuc21pc3Npb25cclxuICAgICAgICAgICAgY29uc3QgdHJhbnNtaXNzaW9uID0gY29udHJvbGxlclNldHRpbmdzLm1UcmFuc21pc3Npb247XHJcbiAgICAgICAgICAgIHRyYW5zbWlzc2lvbi5tTW9kZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICB0cmFuc21pc3Npb24ubVN3aXRjaFRpbWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICB0cmFuc21pc3Npb24ubUNsdXRjaFJlbGVhc2VUaW1lID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1Td2l0Y2hMYXRlbmN5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1TaGlmdFVwUlBNID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1TaGlmdERvd25SUE0gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICB0cmFuc21pc3Npb24ubUNsdXRjaFN0cmVuZ3RoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdXBkYXRlR2VhcnModHJhbnNtaXNzaW9uLm1HZWFyUmF0aW9zKTtcclxuICAgICAgICAgICAgdXBkYXRlR2VhcnModHJhbnNtaXNzaW9uLm1SZXZlcnNlR2VhclJhdGlvcyk7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gd2hlZWxzXHJcbiAgICAgICAgICAgIGNvbnN0IHdoZWVsc0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICBjb25zdCBtV2hlZWxzID0gY29uc3RyYWludFNldHRpbmdzLm1XaGVlbHM7XHJcbiAgICAgICAgICAgIGNvbnN0IFdoZWVsID0gaXNXaGVlbGVkID8gSm9sdC5XaGVlbFNldHRpbmdzV1YgOiBKb2x0LldoZWVsU2V0dGluZ3NUVjtcclxuICAgICAgICAgICAgbVdoZWVscy5jbGVhcigpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdoZWVsID0gbmV3IFdoZWVsKCk7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVXaGVlbCh3aGVlbCk7XHJcbiAgICAgICAgICAgICAgICBtV2hlZWxzLnB1c2hfYmFjayh3aGVlbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBnZXQgdHJhY2tzIGFuZCBtYXAgd2hlZWxzXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cmFja3NDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgdHJhY2tzQ291bnQ7IHQrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gY29udHJvbGxlclNldHRpbmdzLmdldF9tVHJhY2tzKHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHR3YyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTsgLy8gdHJhY2sgd2hlZWxzIGNvdW50XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGxhc3Qgd2hlZWwgaW4gdGhlIHRyYWNrIHRvIGJlIGEgZHJpdmVuIHdoZWVsIChjb25uZWN0ZWQgdG8gZW5naW5lKVxyXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrLm1Ecml2ZW5XaGVlbCA9IHR3YyAtIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHdjOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2subVdoZWVscy5wdXNoX2JhY2soY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRpZmZzID0gW107XHJcbiAgICAgICAgICAgIGlmIChpc1doZWVsZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudGlhbHNcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVudGlhbHMgPSBjb250cm9sbGVyU2V0dGluZ3MubURpZmZlcmVudGlhbHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG5ldyBKb2x0LlZlaGljbGVEaWZmZXJlbnRpYWxTZXR0aW5ncygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubUxlZnRXaGVlbCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tUmlnaHRXaGVlbCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tRGlmZmVyZW50aWFsUmF0aW8gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTGVmdFJpZ2h0U3BsaXQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTGltaXRlZFNsaXBSYXRpbyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1FbmdpbmVUb3JxdWVSYXRpbyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmcy5wdXNoKHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmVyZW50aWFscy5wdXNoX2JhY2soc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyU2V0dGluZ3MubURpZmZlcmVudGlhbExpbWl0ZWRTbGlwUmF0aW8gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJTZXR0aW5ncy5tTWF4TGVhbkFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyU2V0dGluZ3MubUxlYW5TcHJpbmdDb25zdGFudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1MZWFuU3ByaW5nRGFtcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1MZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1MZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudERlY2F5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyU2V0dGluZ3MubUxlYW5TbW9vdGhpbmdGYWN0b3IgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBhbnRpIHJvbGwgYmFyc1xyXG4gICAgICAgICAgICBjb25zdCBiYXJzQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IG1BbnRpUm9sbEJhcnMgPSBjb25zdHJhaW50U2V0dGluZ3MubUFudGlSb2xsQmFycztcclxuICAgICAgICAgICAgY29uc3QgYmFycyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJhcnNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBiYXIgPSBuZXcgSm9sdC5WZWhpY2xlQW50aVJvbGxCYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBiYXIubUxlZnRXaGVlbCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGJhci5tUmlnaHRXaGVlbCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGJhci5tU3RpZmZuZXNzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBiYXJzLnB1c2goYmFyKTtcclxuICAgICAgICAgICAgICAgIG1BbnRpUm9sbEJhcnMucHVzaF9iYWNrKGJhcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncy5tQ29udHJvbGxlciA9IGNvbnRyb2xsZXJTZXR0aW5ncztcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnN0cmFpbnRcclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHRyYWNrZXIuZ2V0Qm9keUJ5UENJRChpbmRleCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgSm9sdC5WZWhpY2xlQ29uc3RyYWludChib2R5LCBjb25zdHJhaW50U2V0dGluZ3MpO1xyXG4gICAgICAgICAgICBjb25zdCBjYXN0VHlwZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICBjb25zdCBsYXllciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEZvciBiYWNrZW5kIHRvIHdyaXRlIHdoZWVscyBpc29tZXRyeVxyXG4gICAgICAgICAgICBib2R5LmlzVmVoaWNsZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAvLyB3aGVlbHMgY29udGFjdCB0ZXN0ZXJcclxuICAgICAgICAgICAgbGV0IHRlc3RlcjtcclxuICAgICAgICAgICAgc3dpdGNoIChjYXN0VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVk6IHtcclxuICAgICAgICAgICAgICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdGVyID0gbmV3IEpvbHQuVmVoaWNsZUNvbGxpc2lvblRlc3RlclJheShsYXllciwganYsIG1heEFuZ2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfU1BIRVJFOiB7XHJcbiAgICAgICAgICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4QW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdGVyID0gbmV3IEpvbHQuVmVoaWNsZUNvbGxpc2lvblRlc3RlckNhc3RTcGhlcmUobGF5ZXIsIHJhZGl1cywganYsIG1heEFuZ2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVI6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmcmFjdGlvbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdGVyID0gbmV3IEpvbHQuVmVoaWNsZUNvbGxpc2lvblRlc3RlckNhc3RDeWxpbmRlcihsYXllciwgZnJhY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYFVucmVjb2duaXplZCBjYXN0IHR5cGU6ICR7IGNhc3RUeXBlIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3RyYWludC5TZXRWZWhpY2xlQ29sbGlzaW9uVGVzdGVyKHRlc3Rlcik7XHJcblxyXG4gICAgICAgICAgICAvLyBldmVudHNcclxuICAgICAgICAgICAgaWYgKGJhY2tlbmQuY29uZmlnLnZlaGljbGVDb250YWN0RXZlbnRzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgYmFja2VuZC5saXN0ZW5lci5pbml0VmVoaWNsZUV2ZW50cyhjb25zdHJhaW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcGh5c2ljc1N5c3RlbS5BZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgSm9sdC5WZWhpY2xlQ29uc3RyYWludFN0ZXBMaXN0ZW5lcihjb25zdHJhaW50KTtcclxuICAgICAgICAgICAgcGh5c2ljc1N5c3RlbS5BZGRTdGVwTGlzdGVuZXIobGlzdGVuZXIpO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIHJlZmVyZW5jZXMgZm9yIENsZWFuZXIgb3BlcmF0b3JcclxuICAgICAgICAgICAgYm9keS5jb25zdHJhaW50cyA9IFtpbmRleF07XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQubGlzdGVuZXIgPSBsaXN0ZW5lcjtcclxuXHJcbiAgICAgICAgICAgIGxldCBDb250cm9sbGVyO1xyXG4gICAgICAgICAgICBpZiAoaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyID0gdHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMID8gXHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5XaGVlbGVkVmVoaWNsZUNvbnRyb2xsZXIgOiBcclxuICAgICAgICAgICAgICAgICAgICBKb2x0Lk1vdG9yY3ljbGVDb250cm9sbGVyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgQ29udHJvbGxlciA9IEpvbHQuVHJhY2tlZFZlaGljbGVDb250cm9sbGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQuY29udHJvbGxlciA9IEpvbHQuY2FzdE9iamVjdChjb25zdHJhaW50LkdldENvbnRyb2xsZXIoKSwgQ29udHJvbGxlcik7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQud2hlZWxzQ291bnQgPSB3aGVlbHNDb3VudDtcclxuXHJcbiAgICAgICAgICAgIHRyYWNrZXIuYWRkQ29uc3RyYWludChpbmRleCwgY29uc3RyYWludCwgYm9keSk7XHJcblxyXG4gICAgICAgICAgICBkZXN0cm95U2V0dGluZ3MoZGlmZnMpO1xyXG4gICAgICAgICAgICBkZXN0cm95U2V0dGluZ3MoYmFycyk7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlR3JvdXBzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IGJhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBncm91cHNDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVWludChncm91cHNDb3VudCwgYEludmFsaWQgZmlsdGVyIGdyb3VwcyBjb3VudDogJHsgZ3JvdXBzQ291bnQgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChncm91cHNDb3VudCA+IDAsIGBJbnZhbGlkIGZpbHRlciBncm91cHMgY291bnQ6ICR7IGdyb3Vwc0NvdW50IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qgc3ViR3JvdXBzQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMilcclxuICAgICAgICAgICAgY29uc3QgdGFibGUgPSBuZXcgSm9sdC5Hcm91cEZpbHRlclRhYmxlKHN1Ykdyb3Vwc0NvdW50KTtcclxuICAgICAgICAgICAgYmFja2VuZC5ncm91cEZpbHRlclRhYmxlcy5wdXNoKHRhYmxlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tVaW50KHN1Ykdyb3Vwc0NvdW50LCBgSW52YWxpZCBzdWIgZ3JvdXAgY291bnQ6ICR7IHN1Ykdyb3Vwc0NvdW50IH1gKTtcclxuICAgICAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGFibGUubWF4SW5kZXggPSBzdWJHcm91cHNDb3VudCAtIDE7IC8vIGZvciBkZWJ1ZyB0ZXN0IGluIGRlYnVnIG1vZGUgd2hlbiBjcmVhdGluZyBhIGJvZHlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZVNoYXBlU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuX2JhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG4gICAgICAgIGNvbnN0IGpxID0gdGhpcy5fam9sdFF1YXQ7XHJcbiAgICAgICAgY29uc3Qgc2hhcGVUeXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcblxyXG4gICAgICAgIC8vIHNjYWxlXHJcbiAgICAgICAgY29uc3QgdXNlU2NhbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGxldCBzeCwgc3ksIHN6XHJcbiAgICAgICAgaWYgKHVzZVNjYWxlKSB7XHJcbiAgICAgICAgICAgIHN4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgc3kgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBzeiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHN4LCBgSW52YWxpZCBzY2FsZSBYOiAkeyBzeCB9YCk7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoc3ksIGBJbnZhbGlkIHNjYWxlIFk6ICR7IHN5IH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChzeiwgYEludmFsaWQgc2NhbGUgWjogJHsgc3ogfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc2V0dGluZ3MsIGhoLCByLCBjcjtcclxuICAgICAgICBzd2l0Y2ggKHNoYXBlVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0JPWDpcclxuICAgICAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgY3IgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKGNyLCBgaW52YWxpZCBjb252ZXggcmFkaXVzOiAkeyBjciB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuY3JlYXRlU2hhcGVTZXR0aW5ncyhzaGFwZVR5cGUsIGp2LCBjcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ0FQU1VMRTpcclxuICAgICAgICAgICAgICAgIGhoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIHIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShoaCwgYGludmFsaWQgaGFsZiBoZWlnaHQ6ICR7IGhoIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShyLCBgaW52YWxpZCByYWRpdXM6ICR7IHIgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTY2FsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydCgoc3ggPT09IHN5KSAmJiAoc3kgPT09IHN6KSwgYENhcHN1bGUgc2hhcGUgc2NhbGUgbXVzdCBiZSB1bmlmb3JtOiAkeyBzeCB9LCAkeyBzeSB9LCAkeyBzeiB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLmNyZWF0ZVNoYXBlU2V0dGluZ3Moc2hhcGVUeXBlLCBoaCwgcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ1lMSU5ERVI6XHJcbiAgICAgICAgICAgICAgICBoaCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICByID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGNyID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0UG9zaXRpdmUoaGgsIGBpbnZhbGlkIGhhbGYgaGVpZ2h0OiAkeyBoaCB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0UG9zaXRpdmUociwgYGludmFsaWQgcmFkaXVzOiAkeyByIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShjciwgYGludmFsaWQgY29udmV4IHJhZGl1czogJHsgY3IgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTY2FsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChzeCA9PT0gc3osIGBDeWxpbmRlciBzaGFwZSBzY2FsZSBtdXN0IGJlIHVuaWZvcm0gaW4gWFogcGxhbmU6ICR7IHN4IH0sICR7IHN6IH1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuY3JlYXRlU2hhcGVTZXR0aW5ncyhzaGFwZVR5cGUsIGhoLCByLCBjcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfU1BIRVJFOlxyXG4gICAgICAgICAgICAgICAgciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHIsIGBpbnZhbGlkIHJhZGl1czogJHsgciB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZVNjYWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KChzeCA9PT0gc3kpICYmIChzeSA9PT0gc3opLCBgU3BoZXJlIHNoYXBlIHNjYWxlIG11c3QgYmUgdW5pZm9ybTogJHsgc3ggfSwgJHsgc3kgfSwgJHsgc3ogfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5jcmVhdGVTaGFwZVNldHRpbmdzKHNoYXBlVHlwZSwgcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIC8vIGludGVudGlvbmFsIGZhbGwtdGhyb3VnaFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX01FU0g6XHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ09OVkVYX0hVTEw6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IENyZWF0b3IuY3JlYXRlTWVzaFNoYXBlU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzLCBzaGFwZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX1NUQVRJQ19DT01QT1VORDpcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5fY3JlYXRlU3RhdGljQ29tcG91bmRTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfSEVJR0hURklFTEQ6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZUhlaWdodEZpZWxkU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy53YXJuKCdJbnZhbGlkIHNoYXBlIHR5cGUnLCBzaGFwZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNoYXBlVHlwZSA9PT0gU0hBUEVfU1RBVElDX0NPTVBPVU5EKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBvdW5kU2V0dGluZ3MgPSBuZXcgSm9sdC5TdGF0aWNDb21wb3VuZFNoYXBlU2V0dGluZ3MoKTtcclxuICAgIFxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gc2V0dGluZ3MubGVuZ3RoOyBpIDwgZW5kOyBpICs9IDMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkU2V0dGluZ3MgPSBzZXR0aW5nc1tpXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHNldHRpbmdzW2kgKyAxXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IHNldHRpbmdzW2kgKyAyXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAganYuU2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICAgICAganEuU2V0KHJvdC54LCByb3QueSwgcm90LnosIHJvdC53KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY29tcG91bmRTZXR0aW5ncy5BZGRTaGFwZShqdiwganEsIGNoaWxkU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IGNvbXBvdW5kU2V0dGluZ3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGlzQ29tcG91bmRDaGlsZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgaWYgKCFpc0NvbXBvdW5kQ2hpbGQpIHtcclxuICAgICAgICAgICAgY29uc3QgZGVuc2l0eSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKGRlbnNpdHksIGBJbnZhbGlkIGRlbnNpdHkgdmFsdWU6ICR7IGRlbnNpdHkgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXR0aW5ncy5tRGVuc2l0eSA9IGRlbnNpdHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBzaGFwZSBvZmZzZXRcclxuICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAganEuRnJvbUJ1ZmZlcihjYik7XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlJvdGF0ZWRUcmFuc2xhdGVkU2hhcGVTZXR0aW5ncyhqdiwganEsIHNldHRpbmdzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNlbnRlciBvZiBtYXNzIG9mZnNldFxyXG4gICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5PZmZzZXRDZW50ZXJPZk1hc3NTaGFwZVNldHRpbmdzKGp2LCBzZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodXNlU2NhbGUpIHtcclxuICAgICAgICAgICAganYuU2V0KHN4LCBzeSwgc3opO1xyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlNjYWxlZFNoYXBlU2V0dGluZ3Moc2V0dGluZ3MsIGp2KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncztcclxuICAgIH0gXHJcblxyXG4gICAgX2NyZWF0ZVN0YXRpY0NvbXBvdW5kU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBjaGlsZHJlbkNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5fY3JlYXRlU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgICAgICBpZiAoIXNldHRpbmdzKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSB7fTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNiLnJlYWRWZWMocG9zKTtcclxuICAgICAgICAgICAgY2IucmVhZFF1YXQocm90KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKHBvcywgYEludmFsaWQgc3RhdGljIGNvbXBvdW5kIGNoaWxkIHBvc2l0aW9uIHZlY3RvcmApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1F1YXQocm90LCBgSW52YWxpZCBzdGF0aWMgY29tcG91bmQgY2hpbGQgcXVhdGVybmlvbmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goc2V0dGluZ3MsIHBvcywgcm90KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjaGlsZHJlbjtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlSGVpZ2h0RmllbGRTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmFzc2VydCghIW1lc2hCdWZmZXJzLCBgTWlzc2luZyBidWZmZXJzIHRvIGdlbmVyYXRlIGEgSGVpZ2h0RmllbGQgc2hhcGU6ICR7IG1lc2hCdWZmZXJzIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQobWVzaEJ1ZmZlcnMubGVuZ3RoID4gMCwgYEludmFsaWQgYnVmZmVycyB0byBnZW5lcmF0ZSBIZWlnaHRGaWVsZCBzaGFwZTogJHsgbWVzaEJ1ZmZlcnMgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuX2JhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IG1lc2hCdWZmZXJzLnNoaWZ0KCk7XHJcbiAgICAgICAgY29uc3Qgc2FtcGxlcyA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyKTtcclxuICAgICAgICBjb25zdCBzaXplID0gc2FtcGxlcy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbmV3IEpvbHQuSGVpZ2h0RmllbGRTaGFwZVNldHRpbmdzKCk7XHJcbiAgICAgICAgc2V0dGluZ3MubU9mZnNldCA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIHNldHRpbmdzLm1TY2FsZSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIHNldHRpbmdzLm1TYW1wbGVDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tQmxvY2tTaXplID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgc2V0dGluZ3MubUJpdHNQZXJTYW1wbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBzZXR0aW5ncy5tQWN0aXZlRWRnZUNvc1RocmVzaG9sZEFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tSGVpZ2h0U2FtcGxlcy5yZXNpemUoc2l6ZSk7XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgdGhlIGhlaWdodCBzYW1wbGVzIGludG8gYSBGbG9hdDMyQXJyYXlcclxuICAgICAgICBjb25zdCBoZWlnaHRTYW1wbGVzID0gbmV3IEZsb2F0MzJBcnJheShKb2x0LkhFQVBGMzIuYnVmZmVyLCBKb2x0LmdldFBvaW50ZXIoc2V0dGluZ3MubUhlaWdodFNhbXBsZXMuZGF0YSgpKSwgc2l6ZSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBlbmQgPSBoZWlnaHRTYW1wbGVzLmxlbmd0aDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHNhbXBsZXNbaV07XHJcbiAgICAgICAgICAgIGhlaWdodFNhbXBsZXNbaV0gPSBoZWlnaHQgPj0wID8gaGVpZ2h0IDogSm9sdC5IZWlnaHRGaWVsZFNoYXBlQ29uc3RhbnRWYWx1ZXMucHJvdG90eXBlLmNOb0NvbGxpc2lvblZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuICAgIF9jcmVhdGVDb25zdHJhaW50KGNiKSB7XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBiYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgcGh5c2ljc1N5c3RlbSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGlkeDEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgaWR4MiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY29uc3QgYm9keTEgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaWR4MSk7XHJcbiAgICAgICAgY29uc3QgYm9keTIgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaWR4Mik7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoISFib2R5MSwgYFVuYWJsZSB0byBsb2NhdGUgYm9keSB0byBhZGQgY29uc3RyYWludCB0bzogJHsgaWR4MSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhYm9keTIsIGBVbmFibGUgdG8gbG9jYXRlIGJvZHkgdG8gYWRkIGNvbnN0cmFpbnQgdG86ICR7IGlkeDIgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gcmVmYWN0b3IgdG8gb3duIG1ldGhvZHNcclxuXHJcbiAgICAgICAgbGV0IHNldHRpbmdzO1xyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9GSVhFRDpcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IEpvbHQuRml4ZWRDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXV0b0RldGVjdFBvaW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MubUF1dG9EZXRlY3RQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXhpc1gxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUF4aXNZMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXhpc1kyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX1BPSU5UOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5Qb2ludENvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0RJU1RBTkNFOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5EaXN0YW5jZUNvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubU1pbkRpc3RhbmNlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWF4RGlzdGFuY2UgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcHJpbmdTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZVNwcmluZ1NldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTGltaXRzU3ByaW5nU2V0dGluZ3MgPSBzcHJpbmdTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3koc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9ISU5HRTpcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IEpvbHQuSGluZ2VDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUhpbmdlQXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTm9ybWFsQXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUhpbmdlQXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTm9ybWFsQXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTGltaXRzTWluID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTGltaXRzTWF4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWF4RnJpY3Rpb25Ub3JxdWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcHJpbmdTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZVNwcmluZ1NldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTGltaXRzU3ByaW5nU2V0dGluZ3MgPSBzcHJpbmdTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3koc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtb3RvclNldHRpbmdzID0gdGhpcy5fY3JlYXRlTW90b3JTZXR0aW5ncyhjYiwgSm9sdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubU1vdG9yU2V0dGluZ3MgPSBtb3RvclNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShtb3RvclNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfU0xJREVSOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5TbGlkZXJDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXV0b0RldGVjdFBvaW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MubUF1dG9EZXRlY3RQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tU2xpZGVyQXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTm9ybWFsQXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tU2xpZGVyQXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTm9ybWFsQXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTGltaXRzTWluID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTGltaXRzTWF4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWF4RnJpY3Rpb25Gb3JjZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZ1NldHRpbmdzID0gdGhpcy5fY3JlYXRlU3ByaW5nU2V0dGluZ3MoY2IsIEpvbHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1MaW1pdHNTcHJpbmdTZXR0aW5ncyA9IHNwcmluZ1NldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShzcHJpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vdG9yU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVNb3RvclNldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTW90b3JTZXR0aW5ncyA9IG1vdG9yU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KG1vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9DT05FOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5Db25lQ29uc3RyYWludFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ud2lzdEF4aXMxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ud2lzdEF4aXMyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUhhbGZDb25lQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVDpcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IEpvbHQuU3dpbmdUd2lzdENvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb3NpdGlvbjEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tVHdpc3RBeGlzMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1QbGFuZUF4aXMxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvc2l0aW9uMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ud2lzdEF4aXMyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBsYW5lQXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTm9ybWFsSGFsZkNvbmVBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBsYW5lSGFsZkNvbmVBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVR3aXN0TWluQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ud2lzdE1heEFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWF4RnJpY3Rpb25Ub3JxdWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzd2luZ01vdG9yU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVNb3RvclNldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tU3dpbmdNb3RvclNldHRpbmdzID0gc3dpbmdNb3RvclNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShzd2luZ01vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0d2lzdE1vdG9yU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVNb3RvclNldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tVHdpc3RNb3RvclNldHRpbmdzID0gdHdpc3RNb3RvclNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveSh0d2lzdE1vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TSVhfRE9GOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF4aXMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYXhpcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRnJlZUF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfVHJhbnNsYXRpb25YKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9ZOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGcmVlQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9aOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGcmVlQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZyZWVBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1k6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZyZWVBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRnJlZUF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25aKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYFVucmVjb2duaXplZCBzaXggZG9mIGNvbnN0cmFpbnQgYXhpcyBzZXR0aW5nOiAkeyBheGlzIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBheGlzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGF4aXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZpeGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1k6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZpeGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9aOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGaXhlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfVHJhbnNsYXRpb25aKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9YOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGaXhlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25YKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRml4ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRml4ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGBVbnJlY29nbml6ZWQgc2l4IGRvZiBjb25zdHJhaW50IGF4aXMgc2V0dGluZzogJHsgYXhpcyB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXhpcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChheGlzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9YOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLlNldExpbWl0ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1RyYW5zbGF0aW9uWCwgbWluLCBtYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1k6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuU2V0TGltaXRlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfVHJhbnNsYXRpb25ZLCBtaW4sIG1heCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1o6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuU2V0TGltaXRlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfVHJhbnNsYXRpb25aLCBtaW4sIG1heCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5TZXRMaW1pdGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19Sb3RhdGlvblgsIG1pbiwgbWF4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5TZXRMaW1pdGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19Sb3RhdGlvblksIG1pbiwgbWF4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLlNldExpbWl0ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWiwgbWluLCBtYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgVW5yZWNvZ25pemVkIHNpeCBkb2YgY29uc3RyYWludCBheGlzIHNldHRpbmc6ICR7IGF4aXMgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvc2l0aW9uMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXhpc1kxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvc2l0aW9uMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXhpc1kyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubU1heEZyaWN0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTGltaXRNaW4gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdE1heCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZ1NldHRpbmdzID0gdGhpcy5fY3JlYXRlU3ByaW5nU2V0dGluZ3MoY2IsIEpvbHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1MaW1pdHNTcHJpbmdTZXR0aW5ncyA9IHNwcmluZ1NldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShzcHJpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vdG9yU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVNb3RvclNldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTW90b3JTZXR0aW5ncyA9IG1vdG9yU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KG1vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGBVbnJlY29nbml6ZWQgY29uc3RyYWludCB0eXBlOiAkeyB0eXBlIH1gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTnVtVmVsb2NpdHlTdGVwc092ZXJyaWRlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1OdW1Qb3NpdGlvblN0ZXBzT3ZlcnJpZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBpZiAoY2IuZmxhZykge1xyXG4gICAgICAgICAgICBjb25zdCBzcGFjZSA9IChjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KSA9PT0gQ09OU1RSQUlOVF9TUEFDRV9XT1JMRCkgPyBKb2x0LkVDb25zdHJhaW50U3BhY2VfV29ybGRTcGFjZSA6IEpvbHQuRUNvbnN0cmFpbnRTcGFjZV9Mb2NhbFRvQm9keUNPTTtcclxuICAgICAgICAgICAgc2V0dGluZ3MubVNwYWNlID0gc3BhY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb25zdHJhaW50ID0gc2V0dGluZ3MuQ3JlYXRlKGJvZHkxLCBib2R5Mik7XHJcblxyXG4gICAgICAgIGlmICghYm9keTEuY29uc3RyYWludHMpIHtcclxuICAgICAgICAgICAgYm9keTEuY29uc3RyYWludHMgPSBbXTtcclxuICAgICAgICAgICAgYm9keTEubGlua2VkID0gbmV3IFNldCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFib2R5Mi5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICBib2R5Mi5jb25zdHJhaW50cyA9IFtdO1xyXG4gICAgICAgICAgICBib2R5Mi5saW5rZWQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBib2R5MS5jb25zdHJhaW50cy5wdXNoKGluZGV4KTtcclxuICAgICAgICBib2R5Mi5jb25zdHJhaW50cy5wdXNoKGluZGV4KTtcclxuXHJcbiAgICAgICAgYm9keTEubGlua2VkLmFkZChib2R5Mik7XHJcbiAgICAgICAgYm9keTIubGlua2VkLmFkZChib2R5MSk7XHJcblxyXG4gICAgICAgIHRyYWNrZXIuYWRkQ29uc3RyYWludChpbmRleCwgY29uc3RyYWludCwgYm9keTEsIGJvZHkyKTtcclxuXHJcbiAgICAgICAgcGh5c2ljc1N5c3RlbS5BZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9jcmVhdGVTcHJpbmdTZXR0aW5ncyhjYiwgSm9sdCkge1xyXG4gICAgICAgIGNvbnN0IHNwcmluZ1NldHRpbmdzID0gbmV3IEpvbHQuU3ByaW5nU2V0dGluZ3MoKTtcclxuICAgICAgICBjb25zdCBtb2RlID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpIDogU1BSSU5HX01PREVfRlJFUVVFTkNZO1xyXG4gICAgICAgIHNwcmluZ1NldHRpbmdzLm1Nb2RlID0gKG1vZGUgPT09IFNQUklOR19NT0RFX0ZSRVFVRU5DWSkgPyBcclxuICAgICAgICAgICAgSm9sdC5FU3ByaW5nTW9kZV9GcmVxdWVuY3lBbmREYW1waW5nIDogSm9sdC5FU3ByaW5nTW9kZV9TdGlmZm5lc3NBbmREYW1waW5nO1xyXG4gICAgICAgIGlmIChjYi5mbGFnKSBzcHJpbmdTZXR0aW5ncy5tRnJlcXVlbmN5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBpZiAoY2IuZmxhZykgc3ByaW5nU2V0dGluZ3MubVN0aWZmbmVzcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIHNwcmluZ1NldHRpbmdzLm1EYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICByZXR1cm4gc3ByaW5nU2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZU1vdG9yU2V0dGluZ3MoY2IsIEpvbHQpIHtcclxuICAgICAgICBjb25zdCBtb3RvclNldHRpbmdzID0gbmV3IEpvbHQuTW90b3JTZXR0aW5ncygpO1xyXG4gICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwcmluZ3NTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZVNwcmluZ1NldHRpbmdzKGNiLCBKb2x0KTtcclxuICAgICAgICAgICAgbW90b3JTZXR0aW5ncy5tU3ByaW5nU2V0dGluZ3MgPSBzcHJpbmdzU2V0dGluZ3M7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveShzcHJpbmdzU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2IuZmxhZykgbW90b3JTZXR0aW5ncy5tTWluRm9yY2VMaW1pdCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIG1vdG9yU2V0dGluZ3MubU1heEZvcmNlTGltaXQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGlmIChjYi5mbGFnKSBtb3RvclNldHRpbmdzLm1NaW5Ub3JxdWVMaW1pdCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIG1vdG9yU2V0dGluZ3MubU1heFRvcnF1ZUxpbWl0ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vdG9yU2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZUNoYXJhY3RlcihjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBiYWNrZW5kLmxpc3RlbmVyO1xyXG4gICAgICAgIGNvbnN0IGNoYXJFdmVudHMgPSBiYWNrZW5kLmNvbmZpZy5jaGFyQ29udGFjdEV2ZW50c0VuYWJsZWQ7XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBqcSA9IHRoaXMuX2pvbHRRdWF0O1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbmV3IEpvbHQuQ2hhcmFjdGVyVmlydHVhbFNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTaGFwZVNldHRpbmdzKGNiLCBudWxsKTtcclxuICAgICAgICBpZiAoIXNoYXBlU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZVNldHRpbmdzLkNyZWF0ZSgpLkdldCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNldHRpbmdzLm1TaGFwZSA9IHNoYXBlO1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCB1c2VNb3Rpb25TdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIHNldHRpbmdzLm1VcCA9IGp2O1xyXG5cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgY29uc3QgcGxhbmUgPSBuZXcgSm9sdC5QbGFuZShqdiwgZGlzdGFuY2UpO1xyXG4gICAgICAgIHNldHRpbmdzLm1TdXBwb3J0aW5nVm9sdW1lID0gcGxhbmU7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHBsYW5lKTtcclxuXHJcbiAgICAgICAgc2V0dGluZ3MubU1heFNsb3BlQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXNzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tTWF4U3RyZW5ndGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBzZXR0aW5ncy5tU2hhcGVPZmZzZXQgPSBqdjtcclxuICAgICAgICBzZXR0aW5ncy5tQmFja0ZhY2VNb2RlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgc2V0dGluZ3MubVByZWRpY3RpdmVDb250YWN0RGlzdGFuY2UgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhDb2xsaXNpb25JdGVyYXRpb25zID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhDb25zdHJhaW50SXRlcmF0aW9ucyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tTWluVGltZVJlbWFpbmluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUNvbGxpc2lvblRvbGVyYW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUNoYXJhY3RlclBhZGRpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhOdW1IaXRzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1IaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubVBlbmV0cmF0aW9uUmVjb3ZlcnlTcGVlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIGpxLkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICBpZiAoY2hhckV2ZW50cyAmJiAhbGlzdGVuZXIuY2hhckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLmluaXRDaGFyYWN0ZXJFdmVudHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNoYXJhY3RlciA9IG5ldyBKb2x0LkNoYXJhY3RlclZpcnR1YWwoc2V0dGluZ3MsIGp2LCBqcSwgYmFja2VuZC5waHlzaWNzU3lzdGVtKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXIuZGVidWdEcmF3ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKGJhY2tlbmQuY29uZmlnLnVzZU1vdGlvblN0YXRlcyAmJiB1c2VNb3Rpb25TdGF0ZSkge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXIubW90aW9uU3RhdGUgPSBuZXcgTW90aW9uU3RhdGUoY2hhcmFjdGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFyRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIGNoYXJhY3Rlci5TZXRMaXN0ZW5lcihsaXN0ZW5lci5jaGFyTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZm9yIG1vdGlvbiBzdGF0ZVxyXG4gICAgICAgIGNoYXJhY3Rlci5pc0NoYXJhY3RlciA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGZvciBzaGFwZSByZXNldFxyXG4gICAgICAgIGNoYXJhY3Rlci5vcmlnaW5hbFNoYXBlID0gc2hhcGU7XHJcblxyXG4gICAgICAgIGJhY2tlbmQudHJhY2tlci5hZGQoY2hhcmFjdGVyLCBpbmRleCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjcmVhdGVNZXNoU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMsIHNoYXBlVHlwZSkge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLl9iYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBiYXNlLCBzdHJpZGUsIG51bUluZGljZXMsIHRyaUNvdW50LCBwb3NpdGlvbnMsIGluZGljZXNcclxuICAgICAgICB9ID0gQ3JlYXRvci5yZWFkTWVzaEJ1ZmZlcnMoY2IsIG1lc2hCdWZmZXJzKTtcclxuXHJcbiAgICAgICAgLy8gVE9ETzpcclxuICAgICAgICAvLyBhZGQgc3VwcG9ydCBmb3IgZHVwbGljYXRlIHZlcnRpY2VzIHRlc3RcclxuXHJcbiAgICAgICAgY29uc3QgcCA9IHBvc2l0aW9ucztcclxuICAgICAgICBsZXQgaTEsIGkyLCBpMztcclxuICAgICAgICBsZXQgc2V0dGluZ3M7XHJcblxyXG4gICAgICAgIGlmIChzaGFwZVR5cGUgPT09IFNIQVBFX0NPTlZFWF9IVUxMKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gbmV3IFNldCgpO1xyXG4gICAgICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5Db252ZXhIdWxsU2hhcGVTZXR0aW5ncygpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1JbmRpY2VzOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gaW5kaWNlc1tpXSAqIHN0cmlkZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwW2luZGV4XTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBwW2luZGV4ICsgMV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCB6ID0gcFtpbmRleCArIDJdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGRlZHVwbGljYXRlIHZlcnRzXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSBgJHt4fToke3l9OiR7en1gO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjYWNoZS5oYXMoc3RyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLmFkZChzdHIpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGp2LlNldCh4LCB5LCB6KTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tUG9pbnRzLnB1c2hfYmFjayhqdik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHNoYXBlVHlwZSA9PT0gU0hBUEVfTUVTSCkge1xyXG4gICAgICAgICAgICBjb25zdCB0cmlhbmdsZXMgPSBuZXcgSm9sdC5UcmlhbmdsZUxpc3QoKTtcclxuICAgIFxyXG4gICAgICAgICAgICB0cmlhbmdsZXMucmVzaXplKHRyaUNvdW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGxldCB2MSwgdjIsIHYzO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGkxID0gaW5kaWNlc1tiYXNlICsgaSAqIDNdICogc3RyaWRlO1xyXG4gICAgICAgICAgICAgICAgaTIgPSBpbmRpY2VzW2Jhc2UgKyBpICogMyArIDFdICogc3RyaWRlO1xyXG4gICAgICAgICAgICAgICAgaTMgPSBpbmRpY2VzW2Jhc2UgKyBpICogMyArIDJdICogc3RyaWRlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdHJpYW5nbGVzLmF0KGkpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2MSA9IHQuZ2V0X21WKDApO1xyXG4gICAgICAgICAgICAgICAgdjIgPSB0LmdldF9tVigxKTtcclxuICAgICAgICAgICAgICAgIHYzID0gdC5nZXRfbVYoMik7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHYxLnggPSBwW2kxXTsgdjEueSA9IHBbaTEgKyAxXTsgdjEueiA9IHBbaTEgKyAyXTtcclxuICAgICAgICAgICAgICAgIHYyLnggPSBwW2kyXTsgdjIueSA9IHBbaTIgKyAxXTsgdjIueiA9IHBbaTIgKyAyXTtcclxuICAgICAgICAgICAgICAgIHYzLnggPSBwW2kzXTsgdjMueSA9IHBbaTMgKyAxXTsgdjMueiA9IHBbaTMgKyAyXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5NZXNoU2hhcGVTZXR0aW5ncyh0cmlhbmdsZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gc2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNyZWF0ZVNvZnRCb2R5U2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMsIEpvbHQpIHtcclxuICAgICAgICAvLyBzY2FsZVxyXG4gICAgICAgIGNvbnN0IHVzZVNjYWxlID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICBsZXQgc3ggPSAxO1xyXG4gICAgICAgIGxldCBzeSA9IDE7XHJcbiAgICAgICAgbGV0IHN6ID0gMTtcclxuICAgICAgICBpZiAodXNlU2NhbGUpIHtcclxuICAgICAgICAgICAgc3ggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBzeSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIHN6ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrRmxvYXQoc3gsIGBJbnZhbGlkIHNjYWxlIFg6ICR7IHN4IH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChzeSwgYEludmFsaWQgc2NhbGUgWTogJHsgc3kgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KHN6LCBgSW52YWxpZCBzY2FsZSBaOiAkeyBzeiB9YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgYmFzZSwgdmVydGV4Q291bnQsIHRyaUNvdW50LCBwb3NpdGlvbnMsIGluZGljZXNcclxuICAgICAgICB9ID0gQ3JlYXRvci5yZWFkTWVzaEJ1ZmZlcnMoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG5ldyBKb2x0LlNvZnRCb2R5U2hhcmVkU2V0dGluZ3MoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgdmVydGljZXNcclxuICAgICAgICBjb25zdCBjYWNoZSA9IG5ldyBTZXQoKTtcclxuICAgICAgICBjb25zdCBqZiA9IG5ldyBKb2x0LkZsb2F0MygpO1xyXG4gICAgICAgIGNvbnN0IHYgPSBuZXcgSm9sdC5Tb2Z0Qm9keVNoYXJlZFNldHRpbmdzVmVydGV4KCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2ZXJ0ZXhDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGkzID0gaSAqIDM7XHJcbiAgICAgICAgICAgIGNvbnN0IHggPSBwb3NpdGlvbnNbaTNdO1xyXG4gICAgICAgICAgICBjb25zdCB5ID0gcG9zaXRpb25zW2kzICsgMV07XHJcbiAgICAgICAgICAgIGNvbnN0IHogPSBwb3NpdGlvbnNbaTMgKyAyXTtcclxuXHJcbiAgICAgICAgICAgIC8vIGRlZHVwbGljYXRlIHZlcnRzXHJcbiAgICAgICAgICAgIGNvbnN0IHN0ciA9IGAke3h9OiR7eX06JHt6fWA7XHJcbiAgICAgICAgICAgIGlmICghY2FjaGUuaGFzKHN0cikpIHtcclxuICAgICAgICAgICAgICAgIGNhY2hlLmFkZChzdHIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBqZi54ID0geCAqIHN4O1xyXG4gICAgICAgICAgICAgICAgamYueSA9IHkgKiBzeTtcclxuICAgICAgICAgICAgICAgIGpmLnogPSB6ICogc3o7XHJcbiAgICAgICAgICAgICAgICB2Lm1Qb3NpdGlvbiA9IGpmO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLm1WZXJ0aWNlcy5wdXNoX2JhY2sodik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBjb21wbGlhbmNlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBjb25zdCBmaXhlZENvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IHJvd1ZlcnRzID0gd2lkdGggKyAxO1xyXG4gICAgICAgIGNvbnN0IGNvbFZlcnRzID0gbGVuZ3RoICsgMTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgZWRnZXNcclxuICAgICAgICBjb25zdCBlZGdlID0gbmV3IEpvbHQuU29mdEJvZHlTaGFyZWRTZXR0aW5nc0VkZ2UoMCwgMCwgY29tcGxpYW5jZSk7XHJcbiAgICAgICAgY29uc3QgY29uc3RyYWludHMgPSBzZXR0aW5ncy5tRWRnZUNvbnN0cmFpbnRzO1xyXG4gICAgICAgIGxldCB2MCwgdjE7XHJcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBjb2xWZXJ0czsgeSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgcm93VmVydHM7IHgrKykge1xyXG4gICAgICAgICAgICAgICAgdjAgPSB5ICsgeCAqIGNvbFZlcnRzO1xyXG4gICAgICAgICAgICAgICAgZWRnZS5zZXRfbVZlcnRleCgwLCB2MCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHkgPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGdlLnNldF9tVmVydGV4KDEsIHYwICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHMucHVzaF9iYWNrKGVkZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHggPCB3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2V0X21WZXJ0ZXgoMSwgdjAgKyBjb2xWZXJ0cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHMucHVzaF9iYWNrKGVkZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHkgPCBsZW5ndGggJiYgeCA8IHdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdjEgPSB2MCArIGNvbFZlcnRzICsgMTtcclxuICAgICAgICAgICAgICAgICAgICBlZGdlLnNldF9tVmVydGV4KDEsIHYxKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50cy5wdXNoX2JhY2soZWRnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRnZS5zZXRfbVZlcnRleCgwLCB2MCArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2V0X21WZXJ0ZXgoMSwgdjEgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50cy5wdXNoX2JhY2soZWRnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0dGluZ3MuQ2FsY3VsYXRlRWRnZUxlbmd0aHMoKTtcclxuXHJcbiAgICAgICAgLy8gRml4ZWQgdmVydHNcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpeGVkQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBmaXhlZEluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5tVmVydGljZXMuYXQoZml4ZWRJbmRleCkubUludk1hc3MgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGZhY2VzXHJcbiAgICAgICAgY29uc3QgZmFjZSA9IG5ldyBKb2x0LlNvZnRCb2R5U2hhcmVkU2V0dGluZ3NGYWNlKDAsIDAsIDAsIDApO1xyXG4gICAgICAgIGxldCBpMSwgaTIsIGkzO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBpMSA9IGluZGljZXNbYmFzZSArIGkgKiAzXTtcclxuICAgICAgICAgICAgaTIgPSBpbmRpY2VzW2Jhc2UgKyBpICogMyArIDFdO1xyXG4gICAgICAgICAgICBpMyA9IGluZGljZXNbYmFzZSArIGkgKiAzICsgMl07XHJcblxyXG4gICAgICAgICAgICBmYWNlLnNldF9tVmVydGV4KDAsIGkxKTtcclxuICAgICAgICAgICAgZmFjZS5zZXRfbVZlcnRleCgxLCBpMik7XHJcbiAgICAgICAgICAgIGZhY2Uuc2V0X21WZXJ0ZXgoMiwgaTMpO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5BZGRGYWNlKGZhY2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0dGluZ3MuT3B0aW1pemUoKTtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KGVkZ2UpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveShmYWNlKTtcclxuICAgICAgICBKb2x0LmRlc3Ryb3koamYpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh2KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWFkTWVzaEJ1ZmZlcnMoY2IsIG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgYmFzZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBzdHJpZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBudW1JbmRpY2VzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGlkeExlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBpZHhPZmZzZXQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tVaW50KGJhc2UsIGBJbnZhbGlkIGJ1ZmZlciBiYXNlIHRvIGdlbmVyYXRlIG1lc2gvaHVsbDogJHsgYmFzZSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KG9mZnNldCwgYEludmFsaWQgcG9zaXRpb25zIGJ1ZmZlciBvZmZzZXQgdG8gZ2VuZXJhdGUgbWVzaC9odWxsOiAkeyBvZmZzZXQgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVWludChzdHJpZGUsIGBJbnZhbGlkIHBvc2l0aW9ucyBidWZmZXIgc3RyaWRlIHRvIGdlbmVyYXRlIG1lc2gvaHVsbDogJHsgc3RyaWRlIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1VpbnQobnVtSW5kaWNlcywgYEludmFsaWQgaW5kaWNlcyBjb3VudCB0byBnZW5lcmF0ZSBtZXNoL2h1bGw6ICR7IG51bUluZGljZXMgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydCghIW1lc2hCdWZmZXJzLCBgTm8gbWVzaCBidWZmZXJzIHRvIGdlbmVyYXRlIGEgbWVzaC9odWxsOiAkeyBtZXNoQnVmZmVycyB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KG1lc2hCdWZmZXJzLmxlbmd0aCA+IDEsIGBJbnZhbGlkIGJ1ZmZlcnMgdG8gZ2VuZXJhdGUgbWVzaC9odWxsOiAkeyBtZXNoQnVmZmVycyB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwb3NCdWZmZXIgPSBtZXNoQnVmZmVycy5zaGlmdCgpO1xyXG4gICAgICAgIGNvbnN0IGlkeEJ1ZmZlciA9IG1lc2hCdWZmZXJzLnNoaWZ0KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShwb3NCdWZmZXIsIG9mZnNldCk7IC8vIHZlcnRleCBwb3NpdGlvbnNcclxuICAgICAgICBjb25zdCBhcnJheUNvbnN0cnVjdG9yID0gbnVtSW5kaWNlcyA+IDY1NTM1ID8gVWludDMyQXJyYXkgOiBVaW50MTZBcnJheTtcclxuICAgICAgICBjb25zdCBpbmRpY2VzID0gbmV3IGFycmF5Q29uc3RydWN0b3IoaWR4QnVmZmVyLCBpZHhPZmZzZXQsIGlkeExlbmd0aCk7XHJcbiAgICAgICAgY29uc3QgdHJpQ291bnQgPSBNYXRoLmZsb29yKG51bUluZGljZXMgLyAzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHsgYmFzZSwgc3RyaWRlLCB2ZXJ0ZXhDb3VudCwgbnVtSW5kaWNlcywgdHJpQ291bnQsIHBvc2l0aW9ucywgaW5kaWNlcyB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBDcmVhdG9yIH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/creator.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/drawer.mjs":
/*!************************************************!*\
  !*** ./src/backends/jolt/operators/drawer.mjs ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Drawer: () => (/* binding */ Drawer)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Drawer {\r\n    constructor(Jolt) {\r\n        this._Jolt = Jolt;\r\n        this._joltAabb = Jolt.AABox.prototype.sBiggest();\r\n        this._joltQuat = Jolt.Quat.prototype.sIdentity();\r\n        this._scale = new Jolt.Vec3(1, 1, 1);\r\n        this._data = [];\r\n        this._buffers = [];\r\n        this._contexts = [];\r\n    }\r\n\r\n    get data() {\r\n        return this._data;\r\n    }\r\n\r\n    get buffers() {\r\n        return this._buffers;\r\n    }\r\n\r\n    get dirty() {\r\n        return this._data.length > 0;\r\n    }\r\n\r\n    write(tracker) {\r\n        const debugBodies = tracker.debug;\r\n\r\n        if (debugBodies.size === 0) {\r\n            return true;\r\n        }\r\n\r\n        let ok = true;\r\n        debugBodies.forEach(body => {\r\n            ok = ok && this._writeShape(body, tracker);\r\n        });\r\n\r\n        return ok;\r\n    }\r\n\r\n    reset() {\r\n        this._data.length = 0;\r\n        this._buffers.length = 0;\r\n    }\r\n\r\n    destroy() {\r\n        const Jolt = this._Jolt;\r\n\r\n        this.reset();\r\n\r\n        Jolt.destroy(this._joltAabb);\r\n        this._joltAabb = null;\r\n\r\n        Jolt.destroy(this._joltQuat);\r\n        this._joltQuat = null;\r\n\r\n        Jolt.destroy(this._scale);\r\n        this._scale = null;\r\n\r\n        this._Jolt = null;\r\n    }\r\n\r\n    _writeShape(body, tracker) {\r\n        const Jolt = this._Jolt;\r\n        \r\n        try {\r\n            const motionType = body.isCharacter ? Jolt.EMotionType_Kinematic : body.GetMotionType();\r\n            const isRigidBody = body.GetBodyType() === Jolt.EBodyType_RigidBody;\r\n\r\n            const data = body.debugDrawData;\r\n            if (data) {\r\n                if (isRigidBody) {\r\n                    const buffer = Jolt.HEAPF32.buffer;\r\n\r\n                    this._data.push(...data, motionType, buffer);\r\n                    this._buffers.push(buffer);\r\n\r\n                    return true;\r\n                } else {\r\n                    // Soft body will have new vertex positions, so we need to create a new triContext\r\n                    Jolt.destroy(body.triContext);\r\n                    body.triContext = null;\r\n                    body.debugDrawData = null;\r\n                }\r\n            }\r\n\r\n            // TODO\r\n            // don't send the heap, create and send a view instead\r\n            // also, use backend's outBuffer.meshBuffers instead of local this._buffers\r\n\r\n            const shape = body.GetShape();\r\n            const index = tracker.getPCID(Jolt.getPointer(body));\r\n            const triContext = new Jolt.ShapeGetTriangles(shape, Jolt.AABox.prototype.sBiggest(), shape.GetCenterOfMass(), Jolt.Quat.prototype.sIdentity(), this._scale);\r\n            const byteOffset = triContext.GetVerticesData();\r\n            const length = triContext.GetVerticesSize() / _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.FLOAT32_SIZE;\r\n            const buffer = Jolt.HEAPF32.buffer;\r\n\r\n            body.debugDrawData = [index, length, byteOffset];\r\n            body.triContext = triContext;\r\n\r\n            this._data.push(index, length, byteOffset, motionType, buffer);\r\n            this._buffers.push(buffer);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvZHJhd2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEU7QUFDM0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCxnRkFBWTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLFlBQVkscURBQUssUUFBUSxxREFBSztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvb3BlcmF0b3JzL2RyYXdlci5tanM/ZGVlMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGTE9BVDMyX1NJWkUgfSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY2xhc3MgRHJhd2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKEpvbHQpIHtcclxuICAgICAgICB0aGlzLl9Kb2x0ID0gSm9sdDtcclxuICAgICAgICB0aGlzLl9qb2x0QWFiYiA9IEpvbHQuQUFCb3gucHJvdG90eXBlLnNCaWdnZXN0KCk7XHJcbiAgICAgICAgdGhpcy5fam9sdFF1YXQgPSBKb2x0LlF1YXQucHJvdG90eXBlLnNJZGVudGl0eSgpO1xyXG4gICAgICAgIHRoaXMuX3NjYWxlID0gbmV3IEpvbHQuVmVjMygxLCAxLCAxKTtcclxuICAgICAgICB0aGlzLl9kYXRhID0gW107XHJcbiAgICAgICAgdGhpcy5fYnVmZmVycyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2NvbnRleHRzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRhdGEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJ1ZmZlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J1ZmZlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRpcnR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhLmxlbmd0aCA+IDA7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGUodHJhY2tlcikge1xyXG4gICAgICAgIGNvbnN0IGRlYnVnQm9kaWVzID0gdHJhY2tlci5kZWJ1ZztcclxuXHJcbiAgICAgICAgaWYgKGRlYnVnQm9kaWVzLnNpemUgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgIGRlYnVnQm9kaWVzLmZvckVhY2goYm9keSA9PiB7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgdGhpcy5fd3JpdGVTaGFwZShib2R5LCB0cmFja2VyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMuX2RhdGEubGVuZ3RoID0gMDtcclxuICAgICAgICB0aGlzLl9idWZmZXJzLmxlbmd0aCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5fSm9sdDtcclxuXHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fam9sdEFhYmIpO1xyXG4gICAgICAgIHRoaXMuX2pvbHRBYWJiID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRRdWF0KTtcclxuICAgICAgICB0aGlzLl9qb2x0UXVhdCA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9zY2FsZSk7XHJcbiAgICAgICAgdGhpcy5fc2NhbGUgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9Kb2x0ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVTaGFwZShib2R5LCB0cmFja2VyKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuX0pvbHQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgbW90aW9uVHlwZSA9IGJvZHkuaXNDaGFyYWN0ZXIgPyBKb2x0LkVNb3Rpb25UeXBlX0tpbmVtYXRpYyA6IGJvZHkuR2V0TW90aW9uVHlwZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBpc1JpZ2lkQm9keSA9IGJvZHkuR2V0Qm9keVR5cGUoKSA9PT0gSm9sdC5FQm9keVR5cGVfUmlnaWRCb2R5O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGJvZHkuZGVidWdEcmF3RGF0YTtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1JpZ2lkQm9keSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IEpvbHQuSEVBUEYzMi5idWZmZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEucHVzaCguLi5kYXRhLCBtb3Rpb25UeXBlLCBidWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1ZmZlcnMucHVzaChidWZmZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU29mdCBib2R5IHdpbGwgaGF2ZSBuZXcgdmVydGV4IHBvc2l0aW9ucywgc28gd2UgbmVlZCB0byBjcmVhdGUgYSBuZXcgdHJpQ29udGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShib2R5LnRyaUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHkudHJpQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keS5kZWJ1Z0RyYXdEYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgICAgICAvLyBkb24ndCBzZW5kIHRoZSBoZWFwLCBjcmVhdGUgYW5kIHNlbmQgYSB2aWV3IGluc3RlYWRcclxuICAgICAgICAgICAgLy8gYWxzbywgdXNlIGJhY2tlbmQncyBvdXRCdWZmZXIubWVzaEJ1ZmZlcnMgaW5zdGVhZCBvZiBsb2NhbCB0aGlzLl9idWZmZXJzXHJcblxyXG4gICAgICAgICAgICBjb25zdCBzaGFwZSA9IGJvZHkuR2V0U2hhcGUoKTtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkpKTtcclxuICAgICAgICAgICAgY29uc3QgdHJpQ29udGV4dCA9IG5ldyBKb2x0LlNoYXBlR2V0VHJpYW5nbGVzKHNoYXBlLCBKb2x0LkFBQm94LnByb3RvdHlwZS5zQmlnZ2VzdCgpLCBzaGFwZS5HZXRDZW50ZXJPZk1hc3MoKSwgSm9sdC5RdWF0LnByb3RvdHlwZS5zSWRlbnRpdHkoKSwgdGhpcy5fc2NhbGUpO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gdHJpQ29udGV4dC5HZXRWZXJ0aWNlc0RhdGEoKTtcclxuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gdHJpQ29udGV4dC5HZXRWZXJ0aWNlc1NpemUoKSAvIEZMT0FUMzJfU0laRTtcclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gSm9sdC5IRUFQRjMyLmJ1ZmZlcjtcclxuXHJcbiAgICAgICAgICAgIGJvZHkuZGVidWdEcmF3RGF0YSA9IFtpbmRleCwgbGVuZ3RoLCBieXRlT2Zmc2V0XTtcclxuICAgICAgICAgICAgYm9keS50cmlDb250ZXh0ID0gdHJpQ29udGV4dDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2RhdGEucHVzaChpbmRleCwgbGVuZ3RoLCBieXRlT2Zmc2V0LCBtb3Rpb25UeXBlLCBidWZmZXIpO1xyXG4gICAgICAgICAgICB0aGlzLl9idWZmZXJzLnB1c2goYnVmZmVyKTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBEcmF3ZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/drawer.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/listener.mjs":
/*!**************************************************!*\
  !*** ./src/backends/jolt/operators/listener.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Listener: () => (/* binding */ Listener)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Listener {\r\n    constructor(backend) {\r\n        this._listener = null;\r\n        this._charListener = null;\r\n\r\n        this._backend = backend;\r\n\r\n        this._contactsData = [0];\r\n        this._contactsCache = new Set();\r\n\r\n        this._charContactsData = new Map();\r\n    }\r\n\r\n    get dirty() {\r\n        return (this._contactsData[0] > 0 || this._charContactsData[0] > 0);\r\n    }\r\n\r\n    get charListener() {\r\n        return this._charListener;\r\n    }\r\n\r\n    // Contact Events\r\n\r\n    onContactValidate(body1, body2, baseOffset, collideShapeResult) {\r\n        return this._backend.Jolt.ValidateResult_AcceptAllContactsForThisBodyPair;\r\n    }\r\n\r\n    initEvents(config) {\r\n        const Jolt = this._backend.Jolt;\r\n\r\n        const listener = new Jolt.ContactListenerJS();\r\n        listener.OnContactValidate = this.onContactValidate.bind(this);\r\n        \r\n        if (config.contactAddedEventsEnabled) {\r\n            listener.OnContactAdded = this.onContactAdded.bind(this);\r\n        } else {\r\n            listener.OnContactAdded = () => {};\r\n        }\r\n\r\n        if (config.contactPersistedEventsEnabled) {\r\n            listener.OnContactPersisted = this.onContactPersisted.bind(this);\r\n        } else {\r\n            listener.OnContactPersisted = () => {};\r\n        }\r\n\r\n        if (config.contactRemovedEventsEnabled) {\r\n            listener.OnContactRemoved = this.onContactRemoved.bind(this);\r\n        } else {\r\n            listener.OnContactRemoved = () => {};\r\n        }\r\n\r\n        this._backend.physicsSystem.SetContactListener(listener);\r\n\r\n        this._listener = listener;\r\n    }\r\n\r\n    overrideContacts(listenerType, overrides) {\r\n        if (listenerType === 'char' && !this._charListener) {\r\n            this.initCharacterEvents();\r\n        }\r\n\r\n        const listener = listenerType === 'contacts' ? this._listener : this._charListener;\r\n\r\n        for (const [method, funcStr] of Object.entries(overrides)) {\r\n            listener[method] = eval('(' + funcStr + ')');\r\n        }\r\n    }\r\n\r\n    onContactPersisted(b1Pointer, b2Pointer, manifoldPointer, settingsPointer) {\r\n        this._wrapAndWrite(b1Pointer, b2Pointer, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_PERSISTED, false);\r\n    }\r\n\r\n    onContactRemoved(subShapePairPointer) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n\r\n        const subShapePair = Jolt.wrapPointer(subShapePairPointer, Jolt.SubShapeIDPair);\r\n        const bodyLockInterface = backend.physicsSystem.GetBodyLockInterface();\r\n\r\n        let body1 = bodyLockInterface.TryGetBody(subShapePair.GetBody1ID());\r\n        let body2 = bodyLockInterface.TryGetBody(subShapePair.GetBody2ID());\r\n\r\n        // A body could have been destroyed by the time this closure is called.\r\n        // Check if the body is still valid:\r\n        if (Jolt.getPointer(body1) === 0) {\r\n            body1 = null;\r\n        }\r\n        if (Jolt.getPointer(body2) === 0) {\r\n            body2 = null;\r\n        }\r\n\r\n        this._writeContactPair(body1, body2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_REMOVED, true);\r\n    }\r\n\r\n    onContactAdded(b1Pointer, b2Pointer, manifoldPointer, settingsPointer) {\r\n        const Jolt = this._backend.Jolt;\r\n        const data = this._contactsData;\r\n        const { contactPoints, contactPointsAveraged } = this._backend.config;\r\n        const manifold = Jolt.wrapPointer(manifoldPointer, Jolt.ContactManifold);\r\n\r\n        this._wrapAndWrite(b1Pointer, b2Pointer, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_ADDED, true);\r\n\r\n        const n = manifold.mWorldSpaceNormal;\r\n        const d = manifold.mPenetrationDepth;\r\n\r\n        data.push(n.GetX(), n.GetY(), n.GetZ(), d);\r\n\r\n        if (contactPoints) {\r\n            const jv = Jolt.Vec3.prototype.sZero();\r\n            const offset = manifold.mBaseOffset;\r\n            const points1 = manifold.mRelativeContactPointsOn1;\r\n            const points2 = manifold.mRelativeContactPointsOn2;\r\n            const count1 = points1.size();\r\n\r\n            if (contactPointsAveraged) {\r\n                for (let i = 0; i < count1; i++) {\r\n                    jv.Add(points1.at(i));\r\n                }\r\n                jv.Mul(1 / count1);\r\n                jv.Add(offset);\r\n                data.push(jv.GetX(), jv.GetY(), jv.GetZ());\r\n            } else {\r\n                const count2 = points1.size();\r\n                data.push(offset.GetX(), offset.GetY(), offset.GetZ(), count1, count2);\r\n                for (let i = 0; i < count1; i++) {\r\n                    const p = points1.at(i);\r\n                    data.push(p.GetX(), p.GetY(), p.GetZ());\r\n                }\r\n                for (let i = 0; i < count2; i++) {\r\n                    const p = points2.at(i);\r\n                    data.push(p.GetX(), p.GetY(), p.GetZ());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Character contact events\r\n\r\n    initCharacterEvents() {\r\n        const Jolt = this._backend.Jolt;\r\n\r\n        const listener = new Jolt.CharacterContactListenerJS();\r\n\r\n        listener.OnAdjustBodyVelocity = () => {};\r\n\r\n        listener.OnContactValidate = (character, bodyID2, subShapeID2) => {\r\n            // allow all\r\n            return true;\r\n        };\r\n\r\n        listener.OnContactAdded = () => {};\r\n\r\n        listener.OnContactSolve = this.onCharContactSolve.bind(this);\r\n\r\n        this._charListener = listener;\r\n    }\r\n\r\n    onCharContactSolve(character, bodyID2, subShapeID2, cp, cn, cv, contactMaterial, characterVelocity, nv) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n\r\n        character = Jolt.wrapPointer(character, Jolt.CharacterVirtual);\r\n        cp = Jolt.wrapPointer(cp, Jolt.Vec3);\r\n        cn = Jolt.wrapPointer(cn, Jolt.Vec3);\r\n        cv = Jolt.wrapPointer(cv, Jolt.Vec3);\r\n        nv = Jolt.wrapPointer(nv, Jolt.Vec3);\r\n\r\n        const data = this._charContactsData;\r\n        const index = tracker.getPCID(Jolt.getPointer(character));\r\n        \r\n        const bodyLockInterface = this._backend.physicsSystem.GetBodyLockInterface();\r\n\r\n        let body2 = bodyLockInterface.TryGetBody(bodyID2);\r\n        if (Jolt.getPointer(body2) === 0) {\r\n            body2 = null;\r\n        }\r\n\r\n        let contacts = data.get(index);\r\n        if (!contacts) {\r\n            contacts = [0];\r\n            data.set(index, contacts);\r\n        }\r\n\r\n        contacts[0] = ++contacts[0];\r\n\r\n        contacts.push(!!body2);\r\n        if (body2) {\r\n            const index2 = tracker.getPCID(Jolt.getPointer(body2));\r\n            contacts.push(index2);\r\n        } else {\r\n            contacts.push(null);\r\n        }\r\n\r\n        // contact position\r\n        contacts.push(cp.GetX());\r\n        contacts.push(cp.GetY());\r\n        contacts.push(cp.GetZ());\r\n\r\n        // contact normal\r\n        contacts.push(cn.GetX());\r\n        contacts.push(cn.GetY());\r\n        contacts.push(cn.GetZ());\r\n\r\n        // contact velocity\r\n        contacts.push(cv.GetX());\r\n        contacts.push(cv.GetY());\r\n        contacts.push(cv.GetZ());\r\n\r\n        // new character velocity\r\n        contacts.push(nv.GetX());\r\n        contacts.push(nv.GetY());\r\n        contacts.push(nv.GetZ());\r\n    }\r\n\r\n    initVehicleEvents(constraint) {\r\n        const Jolt = this._backend.Jolt;\r\n        const listener = Jolt.VehicleConstraintCallbacksJS();\r\n\r\n        listener.GetCombinedFriction = (wheelIndex, tireFrictionDirection, tireFriction, body2, subShapeID2) => {\r\n            body2 = Jolt.wrapPointer(body2, Jolt.Body);\r\n            return Math.sqrt(tireFriction * body2.GetFriction()); // This is the default calculation\r\n        };\r\n        listener.OnPreStepCallback = () => {};\r\n        listener.OnPostCollideCallback = () => {};\r\n        listener.OnPostStepCallback = () => {};\r\n\r\n        listener.SetVehicleConstraint(constraint);\r\n\r\n        this._vehicleListener = listener;\r\n    }\r\n\r\n    write(cb) {\r\n        this._writeContactEvents(cb);\r\n        this._writeCharacterEvents(cb);\r\n    }\r\n\r\n    reset(cb) {\r\n        this._contactsData.length = 0;\r\n        this._contactsData[0] = 0;\r\n        this._contactsCache.clear();\r\n        this._charContactsData.clear();\r\n    }\r\n\r\n    destroy() {\r\n        const Jolt = this._backend.Jolt;\r\n\r\n        if (this._listener) {\r\n            Jolt.destroy(this._listener);\r\n            this._listener = null;\r\n        }\r\n\r\n        if (this._charListener) {\r\n            Jolt.destroy(this._charListener);\r\n            this._charListener = null;\r\n        }\r\n    }\r\n\r\n    _writeContactEvents(cb) {\r\n        const data = this._contactsData;\r\n        const contactsCount = data[0];\r\n        \r\n        if (contactsCount === 0) {\r\n            return;\r\n        }\r\n        \r\n        const { contactPoints, contactPointsAveraged } = this._backend.config;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_BODY);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_CONTACTS);\r\n        \r\n        cb.write(contactsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // TODO\r\n        // average points per contact pair, instead of all contacts\r\n\r\n        for (let i = 0, k = 1; i < contactsCount; i++) {\r\n            // type\r\n            const type = data[k++];\r\n            cb.write(type, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT8, false);\r\n\r\n            // idx1, idx2, can be -1\r\n            const isValidBody1 = data[k++];\r\n            const isValidBody2 = data[k++];\r\n            cb.write(isValidBody1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n            cb.write(isValidBody2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n            if (isValidBody1) {\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n            if (isValidBody2) {\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n\r\n            if (type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_ADDED) {\r\n                // normal xyz\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                \r\n                // depth\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n    \r\n                cb.write(contactPoints, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                if (contactPoints) {\r\n    \r\n                    cb.write(contactPointsAveraged, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                    if (contactPointsAveraged) {\r\n                        // world point\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                    } else {\r\n                        // offset\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        \r\n                        // count1, count2\r\n                        const count1 = data[k++];\r\n                        const count2 = data[k++];\r\n                        cb.write(count1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n                        cb.write(count2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n    \r\n                        // local points\r\n                        for (let i = 0; i < count1; i++) {\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        }\r\n                        for (let i = 0; i < count2; i++) {\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        }                    \r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeCharacterEvents(cb) {\r\n        const data = this._charContactsData;\r\n        const charsCount = data.size;\r\n\r\n        // Skip writing contact events, if there are none\r\n        let skip = true;\r\n        data.forEach(contacts => {\r\n            if (contacts[0] > 0)\r\n                skip = false;\r\n        });\r\n        if (skip)\r\n            return;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_CONTACTS);\r\n        cb.write(charsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n        data.forEach((contacts, index) => {\r\n            const contactsCount = contacts[0];\r\n\r\n            cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(contactsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0, k = 1; i < contactsCount; i++) {\r\n                // is body 2 valid\r\n                cb.write(contacts[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                cb.write(contacts[k++] || 0, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n                \r\n                // contact position\r\n                // contact normal\r\n                // contact velocity\r\n                // new char velocity\r\n                for (let n = 0; n < 12; n++) {\r\n                    cb.write(contacts[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    _wrapAndWrite(b1Pointer, b2Pointer, type, ignoreCache) {\r\n        const Jolt = this._backend.Jolt;\r\n        const Body = Jolt.Body;\r\n\r\n        const body1 = Jolt.wrapPointer(b1Pointer, Body);\r\n\t\tconst body2 = Jolt.wrapPointer(b2Pointer, Body);\r\n\r\n        this._writeContactPair(body1, body2, type, ignoreCache);\r\n    }\r\n\r\n    _writeContactPair(body1, body2, type, ignoreCache) {\r\n        const backend = this._backend;\r\n        const data = this._contactsData;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n\r\n        let idx1 = null;\r\n        if (body1 !== null) {\r\n            idx1 = tracker.getPCID(Jolt.getPointer(body1)) ?? null;\r\n        }\r\n\r\n        let idx2 = null;\r\n        if (body2 !== null) {\r\n            idx2 = tracker.getPCID(Jolt.getPointer(body2)) ?? null;\r\n        }\r\n\r\n        // Persisted contacts will be called once per substep, which may \r\n        // happen multiple times per sim step. For general purposes, the first\r\n        // substep results should be enough, so we can discard the same\r\n        // contact pair after the first substep.\r\n        if (!ignoreCache && body1 && body2) {\r\n            const cache = this._contactsCache;\r\n            const str = `${ idx1 }:${ idx2 }:${ type }`;\r\n            if (cache.has(str)) {\r\n                return;\r\n            }\r\n            cache.add(str);\r\n        }\r\n\r\n        data[0] = ++data[0];\r\n\r\n        data.push(type);\r\n        data.push(!!body1);\r\n        data.push(!!body2);\r\n\r\n        if (body1)\r\n            data.push(idx1);\r\n        \r\n        if (body2)\r\n            data.push(idx2);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbGlzdGVuZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUt3RDtBQUNMO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDBGQUFzQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsd0ZBQW9CO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsdUNBQXVDO0FBQ3ZEO0FBQ0E7QUFDQSxpREFBaUQsc0ZBQWtCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsWUFBWTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxnQ0FBZ0MsWUFBWTtBQUM1QztBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsWUFBWTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFFBQVE7QUFDeEMsNENBQTRDLHdGQUFvQjtBQUNoRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLE1BQU0sSUFBSSxNQUFNLElBQUksTUFBTTtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbGlzdGVuZXIubWpzP2U0YzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UOCwgQ01EX1JFUE9SVF9DT05UQUNUUyxcclxuICAgIENPTVBPTkVOVF9TWVNURU1fQk9EWSwgQ09NUE9ORU5UX1NZU1RFTV9DSEFSLCBDT05UQUNUX1RZUEVfQURERUQsIENPTlRBQ1RfVFlQRV9QRVJTSVNURUQsXHJcbiAgICBDT05UQUNUX1RZUEVfUkVNT1ZFRFxyXG59IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcblxyXG5jbGFzcyBMaXN0ZW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2NoYXJMaXN0ZW5lciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2JhY2tlbmQgPSBiYWNrZW5kO1xyXG5cclxuICAgICAgICB0aGlzLl9jb250YWN0c0RhdGEgPSBbMF07XHJcbiAgICAgICAgdGhpcy5fY29udGFjdHNDYWNoZSA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2hhckNvbnRhY3RzRGF0YSA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLl9jb250YWN0c0RhdGFbMF0gPiAwIHx8IHRoaXMuX2NoYXJDb250YWN0c0RhdGFbMF0gPiAwKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2hhckxpc3RlbmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyTGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29udGFjdCBFdmVudHNcclxuXHJcbiAgICBvbkNvbnRhY3RWYWxpZGF0ZShib2R5MSwgYm9keTIsIGJhc2VPZmZzZXQsIGNvbGxpZGVTaGFwZVJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9iYWNrZW5kLkpvbHQuVmFsaWRhdGVSZXN1bHRfQWNjZXB0QWxsQ29udGFjdHNGb3JUaGlzQm9keVBhaXI7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEV2ZW50cyhjb25maWcpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5fYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IG5ldyBKb2x0LkNvbnRhY3RMaXN0ZW5lckpTKCk7XHJcbiAgICAgICAgbGlzdGVuZXIuT25Db250YWN0VmFsaWRhdGUgPSB0aGlzLm9uQ29udGFjdFZhbGlkYXRlLmJpbmQodGhpcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGNvbmZpZy5jb250YWN0QWRkZWRFdmVudHNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdEFkZGVkID0gdGhpcy5vbkNvbnRhY3RBZGRlZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdEFkZGVkID0gKCkgPT4ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY29uZmlnLmNvbnRhY3RQZXJzaXN0ZWRFdmVudHNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFBlcnNpc3RlZCA9IHRoaXMub25Db250YWN0UGVyc2lzdGVkLmJpbmQodGhpcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGlzdGVuZXIuT25Db250YWN0UGVyc2lzdGVkID0gKCkgPT4ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY29uZmlnLmNvbnRhY3RSZW1vdmVkRXZlbnRzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICBsaXN0ZW5lci5PbkNvbnRhY3RSZW1vdmVkID0gdGhpcy5vbkNvbnRhY3RSZW1vdmVkLmJpbmQodGhpcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGlzdGVuZXIuT25Db250YWN0UmVtb3ZlZCA9ICgpID0+IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fYmFja2VuZC5waHlzaWNzU3lzdGVtLlNldENvbnRhY3RMaXN0ZW5lcihsaXN0ZW5lcik7XHJcblxyXG4gICAgICAgIHRoaXMuX2xpc3RlbmVyID0gbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGVDb250YWN0cyhsaXN0ZW5lclR5cGUsIG92ZXJyaWRlcykge1xyXG4gICAgICAgIGlmIChsaXN0ZW5lclR5cGUgPT09ICdjaGFyJyAmJiAhdGhpcy5fY2hhckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENoYXJhY3RlckV2ZW50cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBsaXN0ZW5lclR5cGUgPT09ICdjb250YWN0cycgPyB0aGlzLl9saXN0ZW5lciA6IHRoaXMuX2NoYXJMaXN0ZW5lcjtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBbbWV0aG9kLCBmdW5jU3RyXSBvZiBPYmplY3QuZW50cmllcyhvdmVycmlkZXMpKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyW21ldGhvZF0gPSBldmFsKCcoJyArIGZ1bmNTdHIgKyAnKScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNvbnRhY3RQZXJzaXN0ZWQoYjFQb2ludGVyLCBiMlBvaW50ZXIsIG1hbmlmb2xkUG9pbnRlciwgc2V0dGluZ3NQb2ludGVyKSB7XHJcbiAgICAgICAgdGhpcy5fd3JhcEFuZFdyaXRlKGIxUG9pbnRlciwgYjJQb2ludGVyLCBDT05UQUNUX1RZUEVfUEVSU0lTVEVELCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Db250YWN0UmVtb3ZlZChzdWJTaGFwZVBhaXJQb2ludGVyKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IGJhY2tlbmQuSm9sdDtcclxuXHJcbiAgICAgICAgY29uc3Qgc3ViU2hhcGVQYWlyID0gSm9sdC53cmFwUG9pbnRlcihzdWJTaGFwZVBhaXJQb2ludGVyLCBKb2x0LlN1YlNoYXBlSURQYWlyKTtcclxuICAgICAgICBjb25zdCBib2R5TG9ja0ludGVyZmFjZSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpO1xyXG5cclxuICAgICAgICBsZXQgYm9keTEgPSBib2R5TG9ja0ludGVyZmFjZS5UcnlHZXRCb2R5KHN1YlNoYXBlUGFpci5HZXRCb2R5MUlEKCkpO1xyXG4gICAgICAgIGxldCBib2R5MiA9IGJvZHlMb2NrSW50ZXJmYWNlLlRyeUdldEJvZHkoc3ViU2hhcGVQYWlyLkdldEJvZHkySUQoKSk7XHJcblxyXG4gICAgICAgIC8vIEEgYm9keSBjb3VsZCBoYXZlIGJlZW4gZGVzdHJveWVkIGJ5IHRoZSB0aW1lIHRoaXMgY2xvc3VyZSBpcyBjYWxsZWQuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGJvZHkgaXMgc3RpbGwgdmFsaWQ6XHJcbiAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihib2R5MSkgPT09IDApIHtcclxuICAgICAgICAgICAgYm9keTEgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoSm9sdC5nZXRQb2ludGVyKGJvZHkyKSA9PT0gMCkge1xyXG4gICAgICAgICAgICBib2R5MiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl93cml0ZUNvbnRhY3RQYWlyKGJvZHkxLCBib2R5MiwgQ09OVEFDVF9UWVBFX1JFTU9WRUQsIHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ29udGFjdEFkZGVkKGIxUG9pbnRlciwgYjJQb2ludGVyLCBtYW5pZm9sZFBvaW50ZXIsIHNldHRpbmdzUG9pbnRlcikge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLl9iYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2NvbnRhY3RzRGF0YTtcclxuICAgICAgICBjb25zdCB7IGNvbnRhY3RQb2ludHMsIGNvbnRhY3RQb2ludHNBdmVyYWdlZCB9ID0gdGhpcy5fYmFja2VuZC5jb25maWc7XHJcbiAgICAgICAgY29uc3QgbWFuaWZvbGQgPSBKb2x0LndyYXBQb2ludGVyKG1hbmlmb2xkUG9pbnRlciwgSm9sdC5Db250YWN0TWFuaWZvbGQpO1xyXG5cclxuICAgICAgICB0aGlzLl93cmFwQW5kV3JpdGUoYjFQb2ludGVyLCBiMlBvaW50ZXIsIENPTlRBQ1RfVFlQRV9BRERFRCwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG4gPSBtYW5pZm9sZC5tV29ybGRTcGFjZU5vcm1hbDtcclxuICAgICAgICBjb25zdCBkID0gbWFuaWZvbGQubVBlbmV0cmF0aW9uRGVwdGg7XHJcblxyXG4gICAgICAgIGRhdGEucHVzaChuLkdldFgoKSwgbi5HZXRZKCksIG4uR2V0WigpLCBkKTtcclxuXHJcbiAgICAgICAgaWYgKGNvbnRhY3RQb2ludHMpIHtcclxuICAgICAgICAgICAgY29uc3QganYgPSBKb2x0LlZlYzMucHJvdG90eXBlLnNaZXJvKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IG1hbmlmb2xkLm1CYXNlT2Zmc2V0O1xyXG4gICAgICAgICAgICBjb25zdCBwb2ludHMxID0gbWFuaWZvbGQubVJlbGF0aXZlQ29udGFjdFBvaW50c09uMTtcclxuICAgICAgICAgICAgY29uc3QgcG9pbnRzMiA9IG1hbmlmb2xkLm1SZWxhdGl2ZUNvbnRhY3RQb2ludHNPbjI7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvdW50MSA9IHBvaW50czEuc2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNvbnRhY3RQb2ludHNBdmVyYWdlZCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGp2LkFkZChwb2ludHMxLmF0KGkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGp2Lk11bCgxIC8gY291bnQxKTtcclxuICAgICAgICAgICAgICAgIGp2LkFkZChvZmZzZXQpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKGp2LkdldFgoKSwganYuR2V0WSgpLCBqdi5HZXRaKCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnQyID0gcG9pbnRzMS5zaXplKCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2Zmc2V0LkdldFgoKSwgb2Zmc2V0LkdldFkoKSwgb2Zmc2V0LkdldFooKSwgY291bnQxLCBjb3VudDIpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwb2ludHMxLmF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChwLkdldFgoKSwgcC5HZXRZKCksIHAuR2V0WigpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQyOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcG9pbnRzMi5hdChpKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gocC5HZXRYKCksIHAuR2V0WSgpLCBwLkdldFooKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hhcmFjdGVyIGNvbnRhY3QgZXZlbnRzXHJcblxyXG4gICAgaW5pdENoYXJhY3RlckV2ZW50cygpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5fYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IG5ldyBKb2x0LkNoYXJhY3RlckNvbnRhY3RMaXN0ZW5lckpTKCk7XHJcblxyXG4gICAgICAgIGxpc3RlbmVyLk9uQWRqdXN0Qm9keVZlbG9jaXR5ID0gKCkgPT4ge307XHJcblxyXG4gICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFZhbGlkYXRlID0gKGNoYXJhY3RlciwgYm9keUlEMiwgc3ViU2hhcGVJRDIpID0+IHtcclxuICAgICAgICAgICAgLy8gYWxsb3cgYWxsXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdEFkZGVkID0gKCkgPT4ge307XHJcblxyXG4gICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFNvbHZlID0gdGhpcy5vbkNoYXJDb250YWN0U29sdmUuYmluZCh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2hhckxpc3RlbmVyID0gbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGFyQ29udGFjdFNvbHZlKGNoYXJhY3RlciwgYm9keUlEMiwgc3ViU2hhcGVJRDIsIGNwLCBjbiwgY3YsIGNvbnRhY3RNYXRlcmlhbCwgY2hhcmFjdGVyVmVsb2NpdHksIG52KSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IGJhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG5cclxuICAgICAgICBjaGFyYWN0ZXIgPSBKb2x0LndyYXBQb2ludGVyKGNoYXJhY3RlciwgSm9sdC5DaGFyYWN0ZXJWaXJ0dWFsKTtcclxuICAgICAgICBjcCA9IEpvbHQud3JhcFBvaW50ZXIoY3AsIEpvbHQuVmVjMyk7XHJcbiAgICAgICAgY24gPSBKb2x0LndyYXBQb2ludGVyKGNuLCBKb2x0LlZlYzMpO1xyXG4gICAgICAgIGN2ID0gSm9sdC53cmFwUG9pbnRlcihjdiwgSm9sdC5WZWMzKTtcclxuICAgICAgICBudiA9IEpvbHQud3JhcFBvaW50ZXIobnYsIEpvbHQuVmVjMyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9jaGFyQ29udGFjdHNEYXRhO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihjaGFyYWN0ZXIpKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBib2R5TG9ja0ludGVyZmFjZSA9IHRoaXMuX2JhY2tlbmQucGh5c2ljc1N5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpO1xyXG5cclxuICAgICAgICBsZXQgYm9keTIgPSBib2R5TG9ja0ludGVyZmFjZS5UcnlHZXRCb2R5KGJvZHlJRDIpO1xyXG4gICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoYm9keTIpID09PSAwKSB7XHJcbiAgICAgICAgICAgIGJvZHkyID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb250YWN0cyA9IGRhdGEuZ2V0KGluZGV4KTtcclxuICAgICAgICBpZiAoIWNvbnRhY3RzKSB7XHJcbiAgICAgICAgICAgIGNvbnRhY3RzID0gWzBdO1xyXG4gICAgICAgICAgICBkYXRhLnNldChpbmRleCwgY29udGFjdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29udGFjdHNbMF0gPSArK2NvbnRhY3RzWzBdO1xyXG5cclxuICAgICAgICBjb250YWN0cy5wdXNoKCEhYm9keTIpO1xyXG4gICAgICAgIGlmIChib2R5Mikge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleDIgPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkyKSk7XHJcbiAgICAgICAgICAgIGNvbnRhY3RzLnB1c2goaW5kZXgyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb250YWN0cy5wdXNoKG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY29udGFjdCBwb3NpdGlvblxyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY3AuR2V0WCgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKGNwLkdldFkoKSk7XHJcbiAgICAgICAgY29udGFjdHMucHVzaChjcC5HZXRaKCkpO1xyXG5cclxuICAgICAgICAvLyBjb250YWN0IG5vcm1hbFxyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY24uR2V0WCgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKGNuLkdldFkoKSk7XHJcbiAgICAgICAgY29udGFjdHMucHVzaChjbi5HZXRaKCkpO1xyXG5cclxuICAgICAgICAvLyBjb250YWN0IHZlbG9jaXR5XHJcbiAgICAgICAgY29udGFjdHMucHVzaChjdi5HZXRYKCkpO1xyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY3YuR2V0WSgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKGN2LkdldFooKSk7XHJcblxyXG4gICAgICAgIC8vIG5ldyBjaGFyYWN0ZXIgdmVsb2NpdHlcclxuICAgICAgICBjb250YWN0cy5wdXNoKG52LkdldFgoKSk7XHJcbiAgICAgICAgY29udGFjdHMucHVzaChudi5HZXRZKCkpO1xyXG4gICAgICAgIGNvbnRhY3RzLnB1c2gobnYuR2V0WigpKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0VmVoaWNsZUV2ZW50cyhjb25zdHJhaW50KSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuX2JhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IEpvbHQuVmVoaWNsZUNvbnN0cmFpbnRDYWxsYmFja3NKUygpO1xyXG5cclxuICAgICAgICBsaXN0ZW5lci5HZXRDb21iaW5lZEZyaWN0aW9uID0gKHdoZWVsSW5kZXgsIHRpcmVGcmljdGlvbkRpcmVjdGlvbiwgdGlyZUZyaWN0aW9uLCBib2R5Miwgc3ViU2hhcGVJRDIpID0+IHtcclxuICAgICAgICAgICAgYm9keTIgPSBKb2x0LndyYXBQb2ludGVyKGJvZHkyLCBKb2x0LkJvZHkpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRpcmVGcmljdGlvbiAqIGJvZHkyLkdldEZyaWN0aW9uKCkpOyAvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IGNhbGN1bGF0aW9uXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsaXN0ZW5lci5PblByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9O1xyXG4gICAgICAgIGxpc3RlbmVyLk9uUG9zdENvbGxpZGVDYWxsYmFjayA9ICgpID0+IHt9O1xyXG4gICAgICAgIGxpc3RlbmVyLk9uUG9zdFN0ZXBDYWxsYmFjayA9ICgpID0+IHt9O1xyXG5cclxuICAgICAgICBsaXN0ZW5lci5TZXRWZWhpY2xlQ29uc3RyYWludChjb25zdHJhaW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5fdmVoaWNsZUxpc3RlbmVyID0gbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGUoY2IpIHtcclxuICAgICAgICB0aGlzLl93cml0ZUNvbnRhY3RFdmVudHMoY2IpO1xyXG4gICAgICAgIHRoaXMuX3dyaXRlQ2hhcmFjdGVyRXZlbnRzKGNiKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldChjYikge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhY3RzRGF0YS5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhY3RzRGF0YVswXSA9IDA7XHJcbiAgICAgICAgdGhpcy5fY29udGFjdHNDYWNoZS5jbGVhcigpO1xyXG4gICAgICAgIHRoaXMuX2NoYXJDb250YWN0c0RhdGEuY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLl9iYWNrZW5kLkpvbHQ7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5lcikge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fbGlzdGVuZXIpO1xyXG4gICAgICAgICAgICB0aGlzLl9saXN0ZW5lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2hhckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9jaGFyTGlzdGVuZXIpO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFyTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDb250YWN0RXZlbnRzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2NvbnRhY3RzRGF0YTtcclxuICAgICAgICBjb25zdCBjb250YWN0c0NvdW50ID0gZGF0YVswXTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoY29udGFjdHNDb3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHsgY29udGFjdFBvaW50cywgY29udGFjdFBvaW50c0F2ZXJhZ2VkIH0gPSB0aGlzLl9iYWNrZW5kLmNvbmZpZztcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX0JPRFkpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX0NPTlRBQ1RTKTtcclxuICAgICAgICBcclxuICAgICAgICBjYi53cml0ZShjb250YWN0c0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyBhdmVyYWdlIHBvaW50cyBwZXIgY29udGFjdCBwYWlyLCBpbnN0ZWFkIG9mIGFsbCBjb250YWN0c1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgayA9IDE7IGkgPCBjb250YWN0c0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgLy8gdHlwZVxyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gZGF0YVtrKytdO1xyXG4gICAgICAgICAgICBjYi53cml0ZSh0eXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlkeDEsIGlkeDIsIGNhbiBiZSAtMVxyXG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkQm9keTEgPSBkYXRhW2srK107XHJcbiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRCb2R5MiA9IGRhdGFbaysrXTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoaXNWYWxpZEJvZHkxLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShpc1ZhbGlkQm9keTIsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTEpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTIpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gQ09OVEFDVF9UWVBFX0FEREVEKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBub3JtYWwgeHl6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIGRlcHRoXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGNvbnRhY3RQb2ludHMsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFjdFBvaW50cykge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdFBvaW50c0F2ZXJhZ2VkLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0UG9pbnRzQXZlcmFnZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd29ybGQgcG9pbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZGF0YVtrKytdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZGF0YVtrKytdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdW50MSwgY291bnQyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50MSA9IGRhdGFbaysrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQyID0gZGF0YVtrKytdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShjb3VudDEsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY291bnQyLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9jYWwgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50MjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDaGFyYWN0ZXJFdmVudHMoY2IpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fY2hhckNvbnRhY3RzRGF0YTtcclxuICAgICAgICBjb25zdCBjaGFyc0NvdW50ID0gZGF0YS5zaXplO1xyXG5cclxuICAgICAgICAvLyBTa2lwIHdyaXRpbmcgY29udGFjdCBldmVudHMsIGlmIHRoZXJlIGFyZSBub25lXHJcbiAgICAgICAgbGV0IHNraXAgPSB0cnVlO1xyXG4gICAgICAgIGRhdGEuZm9yRWFjaChjb250YWN0cyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb250YWN0c1swXSA+IDApXHJcbiAgICAgICAgICAgICAgICBza2lwID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHNraXApXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX0NIQVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX0NPTlRBQ1RTKTtcclxuICAgICAgICBjYi53cml0ZShjaGFyc0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGRhdGEuZm9yRWFjaCgoY29udGFjdHMsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhY3RzQ291bnQgPSBjb250YWN0c1swXTtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGNvbnRhY3RzQ291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBrID0gMTsgaSA8IGNvbnRhY3RzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gaXMgYm9keSAyIHZhbGlkXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShjb250YWN0c1trKytdLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdHNbaysrXSB8fCAwLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIGNvbnRhY3QgcG9zaXRpb25cclxuICAgICAgICAgICAgICAgIC8vIGNvbnRhY3Qgbm9ybWFsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250YWN0IHZlbG9jaXR5XHJcbiAgICAgICAgICAgICAgICAvLyBuZXcgY2hhciB2ZWxvY2l0eVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCAxMjsgbisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdHNbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIF93cmFwQW5kV3JpdGUoYjFQb2ludGVyLCBiMlBvaW50ZXIsIHR5cGUsIGlnbm9yZUNhY2hlKSB7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IHRoaXMuX2JhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBCb2R5ID0gSm9sdC5Cb2R5O1xyXG5cclxuICAgICAgICBjb25zdCBib2R5MSA9IEpvbHQud3JhcFBvaW50ZXIoYjFQb2ludGVyLCBCb2R5KTtcclxuXHRcdGNvbnN0IGJvZHkyID0gSm9sdC53cmFwUG9pbnRlcihiMlBvaW50ZXIsIEJvZHkpO1xyXG5cclxuICAgICAgICB0aGlzLl93cml0ZUNvbnRhY3RQYWlyKGJvZHkxLCBib2R5MiwgdHlwZSwgaWdub3JlQ2FjaGUpO1xyXG4gICAgfVxyXG5cclxuICAgIF93cml0ZUNvbnRhY3RQYWlyKGJvZHkxLCBib2R5MiwgdHlwZSwgaWdub3JlQ2FjaGUpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fY29udGFjdHNEYXRhO1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuXHJcbiAgICAgICAgbGV0IGlkeDEgPSBudWxsO1xyXG4gICAgICAgIGlmIChib2R5MSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZHgxID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihib2R5MSkpID8/IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgaWR4MiA9IG51bGw7XHJcbiAgICAgICAgaWYgKGJvZHkyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlkeDIgPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkyKSkgPz8gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFBlcnNpc3RlZCBjb250YWN0cyB3aWxsIGJlIGNhbGxlZCBvbmNlIHBlciBzdWJzdGVwLCB3aGljaCBtYXkgXHJcbiAgICAgICAgLy8gaGFwcGVuIG11bHRpcGxlIHRpbWVzIHBlciBzaW0gc3RlcC4gRm9yIGdlbmVyYWwgcHVycG9zZXMsIHRoZSBmaXJzdFxyXG4gICAgICAgIC8vIHN1YnN0ZXAgcmVzdWx0cyBzaG91bGQgYmUgZW5vdWdoLCBzbyB3ZSBjYW4gZGlzY2FyZCB0aGUgc2FtZVxyXG4gICAgICAgIC8vIGNvbnRhY3QgcGFpciBhZnRlciB0aGUgZmlyc3Qgc3Vic3RlcC5cclxuICAgICAgICBpZiAoIWlnbm9yZUNhY2hlICYmIGJvZHkxICYmIGJvZHkyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fY29udGFjdHNDYWNoZTtcclxuICAgICAgICAgICAgY29uc3Qgc3RyID0gYCR7IGlkeDEgfTokeyBpZHgyIH06JHsgdHlwZSB9YDtcclxuICAgICAgICAgICAgaWYgKGNhY2hlLmhhcyhzdHIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FjaGUuYWRkKHN0cik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkYXRhWzBdID0gKytkYXRhWzBdO1xyXG5cclxuICAgICAgICBkYXRhLnB1c2godHlwZSk7XHJcbiAgICAgICAgZGF0YS5wdXNoKCEhYm9keTEpO1xyXG4gICAgICAgIGRhdGEucHVzaCghIWJvZHkyKTtcclxuXHJcbiAgICAgICAgaWYgKGJvZHkxKVxyXG4gICAgICAgICAgICBkYXRhLnB1c2goaWR4MSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGJvZHkyKVxyXG4gICAgICAgICAgICBkYXRhLnB1c2goaWR4Mik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IExpc3RlbmVyIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/listener.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/modifier.mjs":
/*!**************************************************!*\
  !*** ./src/backends/jolt/operators/modifier.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Modifier: () => (/* binding */ Modifier)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../motion-state.mjs */ \"./src/backends/jolt/motion-state.mjs\");\n\r\n\r\n\r\n\r\nclass Modifier {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n\r\n        const Jolt = backend.Jolt;\r\n\r\n        this._joltVec3_1 = new Jolt.Vec3();\r\n        this._joltVec3_2 = new Jolt.Vec3();\r\n        this._joltVec3_3 = new Jolt.Vec3();\r\n        this._joltQuat_1 = new Jolt.Quat();\r\n    }\r\n\r\n    get joltVec3_1() {\r\n        return this._joltVec3_1;\r\n    }\r\n\r\n    get joltVec3_2() {\r\n        return this._joltVec3_2;\r\n    }\r\n\r\n    modify() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHANGE_GRAVITY:\r\n                ok = this._changeGravity(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_FORCE:\r\n                ok = this._applyForces(cb, 'AddForce');\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_IMPULSE:\r\n                ok = this._applyForces(cb, 'AddImpulse');\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_ANGULAR_IMPULSE:\r\n                ok = this._applyForces(cb, 'AddAngularImpulse', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_APPLY_BUOYANCY_IMPULSE:\r\n                ok = this._applyBuoyancyImpulse(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_TORQUE:\r\n                ok = this._applyForces(cb, 'AddTorque', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_MOVE_BODY:\r\n                ok = this._moveBody(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_LIN_VEL:\r\n                ok = this._applyForces(cb, 'SetLinearVelocity', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHAR_SET_LIN_VEL:\r\n                this._setCharacterLinVel(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_ANG_VEL:\r\n                ok = this._applyForces(cb, 'SetAngularVelocity', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_RESET_VELOCITIES:\r\n                ok = this._resetVelocities(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_MOTION_TYPE:\r\n                ok = this._setMotionType(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_TOGGLE_GROUP_PAIR:\r\n                ok = this._toggleGroupPair(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_USER_DATA:\r\n                ok = this._setUserData(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHAR_SET_SHAPE:\r\n                ok = this._setCharShape(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_USE_MOTION_STATE:\r\n                ok = this._useMotionState(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_CONSTRAINT_ENABLED:\r\n                ok = this._setConstraintEnabled(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_DRIVER_INPUT:\r\n                ok = this._setDriverInput(cb);\r\n                break;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        const Jolt = this._backend.Jolt;\r\n\r\n        Jolt.destroy(this._joltVec3_1);\r\n        Jolt.destroy(this._joltVec3_2);\r\n        Jolt.destroy(this._joltVec3_3);\r\n        Jolt.destroy(this._joltQuat_1);\r\n\r\n        this._joltVec3_1 = null;\r\n        this._joltVec3_2 = null;\r\n        this._joltVec3_3 = null;\r\n        this._joltQuat_1 = null;        \r\n    }\r\n\r\n    _changeGravity(cb) {\r\n        const jv = this._joltVec3;\r\n\r\n        jv.FromBuffer(cb);\r\n\r\n        try {\r\n            this._backend.system.SetGravity(jv);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _applyForces(cb, method, oneAttr = false) {\r\n        const jv1 = this._joltVec3_1;\r\n        const jv2 = this._joltVec3_2;\r\n\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv1.FromBuffer(cb);\r\n            if (oneAttr) {\r\n                body[method](jv1);\r\n            } else {\r\n                if (cb.flag) {\r\n                    jv2.FromBuffer(cb);\r\n                    body[method](jv1, jv2);\r\n                } else {\r\n                    body[method](jv1);\r\n                }\r\n            }\r\n            this._backend.bodyInterface.ActivateBody(body.GetID());\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setCharShape(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const pcid = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useCallback = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const shapeIndex = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        const char = tracker.getBodyByPCID(pcid);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !char) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Unable to locate character under id: ${ pcid }`);\r\n            return false;\r\n        }\r\n\r\n        let shape;\r\n        if (shapeIndex != null) {\r\n            shape = tracker.shapeMap.get(shapeIndex);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !shape) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Unable to locate shape: ${ shapeIndex }`);\r\n                return false;\r\n            }\r\n        } else {\r\n            shape = char.originalShape;\r\n        }\r\n\r\n        let cbIndex;\r\n        if (useCallback) {\r\n            cbIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        }\r\n\r\n        const ok = char.SetShape(shape, \r\n            backend.config.penetrationSlop * 1.5,\r\n            backend.bpFilter,\r\n            backend.objFilter,\r\n            backend.bodyFilter,\r\n            backend.shapeFilter,\r\n            backend.joltInterface.GetTempAllocator());\r\n        \r\n        if (ok && useCallback) {\r\n            const cb = backend.outBuffer;\r\n\r\n            cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n            cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_SET_SHAPE);\r\n            cb.write(cbIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _resetCharShape(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const pcid = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useCallback = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        let cbIndex;\r\n        if (useCallback) {\r\n            cbIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        }\r\n\r\n        const char = tracker.getBodyByPCID(pcid);\r\n\r\n        const ok = char.SetShape(shape, \r\n            backend.config.penetrationSlop * 1.5,\r\n            backend.bpFilter,\r\n            backend.objFilter,\r\n            backend.bodyFilter,\r\n            backend.shapeFilter,\r\n            backend.joltInterface.GetTempAllocator());\r\n        \r\n        if (ok && useCallback) {\r\n            const cb = backend.outBuffer;\r\n\r\n            cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n            cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_SET_SHAPE);\r\n            cb.write(cbIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _setUserData(cb) {\r\n        const obj = this._getBody(cb);\r\n\r\n        try {\r\n            const shape = obj.GetShape();\r\n            const value = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            shape.SetUserData(value);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _useMotionState(cb) {\r\n        const body = this._getBody(cb);\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        if (!body.motionState && useMotionState) {\r\n            body.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(body);\r\n        } else if (body.motionState && !useMotionState) {\r\n            body.motionState = null;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setCharacterLinVel(cb) {\r\n        const jv = this._joltVec3_1;\r\n        const char = this._getBody(cb);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            char.SetLinearVelocity(jv);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }        \r\n    }\r\n\r\n    _applyBuoyancyImpulse(cb) {\r\n        const backend = this._backend;\r\n        const body = this._getBody(cb);\r\n        const jv1 = this._joltVec3_1;\r\n        const jv2 = this._joltVec3_2;\r\n        const jv3 = this._joltVec3_3;\r\n\r\n        try {\r\n            const waterSurfacePosition = jv1.FromBuffer(cb);\r\n            const surfaceNormal = jv2.FromBuffer(cb);\r\n            const buoyancy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const linearDrag = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const angularDrag = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const fluidVelocity = jv3.FromBuffer(cb);\r\n            const deltaTime = backend.config.fixedStep;\r\n            const gravity = backend.physicsSystem.GetGravity();\r\n\r\n            body.ApplyBuoyancyImpulse(waterSurfacePosition, surfaceNormal, buoyancy, linearDrag, angularDrag, fluidVelocity, gravity, deltaTime);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setConstraintEnabled(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const enabled = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const activate = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        const data = backend.tracker.constraintMap.get(index);\r\n        \r\n        // An index could be old and constraint might have been already destroyed.\r\n        if (!data) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Trying to enable/disable a constraint that has already been destroyed: ${ index }`);\r\n            return true;\r\n        }\r\n\r\n        try {\r\n            data.constraint.SetEnabled(enabled);\r\n    \r\n            if (activate) {\r\n                const bodyInterface = backend.bodyInterface;\r\n                const { body1, body2 } = data;\r\n    \r\n                if (Jolt.getPointer(data.body1) !== 0) {\r\n                    bodyInterface.ActivateBody(body1.GetID());\r\n                }\r\n                if (Jolt.getPointer(data.body2) !== 0) {\r\n                    bodyInterface.ActivateBody(body2.GetID());\r\n                }\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _resetVelocities(cb) {\r\n        const jv1 = this._joltVec3_1;\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv1.Set(0, 0, 0);\r\n\r\n            body.SetLinearVelocity(jv1);\r\n            body.SetAngularVelocity(jv1);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _moveBody(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const jv = this._joltVec3_1;\r\n        const jq = this._joltQuat_1;\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            jq.FromBuffer(cb);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const type = body.GetMotionType();\r\n                if (type === Jolt.EMotionType_Dynamic || type === Jolt.EMotionType_Kinematic) {\r\n                    backend.bodyInterface.SetPositionAndRotation(body.GetID(), jv, jq, Jolt.Activate);\r\n                } else {\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warnOnce('Trying to move a static body.');\r\n                }\r\n            } else {\r\n                backend.bodyInterface.SetPositionAndRotation(body.GetID(), jv, jq, Jolt.Activate);\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setDriverInput(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const body = tracker.getBodyByPCID(index);\r\n        const data = tracker.constraintMap.get(index);\r\n        if (!data || !body) {\r\n            return true;\r\n        }\r\n\r\n        data.constraint.controller.SetDriverInput(\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        backend.bodyInterface.ActivateBody(body.GetID());\r\n\r\n        return true;\r\n    }\r\n\r\n    _toggleGroupPair(cb) {\r\n        const backend = this._backend;\r\n        const enable = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const group = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const subGroup1 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const subGroup2 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n\r\n        try {\r\n            const filter = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = true;\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!filter, `Unable to locate filter group: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(subGroup1 <= filter.maxIndex, `Sub group number is over the filter table size: ${ subGroup1 }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(subGroup2 <= filter.maxIndex, `Sub group number is over the filter table size: ${ subGroup2 }`);\r\n                if (!ok) return false;\r\n            }\r\n\r\n            if (enable) {\r\n                filter.EnableCollision(subGroup1, subGroup2);\r\n            } else {\r\n                filter.DisableCollision(subGroup1, subGroup2);\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setMotionType(cb) {\r\n        const backend = this._backend;\r\n        const Jolt = backend.Jolt;\r\n        const tracker = backend.tracker;\r\n        const bodyInterface = backend.bodyInterface;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const body = tracker.getBodyByPCID(index);\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(type);\r\n\r\n        try {\r\n            bodyInterface.SetMotionType(body.GetID(), type, Jolt.Activate);\r\n            tracker.update(body, index);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _getBody(cb) {\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        return this._backend.tracker.getBodyByPCID(index);\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbW9kaWZpZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFxQndEO0FBQ0w7QUFDRDtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsc0ZBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixpRkFBYTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsbUZBQWU7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDJGQUF1QjtBQUN4QztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsOEZBQTBCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixrRkFBYztBQUMvQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsaUZBQWE7QUFDOUI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG1GQUFlO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQix3RkFBb0I7QUFDckM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG1GQUFlO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQix3RkFBb0I7QUFDckM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHVGQUFtQjtBQUNwQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIseUZBQXFCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixxRkFBaUI7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHNGQUFrQjtBQUNuQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsd0ZBQW9CO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw4RkFBMEI7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHdGQUFvQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsc0ZBQWtCO0FBQ2hEO0FBQ0EsNkJBQTZCLHFGQUFpQjtBQUM5QztBQUNBLFFBQVEscURBQUssUUFBUSxxREFBSztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVixZQUFZLHFEQUFLLFFBQVEscURBQUs7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsc0ZBQWtCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ29CO0FBQ3BCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbW9kaWZpZXIubWpzPzBiYmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9SRUFEX0JPT0wsXHJcbiAgICBCVUZGRVJfUkVBRF9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDE2LCBCVUZGRVJfUkVBRF9VSU5UMzIsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UOCxcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsXHJcbiAgICBDTURfQUREX0FOR1VMQVJfSU1QVUxTRSwgQ01EX0FERF9GT1JDRSwgQ01EX0FERF9JTVBVTFNFLFxyXG4gICAgQ01EX0FERF9UT1JRVUUsIENNRF9BUFBMWV9CVU9ZQU5DWV9JTVBVTFNFLCBDTURfQ0hBTkdFX0dSQVZJVFksXHJcbiAgICBDTURfQ0hBUl9TRVRfTElOX1ZFTCxcclxuICAgIENNRF9DSEFSX1NFVF9TSEFQRSxcclxuICAgIENNRF9NT1ZFX0JPRFksXHJcbiAgICBDTURfUkVQT1JUX1NFVF9TSEFQRSxcclxuICAgIENNRF9SRVNFVF9WRUxPQ0lUSUVTLFxyXG4gICAgQ01EX1NFVF9BTkdfVkVMLFxyXG4gICAgQ01EX1NFVF9DT05TVFJBSU5UX0VOQUJMRUQsXHJcbiAgICBDTURfU0VUX0RSSVZFUl9JTlBVVCxcclxuICAgIENNRF9TRVRfTElOX1ZFTCwgQ01EX1NFVF9NT1RJT05fVFlQRSxcclxuICAgIENNRF9TRVRfVVNFUl9EQVRBLFxyXG4gICAgQ01EX1RPR0dMRV9HUk9VUF9QQUlSLFxyXG4gICAgQ01EX1VTRV9NT1RJT05fU1RBVEUsXHJcbiAgICBDT01QT05FTlRfU1lTVEVNX0NIQVJcclxufSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBNb3Rpb25TdGF0ZSB9IGZyb20gXCIuLi9tb3Rpb24tc3RhdGUubWpzXCI7XHJcblxyXG5jbGFzcyBNb2RpZmllciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IGJhY2tlbmQ7XHJcblxyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcblxyXG4gICAgICAgIHRoaXMuX2pvbHRWZWMzXzEgPSBuZXcgSm9sdC5WZWMzKCk7XHJcbiAgICAgICAgdGhpcy5fam9sdFZlYzNfMiA9IG5ldyBKb2x0LlZlYzMoKTtcclxuICAgICAgICB0aGlzLl9qb2x0VmVjM18zID0gbmV3IEpvbHQuVmVjMygpO1xyXG4gICAgICAgIHRoaXMuX2pvbHRRdWF0XzEgPSBuZXcgSm9sdC5RdWF0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGpvbHRWZWMzXzEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvbHRWZWMzXzE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGpvbHRWZWMzXzIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvbHRWZWMzXzI7XHJcbiAgICB9XHJcblxyXG4gICAgbW9kaWZ5KCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fYmFja2VuZC5pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfQ0hBTkdFX0dSQVZJVFk6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2NoYW5nZUdyYXZpdHkoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9BRERfRk9SQ0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5Rm9yY2VzKGNiLCAnQWRkRm9yY2UnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQUREX0lNUFVMU0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5Rm9yY2VzKGNiLCAnQWRkSW1wdWxzZScpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9BRERfQU5HVUxBUl9JTVBVTFNFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9hcHBseUZvcmNlcyhjYiwgJ0FkZEFuZ3VsYXJJbXB1bHNlJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0FQUExZX0JVT1lBTkNZX0lNUFVMU0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5QnVveWFuY3lJbXB1bHNlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQUREX1RPUlFVRTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fYXBwbHlGb3JjZXMoY2IsICdBZGRUb3JxdWUnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfTU9WRV9CT0RZOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9tb3ZlQm9keShjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1NFVF9MSU5fVkVMOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9hcHBseUZvcmNlcyhjYiwgJ1NldExpbmVhclZlbG9jaXR5JywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NIQVJfU0VUX0xJTl9WRUw6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDaGFyYWN0ZXJMaW5WZWwoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9TRVRfQU5HX1ZFTDpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fYXBwbHlGb3JjZXMoY2IsICdTZXRBbmd1bGFyVmVsb2NpdHknLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfUkVTRVRfVkVMT0NJVElFUzpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fcmVzZXRWZWxvY2l0aWVzKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfU0VUX01PVElPTl9UWVBFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9zZXRNb3Rpb25UeXBlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfVE9HR0xFX0dST1VQX1BBSVI6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3RvZ2dsZUdyb3VwUGFpcihjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1NFVF9VU0VSX0RBVEE6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3NldFVzZXJEYXRhKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ0hBUl9TRVRfU0hBUEU6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3NldENoYXJTaGFwZShjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1VTRV9NT1RJT05fU1RBVEU6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3VzZU1vdGlvblN0YXRlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfU0VUX0NPTlNUUkFJTlRfRU5BQkxFRDpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fc2V0Q29uc3RyYWludEVuYWJsZWQoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9TRVRfRFJJVkVSX0lOUFVUOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9zZXREcml2ZXJJbnB1dChjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLl9iYWNrZW5kLkpvbHQ7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0VmVjM18xKTtcclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fam9sdFZlYzNfMik7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRWZWMzXzMpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0UXVhdF8xKTtcclxuXHJcbiAgICAgICAgdGhpcy5fam9sdFZlYzNfMSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fam9sdFZlYzNfMiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fam9sdFZlYzNfMyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fam9sdFF1YXRfMSA9IG51bGw7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBfY2hhbmdlR3Jhdml0eShjYikge1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzM7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLl9iYWNrZW5kLnN5c3RlbS5TZXRHcmF2aXR5KGp2KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2FwcGx5Rm9yY2VzKGNiLCBtZXRob2QsIG9uZUF0dHIgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IGp2MSA9IHRoaXMuX2pvbHRWZWMzXzE7XHJcbiAgICAgICAgY29uc3QganYyID0gdGhpcy5fam9sdFZlYzNfMjtcclxuXHJcbiAgICAgICAgY29uc3QgYm9keSA9IHRoaXMuX2dldEJvZHkoY2IpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqdjEuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGlmIChvbmVBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICBib2R5W21ldGhvZF0oanYxKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAganYyLkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHlbbWV0aG9kXShqdjEsIGp2Mik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHlbbWV0aG9kXShqdjEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2JhY2tlbmQuYm9keUludGVyZmFjZS5BY3RpdmF0ZUJvZHkoYm9keS5HZXRJRCgpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENoYXJTaGFwZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBiYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgcGNpZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCB1c2VDYWxsYmFjayA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgY29uc3Qgc2hhcGVJbmRleCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMikgOiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBjaGFyID0gdHJhY2tlci5nZXRCb2R5QnlQQ0lEKHBjaWQpO1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgIWNoYXIpIHtcclxuICAgICAgICAgICAgRGVidWcud2FybihgVW5hYmxlIHRvIGxvY2F0ZSBjaGFyYWN0ZXIgdW5kZXIgaWQ6ICR7IHBjaWQgfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc2hhcGU7XHJcbiAgICAgICAgaWYgKHNoYXBlSW5kZXggIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzaGFwZSA9IHRyYWNrZXIuc2hhcGVNYXAuZ2V0KHNoYXBlSW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2ICYmICFzaGFwZSkge1xyXG4gICAgICAgICAgICAgICAgRGVidWcud2FybihgVW5hYmxlIHRvIGxvY2F0ZSBzaGFwZTogJHsgc2hhcGVJbmRleCB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaGFwZSA9IGNoYXIub3JpZ2luYWxTaGFwZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjYkluZGV4O1xyXG4gICAgICAgIGlmICh1c2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgICBjYkluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb2sgPSBjaGFyLlNldFNoYXBlKHNoYXBlLCBcclxuICAgICAgICAgICAgYmFja2VuZC5jb25maWcucGVuZXRyYXRpb25TbG9wICogMS41LFxyXG4gICAgICAgICAgICBiYWNrZW5kLmJwRmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLm9iakZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5ib2R5RmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLnNoYXBlRmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLmpvbHRJbnRlcmZhY2UuR2V0VGVtcEFsbG9jYXRvcigpKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAob2sgJiYgdXNlQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY29uc3QgY2IgPSBiYWNrZW5kLm91dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlT3BlcmF0b3IoQ09NUE9ORU5UX1NZU1RFTV9DSEFSKTtcclxuICAgICAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9SRVBPUlRfU0VUX1NIQVBFKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoY2JJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfcmVzZXRDaGFyU2hhcGUoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHBjaWQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgdXNlQ2FsbGJhY2sgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICBsZXQgY2JJbmRleDtcclxuICAgICAgICBpZiAodXNlQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY2JJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNoYXIgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQocGNpZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9rID0gY2hhci5TZXRTaGFwZShzaGFwZSwgXHJcbiAgICAgICAgICAgIGJhY2tlbmQuY29uZmlnLnBlbmV0cmF0aW9uU2xvcCAqIDEuNSxcclxuICAgICAgICAgICAgYmFja2VuZC5icEZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5vYmpGaWx0ZXIsXHJcbiAgICAgICAgICAgIGJhY2tlbmQuYm9keUZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5zaGFwZUZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5qb2x0SW50ZXJmYWNlLkdldFRlbXBBbGxvY2F0b3IoKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKG9rICYmIHVzZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNiID0gYmFja2VuZC5vdXRCdWZmZXI7XHJcblxyXG4gICAgICAgICAgICBjYi53cml0ZU9wZXJhdG9yKENPTVBPTkVOVF9TWVNURU1fQ0hBUik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX1NFVF9TSEFQRSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGNiSW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldFVzZXJEYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNoYXBlID0gb2JqLkdldFNoYXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgc2hhcGUuU2V0VXNlckRhdGEodmFsdWUpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfdXNlTW90aW9uU3RhdGUoY2IpIHtcclxuICAgICAgICBjb25zdCBib2R5ID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcbiAgICAgICAgY29uc3QgdXNlTW90aW9uU3RhdGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICBpZiAoIWJvZHkubW90aW9uU3RhdGUgJiYgdXNlTW90aW9uU3RhdGUpIHtcclxuICAgICAgICAgICAgYm9keS5tb3Rpb25TdGF0ZSA9IG5ldyBNb3Rpb25TdGF0ZShib2R5KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGJvZHkubW90aW9uU3RhdGUgJiYgIXVzZU1vdGlvblN0YXRlKSB7XHJcbiAgICAgICAgICAgIGJvZHkubW90aW9uU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENoYXJhY3RlckxpblZlbChjYikge1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzNfMTtcclxuICAgICAgICBjb25zdCBjaGFyID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICBjaGFyLlNldExpbmVhclZlbG9jaXR5KGp2KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIF9hcHBseUJ1b3lhbmN5SW1wdWxzZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9nZXRCb2R5KGNiKTtcclxuICAgICAgICBjb25zdCBqdjEgPSB0aGlzLl9qb2x0VmVjM18xO1xyXG4gICAgICAgIGNvbnN0IGp2MiA9IHRoaXMuX2pvbHRWZWMzXzI7XHJcbiAgICAgICAgY29uc3QganYzID0gdGhpcy5fam9sdFZlYzNfMztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgd2F0ZXJTdXJmYWNlUG9zaXRpb24gPSBqdjEuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0IHN1cmZhY2VOb3JtYWwgPSBqdjIuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1b3lhbmN5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbGluZWFyRHJhZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IGFuZ3VsYXJEcmFnID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgZmx1aWRWZWxvY2l0eSA9IGp2My5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgY29uc3QgZGVsdGFUaW1lID0gYmFja2VuZC5jb25maWcuZml4ZWRTdGVwO1xyXG4gICAgICAgICAgICBjb25zdCBncmF2aXR5ID0gYmFja2VuZC5waHlzaWNzU3lzdGVtLkdldEdyYXZpdHkoKTtcclxuXHJcbiAgICAgICAgICAgIGJvZHkuQXBwbHlCdW95YW5jeUltcHVsc2Uod2F0ZXJTdXJmYWNlUG9zaXRpb24sIHN1cmZhY2VOb3JtYWwsIGJ1b3lhbmN5LCBsaW5lYXJEcmFnLCBhbmd1bGFyRHJhZywgZmx1aWRWZWxvY2l0eSwgZ3Jhdml0eSwgZGVsdGFUaW1lKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENvbnN0cmFpbnRFbmFibGVkKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IGJhY2tlbmQuSm9sdDtcclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgZW5hYmxlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgY29uc3QgYWN0aXZhdGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0gYmFja2VuZC50cmFja2VyLmNvbnN0cmFpbnRNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBBbiBpbmRleCBjb3VsZCBiZSBvbGQgYW5kIGNvbnN0cmFpbnQgbWlnaHQgaGF2ZSBiZWVuIGFscmVhZHkgZGVzdHJveWVkLlxyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcud2FybihgVHJ5aW5nIHRvIGVuYWJsZS9kaXNhYmxlIGEgY29uc3RyYWludCB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gZGVzdHJveWVkOiAkeyBpbmRleCB9YCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZGF0YS5jb25zdHJhaW50LlNldEVuYWJsZWQoZW5hYmxlZCk7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKGFjdGl2YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBib2R5SW50ZXJmYWNlID0gYmFja2VuZC5ib2R5SW50ZXJmYWNlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBib2R5MSwgYm9keTIgfSA9IGRhdGE7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoZGF0YS5ib2R5MSkgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBib2R5SW50ZXJmYWNlLkFjdGl2YXRlQm9keShib2R5MS5HZXRJRCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoZGF0YS5ib2R5MikgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBib2R5SW50ZXJmYWNlLkFjdGl2YXRlQm9keShib2R5Mi5HZXRJRCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9yZXNldFZlbG9jaXRpZXMoY2IpIHtcclxuICAgICAgICBjb25zdCBqdjEgPSB0aGlzLl9qb2x0VmVjM18xO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9nZXRCb2R5KGNiKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAganYxLlNldCgwLCAwLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGJvZHkuU2V0TGluZWFyVmVsb2NpdHkoanYxKTtcclxuICAgICAgICAgICAgYm9keS5TZXRBbmd1bGFyVmVsb2NpdHkoanYxKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX21vdmVCb2R5KGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgSm9sdCA9IGJhY2tlbmQuSm9sdDtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzXzE7XHJcbiAgICAgICAgY29uc3QganEgPSB0aGlzLl9qb2x0UXVhdF8xO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9nZXRCb2R5KGNiKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGpxLkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGJvZHkuR2V0TW90aW9uVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IEpvbHQuRU1vdGlvblR5cGVfRHluYW1pYyB8fCB0eXBlID09PSBKb2x0LkVNb3Rpb25UeXBlX0tpbmVtYXRpYykge1xyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tlbmQuYm9keUludGVyZmFjZS5TZXRQb3NpdGlvbkFuZFJvdGF0aW9uKGJvZHkuR2V0SUQoKSwganYsIGpxLCBKb2x0LkFjdGl2YXRlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoJ1RyeWluZyB0byBtb3ZlIGEgc3RhdGljIGJvZHkuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBiYWNrZW5kLmJvZHlJbnRlcmZhY2UuU2V0UG9zaXRpb25BbmRSb3RhdGlvbihib2R5LkdldElEKCksIGp2LCBqcSwgSm9sdC5BY3RpdmF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldERyaXZlcklucHV0KGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY29uc3QgYm9keSA9IHRyYWNrZXIuZ2V0Qm9keUJ5UENJRChpbmRleCk7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRyYWNrZXIuY29uc3RyYWludE1hcC5nZXQoaW5kZXgpO1xyXG4gICAgICAgIGlmICghZGF0YSB8fCAhYm9keSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRhdGEuY29uc3RyYWludC5jb250cm9sbGVyLlNldERyaXZlcklucHV0KFxyXG4gICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgYmFja2VuZC5ib2R5SW50ZXJmYWNlLkFjdGl2YXRlQm9keShib2R5LkdldElEKCkpO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfdG9nZ2xlR3JvdXBQYWlyKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgZW5hYmxlID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICBjb25zdCBncm91cCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDE2KTtcclxuICAgICAgICBjb25zdCBzdWJHcm91cDEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcbiAgICAgICAgY29uc3Qgc3ViR3JvdXAyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBiYWNrZW5kLmdyb3VwRmlsdGVyVGFibGVzW2dyb3VwXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydCghIWZpbHRlciwgYFVuYWJsZSB0byBsb2NhdGUgZmlsdGVyIGdyb3VwOiAkeyBncm91cCB9YCk7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChzdWJHcm91cDEgPD0gZmlsdGVyLm1heEluZGV4LCBgU3ViIGdyb3VwIG51bWJlciBpcyBvdmVyIHRoZSBmaWx0ZXIgdGFibGUgc2l6ZTogJHsgc3ViR3JvdXAxIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KHN1Ykdyb3VwMiA8PSBmaWx0ZXIubWF4SW5kZXgsIGBTdWIgZ3JvdXAgbnVtYmVyIGlzIG92ZXIgdGhlIGZpbHRlciB0YWJsZSBzaXplOiAkeyBzdWJHcm91cDIgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZW5hYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIuRW5hYmxlQ29sbGlzaW9uKHN1Ykdyb3VwMSwgc3ViR3JvdXAyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZpbHRlci5EaXNhYmxlQ29sbGlzaW9uKHN1Ykdyb3VwMSwgc3ViR3JvdXAyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfc2V0TW90aW9uVHlwZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSBiYWNrZW5kLkpvbHQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBib2R5SW50ZXJmYWNlID0gYmFja2VuZC5ib2R5SW50ZXJmYWNlO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuXHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh0eXBlKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYm9keUludGVyZmFjZS5TZXRNb3Rpb25UeXBlKGJvZHkuR2V0SUQoKSwgdHlwZSwgSm9sdC5BY3RpdmF0ZSk7XHJcbiAgICAgICAgICAgIHRyYWNrZXIudXBkYXRlKGJvZHksIGluZGV4KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2dldEJvZHkoY2IpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYmFja2VuZC50cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBNb2RpZmllciB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/modifier.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/querier.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/querier.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Querier: () => (/* binding */ Querier)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nconst params = [];\r\n\r\nclass Querier {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n        \r\n        const Jolt = backend.Jolt;\r\n\r\n        // TODO\r\n        // refactor to lazy allocate\r\n\r\n        this._rayCast = new Jolt.RRayCast();\r\n        this._rayCastSettings = new Jolt.RayCastSettings();\r\n        this._tempVectors = [\r\n            new Jolt.Quat(), new Jolt.Vec3(), new Jolt.Vec3(), \r\n            new Jolt.Vec3(), new Jolt.Vec3(), new Jolt.Vec3(),\r\n        ];\r\n\r\n        this._shapeCastSettings = new Jolt.ShapeCastSettings();\r\n\r\n        this._collectorRayFirst = new Jolt.CastRayClosestHitCollisionCollector();\r\n        this._collectorRayAll = new Jolt.CastRayAllHitCollisionCollector();\r\n\r\n        this._collectorShapeFirst = new Jolt.CastShapeClosestHitCollisionCollector();\r\n        this._collectorShapeAll = new Jolt.CastShapeAllHitCollisionCollector();\r\n\r\n        this._bodies = [];\r\n    }\r\n\r\n    query() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_RAY:\r\n                ok = this._castRay(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_SHAPE:\r\n                ok = this._castShape(cb);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Invalid querier command: ${ command }`);\r\n                return false;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        this._tempVectors.forEach(vector => {\r\n            Jolt.destroy(vector);\r\n        });\r\n        this._tempVectors.length = 0;\r\n\r\n        Jolt.destroy(this._rayCast);\r\n        this._rayCast = null;\r\n\r\n        Jolt.destroy(this._rayCastSettings);\r\n        this._rayCastSettings = null;\r\n\r\n        Jolt.destroy(this._shapeCastSettings);\r\n        this._shapeCastSettings = null;\r\n\r\n        Jolt.destroy(this._collectorRayFirst);\r\n        this._collectorRayFirst = null;\r\n\r\n        Jolt.destroy(this._collectorRayAll);\r\n        this._collectorRayAll = null;\r\n\r\n        this._commandsBuffer.destroy();\r\n        this._commandsBuffer = null;\r\n\r\n        params.length = 0;\r\n        params = undefined;\r\n    }\r\n\r\n    _castRay(cb) {\r\n        const backend = this._backend;\r\n        const buffer = this._commandsBuffer;\r\n        const castSettings = this._rayCastSettings;\r\n        const jv = this._tempVectors[1];\r\n        const cast = this._rayCast;\r\n        const tracker = backend.tracker;\r\n        const system = backend.physicsSystem;\r\n        const Jolt = backend.Jolt;\r\n\r\n        buffer.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_RAY);\r\n        \r\n        const queryIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        buffer.write(queryIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            cast.mOrigin = jv;\r\n    \r\n            jv.FromBuffer(cb);\r\n            cast.mDirection = jv;\r\n    \r\n            const firstOnly = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const calculateNormal = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n            const ignoreBackFaces = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const solidConvex = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const collector = firstOnly ? this._collectorRayFirst : this._collectorRayAll;\r\n            const { bpFilter, objFilter, bodyFilter, shapeFilter } = this._backend;\r\n    \r\n            castSettings.mBackFaceMode = ignoreBackFaces ? Jolt.EBackFaceMode_IgnoreBackFaces : Jolt.EBackFaceMode_CollideWithBackFaces;\r\n            castSettings.mTreatConvexAsSolid = solidConvex;\r\n\r\n            system.GetNarrowPhaseQuery().CastRay(cast, castSettings, collector, bpFilter, objFilter, bodyFilter, shapeFilter);\r\n\r\n            if (firstOnly) {\r\n                if (collector.HadHit()) {\r\n                    buffer.write(1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                    Querier.writeRayHit(buffer, system, tracker, cast, calculateNormal, collector.mHit, Jolt);\r\n                } else {\r\n                    buffer.write(0, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                }\r\n            } else {\r\n                const hits = collector.mHits;\r\n                const count = hits.size();\r\n                buffer.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                for (let i = 0; i < count; i++) {\r\n                    Querier.writeRayHit(buffer, system, tracker, cast, calculateNormal, hits.at(i), Jolt);\r\n                }\r\n            }\r\n    \r\n            collector.Reset();\r\n            \r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _castShape(cb) {\r\n        const buffer = this._backend.outBuffer;\r\n        const tempVectors = this._tempVectors;\r\n        const scale = tempVectors[1];\r\n        const direction = tempVectors[2];\r\n        const position = tempVectors[3];\r\n        const offset = tempVectors[4];\r\n        const rotation = tempVectors[0];\r\n        const backend = this._backend;\r\n        const castSettings = this._shapeCastSettings;\r\n        const tracker = backend.tracker;\r\n        const system = backend.physicsSystem;\r\n        const Jolt = backend.Jolt;\r\n\r\n        const queryIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        buffer.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_MANAGER);\r\n        buffer.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_SHAPE);\r\n        buffer.write(queryIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false);\r\n        \r\n        try {\r\n            position.FromBuffer(cb);\r\n            rotation.FromBuffer(cb);\r\n            direction.FromBuffer(cb);\r\n            cb.flag ? scale.FromBuffer(cb) : scale.Set(1, 1, 1);\r\n            cb.flag ? offset.FromBuffer(cb) : offset.Set(0, 0, 0);\r\n            if (cb.flag) castSettings.mBackFaceModeTriangles = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            if (cb.flag) castSettings.mBackFaceModeConvex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            if (cb.flag) castSettings.mUseShrunkenShapeAndConvexRadius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            if (cb.flag) castSettings.mReturnDeepestPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            \r\n            const firstOnly = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const calculateNormal = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n            const collector = firstOnly ? this._collectorShapeFirst : this._collectorShapeAll;\r\n            const shapeIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            \r\n            params.length = 0;\r\n\r\n            const shape = tracker.shapeMap.get(shapeIndex);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !shape) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Unable to locate shape for shape cast: ${ shapeIndex }`);\r\n                return false;\r\n            }\r\n\r\n            const transform = Jolt.Mat44.prototype.sRotationTranslation(rotation, position);\r\n            const shapeCast = new Jolt.RShapeCast(shape, scale, transform, direction);\r\n            // const { bpFilter, objFilter, bodyFilter, shapeFilter } = backend;\r\n            const { bodyFilter, shapeFilter } = backend;\r\n            const bpFilter = new Jolt.DefaultBroadPhaseLayerFilter(backend.joltInterface.GetObjectVsBroadPhaseLayerFilter(), 0);\r\n            const objFilter = new Jolt.DefaultObjectLayerFilter(backend.joltInterface.GetObjectLayerPairFilter(), 2);\r\n            system.GetNarrowPhaseQuery().CastShape(shapeCast, castSettings, offset, collector, bpFilter, objFilter, bodyFilter, shapeFilter);\r\n            \r\n            if (firstOnly) {\r\n                if (collector.HadHit()) {\r\n                    buffer.write(1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                    Querier.writeShapeHit(buffer, system, tracker, shapeCast, calculateNormal, collector.mHit, Jolt);\r\n                } else {\r\n                    buffer.write(0, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                }\r\n            } else {\r\n                const hits = collector.mHits;\r\n                const count = hits.size();\r\n                buffer.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                for (let i = 0; i < count; i++) {\r\n                    Querier.writeShapeHit(buffer, system, tracker, shapeCast, calculateNormal, hits.at(i), Jolt);\r\n                }\r\n            }\r\n\r\n            collector.Reset();\r\n\r\n            Jolt.destroy(shapeCast);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static writeRayHit(buffer, system, tracker, cast, calculateNormal, hit, Jolt) {\r\n        const body = system.GetBodyLockInterfaceNoLock().TryGetBody(hit.mBodyID);\r\n        const point = cast.GetPointOnRay(hit.mFraction);\r\n        const normal = calculateNormal ? body.GetWorldSpaceSurfaceNormal(hit.mSubShapeID2, point) : null;\r\n\r\n        const index = tracker.getPCID(Jolt.getPointer(body));\r\n        buffer.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        buffer.write(point, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32, false);\r\n        buffer.write(normal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32);\r\n    }\r\n\r\n    static writeShapeHit(buffer, system, tracker, cast, calculateNormal, hit, Jolt) {\r\n        const body = system.GetBodyLockInterfaceNoLock().TryGetBody(hit.mBodyID2);\r\n        const transform = cast.mCenterOfMassStart;\r\n        const point = transform.GetTranslation();\r\n        const dir = cast.mDirection;\r\n\r\n        dir.Mul(hit.mFraction);\r\n        point.Add(dir);\r\n\r\n        const normal = calculateNormal ? body.GetWorldSpaceSurfaceNormal(hit.mSubShapeID2, point) : null;\r\n\r\n        const index = tracker.getPCID(Jolt.getPointer(body));\r\n        buffer.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        buffer.write(point, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32, false);\r\n        buffer.write(normal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32);\r\n    }\r\n}\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUssUUFBUSxxREFBSztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsdUZBQW1CO0FBQy9DLDRCQUE0QiwwRkFBc0I7QUFDbEQsNkJBQTZCLDBGQUFzQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVGQUFtQjtBQUMvQyw0QkFBNEIsMEZBQXNCO0FBQ2xELDZCQUE2QiwwRkFBc0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ21CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvcXVlcmllci5tanM/OTgxOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQlVGRkVSX1JFQURfQk9PTCwgQlVGRkVSX1JFQURfVUlOVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDgsXHJcbiAgICBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQxNiwgQlVGRkVSX1dSSVRFX1VJTlQzMixcclxuICAgIENNRF9DQVNUX1JBWSwgQ01EX0NBU1RfU0hBUEUsXHJcbiAgICBDT01QT05FTlRfU1lTVEVNX01BTkFHRVJcclxufSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY29uc3QgcGFyYW1zID0gW107XHJcblxyXG5jbGFzcyBRdWVyaWVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGJhY2tlbmQpIHtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gYmFja2VuZDtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gcmVmYWN0b3IgdG8gbGF6eSBhbGxvY2F0ZVxyXG5cclxuICAgICAgICB0aGlzLl9yYXlDYXN0ID0gbmV3IEpvbHQuUlJheUNhc3QoKTtcclxuICAgICAgICB0aGlzLl9yYXlDYXN0U2V0dGluZ3MgPSBuZXcgSm9sdC5SYXlDYXN0U2V0dGluZ3MoKTtcclxuICAgICAgICB0aGlzLl90ZW1wVmVjdG9ycyA9IFtcclxuICAgICAgICAgICAgbmV3IEpvbHQuUXVhdCgpLCBuZXcgSm9sdC5WZWMzKCksIG5ldyBKb2x0LlZlYzMoKSwgXHJcbiAgICAgICAgICAgIG5ldyBKb2x0LlZlYzMoKSwgbmV3IEpvbHQuVmVjMygpLCBuZXcgSm9sdC5WZWMzKCksXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdGhpcy5fc2hhcGVDYXN0U2V0dGluZ3MgPSBuZXcgSm9sdC5TaGFwZUNhc3RTZXR0aW5ncygpO1xyXG5cclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JSYXlGaXJzdCA9IG5ldyBKb2x0LkNhc3RSYXlDbG9zZXN0SGl0Q29sbGlzaW9uQ29sbGVjdG9yKCk7XHJcbiAgICAgICAgdGhpcy5fY29sbGVjdG9yUmF5QWxsID0gbmV3IEpvbHQuQ2FzdFJheUFsbEhpdENvbGxpc2lvbkNvbGxlY3RvcigpO1xyXG5cclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JTaGFwZUZpcnN0ID0gbmV3IEpvbHQuQ2FzdFNoYXBlQ2xvc2VzdEhpdENvbGxpc2lvbkNvbGxlY3RvcigpO1xyXG4gICAgICAgIHRoaXMuX2NvbGxlY3RvclNoYXBlQWxsID0gbmV3IEpvbHQuQ2FzdFNoYXBlQWxsSGl0Q29sbGlzaW9uQ29sbGVjdG9yKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2JvZGllcyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHF1ZXJ5KCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fYmFja2VuZC5pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfQ0FTVF9SQVk6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2Nhc3RSYXkoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DQVNUX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jYXN0U2hhcGUoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGBJbnZhbGlkIHF1ZXJpZXIgY29tbWFuZDogJHsgY29tbWFuZCB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl90ZW1wVmVjdG9ycy5mb3JFYWNoKHZlY3RvciA9PiB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveSh2ZWN0b3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX3RlbXBWZWN0b3JzLmxlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9yYXlDYXN0KTtcclxuICAgICAgICB0aGlzLl9yYXlDYXN0ID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX3JheUNhc3RTZXR0aW5ncyk7XHJcbiAgICAgICAgdGhpcy5fcmF5Q2FzdFNldHRpbmdzID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX3NoYXBlQ2FzdFNldHRpbmdzKTtcclxuICAgICAgICB0aGlzLl9zaGFwZUNhc3RTZXR0aW5ncyA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9jb2xsZWN0b3JSYXlGaXJzdCk7XHJcbiAgICAgICAgdGhpcy5fY29sbGVjdG9yUmF5Rmlyc3QgPSBudWxsO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fY29sbGVjdG9yUmF5QWxsKTtcclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JSYXlBbGwgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9jb21tYW5kc0J1ZmZlci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fY29tbWFuZHNCdWZmZXIgPSBudWxsO1xyXG5cclxuICAgICAgICBwYXJhbXMubGVuZ3RoID0gMDtcclxuICAgICAgICBwYXJhbXMgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgX2Nhc3RSYXkoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLl9jb21tYW5kc0J1ZmZlcjtcclxuICAgICAgICBjb25zdCBjYXN0U2V0dGluZ3MgPSB0aGlzLl9yYXlDYXN0U2V0dGluZ3M7XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl90ZW1wVmVjdG9yc1sxXTtcclxuICAgICAgICBjb25zdCBjYXN0ID0gdGhpcy5fcmF5Q2FzdDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICBidWZmZXIud3JpdGVDb21tYW5kKENNRF9DQVNUX1JBWSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgcXVlcnlJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBidWZmZXIud3JpdGUocXVlcnlJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgY2FzdC5tT3JpZ2luID0ganY7XHJcbiAgICBcclxuICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNhc3QubURpcmVjdGlvbiA9IGp2O1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0T25seSA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgY2FsY3VsYXRlTm9ybWFsID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkgOiBmYWxzZTtcclxuICAgICAgICAgICAgY29uc3QgaWdub3JlQmFja0ZhY2VzID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkgOiB0cnVlO1xyXG4gICAgICAgICAgICBjb25zdCBzb2xpZENvbnZleCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgY29sbGVjdG9yID0gZmlyc3RPbmx5ID8gdGhpcy5fY29sbGVjdG9yUmF5Rmlyc3QgOiB0aGlzLl9jb2xsZWN0b3JSYXlBbGw7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgYnBGaWx0ZXIsIG9iakZpbHRlciwgYm9keUZpbHRlciwgc2hhcGVGaWx0ZXIgfSA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICBcclxuICAgICAgICAgICAgY2FzdFNldHRpbmdzLm1CYWNrRmFjZU1vZGUgPSBpZ25vcmVCYWNrRmFjZXMgPyBKb2x0LkVCYWNrRmFjZU1vZGVfSWdub3JlQmFja0ZhY2VzIDogSm9sdC5FQmFja0ZhY2VNb2RlX0NvbGxpZGVXaXRoQmFja0ZhY2VzO1xyXG4gICAgICAgICAgICBjYXN0U2V0dGluZ3MubVRyZWF0Q29udmV4QXNTb2xpZCA9IHNvbGlkQ29udmV4O1xyXG5cclxuICAgICAgICAgICAgc3lzdGVtLkdldE5hcnJvd1BoYXNlUXVlcnkoKS5DYXN0UmF5KGNhc3QsIGNhc3RTZXR0aW5ncywgY29sbGVjdG9yLCBicEZpbHRlciwgb2JqRmlsdGVyLCBib2R5RmlsdGVyLCBzaGFwZUZpbHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoZmlyc3RPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdG9yLkhhZEhpdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLndyaXRlKDEsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTsgLy8gaGl0cyBjb3VudFxyXG4gICAgICAgICAgICAgICAgICAgIFF1ZXJpZXIud3JpdGVSYXlIaXQoYnVmZmVyLCBzeXN0ZW0sIHRyYWNrZXIsIGNhc3QsIGNhbGN1bGF0ZU5vcm1hbCwgY29sbGVjdG9yLm1IaXQsIEpvbHQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBidWZmZXIud3JpdGUoMCwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpOyAvLyBoaXRzIGNvdW50XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaXRzID0gY29sbGVjdG9yLm1IaXRzO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBoaXRzLnNpemUoKTtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpOyAvLyBoaXRzIGNvdW50XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBRdWVyaWVyLndyaXRlUmF5SGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBjYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGhpdHMuYXQoaSksIEpvbHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgY29sbGVjdG9yLlJlc2V0KCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfY2FzdFNoYXBlKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gdGhpcy5fYmFja2VuZC5vdXRCdWZmZXI7XHJcbiAgICAgICAgY29uc3QgdGVtcFZlY3RvcnMgPSB0aGlzLl90ZW1wVmVjdG9ycztcclxuICAgICAgICBjb25zdCBzY2FsZSA9IHRlbXBWZWN0b3JzWzFdO1xyXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRlbXBWZWN0b3JzWzJdO1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGVtcFZlY3RvcnNbM107XHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdGVtcFZlY3RvcnNbNF07XHJcbiAgICAgICAgY29uc3Qgcm90YXRpb24gPSB0ZW1wVmVjdG9yc1swXTtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBjYXN0U2V0dGluZ3MgPSB0aGlzLl9zaGFwZUNhc3RTZXR0aW5ncztcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuICAgICAgICBjb25zdCBKb2x0ID0gYmFja2VuZC5Kb2x0O1xyXG5cclxuICAgICAgICBjb25zdCBxdWVyeUluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBidWZmZXIud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX01BTkFHRVIpO1xyXG4gICAgICAgIGJ1ZmZlci53cml0ZUNvbW1hbmQoQ01EX0NBU1RfU0hBUEUpO1xyXG4gICAgICAgIGJ1ZmZlci53cml0ZShxdWVyeUluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDE2LCBmYWxzZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcG9zaXRpb24uRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIHJvdGF0aW9uLkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICBkaXJlY3Rpb24uRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNiLmZsYWcgPyBzY2FsZS5Gcm9tQnVmZmVyKGNiKSA6IHNjYWxlLlNldCgxLCAxLCAxKTtcclxuICAgICAgICAgICAgY2IuZmxhZyA/IG9mZnNldC5Gcm9tQnVmZmVyKGNiKSA6IG9mZnNldC5TZXQoMCwgMCwgMCk7XHJcbiAgICAgICAgICAgIGlmIChjYi5mbGFnKSBjYXN0U2V0dGluZ3MubUJhY2tGYWNlTW9kZVRyaWFuZ2xlcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICBpZiAoY2IuZmxhZykgY2FzdFNldHRpbmdzLm1CYWNrRmFjZU1vZGVDb252ZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICAgICAgaWYgKGNiLmZsYWcpIGNhc3RTZXR0aW5ncy5tVXNlU2hydW5rZW5TaGFwZUFuZENvbnZleFJhZGl1cyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgIGlmIChjYi5mbGFnKSBjYXN0U2V0dGluZ3MubVJldHVybkRlZXBlc3RQb2ludCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaXJzdE9ubHkgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSA6IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGN1bGF0ZU5vcm1hbCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogZmFsc2U7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbGxlY3RvciA9IGZpcnN0T25seSA/IHRoaXMuX2NvbGxlY3RvclNoYXBlRmlyc3QgOiB0aGlzLl9jb2xsZWN0b3JTaGFwZUFsbDtcclxuICAgICAgICAgICAgY29uc3Qgc2hhcGVJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHBhcmFtcy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2hhcGUgPSB0cmFja2VyLnNoYXBlTWFwLmdldChzaGFwZUluZGV4KTtcclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhc2hhcGUpIHtcclxuICAgICAgICAgICAgICAgIERlYnVnLndhcm4oYFVuYWJsZSB0byBsb2NhdGUgc2hhcGUgZm9yIHNoYXBlIGNhc3Q6ICR7IHNoYXBlSW5kZXggfWApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBKb2x0Lk1hdDQ0LnByb3RvdHlwZS5zUm90YXRpb25UcmFuc2xhdGlvbihyb3RhdGlvbiwgcG9zaXRpb24pO1xyXG4gICAgICAgICAgICBjb25zdCBzaGFwZUNhc3QgPSBuZXcgSm9sdC5SU2hhcGVDYXN0KHNoYXBlLCBzY2FsZSwgdHJhbnNmb3JtLCBkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAvLyBjb25zdCB7IGJwRmlsdGVyLCBvYmpGaWx0ZXIsIGJvZHlGaWx0ZXIsIHNoYXBlRmlsdGVyIH0gPSBiYWNrZW5kO1xyXG4gICAgICAgICAgICBjb25zdCB7IGJvZHlGaWx0ZXIsIHNoYXBlRmlsdGVyIH0gPSBiYWNrZW5kO1xyXG4gICAgICAgICAgICBjb25zdCBicEZpbHRlciA9IG5ldyBKb2x0LkRlZmF1bHRCcm9hZFBoYXNlTGF5ZXJGaWx0ZXIoYmFja2VuZC5qb2x0SW50ZXJmYWNlLkdldE9iamVjdFZzQnJvYWRQaGFzZUxheWVyRmlsdGVyKCksIDApO1xyXG4gICAgICAgICAgICBjb25zdCBvYmpGaWx0ZXIgPSBuZXcgSm9sdC5EZWZhdWx0T2JqZWN0TGF5ZXJGaWx0ZXIoYmFja2VuZC5qb2x0SW50ZXJmYWNlLkdldE9iamVjdExheWVyUGFpckZpbHRlcigpLCAyKTtcclxuICAgICAgICAgICAgc3lzdGVtLkdldE5hcnJvd1BoYXNlUXVlcnkoKS5DYXN0U2hhcGUoc2hhcGVDYXN0LCBjYXN0U2V0dGluZ3MsIG9mZnNldCwgY29sbGVjdG9yLCBicEZpbHRlciwgb2JqRmlsdGVyLCBib2R5RmlsdGVyLCBzaGFwZUZpbHRlcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoZmlyc3RPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdG9yLkhhZEhpdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLndyaXRlKDEsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTsgLy8gaGl0cyBjb3VudFxyXG4gICAgICAgICAgICAgICAgICAgIFF1ZXJpZXIud3JpdGVTaGFwZUhpdChidWZmZXIsIHN5c3RlbSwgdHJhY2tlciwgc2hhcGVDYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGNvbGxlY3Rvci5tSGl0LCBKb2x0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLndyaXRlKDAsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTsgLy8gaGl0cyBjb3VudFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGl0cyA9IGNvbGxlY3Rvci5tSGl0cztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gaGl0cy5zaXplKCk7XHJcbiAgICAgICAgICAgICAgICBidWZmZXIud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTsgLy8gaGl0cyBjb3VudFxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgUXVlcmllci53cml0ZVNoYXBlSGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBzaGFwZUNhc3QsIGNhbGN1bGF0ZU5vcm1hbCwgaGl0cy5hdChpKSwgSm9sdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbGxlY3Rvci5SZXNldCgpO1xyXG5cclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KHNoYXBlQ2FzdCk7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgd3JpdGVSYXlIaXQoYnVmZmVyLCBzeXN0ZW0sIHRyYWNrZXIsIGNhc3QsIGNhbGN1bGF0ZU5vcm1hbCwgaGl0LCBKb2x0KSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHN5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZU5vTG9jaygpLlRyeUdldEJvZHkoaGl0Lm1Cb2R5SUQpO1xyXG4gICAgICAgIGNvbnN0IHBvaW50ID0gY2FzdC5HZXRQb2ludE9uUmF5KGhpdC5tRnJhY3Rpb24pO1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCA/IGJvZHkuR2V0V29ybGRTcGFjZVN1cmZhY2VOb3JtYWwoaGl0Lm1TdWJTaGFwZUlEMiwgcG9pbnQpIDogbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkpKTtcclxuICAgICAgICBidWZmZXIud3JpdGUoaW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBidWZmZXIud3JpdGUocG9pbnQsIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBidWZmZXIud3JpdGUobm9ybWFsLCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgd3JpdGVTaGFwZUhpdChidWZmZXIsIHN5c3RlbSwgdHJhY2tlciwgY2FzdCwgY2FsY3VsYXRlTm9ybWFsLCBoaXQsIEpvbHQpIHtcclxuICAgICAgICBjb25zdCBib2R5ID0gc3lzdGVtLkdldEJvZHlMb2NrSW50ZXJmYWNlTm9Mb2NrKCkuVHJ5R2V0Qm9keShoaXQubUJvZHlJRDIpO1xyXG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IGNhc3QubUNlbnRlck9mTWFzc1N0YXJ0O1xyXG4gICAgICAgIGNvbnN0IHBvaW50ID0gdHJhbnNmb3JtLkdldFRyYW5zbGF0aW9uKCk7XHJcbiAgICAgICAgY29uc3QgZGlyID0gY2FzdC5tRGlyZWN0aW9uO1xyXG5cclxuICAgICAgICBkaXIuTXVsKGhpdC5tRnJhY3Rpb24pO1xyXG4gICAgICAgIHBvaW50LkFkZChkaXIpO1xyXG5cclxuICAgICAgICBjb25zdCBub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwgPyBib2R5LkdldFdvcmxkU3BhY2VTdXJmYWNlTm9ybWFsKGhpdC5tU3ViU2hhcGVJRDIsIHBvaW50KSA6IG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihib2R5KSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKHBvaW50LCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKG5vcm1hbCwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFF1ZXJpZXIgfTtcclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/querier.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/tracker.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/tracker.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Tracker: () => (/* binding */ Tracker)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\nclass Tracker {\r\n    constructor(Jolt) {\r\n        this._Jolt = Jolt;\r\n\r\n        // TODO\r\n        // eval: get rid of _dynamic and _kinematic\r\n        this._dynamic = new Set();\r\n        this._kinematic = new Set();\r\n\r\n        this._character = new Set();\r\n        this._bodyMap = new Map();\r\n        this._idxMap = new Map();\r\n        this._shapeMap = new Map();\r\n        this._constraintMap = new Map();\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug = new Set();\r\n\r\n            Object.defineProperty(this, 'debug', {\r\n                get: () => { return this._debug; }\r\n            });\r\n        }\r\n    }\r\n\r\n    get dynamic() {\r\n        return this._dynamic;\r\n    }\r\n\r\n    get kinematic() {\r\n        return this._kinematic;\r\n    }\r\n\r\n    get character() {\r\n        return this._character;\r\n    }\r\n\r\n    get shapeMap() {\r\n        return this._shapeMap;\r\n    }\r\n\r\n    get constraintMap() {\r\n        return this._constraintMap;\r\n    }\r\n\r\n    add(body, index) {\r\n        const Jolt = this._Jolt;\r\n\r\n        if (body.isCharacter) {\r\n            this._character.add(body);\r\n        } else {\r\n            const motionType = body.GetMotionType();\r\n            const bodyType = body.GetBodyType();\r\n    \r\n            if (bodyType === Jolt.EBodyType_RigidBody) {\r\n                switch (motionType) {\r\n                    case Jolt.EMotionType_Dynamic:\r\n                        this._dynamic.add(body);\r\n                        break;\r\n                    case Jolt.EMotionType_Kinematic:\r\n                        this._kinematic.add(body);\r\n                        break;\r\n                    case Jolt.EMotionType_Static:\r\n                        // no need to track statics\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && body.debugDraw) {\r\n            this._debug.add(body);\r\n        }\r\n\r\n        this._idxMap.set(Jolt.getPointer(body), index);\r\n        this._bodyMap.set(index, body);\r\n    }\r\n\r\n    addConstraint(index, constraint, body1, body2) {\r\n        this._constraintMap.set(index, { constraint, body1, body2 });\r\n    }\r\n\r\n    getBodyByPCID(index) {\r\n        return this._bodyMap.get(index);\r\n    }\r\n\r\n    getPCID(index) {\r\n        return this._idxMap.get(index);\r\n    }\r\n\r\n    update(body, index) {\r\n        this.remove(body);\r\n        this.add(body, index);\r\n    }\r\n\r\n    stopTrackingBody(body) {\r\n        this._dynamic.delete(body);\r\n        this._kinematic.delete(body);\r\n        this._character.delete(body);\r\n        \r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug.delete(body);\r\n        }\r\n        \r\n        const jid = this._Jolt.getPointer(body);\r\n        const idx = this._idxMap.get(jid);\r\n\r\n        this._bodyMap.delete(idx);\r\n        this._idxMap.delete(jid);\r\n    }\r\n\r\n    destroy() {\r\n        const Jolt = this._Jolt;\r\n\r\n        this._dynamic.clear();\r\n        this._kinematic.clear();\r\n\r\n        this._character.forEach(char => {\r\n            Jolt.destroy(char);\r\n        });\r\n        this._character.clear();\r\n\r\n        this._bodyMap.forEach(body => {\r\n            Jolt.destroy(body);\r\n        });\r\n        this._bodyMap.clear();\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug.clear();\r\n        }\r\n\r\n        this._Jolt = null;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvdHJhY2tlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBbUQ7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFEQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUs7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QywwQkFBMEI7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUs7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZLHFEQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvdHJhY2tlci5tanM/MjNhNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY2xhc3MgVHJhY2tlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihKb2x0KSB7XHJcbiAgICAgICAgdGhpcy5fSm9sdCA9IEpvbHQ7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyBldmFsOiBnZXQgcmlkIG9mIF9keW5hbWljIGFuZCBfa2luZW1hdGljXHJcbiAgICAgICAgdGhpcy5fZHluYW1pYyA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLl9raW5lbWF0aWMgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NoYXJhY3RlciA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLl9ib2R5TWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuX2lkeE1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLl9zaGFwZU1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLl9jb25zdHJhaW50TWFwID0gbmV3IE1hcCgpO1xyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlYnVnID0gbmV3IFNldCgpO1xyXG5cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdkZWJ1ZycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogKCkgPT4geyByZXR1cm4gdGhpcy5fZGVidWc7IH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBkeW5hbWljKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9keW5hbWljO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBraW5lbWF0aWMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tpbmVtYXRpYztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2hhcmFjdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNoYXBlTWFwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zaGFwZU1hcDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29uc3RyYWludE1hcCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uc3RyYWludE1hcDtcclxuICAgIH1cclxuXHJcbiAgICBhZGQoYm9keSwgaW5kZXgpIHtcclxuICAgICAgICBjb25zdCBKb2x0ID0gdGhpcy5fSm9sdDtcclxuXHJcbiAgICAgICAgaWYgKGJvZHkuaXNDaGFyYWN0ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyLmFkZChib2R5KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBtb3Rpb25UeXBlID0gYm9keS5HZXRNb3Rpb25UeXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHlUeXBlID0gYm9keS5HZXRCb2R5VHlwZSgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmIChib2R5VHlwZSA9PT0gSm9sdC5FQm9keVR5cGVfUmlnaWRCb2R5KSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vdGlvblR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEpvbHQuRU1vdGlvblR5cGVfRHluYW1pYzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHluYW1pYy5hZGQoYm9keSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgSm9sdC5FTW90aW9uVHlwZV9LaW5lbWF0aWM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2tpbmVtYXRpYy5hZGQoYm9keSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgSm9sdC5FTW90aW9uVHlwZV9TdGF0aWM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIG5lZWQgdG8gdHJhY2sgc3RhdGljc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiBib2R5LmRlYnVnRHJhdykge1xyXG4gICAgICAgICAgICB0aGlzLl9kZWJ1Zy5hZGQoYm9keSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9pZHhNYXAuc2V0KEpvbHQuZ2V0UG9pbnRlcihib2R5KSwgaW5kZXgpO1xyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuc2V0KGluZGV4LCBib2R5KTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRDb25zdHJhaW50KGluZGV4LCBjb25zdHJhaW50LCBib2R5MSwgYm9keTIpIHtcclxuICAgICAgICB0aGlzLl9jb25zdHJhaW50TWFwLnNldChpbmRleCwgeyBjb25zdHJhaW50LCBib2R5MSwgYm9keTIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Qm9keUJ5UENJRChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ib2R5TWFwLmdldChpbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UENJRChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pZHhNYXAuZ2V0KGluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoYm9keSwgaW5kZXgpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZShib2R5KTtcclxuICAgICAgICB0aGlzLmFkZChib2R5LCBpbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcFRyYWNraW5nQm9keShib2R5KSB7XHJcbiAgICAgICAgdGhpcy5fZHluYW1pYy5kZWxldGUoYm9keSk7XHJcbiAgICAgICAgdGhpcy5fa2luZW1hdGljLmRlbGV0ZShib2R5KTtcclxuICAgICAgICB0aGlzLl9jaGFyYWN0ZXIuZGVsZXRlKGJvZHkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGVidWcuZGVsZXRlKGJvZHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBqaWQgPSB0aGlzLl9Kb2x0LmdldFBvaW50ZXIoYm9keSk7XHJcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5faWR4TWFwLmdldChqaWQpO1xyXG5cclxuICAgICAgICB0aGlzLl9ib2R5TWFwLmRlbGV0ZShpZHgpO1xyXG4gICAgICAgIHRoaXMuX2lkeE1hcC5kZWxldGUoamlkKTtcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIGNvbnN0IEpvbHQgPSB0aGlzLl9Kb2x0O1xyXG5cclxuICAgICAgICB0aGlzLl9keW5hbWljLmNsZWFyKCk7XHJcbiAgICAgICAgdGhpcy5fa2luZW1hdGljLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NoYXJhY3Rlci5mb3JFYWNoKGNoYXIgPT4ge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3koY2hhcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVyLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuZm9yRWFjaChib2R5ID0+IHtcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KGJvZHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICB0aGlzLl9kZWJ1Zy5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fSm9sdCA9IG51bGw7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFRyYWNrZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/tracker.mjs\n");

/***/ }),

/***/ "./src/index.mjs":
/*!***********************!*\
  !*** ./src/index.mjs ***!
  \***********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _physics_init_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./physics/init.mjs */ \"./src/physics/init.mjs\");\n\r\n\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({ init: _physics_init_mjs__WEBPACK_IMPORTED_MODULE_0__.init });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTBDO0FBQzFDO0FBQ0EsaUVBQWUsRUFBRSxJQUFJLHVEQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvaW5kZXgubWpzP2IzZGMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5pdCB9IGZyb20gXCIuL3BoeXNpY3MvaW5pdC5tanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHsgaW5pdCB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/index.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/body/component.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/body/component.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BodyComponent: () => (/* binding */ BodyComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nconst vec3 = new pc.Vec3();\r\n\r\nclass BodyComponent extends _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent {\r\n\r\n    // ---- BODY PROPS ----\r\n\r\n    // Position of the body (not of the center of mass)\r\n    _position = new pc.Vec3();\r\n\r\n    // Rotation of the body.\r\n    _rotation = new pc.Quat();\r\n\r\n    // World space linear velocity of the center of mass (m/s)\r\n    _linearVelocity = new pc.Vec3();\r\n\r\n    // World space angular velocity (rad/s)\r\n    _angularVelocity = new pc.Vec3();\r\n\r\n    // Motion type, determines if the object is static, dynamic or kinematic.\r\n    _motionType = pc.JOLT_MOTION_TYPE_STATIC;\r\n\r\n    // Enables/disables the use of motion state for this entity. Not used by static bodies.\r\n    _useMotionState = true;\r\n\r\n    // The collision layer this body belongs to (determines if two objects can collide).\r\n    // Allows cheap filtering.\r\n    _objectLayer = 0;\r\n\r\n    // The collision group this body belongs to (determines if two objects can collide).\r\n    // Expensive, so disabled by default.\r\n    _collisionGroup = null;\r\n\r\n    // Sub-group (within the collision group). Expensive, so disabled by default.\r\n    _subGroup = null;\r\n\r\n    // Which degrees of freedom this body has (can be used to limit simulation to 2D)\r\n    _allowedDOFs = pc.JOLT_ALLOWED_DOFS_ALL;\r\n\r\n    // When this body is created as static, this setting tells the system to create a\r\n    // MotionProperties object so that the object can be switched to kinematic or dynamic.\r\n    _allowDynamicOrKinematic = false;\r\n\r\n    // If this body is a sensor. A sensor will receive collision callbacks, but will not\r\n    // cause any collision responses and can be used as a trigger volume.\r\n    _isSensor = false;\r\n\r\n    // Motion quality, or how well it detects collisions when it has a high velocity.\r\n    _motionQuality = pc.JOLT_MOTION_QUALITY_DISCRETE;\r\n\r\n    // If this body can go to sleep or not.\r\n    _allowSleeping = true;\r\n\r\n    // Friction of the body (dimensionless number, usually between 0 and 1, 0 = no friction,\r\n    // 1 = friction force equals force that presses the two bodies together). Note that bodies\r\n    // can have negative friction but the combined friction should never go below zero.\r\n    _friction = 0.2;\r\n\r\n    // Restitution of body (dimensionless number, usually between 0 and 1, 0 = completely\r\n    // inelastic collision response, 1 = completely elastic collision response). Note that\r\n    // bodies can have negative restitution but the combined restitution should never go below zero.\r\n    _restitution = 0;\r\n\r\n    // Linear damping: dv/dt = -c * v. c must be between 0 and 1 but is usually close to 0.\r\n    _linearDamping = 0;\r\n\r\n    // Angular damping: dw/dt = -c * w. c must be between 0 and 1 but is usually close to 0.\r\n    _angularDamping = 0;\r\n\r\n    // Maximum linear velocity that this body can reach (m/s)\r\n    _maxLinearVelocity = 500;\r\n\r\n    // Maximum angular velocity that this body can reach (rad/s)\r\n    _maxAngularVelocity = 0.25 * Math.PI * 60;\r\n\r\n    // Value to multiply gravity with for this body.\r\n    _gravityFactor = 1;\r\n\r\n    // When calculating the inertia (not when it is provided) the calculated inertia will be multiplied by this value.\r\n    _inertiaMultiplier = 1;\r\n\r\n    // Determines how mMassPropertiesOverride will be used. By default tells Jolt to\r\n    // auto-calculate by the shape.\r\n    _overrideMassProperties = pc.JOLT_OMP_CALCULATE_MASS_AND_INERTIA;\r\n\r\n    // Used only if Jolt.CalculateInertia or Jolt.MassAndInertiaProvided is selected for\r\n    // mass calculation method\r\n    _overrideMass = 1;\r\n\r\n    // Used if Jolt.MassAndInertiaProvided is selected for mass calculation method.\r\n    // Backend will create inertia matrix from the given position/rotation.\r\n    _overrideInertiaPosition = new pc.Vec3();\r\n    _overrideInertiaRotation = new pc.Quat();\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    set linearVelocity(vec) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vec, `Invalid linear velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        if (!vec.equals(this._linearVelocity)) {\r\n            this._linearVelocity.copy(vec);\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_LIN_VEL, this._index,\r\n                vec, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n        }\r\n    }\r\n\r\n    get linearVelocity() {\r\n        return this._linearVelocity;\r\n    }\r\n\r\n    set angularVelocity(vec) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vec, `Invalid angular velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        if (!vec.equals(this._angularVelocity)) {\r\n            this._angularVelocity.copy(vec);\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_ANG_VEL, this._index,\r\n                vec, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n        }\r\n    }\r\n\r\n    get angularVelocity() {\r\n        return this._angularVelocity;\r\n    }\r\n\r\n    set motionType(type) {\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(type, `Invalid motion type: ${ type }`);\r\n        this._motionType = type;\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_MOTION_TYPE, this._index,\r\n            type, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false\r\n        );\r\n    }\r\n\r\n    get motionType() {\r\n        return this._motionType;\r\n    }\r\n\r\n    get collisionGroup() {\r\n        return this._group;\r\n    }\r\n\r\n    get subGroup() {\r\n        return this._subGroup;\r\n    }\r\n\r\n    get index() {\r\n        return this._index;\r\n    }\r\n\r\n    get userData() {\r\n        return this._userData;\r\n    }\r\n\r\n    set userData(num) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(num, `Invalid user data value. Should be a number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this._userData = num;\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_USER_DATA, this._index,\r\n            num, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );      \r\n    }\r\n\r\n    get useMotionState() {\r\n        return this._useMotionState;\r\n    }\r\n\r\n    set useMotionState(bool) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(bool, `Invalid bool value for useMotionState property: ${ bool }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_USE_MOTION_STATE, this._index,\r\n            bool, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false\r\n        );\r\n    }\r\n\r\n    addForce(force, offset, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(force, `Invalid add force vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(offset, `Invalid add force offset`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let _offset = null;\r\n        if (offset) {\r\n            _offset = vec3.copy(offset);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(_offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            force, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            _offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addForceScalars(forceX, forceY, forceZ, offsetX = 0, offsetY = 0, offsetZ = 0, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceX, `Invalid add impulse X component: ${ forceX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceY, `Invalid add impulse Y component: ${ forceY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceZ, `Invalid add impulse Z component: ${ forceZ }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetX, `Invalid add impulse offset X component: ${ offsetX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetY, `Invalid add impulse offset Y component: ${ offsetY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetZ, `Invalid add impulse offset Z component: ${ offsetZ }`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let offset = null;\r\n        if (offsetX !== 0 || offsetY !== 0 || offsetZ !== 0) {\r\n            offset = vec3.set(offsetX, offsetY, offsetZ);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            forceX, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            forceY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            forceZ, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addImpulse(impulse, offset = pc.Vec3.ZERO, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(impulse, `Invalid add impulse vector:`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(offset, `Invalid add impulse offset:`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let _offset = null;\r\n        if (offset) {\r\n            _offset = vec3.copy(offset);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(_offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_IMPULSE, this._index,\r\n            impulse, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            _offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addImpulseScalars(impulseX, impulseY, impulseZ, offsetX = 0, offsetY = 0, offsetZ = 0, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseX, `Invalid add impulse X component: ${ impulseX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseY, `Invalid add impulse Y component: ${ impulseY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseZ, `Invalid add impulse Z component: ${ impulseZ }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetX, `Invalid add impulse offset X component: ${ offsetX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetY, `Invalid add impulse offset Y component: ${ offsetY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetZ, `Invalid add impulse offset Z component: ${ offsetZ }`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let offset = null;\r\n        if (offsetX !== 0 || offsetY !== 0 || offsetZ !== 0) {\r\n            offset = vec3.set(offsetX, offsetY, offsetZ);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            impulseX, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            impulseY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            impulseZ, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    applyBuoyancyImpulse(waterSurfacePosition, surfaceNormal, buoyancy, linearDrag, angularDrag, fluidVelocity) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(waterSurfacePosition, `Invalid water surface position vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(surfaceNormal, `Invalid surface normal`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(buoyancy, `Invalid buoyancy scalar: ${ buoyancy }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(linearDrag, `Invalid linear drag scalar: ${ linearDrag }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(angularDrag, `Invalid angular drag scalar: ${ angularDrag }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(fluidVelocity, `Invalid fluid velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_APPLY_BUOYANCY_IMPULSE, this._index,\r\n            waterSurfacePosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            surfaceNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            buoyancy, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            linearDrag, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            angularDrag, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            fluidVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    addAngularImpulse(impulse) {\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_IMPULSE, this._index,\r\n            impulse, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    addTorque(torque) {\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            torque, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    writeIsometry() {\r\n        const entity = this.entity;\r\n        if (entity._dirtyWorld) {\r\n            const position = entity.getPosition();\r\n            const rotation = entity.getRotation();\r\n\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_MOVE_BODY, this._index,\r\n                position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n                rotation, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n\r\n            if (this._motionType === pc.JOLT_MOTION_TYPE_DYNAMIC) {\r\n                this.resetVelocities();\r\n            }\r\n        }\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        const ok = _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent.writeShapeData(cb, this);\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !ok) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Error creating a shape data.');\r\n            cb.reset();\r\n            return;\r\n        }\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // We always use world position and rotation from the current entity the component\r\n        // is attached to (instead of default zero vectors)\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // TODO\r\n        // get rid of flags\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n        cb.write(this._motionType, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._useMotionState, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._objectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._linearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._angularVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._maxLinearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxAngularVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._friction, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._restitution, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._linearDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._angularDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._gravityFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._inertiaMultiplier, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._allowedDOFs, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._allowDynamicOrKinematic, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._isSensor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._motionQuality, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._allowSleeping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._collisionGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32);\r\n        cb.write(this._subGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n        const massProps = this._overrideMassProperties;\r\n        cb.write(massProps, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n\r\n        if (massProps !== pc.JOLT_OMP_CALCULATE_MASS_AND_INERTIA) {\r\n            cb.write(this._overrideMass, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            if (this._overrideMassProperties === pc.JOLT_OMP_MASS_AND_INERTIA_PROVIDED) {\r\n                // override inertia\r\n                // Potential precision loss (64 -> 32)\r\n                cb.write(this._overrideInertiaPosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._overrideInertiaRotation, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    resetVelocities() {\r\n        this.system.addCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_RESET_VELOCITIES, this._index);\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n        const shape = this._shape;\r\n        const isCompoundChild = this._isCompoundChild;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        if ((shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH || shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL || shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_HEIGHTFIELD) && \r\n            this._renderAsset && !this._meshes) {\r\n            this._addMeshes();\r\n        } else if (!isCompoundChild) {\r\n            system.createBody(this);\r\n        }\r\n\r\n        if (!isCompoundChild) {\r\n            const motionType = this._motionType;\r\n            if ((motionType === pc.JOLT_MOTION_TYPE_DYNAMIC && this._trackDynamic) || motionType === pc.JOLT_MOTION_TYPE_KINEMATIC) {\r\n                this._isometryEvent = this.system.on('write-isometry', this.writeIsometry, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n\r\n        const system = this.system;\r\n        const componentIndex = this._index;\r\n\r\n        system.setIndexFree(componentIndex);\r\n\r\n        // TODO\r\n        // Jolt currently exposes only static compounds to Wasm. Which means,\r\n        // that a compound parent cannot change children. So, currently\r\n        // a child cannot be added/removed, we can only destroy/create\r\n        // parent.\r\n\r\n        if (this._isCompoundChild) return;\r\n\r\n        system.addCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CLEANER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_DESTROY_BODY, componentIndex);\r\n\r\n        this._isometryEvent?.off();\r\n        this._isometryEvent = null;\r\n    }\r\n\r\n    _localToWorld(vec) {\r\n        const m4 = this.entity.getWorldTransform();\r\n        m4.transformPoint(vec, vec);\r\n    }\r\n\r\n    _addMeshes() {\r\n        const id = this._renderAsset;\r\n        const assets = this.system.app.assets;\r\n\r\n        const onAssetFullyReady = (asset) => {\r\n            this._meshes = asset.resource.meshes;\r\n            this.system.createBody(this);\r\n        };\r\n\r\n        const loadAndHandleAsset = (asset) => {\r\n            asset.ready((asset) => {\r\n                if (asset.data.containerAsset) {\r\n                    const containerAsset = assets.get(asset.data.containerAsset);\r\n                    if (containerAsset.loaded) {\r\n                        onAssetFullyReady(asset);\r\n                    } else {\r\n                        containerAsset.ready(() => {\r\n                            onAssetFullyReady(asset);\r\n                        });\r\n                        assets.load(containerAsset);\r\n                    }\r\n                } else {\r\n                    onAssetFullyReady(asset);\r\n                }\r\n            });\r\n\r\n            assets.load(asset);\r\n        };\r\n\r\n        const asset = assets.get(id);\r\n        if (asset) {\r\n            loadAndHandleAsset(asset);\r\n        } else {\r\n            assets.once('add:' + id, loadAndHandleAsset);\r\n        }        \r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBMkM7QUFDTztBQWtCeEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDBEQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFLO0FBQ2pCLHVCQUF1Qiw2Q0FBSztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkRBQWlCLEVBQUUsMkRBQWU7QUFDbEQscUJBQXFCLDhEQUFrQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFLO0FBQ2pCLHVCQUF1Qiw2Q0FBSztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkRBQWlCLEVBQUUsMkRBQWU7QUFDbEQscUJBQXFCLDhEQUFrQjtBQUN2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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDeUI7QUFDekIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9ib2R5L2NvbXBvbmVudC5tanM/ZGYyZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgU2hhcGVDb21wb25lbnQgfSBmcm9tIFwiLi4vY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsXHJcbiAgICBCVUZGRVJfV1JJVEVfRkxPQVQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMTYsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQ4LCBCVUZGRVJfV1JJVEVfVkVDMzIsXHJcbiAgICBDTURfQUREX0ZPUkNFLCBDTURfQUREX0lNUFVMU0UsXHJcbiAgICBDTURfQVBQTFlfQlVPWUFOQ1lfSU1QVUxTRSxcclxuICAgIENNRF9ERVNUUk9ZX0JPRFksXHJcbiAgICBDTURfTU9WRV9CT0RZLCBDTURfUkVTRVRfVkVMT0NJVElFUywgQ01EX1NFVF9BTkdfVkVMLFxyXG4gICAgQ01EX1NFVF9MSU5fVkVMLCBDTURfU0VUX01PVElPTl9UWVBFLFxyXG4gICAgQ01EX1NFVF9VU0VSX0RBVEEsXHJcbiAgICBDTURfVVNFX01PVElPTl9TVEFURSxcclxuICAgIE9QRVJBVE9SX0NMRUFORVIsIE9QRVJBVE9SX01PRElGSUVSLFxyXG4gICAgU0hBUEVfQ09OVkVYX0hVTEwsXHJcbiAgICBTSEFQRV9IRUlHSFRGSUVMRCxcclxuICAgIFNIQVBFX01FU0hcclxufSBmcm9tIFwiLi4vY29uc3RhbnRzLm1qc1wiO1xyXG5cclxuY29uc3QgdmVjMyA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG5jbGFzcyBCb2R5Q29tcG9uZW50IGV4dGVuZHMgU2hhcGVDb21wb25lbnQge1xyXG5cclxuICAgIC8vIC0tLS0gQk9EWSBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gUG9zaXRpb24gb2YgdGhlIGJvZHkgKG5vdCBvZiB0aGUgY2VudGVyIG9mIG1hc3MpXHJcbiAgICBfcG9zaXRpb24gPSBuZXcgcGMuVmVjMygpO1xyXG5cclxuICAgIC8vIFJvdGF0aW9uIG9mIHRoZSBib2R5LlxyXG4gICAgX3JvdGF0aW9uID0gbmV3IHBjLlF1YXQoKTtcclxuXHJcbiAgICAvLyBXb3JsZCBzcGFjZSBsaW5lYXIgdmVsb2NpdHkgb2YgdGhlIGNlbnRlciBvZiBtYXNzIChtL3MpXHJcbiAgICBfbGluZWFyVmVsb2NpdHkgPSBuZXcgcGMuVmVjMygpO1xyXG5cclxuICAgIC8vIFdvcmxkIHNwYWNlIGFuZ3VsYXIgdmVsb2NpdHkgKHJhZC9zKVxyXG4gICAgX2FuZ3VsYXJWZWxvY2l0eSA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG4gICAgLy8gTW90aW9uIHR5cGUsIGRldGVybWluZXMgaWYgdGhlIG9iamVjdCBpcyBzdGF0aWMsIGR5bmFtaWMgb3Iga2luZW1hdGljLlxyXG4gICAgX21vdGlvblR5cGUgPSBwYy5KT0xUX01PVElPTl9UWVBFX1NUQVRJQztcclxuXHJcbiAgICAvLyBFbmFibGVzL2Rpc2FibGVzIHRoZSB1c2Ugb2YgbW90aW9uIHN0YXRlIGZvciB0aGlzIGVudGl0eS4gTm90IHVzZWQgYnkgc3RhdGljIGJvZGllcy5cclxuICAgIF91c2VNb3Rpb25TdGF0ZSA9IHRydWU7XHJcblxyXG4gICAgLy8gVGhlIGNvbGxpc2lvbiBsYXllciB0aGlzIGJvZHkgYmVsb25ncyB0byAoZGV0ZXJtaW5lcyBpZiB0d28gb2JqZWN0cyBjYW4gY29sbGlkZSkuXHJcbiAgICAvLyBBbGxvd3MgY2hlYXAgZmlsdGVyaW5nLlxyXG4gICAgX29iamVjdExheWVyID0gMDtcclxuXHJcbiAgICAvLyBUaGUgY29sbGlzaW9uIGdyb3VwIHRoaXMgYm9keSBiZWxvbmdzIHRvIChkZXRlcm1pbmVzIGlmIHR3byBvYmplY3RzIGNhbiBjb2xsaWRlKS5cclxuICAgIC8vIEV4cGVuc2l2ZSwgc28gZGlzYWJsZWQgYnkgZGVmYXVsdC5cclxuICAgIF9jb2xsaXNpb25Hcm91cCA9IG51bGw7XHJcblxyXG4gICAgLy8gU3ViLWdyb3VwICh3aXRoaW4gdGhlIGNvbGxpc2lvbiBncm91cCkuIEV4cGVuc2l2ZSwgc28gZGlzYWJsZWQgYnkgZGVmYXVsdC5cclxuICAgIF9zdWJHcm91cCA9IG51bGw7XHJcblxyXG4gICAgLy8gV2hpY2ggZGVncmVlcyBvZiBmcmVlZG9tIHRoaXMgYm9keSBoYXMgKGNhbiBiZSB1c2VkIHRvIGxpbWl0IHNpbXVsYXRpb24gdG8gMkQpXHJcbiAgICBfYWxsb3dlZERPRnMgPSBwYy5KT0xUX0FMTE9XRURfRE9GU19BTEw7XHJcblxyXG4gICAgLy8gV2hlbiB0aGlzIGJvZHkgaXMgY3JlYXRlZCBhcyBzdGF0aWMsIHRoaXMgc2V0dGluZyB0ZWxscyB0aGUgc3lzdGVtIHRvIGNyZWF0ZSBhXHJcbiAgICAvLyBNb3Rpb25Qcm9wZXJ0aWVzIG9iamVjdCBzbyB0aGF0IHRoZSBvYmplY3QgY2FuIGJlIHN3aXRjaGVkIHRvIGtpbmVtYXRpYyBvciBkeW5hbWljLlxyXG4gICAgX2FsbG93RHluYW1pY09yS2luZW1hdGljID0gZmFsc2U7XHJcblxyXG4gICAgLy8gSWYgdGhpcyBib2R5IGlzIGEgc2Vuc29yLiBBIHNlbnNvciB3aWxsIHJlY2VpdmUgY29sbGlzaW9uIGNhbGxiYWNrcywgYnV0IHdpbGwgbm90XHJcbiAgICAvLyBjYXVzZSBhbnkgY29sbGlzaW9uIHJlc3BvbnNlcyBhbmQgY2FuIGJlIHVzZWQgYXMgYSB0cmlnZ2VyIHZvbHVtZS5cclxuICAgIF9pc1NlbnNvciA9IGZhbHNlO1xyXG5cclxuICAgIC8vIE1vdGlvbiBxdWFsaXR5LCBvciBob3cgd2VsbCBpdCBkZXRlY3RzIGNvbGxpc2lvbnMgd2hlbiBpdCBoYXMgYSBoaWdoIHZlbG9jaXR5LlxyXG4gICAgX21vdGlvblF1YWxpdHkgPSBwYy5KT0xUX01PVElPTl9RVUFMSVRZX0RJU0NSRVRFO1xyXG5cclxuICAgIC8vIElmIHRoaXMgYm9keSBjYW4gZ28gdG8gc2xlZXAgb3Igbm90LlxyXG4gICAgX2FsbG93U2xlZXBpbmcgPSB0cnVlO1xyXG5cclxuICAgIC8vIEZyaWN0aW9uIG9mIHRoZSBib2R5IChkaW1lbnNpb25sZXNzIG51bWJlciwgdXN1YWxseSBiZXR3ZWVuIDAgYW5kIDEsIDAgPSBubyBmcmljdGlvbixcclxuICAgIC8vIDEgPSBmcmljdGlvbiBmb3JjZSBlcXVhbHMgZm9yY2UgdGhhdCBwcmVzc2VzIHRoZSB0d28gYm9kaWVzIHRvZ2V0aGVyKS4gTm90ZSB0aGF0IGJvZGllc1xyXG4gICAgLy8gY2FuIGhhdmUgbmVnYXRpdmUgZnJpY3Rpb24gYnV0IHRoZSBjb21iaW5lZCBmcmljdGlvbiBzaG91bGQgbmV2ZXIgZ28gYmVsb3cgemVyby5cclxuICAgIF9mcmljdGlvbiA9IDAuMjtcclxuXHJcbiAgICAvLyBSZXN0aXR1dGlvbiBvZiBib2R5IChkaW1lbnNpb25sZXNzIG51bWJlciwgdXN1YWxseSBiZXR3ZWVuIDAgYW5kIDEsIDAgPSBjb21wbGV0ZWx5XHJcbiAgICAvLyBpbmVsYXN0aWMgY29sbGlzaW9uIHJlc3BvbnNlLCAxID0gY29tcGxldGVseSBlbGFzdGljIGNvbGxpc2lvbiByZXNwb25zZSkuIE5vdGUgdGhhdFxyXG4gICAgLy8gYm9kaWVzIGNhbiBoYXZlIG5lZ2F0aXZlIHJlc3RpdHV0aW9uIGJ1dCB0aGUgY29tYmluZWQgcmVzdGl0dXRpb24gc2hvdWxkIG5ldmVyIGdvIGJlbG93IHplcm8uXHJcbiAgICBfcmVzdGl0dXRpb24gPSAwO1xyXG5cclxuICAgIC8vIExpbmVhciBkYW1waW5nOiBkdi9kdCA9IC1jICogdi4gYyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMSBidXQgaXMgdXN1YWxseSBjbG9zZSB0byAwLlxyXG4gICAgX2xpbmVhckRhbXBpbmcgPSAwO1xyXG5cclxuICAgIC8vIEFuZ3VsYXIgZGFtcGluZzogZHcvZHQgPSAtYyAqIHcuIGMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEgYnV0IGlzIHVzdWFsbHkgY2xvc2UgdG8gMC5cclxuICAgIF9hbmd1bGFyRGFtcGluZyA9IDA7XHJcblxyXG4gICAgLy8gTWF4aW11bSBsaW5lYXIgdmVsb2NpdHkgdGhhdCB0aGlzIGJvZHkgY2FuIHJlYWNoIChtL3MpXHJcbiAgICBfbWF4TGluZWFyVmVsb2NpdHkgPSA1MDA7XHJcblxyXG4gICAgLy8gTWF4aW11bSBhbmd1bGFyIHZlbG9jaXR5IHRoYXQgdGhpcyBib2R5IGNhbiByZWFjaCAocmFkL3MpXHJcbiAgICBfbWF4QW5ndWxhclZlbG9jaXR5ID0gMC4yNSAqIE1hdGguUEkgKiA2MDtcclxuXHJcbiAgICAvLyBWYWx1ZSB0byBtdWx0aXBseSBncmF2aXR5IHdpdGggZm9yIHRoaXMgYm9keS5cclxuICAgIF9ncmF2aXR5RmFjdG9yID0gMTtcclxuXHJcbiAgICAvLyBXaGVuIGNhbGN1bGF0aW5nIHRoZSBpbmVydGlhIChub3Qgd2hlbiBpdCBpcyBwcm92aWRlZCkgdGhlIGNhbGN1bGF0ZWQgaW5lcnRpYSB3aWxsIGJlIG11bHRpcGxpZWQgYnkgdGhpcyB2YWx1ZS5cclxuICAgIF9pbmVydGlhTXVsdGlwbGllciA9IDE7XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lcyBob3cgbU1hc3NQcm9wZXJ0aWVzT3ZlcnJpZGUgd2lsbCBiZSB1c2VkLiBCeSBkZWZhdWx0IHRlbGxzIEpvbHQgdG9cclxuICAgIC8vIGF1dG8tY2FsY3VsYXRlIGJ5IHRoZSBzaGFwZS5cclxuICAgIF9vdmVycmlkZU1hc3NQcm9wZXJ0aWVzID0gcGMuSk9MVF9PTVBfQ0FMQ1VMQVRFX01BU1NfQU5EX0lORVJUSUE7XHJcblxyXG4gICAgLy8gVXNlZCBvbmx5IGlmIEpvbHQuQ2FsY3VsYXRlSW5lcnRpYSBvciBKb2x0Lk1hc3NBbmRJbmVydGlhUHJvdmlkZWQgaXMgc2VsZWN0ZWQgZm9yXHJcbiAgICAvLyBtYXNzIGNhbGN1bGF0aW9uIG1ldGhvZFxyXG4gICAgX292ZXJyaWRlTWFzcyA9IDE7XHJcblxyXG4gICAgLy8gVXNlZCBpZiBKb2x0Lk1hc3NBbmRJbmVydGlhUHJvdmlkZWQgaXMgc2VsZWN0ZWQgZm9yIG1hc3MgY2FsY3VsYXRpb24gbWV0aG9kLlxyXG4gICAgLy8gQmFja2VuZCB3aWxsIGNyZWF0ZSBpbmVydGlhIG1hdHJpeCBmcm9tIHRoZSBnaXZlbiBwb3NpdGlvbi9yb3RhdGlvbi5cclxuICAgIF9vdmVycmlkZUluZXJ0aWFQb3NpdGlvbiA9IG5ldyBwYy5WZWMzKCk7XHJcbiAgICBfb3ZlcnJpZGVJbmVydGlhUm90YXRpb24gPSBuZXcgcGMuUXVhdCgpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBsaW5lYXJWZWxvY2l0eSh2ZWMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tWZWModmVjLCBgSW52YWxpZCBsaW5lYXIgdmVsb2NpdHkgdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdmVjLmVxdWFscyh0aGlzLl9saW5lYXJWZWxvY2l0eSkpIHtcclxuICAgICAgICAgICAgdGhpcy5fbGluZWFyVmVsb2NpdHkuY29weSh2ZWMpO1xyXG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9TRVRfTElOX1ZFTCwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgICAgICB2ZWMsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2VcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGxpbmVhclZlbG9jaXR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saW5lYXJWZWxvY2l0eTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYW5ndWxhclZlbG9jaXR5KHZlYykge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5jaGVja1ZlYyh2ZWMsIGBJbnZhbGlkIGFuZ3VsYXIgdmVsb2NpdHkgdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdmVjLmVxdWFscyh0aGlzLl9hbmd1bGFyVmVsb2NpdHkpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FuZ3VsYXJWZWxvY2l0eS5jb3B5KHZlYyk7XHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX1NFVF9BTkdfVkVMLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgICAgIHZlYywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgYW5ndWxhclZlbG9jaXR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hbmd1bGFyVmVsb2NpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IG1vdGlvblR5cGUodHlwZSkge1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1VpbnQodHlwZSwgYEludmFsaWQgbW90aW9uIHR5cGU6ICR7IHR5cGUgfWApO1xyXG4gICAgICAgIHRoaXMuX21vdGlvblR5cGUgPSB0eXBlO1xyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfU0VUX01PVElPTl9UWVBFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgdHlwZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1vdGlvblR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21vdGlvblR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbGxpc2lvbkdyb3VwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ncm91cDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc3ViR3JvdXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1Ykdyb3VwO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbmRleCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVzZXJEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdXNlckRhdGEobnVtKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KG51bSwgYEludmFsaWQgdXNlciBkYXRhIHZhbHVlLiBTaG91bGQgYmUgYSBudW1iZXI6ICR7IG51bSB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91c2VyRGF0YSA9IG51bTtcclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9TRVRfVVNFUl9EQVRBLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgbnVtLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2VcclxuICAgICAgICApOyAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGdldCB1c2VNb3Rpb25TdGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdXNlTW90aW9uU3RhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHVzZU1vdGlvblN0YXRlKGJvb2wpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tCb29sKGJvb2wsIGBJbnZhbGlkIGJvb2wgdmFsdWUgZm9yIHVzZU1vdGlvblN0YXRlIHByb3BlcnR5OiAkeyBib29sIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfVVNFX01PVElPTl9TVEFURSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIGJvb2wsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkRm9yY2UoZm9yY2UsIG9mZnNldCwgaXNPZmZzZXRMb2NhbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKGZvcmNlLCBgSW52YWxpZCBhZGQgZm9yY2UgdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMob2Zmc2V0LCBgSW52YWxpZCBhZGQgZm9yY2Ugb2Zmc2V0YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IF9vZmZzZXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChvZmZzZXQpIHtcclxuICAgICAgICAgICAgX29mZnNldCA9IHZlYzMuY29weShvZmZzZXQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzT2Zmc2V0TG9jYWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvY2FsVG9Xb3JsZChfb2Zmc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9BRERfRk9SQ0UsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBmb3JjZSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSxcclxuICAgICAgICAgICAgX29mZnNldCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCB0cnVlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRGb3JjZVNjYWxhcnMoZm9yY2VYLCBmb3JjZVksIGZvcmNlWiwgb2Zmc2V0WCA9IDAsIG9mZnNldFkgPSAwLCBvZmZzZXRaID0gMCwgaXNPZmZzZXRMb2NhbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoZm9yY2VYLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBYIGNvbXBvbmVudDogJHsgZm9yY2VYIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGZvcmNlWSwgYEludmFsaWQgYWRkIGltcHVsc2UgWSBjb21wb25lbnQ6ICR7IGZvcmNlWSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChmb3JjZVosIGBJbnZhbGlkIGFkZCBpbXB1bHNlIFogY29tcG9uZW50OiAkeyBmb3JjZVogfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQob2Zmc2V0WCwgYEludmFsaWQgYWRkIGltcHVsc2Ugb2Zmc2V0IFggY29tcG9uZW50OiAkeyBvZmZzZXRYIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KG9mZnNldFksIGBJbnZhbGlkIGFkZCBpbXB1bHNlIG9mZnNldCBZIGNvbXBvbmVudDogJHsgb2Zmc2V0WSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChvZmZzZXRaLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBvZmZzZXQgWiBjb21wb25lbnQ6ICR7IG9mZnNldFogfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvZmZzZXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChvZmZzZXRYICE9PSAwIHx8IG9mZnNldFkgIT09IDAgfHwgb2Zmc2V0WiAhPT0gMCkge1xyXG4gICAgICAgICAgICBvZmZzZXQgPSB2ZWMzLnNldChvZmZzZXRYLCBvZmZzZXRZLCBvZmZzZXRaKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc09mZnNldExvY2FsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFRvV29ybGQob2Zmc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9BRERfRk9SQ0UsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBmb3JjZVgsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgZm9yY2VZLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGZvcmNlWiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBvZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSW1wdWxzZShpbXB1bHNlLCBvZmZzZXQgPSBwYy5WZWMzLlpFUk8sIGlzT2Zmc2V0TG9jYWwgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhpbXB1bHNlLCBgSW52YWxpZCBhZGQgaW1wdWxzZSB2ZWN0b3I6YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMob2Zmc2V0LCBgSW52YWxpZCBhZGQgaW1wdWxzZSBvZmZzZXQ6YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IF9vZmZzZXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChvZmZzZXQpIHtcclxuICAgICAgICAgICAgX29mZnNldCA9IHZlYzMuY29weShvZmZzZXQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzT2Zmc2V0TG9jYWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvY2FsVG9Xb3JsZChfb2Zmc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9BRERfSU1QVUxTRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIGltcHVsc2UsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIF9vZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSW1wdWxzZVNjYWxhcnMoaW1wdWxzZVgsIGltcHVsc2VZLCBpbXB1bHNlWiwgb2Zmc2V0WCA9IDAsIG9mZnNldFkgPSAwLCBvZmZzZXRaID0gMCwgaXNPZmZzZXRMb2NhbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoaW1wdWxzZVgsIGBJbnZhbGlkIGFkZCBpbXB1bHNlIFggY29tcG9uZW50OiAkeyBpbXB1bHNlWCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChpbXB1bHNlWSwgYEludmFsaWQgYWRkIGltcHVsc2UgWSBjb21wb25lbnQ6ICR7IGltcHVsc2VZIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGltcHVsc2VaLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBaIGNvbXBvbmVudDogJHsgaW1wdWxzZVogfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQob2Zmc2V0WCwgYEludmFsaWQgYWRkIGltcHVsc2Ugb2Zmc2V0IFggY29tcG9uZW50OiAkeyBvZmZzZXRYIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KG9mZnNldFksIGBJbnZhbGlkIGFkZCBpbXB1bHNlIG9mZnNldCBZIGNvbXBvbmVudDogJHsgb2Zmc2V0WSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChvZmZzZXRaLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBvZmZzZXQgWiBjb21wb25lbnQ6ICR7IG9mZnNldFogfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvZmZzZXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChvZmZzZXRYICE9PSAwIHx8IG9mZnNldFkgIT09IDAgfHwgb2Zmc2V0WiAhPT0gMCkge1xyXG4gICAgICAgICAgICBvZmZzZXQgPSB2ZWMzLnNldChvZmZzZXRYLCBvZmZzZXRZLCBvZmZzZXRaKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc09mZnNldExvY2FsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFRvV29ybGQob2Zmc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9BRERfRk9SQ0UsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBpbXB1bHNlWCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBpbXB1bHNlWSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBpbXB1bHNlWiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBvZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYXBwbHlCdW95YW5jeUltcHVsc2Uod2F0ZXJTdXJmYWNlUG9zaXRpb24sIHN1cmZhY2VOb3JtYWwsIGJ1b3lhbmN5LCBsaW5lYXJEcmFnLCBhbmd1bGFyRHJhZywgZmx1aWRWZWxvY2l0eSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyh3YXRlclN1cmZhY2VQb3NpdGlvbiwgYEludmFsaWQgd2F0ZXIgc3VyZmFjZSBwb3NpdGlvbiB2ZWN0b3JgKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhzdXJmYWNlTm9ybWFsLCBgSW52YWxpZCBzdXJmYWNlIG5vcm1hbGApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoYnVveWFuY3ksIGBJbnZhbGlkIGJ1b3lhbmN5IHNjYWxhcjogJHsgYnVveWFuY3kgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQobGluZWFyRHJhZywgYEludmFsaWQgbGluZWFyIGRyYWcgc2NhbGFyOiAkeyBsaW5lYXJEcmFnIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGFuZ3VsYXJEcmFnLCBgSW52YWxpZCBhbmd1bGFyIGRyYWcgc2NhbGFyOiAkeyBhbmd1bGFyRHJhZyB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMoZmx1aWRWZWxvY2l0eSwgYEludmFsaWQgZmx1aWQgdmVsb2NpdHkgdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQVBQTFlfQlVPWUFOQ1lfSU1QVUxTRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIHdhdGVyU3VyZmFjZVBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBzdXJmYWNlTm9ybWFsLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBidW95YW5jeSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5lYXJEcmFnLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGFuZ3VsYXJEcmFnLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGZsdWlkVmVsb2NpdHksIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2VcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEFuZ3VsYXJJbXB1bHNlKGltcHVsc2UpIHtcclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX0FERF9JTVBVTFNFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgaW1wdWxzZSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkVG9ycXVlKHRvcnF1ZSkge1xyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQUREX0ZPUkNFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgdG9ycXVlLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZUlzb21ldHJ5KCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG4gICAgICAgIGlmIChlbnRpdHkuX2RpcnR5V29ybGQpIHtcclxuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBlbnRpdHkuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3Qgcm90YXRpb24gPSBlbnRpdHkuZ2V0Um90YXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX01PVkVfQk9EWSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJvdGF0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fbW90aW9uVHlwZSA9PT0gcGMuSk9MVF9NT1RJT05fVFlQRV9EWU5BTUlDKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0VmVsb2NpdGllcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlQ29tcG9uZW50RGF0YShjYikge1xyXG4gICAgICAgIGNvbnN0IG9rID0gU2hhcGVDb21wb25lbnQud3JpdGVTaGFwZURhdGEoY2IsIHRoaXMpO1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgIW9rKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm4oJ0Vycm9yIGNyZWF0aW5nIGEgc2hhcGUgZGF0YS4nKTtcclxuICAgICAgICAgICAgY2IucmVzZXQoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5faW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgLy8gV2UgYWx3YXlzIHVzZSB3b3JsZCBwb3NpdGlvbiBhbmQgcm90YXRpb24gZnJvbSB0aGUgY3VycmVudCBlbnRpdHkgdGhlIGNvbXBvbmVudFxyXG4gICAgICAgIC8vIGlzIGF0dGFjaGVkIHRvIChpbnN0ZWFkIG9mIGRlZmF1bHQgemVybyB2ZWN0b3JzKVxyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG4gICAgICAgIGNvbnN0IHBvcyA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IHJvdCA9IGVudGl0eS5nZXRSb3RhdGlvbigpO1xyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gZ2V0IHJpZCBvZiBmbGFnc1xyXG5cclxuICAgICAgICAvLyBMb3NzIG9mIHByZWNpc2lvbiBmb3IgcG9zL3JvdCAoNjQgLT4gMzIpXHJcbiAgICAgICAgY2Iud3JpdGUocG9zLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShyb3QsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tb3Rpb25UeXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl91c2VNb3Rpb25TdGF0ZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9vYmplY3RMYXllciwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2xpbmVhclZlbG9jaXR5LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9hbmd1bGFyVmVsb2NpdHksIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heExpbmVhclZlbG9jaXR5LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heEFuZ3VsYXJWZWxvY2l0eSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9mcmljdGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9yZXN0aXR1dGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9saW5lYXJEYW1waW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FuZ3VsYXJEYW1waW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2dyYXZpdHlGYWN0b3IsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5faW5lcnRpYU11bHRpcGxpZXIsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fYWxsb3dlZERPRnMsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FsbG93RHluYW1pY09yS2luZW1hdGljLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2lzU2Vuc29yLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21vdGlvblF1YWxpdHksIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FsbG93U2xlZXBpbmcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY29sbGlzaW9uR3JvdXAsIEJVRkZFUl9XUklURV9VSU5UMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3N1Ykdyb3VwLCBCVUZGRVJfV1JJVEVfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgRGVidWcuZGV2ICYmIGNiLndyaXRlKHRoaXMuX2RlYnVnRHJhdywgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY29uc3QgbWFzc1Byb3BzID0gdGhpcy5fb3ZlcnJpZGVNYXNzUHJvcGVydGllcztcclxuICAgICAgICBjYi53cml0ZShtYXNzUHJvcHMsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG5cclxuICAgICAgICBpZiAobWFzc1Byb3BzICE9PSBwYy5KT0xUX09NUF9DQUxDVUxBVEVfTUFTU19BTkRfSU5FUlRJQSkge1xyXG4gICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9vdmVycmlkZU1hc3MsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fb3ZlcnJpZGVNYXNzUHJvcGVydGllcyA9PT0gcGMuSk9MVF9PTVBfTUFTU19BTkRfSU5FUlRJQV9QUk9WSURFRCkge1xyXG4gICAgICAgICAgICAgICAgLy8gb3ZlcnJpZGUgaW5lcnRpYVxyXG4gICAgICAgICAgICAgICAgLy8gUG90ZW50aWFsIHByZWNpc2lvbiBsb3NzICg2NCAtPiAzMilcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX292ZXJyaWRlSW5lcnRpYVBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX292ZXJyaWRlSW5lcnRpYVJvdGF0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldFZlbG9jaXRpZXMoKSB7XHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChPUEVSQVRPUl9NT0RJRklFUiwgQ01EX1JFU0VUX1ZFTE9DSVRJRVMsIHRoaXMuX2luZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkVuYWJsZSgpIHtcclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLnN5c3RlbTtcclxuICAgICAgICBjb25zdCBzaGFwZSA9IHRoaXMuX3NoYXBlO1xyXG4gICAgICAgIGNvbnN0IGlzQ29tcG91bmRDaGlsZCA9IHRoaXMuX2lzQ29tcG91bmRDaGlsZDtcclxuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSBzeXN0ZW0uZ2V0SW5kZXgodGhpcy5lbnRpdHkpO1xyXG5cclxuICAgICAgICBpZiAoKHNoYXBlID09PSBTSEFQRV9NRVNIIHx8IHNoYXBlID09PSBTSEFQRV9DT05WRVhfSFVMTCB8fCBzaGFwZSA9PT0gU0hBUEVfSEVJR0hURklFTEQpICYmIFxyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJBc3NldCAmJiAhdGhpcy5fbWVzaGVzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FkZE1lc2hlcygpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIWlzQ29tcG91bmRDaGlsZCkge1xyXG4gICAgICAgICAgICBzeXN0ZW0uY3JlYXRlQm9keSh0aGlzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghaXNDb21wb3VuZENoaWxkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vdGlvblR5cGUgPSB0aGlzLl9tb3Rpb25UeXBlO1xyXG4gICAgICAgICAgICBpZiAoKG1vdGlvblR5cGUgPT09IHBjLkpPTFRfTU9USU9OX1RZUEVfRFlOQU1JQyAmJiB0aGlzLl90cmFja0R5bmFtaWMpIHx8IG1vdGlvblR5cGUgPT09IHBjLkpPTFRfTU9USU9OX1RZUEVfS0lORU1BVElDKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pc29tZXRyeUV2ZW50ID0gdGhpcy5zeXN0ZW0ub24oJ3dyaXRlLWlzb21ldHJ5JywgdGhpcy53cml0ZUlzb21ldHJ5LCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkRpc2FibGUoKSB7XHJcbiAgICAgICAgc3VwZXIub25EaXNhYmxlKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuc3lzdGVtO1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudEluZGV4ID0gdGhpcy5faW5kZXg7XHJcblxyXG4gICAgICAgIHN5c3RlbS5zZXRJbmRleEZyZWUoY29tcG9uZW50SW5kZXgpO1xyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gSm9sdCBjdXJyZW50bHkgZXhwb3NlcyBvbmx5IHN0YXRpYyBjb21wb3VuZHMgdG8gV2FzbS4gV2hpY2ggbWVhbnMsXHJcbiAgICAgICAgLy8gdGhhdCBhIGNvbXBvdW5kIHBhcmVudCBjYW5ub3QgY2hhbmdlIGNoaWxkcmVuLiBTbywgY3VycmVudGx5XHJcbiAgICAgICAgLy8gYSBjaGlsZCBjYW5ub3QgYmUgYWRkZWQvcmVtb3ZlZCwgd2UgY2FuIG9ubHkgZGVzdHJveS9jcmVhdGVcclxuICAgICAgICAvLyBwYXJlbnQuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9pc0NvbXBvdW5kQ2hpbGQpIHJldHVybjtcclxuXHJcbiAgICAgICAgc3lzdGVtLmFkZENvbW1hbmQoT1BFUkFUT1JfQ0xFQU5FUiwgQ01EX0RFU1RST1lfQk9EWSwgY29tcG9uZW50SW5kZXgpO1xyXG5cclxuICAgICAgICB0aGlzLl9pc29tZXRyeUV2ZW50Py5vZmYoKTtcclxuICAgICAgICB0aGlzLl9pc29tZXRyeUV2ZW50ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfbG9jYWxUb1dvcmxkKHZlYykge1xyXG4gICAgICAgIGNvbnN0IG00ID0gdGhpcy5lbnRpdHkuZ2V0V29ybGRUcmFuc2Zvcm0oKTtcclxuICAgICAgICBtNC50cmFuc2Zvcm1Qb2ludCh2ZWMsIHZlYyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2FkZE1lc2hlcygpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMuX3JlbmRlckFzc2V0O1xyXG4gICAgICAgIGNvbnN0IGFzc2V0cyA9IHRoaXMuc3lzdGVtLmFwcC5hc3NldHM7XHJcblxyXG4gICAgICAgIGNvbnN0IG9uQXNzZXRGdWxseVJlYWR5ID0gKGFzc2V0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21lc2hlcyA9IGFzc2V0LnJlc291cmNlLm1lc2hlcztcclxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uY3JlYXRlQm9keSh0aGlzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBsb2FkQW5kSGFuZGxlQXNzZXQgPSAoYXNzZXQpID0+IHtcclxuICAgICAgICAgICAgYXNzZXQucmVhZHkoKGFzc2V0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5jb250YWluZXJBc3NldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckFzc2V0ID0gYXNzZXRzLmdldChhc3NldC5kYXRhLmNvbnRhaW5lckFzc2V0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyQXNzZXQubG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQXNzZXRGdWxseVJlYWR5KGFzc2V0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJBc3NldC5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkFzc2V0RnVsbHlSZWFkeShhc3NldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldHMubG9hZChjb250YWluZXJBc3NldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvbkFzc2V0RnVsbHlSZWFkeShhc3NldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgYXNzZXRzLmxvYWQoYXNzZXQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IGFzc2V0ID0gYXNzZXRzLmdldChpZCk7XHJcbiAgICAgICAgaWYgKGFzc2V0KSB7XHJcbiAgICAgICAgICAgIGxvYWRBbmRIYW5kbGVBc3NldChhc3NldCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXNzZXRzLm9uY2UoJ2FkZDonICsgaWQsIGxvYWRBbmRIYW5kbGVBc3NldCk7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJvZHlDb21wb25lbnQgfTtcclxuXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/body/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/body/system.mjs":
/*!*****************************************************!*\
  !*** ./src/physics/components/jolt/body/system.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BodyComponentSystem: () => (/* binding */ BodyComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../response-handler.mjs */ \"./src/physics/components/jolt/response-handler.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Jolt body\r\n    'position',\r\n    'rotation',\r\n    'linearVelocity',\r\n    'angularVelocity',\r\n    'friction',\r\n    'restitution',\r\n    'linearDamping',\r\n    'angularDamping',\r\n    'maxLinearVelocity',\r\n    'maxAngularVelocity',\r\n    'gravityFactor',\r\n    'inertiaMultiplier',\r\n    'overrideMass',\r\n    'overrideMassProperties',\r\n    'overrideInertiaPosition',\r\n    'overrideInertiaRotation',\r\n    'motionType',\r\n    'objectLayer',\r\n    'collisionGroup',\r\n    'subGroup',\r\n    'allowedDOFs',\r\n    'allowDynamicOrKinematic',\r\n    'isSensor',\r\n    'motionQuality',\r\n    'allowSleeping',\r\n];\r\n\r\nclass BodyComponentSystem extends _system_mjs__WEBPACK_IMPORTED_MODULE_4__.ShapeComponentSystem {\r\n\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'body';\r\n        this.schema = [...this.schema, ...schema];\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_5__.BodyComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_1__.buildAccessors)(this, this.schema);\r\n\r\n        this.on('beforeremove', this.onBeforeRemove, this);\r\n    }\r\n\r\n    overrideContacts(callbacks = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            !!callbacks.OnContactValidate && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactValidate === 'function', 'OnContactValidate must be a function', callbacks);\r\n            !!callbacks.OnContactAdded && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactAdded === 'function', 'OnContactAdded must be a function', callbacks);\r\n            !!callbacks.OnContactPersisted && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactPersisted === 'function', 'OnContactPersisted must be a function', callbacks);\r\n            !!callbacks.OnContactRemoved && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactRemoved === 'function', 'OnContactRemoved must be a function', callbacks);\r\n        }\r\n\r\n        const overrides = Object.create(null);\r\n        if (callbacks.OnContactValidate) {\r\n            overrides.OnContactValidate = new String(callbacks.OnContactValidate);\r\n        }\r\n        if (callbacks.OnContactAdded) {\r\n            overrides.OnContactAdded = new String(callbacks.OnContactAdded);\r\n        }\r\n        if (callbacks.OnContactPersisted) {\r\n            overrides.OnContactPersisted = new String(callbacks.OnContactPersisted);\r\n        }\r\n        if (callbacks.OnContactRemoved) {\r\n            overrides.OnContactRemoved = new String(callbacks.OnContactRemoved);\r\n        }\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'override-contacts';\r\n        msg.listener = 'contacts';\r\n        msg.overrides = overrides;\r\n        this._manager.sendUncompressed(msg);\r\n    }\r\n\r\n    createBody(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_BODY);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_UPDATE_TRANSFORMS:\r\n                // TODO\r\n                // move to ResponseHandler\r\n                _system_mjs__WEBPACK_IMPORTED_MODULE_4__.ShapeComponentSystem.updateDynamic(cb);\r\n                break;\r\n\r\n            // TODO\r\n            // handle by manager directly\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CAST_RAY:\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CAST_SHAPE:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__.ResponseHandler.handleQuery(cb, this.entityMap, this._manager.queryMap);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_CONTACTS:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__.ResponseHandler.handleContact(cb, this.entityMap, this._manager.config);\r\n                break;\r\n        }\r\n    }\r\n\r\n    requestIsometry() {\r\n        this.fire('write-isometry');\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.verifyProperties(data, this.schema);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        super.initializeComponentData(component, data);\r\n    }\r\n\r\n    onBeforeRemove(entity, component) {\r\n        if (component.enabled) {\r\n            component.enabled = false;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBMkM7QUFDUTtBQVN6QjtBQUNnQztBQUNMO0FBQ0w7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDZEQUFvQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIseURBQWE7QUFDMUM7QUFDQTtBQUNBO0FBQ0EsUUFBUSx5REFBYztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQyxZQUFZLDZDQUFLO0FBQ2pCLDZDQUE2Qyw2Q0FBSztBQUNsRCwwQ0FBMEMsNkNBQUs7QUFDL0MsOENBQThDLDZDQUFLO0FBQ25ELDRDQUE0Qyw2Q0FBSztBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLDREQUFnQjtBQUN6Qyx3QkFBd0IsMkRBQWU7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixpRUFBcUI7QUFDdEM7QUFDQTtBQUNBLGdCQUFnQiw2REFBb0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsd0RBQVk7QUFDN0IsaUJBQWlCLDBEQUFjO0FBQy9CLGdCQUFnQixrRUFBZTtBQUMvQjtBQUNBO0FBQ0EsaUJBQWlCLCtEQUFtQjtBQUNwQyxnQkFBZ0Isa0VBQWU7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQix1QkFBdUIsNkNBQUs7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUMrQjtBQUMvQiIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2JvZHkvc3lzdGVtLm1qcz8xZTJjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBidWlsZEFjY2Vzc29ycyB9IGZyb20gXCIuLi8uLi8uLi91dGlsLm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQ01EX0NBU1RfUkFZLFxyXG4gICAgQ01EX0NBU1RfU0hBUEUsXHJcbiAgICBDTURfQ1JFQVRFX0JPRFksXHJcbiAgICBDTURfUkVQT1JUX0NPTlRBQ1RTLFxyXG4gICAgQ01EX1VQREFURV9UUkFOU0ZPUk1TLFxyXG4gICAgQ09NUE9ORU5UX1NZU1RFTV9CT0RZLFxyXG4gICAgT1BFUkFUT1JfQ1JFQVRPUlxyXG59IGZyb20gXCIuLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlSGFuZGxlciB9IGZyb20gXCIuLi9yZXNwb25zZS1oYW5kbGVyLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuLi9zeXN0ZW0ubWpzXCI7XHJcbmltcG9ydCB7IEJvZHlDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnQubWpzXCI7XHJcblxyXG5jb25zdCBzY2hlbWEgPSBbXHJcbiAgICAvLyBKb2x0IGJvZHlcclxuICAgICdwb3NpdGlvbicsXHJcbiAgICAncm90YXRpb24nLFxyXG4gICAgJ2xpbmVhclZlbG9jaXR5JyxcclxuICAgICdhbmd1bGFyVmVsb2NpdHknLFxyXG4gICAgJ2ZyaWN0aW9uJyxcclxuICAgICdyZXN0aXR1dGlvbicsXHJcbiAgICAnbGluZWFyRGFtcGluZycsXHJcbiAgICAnYW5ndWxhckRhbXBpbmcnLFxyXG4gICAgJ21heExpbmVhclZlbG9jaXR5JyxcclxuICAgICdtYXhBbmd1bGFyVmVsb2NpdHknLFxyXG4gICAgJ2dyYXZpdHlGYWN0b3InLFxyXG4gICAgJ2luZXJ0aWFNdWx0aXBsaWVyJyxcclxuICAgICdvdmVycmlkZU1hc3MnLFxyXG4gICAgJ292ZXJyaWRlTWFzc1Byb3BlcnRpZXMnLFxyXG4gICAgJ292ZXJyaWRlSW5lcnRpYVBvc2l0aW9uJyxcclxuICAgICdvdmVycmlkZUluZXJ0aWFSb3RhdGlvbicsXHJcbiAgICAnbW90aW9uVHlwZScsXHJcbiAgICAnb2JqZWN0TGF5ZXInLFxyXG4gICAgJ2NvbGxpc2lvbkdyb3VwJyxcclxuICAgICdzdWJHcm91cCcsXHJcbiAgICAnYWxsb3dlZERPRnMnLFxyXG4gICAgJ2FsbG93RHluYW1pY09yS2luZW1hdGljJyxcclxuICAgICdpc1NlbnNvcicsXHJcbiAgICAnbW90aW9uUXVhbGl0eScsXHJcbiAgICAnYWxsb3dTbGVlcGluZycsXHJcbl07XHJcblxyXG5jbGFzcyBCb2R5Q29tcG9uZW50U3lzdGVtIGV4dGVuZHMgU2hhcGVDb21wb25lbnRTeXN0ZW0ge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcCwgbWFuYWdlciwgaWQpIHtcclxuICAgICAgICBzdXBlcihhcHAsIG1hbmFnZXIpO1xyXG5cclxuICAgICAgICB0aGlzLmlkID0gJ2JvZHknO1xyXG4gICAgICAgIHRoaXMuc2NoZW1hID0gWy4uLnRoaXMuc2NoZW1hLCAuLi5zY2hlbWFdO1xyXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IEJvZHlDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIG1hbmFnZXIuc3lzdGVtcy5zZXQoaWQsIHRoaXMpO1xyXG5cclxuICAgICAgICBidWlsZEFjY2Vzc29ycyh0aGlzLCB0aGlzLnNjaGVtYSk7XHJcblxyXG4gICAgICAgIHRoaXMub24oJ2JlZm9yZXJlbW92ZScsIHRoaXMub25CZWZvcmVSZW1vdmUsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlQ29udGFjdHMoY2FsbGJhY2tzID0ge30pIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICEhY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlID09PSAnZnVuY3Rpb24nLCAnT25Db250YWN0VmFsaWRhdGUgbXVzdCBiZSBhIGZ1bmN0aW9uJywgY2FsbGJhY2tzKTtcclxuICAgICAgICAgICAgISFjYWxsYmFja3MuT25Db250YWN0QWRkZWQgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25Db250YWN0QWRkZWQgPT09ICdmdW5jdGlvbicsICdPbkNvbnRhY3RBZGRlZCBtdXN0IGJlIGEgZnVuY3Rpb24nLCBjYWxsYmFja3MpO1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkNvbnRhY3RQZXJzaXN0ZWQgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25Db250YWN0UGVyc2lzdGVkID09PSAnZnVuY3Rpb24nLCAnT25Db250YWN0UGVyc2lzdGVkIG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgICAgICEhY2FsbGJhY2tzLk9uQ29udGFjdFJlbW92ZWQgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25Db250YWN0UmVtb3ZlZCA9PT0gJ2Z1bmN0aW9uJywgJ09uQ29udGFjdFJlbW92ZWQgbXVzdCBiZSBhIGZ1bmN0aW9uJywgY2FsbGJhY2tzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG92ZXJyaWRlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgICBvdmVycmlkZXMuT25Db250YWN0VmFsaWRhdGUgPSBuZXcgU3RyaW5nKGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25Db250YWN0QWRkZWQpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQ29udGFjdEFkZGVkID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0QWRkZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2FsbGJhY2tzLk9uQ29udGFjdFBlcnNpc3RlZCkge1xyXG4gICAgICAgICAgICBvdmVycmlkZXMuT25Db250YWN0UGVyc2lzdGVkID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0UGVyc2lzdGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrcy5PbkNvbnRhY3RSZW1vdmVkKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlcy5PbkNvbnRhY3RSZW1vdmVkID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0UmVtb3ZlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBtc2cgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIG1zZy50eXBlID0gJ292ZXJyaWRlLWNvbnRhY3RzJztcclxuICAgICAgICBtc2cubGlzdGVuZXIgPSAnY29udGFjdHMnO1xyXG4gICAgICAgIG1zZy5vdmVycmlkZXMgPSBvdmVycmlkZXM7XHJcbiAgICAgICAgdGhpcy5fbWFuYWdlci5zZW5kVW5jb21wcmVzc2VkKG1zZyk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQm9keShjb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX21hbmFnZXIuY29tbWFuZHNCdWZmZXI7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfQ1JFQVRPUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9DUkVBVEVfQk9EWSk7XHJcblxyXG4gICAgICAgIGNvbXBvbmVudC53cml0ZUNvbXBvbmVudERhdGEoY2IpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb2Nlc3NDb21tYW5kcyhjYikge1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjYi5yZWFkQ29tbWFuZCgpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfVVBEQVRFX1RSQU5TRk9STVM6XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIHRvIFJlc3BvbnNlSGFuZGxlclxyXG4gICAgICAgICAgICAgICAgU2hhcGVDb21wb25lbnRTeXN0ZW0udXBkYXRlRHluYW1pYyhjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIC8vIFRPRE9cclxuICAgICAgICAgICAgLy8gaGFuZGxlIGJ5IG1hbmFnZXIgZGlyZWN0bHlcclxuICAgICAgICAgICAgY2FzZSBDTURfQ0FTVF9SQVk6XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NBU1RfU0hBUEU6XHJcbiAgICAgICAgICAgICAgICBSZXNwb25zZUhhbmRsZXIuaGFuZGxlUXVlcnkoY2IsIHRoaXMuZW50aXR5TWFwLCB0aGlzLl9tYW5hZ2VyLnF1ZXJ5TWFwKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfUkVQT1JUX0NPTlRBQ1RTOlxyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VIYW5kbGVyLmhhbmRsZUNvbnRhY3QoY2IsIHRoaXMuZW50aXR5TWFwLCB0aGlzLl9tYW5hZ2VyLmNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVxdWVzdElzb21ldHJ5KCkge1xyXG4gICAgICAgIHRoaXMuZmlyZSgnd3JpdGUtaXNvbWV0cnknKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcudmVyaWZ5UHJvcGVydGllcyhkYXRhLCB0aGlzLnNjaGVtYSk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdXBlci5pbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmVmb3JlUmVtb3ZlKGVudGl0eSwgY29tcG9uZW50KSB7XHJcbiAgICAgICAgaWYgKGNvbXBvbmVudC5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGNvbXBvbmVudC5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBCb2R5Q29tcG9uZW50U3lzdGVtIH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/body/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/char/component.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/char/component.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CharComponent: () => (/* binding */ CharComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\n\r\nclass CharComponent extends _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent {\r\n    // ---- SHAPE PROPS ----\r\n\r\n    // Shape type\r\n    _shape = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CAPSULE;\r\n\r\n    // ---- CHARACTER PROPS ----\r\n\r\n    // Vector indicating the up direction of the character.\r\n    _up = pc.Vec3.UP;\r\n\r\n    // Enables/disables the use of motion state for the character.\r\n    _useMotionState = true;\r\n\r\n    // Character linear velocity. Must be set by user. Backend will use it to calculate next\r\n    // position.\r\n    _linearVelocity = new pc.Vec3();\r\n\r\n    // Plane, defined in local space relative to the character. Every contact \r\n    // behind this plane can support the character, every contact in front of \r\n    // this plane is treated as only colliding with the player. Default: Accept\r\n    // any contact.\r\n    _supportingVolume = new pc.Plane(pc.Vec3.UP, -1);\r\n\r\n    // Maximum angle of slope that character can still walk on (radians).\r\n    _maxSlopeAngle = 45 * pc.math.DEG_TO_RAD;\r\n\r\n    // Character mass (kg). Used to push down objects with gravity when the \r\n    // character is standing on top.\r\n    _mass = 70;\r\n\r\n    // Maximum force with which the character can push other bodies (N).\r\n    _maxStrength = 100;\r\n\r\n    // An extra offset applied to the shape in local space.\r\n    _shapeOffset = pc.Vec3.ZERO;\r\n\r\n    // When colliding with back faces, the character will not be able to move through\r\n    // back facing triangles. Use this if you have triangles that need to collide\r\n    // on both sides.\r\n    _backFaceMode = pc.JOLT_BFM_COLLIDE_BACK_FACES;\r\n\r\n    // How far to scan outside of the shape for predictive contacts. A value of 0 will\r\n    // most likely cause the character to get stuck as it cannot properly calculate a sliding\r\n    // direction anymore. A value that's too high will cause ghost collisions.\r\n    _predictiveContactDistance = 0.1;\r\n\r\n    // Max amount of collision loops\r\n    _maxCollisionIterations = 5;\r\n\r\n    // How often to try stepping in the constraint solving.\r\n    _maxConstraintIterations = 15;\r\n\r\n    // Early out condition: If this much time is left to simulate we are done.\r\n    _minTimeRemaining = 1.0e-4;\r\n\r\n    // How far we're willing to penetrate geometry\r\n    _collisionTolerance = 1.0e-3;\r\n\r\n    // How far we try to stay away from the geometry, this ensures that the sweep will\r\n    // hit as little as possible lowering the collision cost and reducing the risk of\r\n    // getting stuck.\r\n    _characterPadding = 0.02;\r\n\r\n    // Max num hits to collect in order to avoid excess of contact points collection.\r\n    _maxNumHits = 256;\r\n\r\n    // Cos(angle) where angle is the maximum angle between two hits contact normals that \r\n    // are allowed to be merged during hit reduction. Default is around 2.5 degrees. Set \r\n    // to -1 to turn off.\r\n    _hitReductionCosMaxAngle = 0.999;\r\n\r\n    // This value governs how fast a penetration will be resolved, 0 = nothing is resolved,\r\n    // 1 = everything in one update.\r\n    _penetrationRecoverySpeed = 1;\r\n\r\n    // Read-only. True if the character is supported by normal or steep ground.\r\n    _isSupported = false;\r\n\r\n    // Read-only. True if the ground is too steep to walk on.\r\n    _isSlopeTooSteep = false;\r\n\r\n    // Read-only. If the character is supported, this will tell the ground entity.\r\n    _groundEntity = null;\r\n\r\n    // Read-only. If the character is supported, this will tell the ground normal. Otherwise\r\n    // will be a zero vector.\r\n    _groundNormal = new pc.Vec3();\r\n\r\n    // If the character is not supported, will be a zero vector.\r\n    _groundVelocity = new pc.Vec3();\r\n\r\n    // Ground state.\r\n    _state = pc.JOLT_GROUND_STATE_NOT_SUPPORTED;\r\n\r\n    // User data to be associated with a shape.\r\n    _userData = null;\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    get linearVelocity() {\r\n        return this._linearVelocity;\r\n    }\r\n\r\n    set linearVelocity(vel) {\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vel, `Invalid character linear velocity`, vel);\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CHAR_SET_LIN_VEL, this._index,\r\n            vel, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    get userData() {\r\n        return this._userData;\r\n    }\r\n\r\n    set userData(num) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(num, `Invalid user data value. Should be a number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this._userData = num;\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_USER_DATA, this._index,\r\n            num, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );        \r\n    }\r\n\r\n    setShape(shapeIndex = null, callback = null) {\r\n        const system = this.system;\r\n\r\n        system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CHAR_SET_SHAPE, this._index,\r\n            !!callback, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false,\r\n            shapeIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, true\r\n        );\r\n\r\n        if (callback) {\r\n            this._writeCallback(callback);\r\n        }\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        const ok = _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent.writeShapeData(cb, this, true /* force write rotation */);\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !ok) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Error creating a shape data.');\r\n            return false;\r\n        }\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._useMotionState, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._up, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._supportingVolume, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_PLANE, false);\r\n        cb.write(this._maxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._mass, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxStrength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shapeOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._backFaceMode, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._predictiveContactDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxCollisionIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._maxConstraintIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._minTimeRemaining, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._collisionTolerance, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._characterPadding, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxNumHits, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._hitReductionCosMaxAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._penetrationRecoverySpeed, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n\r\n    updateTransforms(cb, map) {\r\n        const entity = this.entity;\r\n\r\n        entity.setPosition(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        entity.setRotation(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        this._linearVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        const isSupported = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL);\r\n        this._isSupported = isSupported;\r\n        this._state = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT8);\r\n\r\n        if (isSupported && cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL)) {\r\n            const groundIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n            this._groundEntity = map.get(groundIndex) || null;\r\n            this._isSlopeTooSteep = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL);\r\n            this._groundVelocity.set(\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n            );\r\n            this._groundNormal.set(\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n            );\r\n        } else {\r\n            this._groundEntity = null;\r\n            this._groundNormal.set(0, 0, 0);\r\n            this._groundVelocity.set(0, 0, 0);\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        system.createCharacter(this);\r\n    }\r\n\r\n    _writeCallback(callback) {\r\n        if (callback) {\r\n            const system = this.system;\r\n            const callbackIndex = system.getCallbackIndex(callback);\r\n            system.addCommandArgs(callbackIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY2hhci9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTJDO0FBQ087QUFnQnhCO0FBQzJCO0FBQ3JEO0FBQ0EsNEJBQTRCLDBEQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLGFBQWEseURBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSw2Q0FBSyxRQUFRLDZDQUFLO0FBQzFCO0FBQ0EsWUFBWSw2REFBaUIsRUFBRSxnRUFBb0I7QUFDbkQsaUJBQWlCLDhEQUFrQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQixxQkFBcUIsNkNBQUssa0VBQWtFLEtBQUs7QUFDakc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZEQUFpQixFQUFFLDZEQUFpQjtBQUNoRCxpQkFBaUIsZ0VBQW9CO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2REFBaUIsRUFBRSw4REFBa0I7QUFDakQsd0JBQXdCLDZEQUFpQjtBQUN6Qyx3QkFBd0IsK0RBQW1CO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMERBQWM7QUFDakMsWUFBWSw2Q0FBSztBQUNqQixZQUFZLDZDQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QiwrREFBbUI7QUFDakQsdUNBQXVDLDZEQUFpQjtBQUN4RCwyQkFBMkIsOERBQWtCO0FBQzdDLHlDQUF5Qyw4REFBa0I7QUFDM0Qsc0NBQXNDLGdFQUFvQjtBQUMxRCw2QkFBNkIsZ0VBQW9CO0FBQ2pELG9DQUFvQyxnRUFBb0I7QUFDeEQsb0NBQW9DLDhEQUFrQjtBQUN0RCxxQ0FBcUMsOERBQWtCO0FBQ3ZELGtEQUFrRCxnRUFBb0I7QUFDdEUsK0NBQStDLCtEQUFtQjtBQUNsRSxnREFBZ0QsK0RBQW1CO0FBQ25FLHlDQUF5QyxnRUFBb0I7QUFDN0QsMkNBQTJDLGdFQUFvQjtBQUMvRCx5Q0FBeUMsZ0VBQW9CO0FBQzdELG1DQUFtQywrREFBbUI7QUFDdEQsZ0RBQWdELGdFQUFvQjtBQUNwRSxpREFBaUQsZ0VBQW9CO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw4REFBa0I7QUFDeEMsc0JBQXNCLDhEQUFrQjtBQUN4QztBQUNBLFFBQVEsNkNBQUssa0NBQWtDLDZEQUFpQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsK0RBQW1CO0FBQ3ZDLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QztBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsK0RBQW1CO0FBQ3ZDLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QyxvQkFBb0IsK0RBQW1CO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QyxvQkFBb0IsK0RBQW1CO0FBQ3ZDO0FBQ0E7QUFDQSxvQ0FBb0MsNERBQWdCO0FBQ3BEO0FBQ0EsOEJBQThCLDZEQUFpQjtBQUMvQztBQUNBLG1DQUFtQyw0REFBZ0I7QUFDbkQsd0NBQXdDLDhEQUFrQjtBQUMxRDtBQUNBLDRDQUE0Qyw0REFBZ0I7QUFDNUQ7QUFDQSx3QkFBd0IsK0RBQW1CO0FBQzNDLHdCQUF3QiwrREFBbUI7QUFDM0Msd0JBQXdCLCtEQUFtQjtBQUMzQztBQUNBO0FBQ0Esd0JBQXdCLCtEQUFtQjtBQUMzQyx3QkFBd0IsK0RBQW1CO0FBQzNDLHdCQUF3QiwrREFBbUI7QUFDM0M7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELCtEQUFtQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUN5QjtBQUN6QiIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2NoYXIvY29tcG9uZW50Lm1qcz82YjNlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBCVUZGRVJfUkVBRF9CT09MLCBCVUZGRVJfUkVBRF9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDgsXHJcbiAgICBCVUZGRVJfV1JJVEVfQk9PTCxcclxuICAgIEJVRkZFUl9XUklURV9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1BMQU5FLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UOCxcclxuICAgIEJVRkZFUl9XUklURV9WRUMzMixcclxuICAgIENNRF9DSEFSX1NFVF9MSU5fVkVMLFxyXG4gICAgQ01EX0NIQVJfU0VUX1NIQVBFLFxyXG4gICAgQ01EX1NFVF9VU0VSX0RBVEEsXHJcbiAgICBPUEVSQVRPUl9NT0RJRklFUixcclxuICAgIFNIQVBFX0NBUFNVTEVcclxufSBmcm9tIFwiLi4vY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuLi9zeXN0ZW0ubWpzXCI7XHJcblxyXG5jbGFzcyBDaGFyQ29tcG9uZW50IGV4dGVuZHMgU2hhcGVDb21wb25lbnQge1xyXG4gICAgLy8gLS0tLSBTSEFQRSBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gU2hhcGUgdHlwZVxyXG4gICAgX3NoYXBlID0gU0hBUEVfQ0FQU1VMRTtcclxuXHJcbiAgICAvLyAtLS0tIENIQVJBQ1RFUiBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gVmVjdG9yIGluZGljYXRpbmcgdGhlIHVwIGRpcmVjdGlvbiBvZiB0aGUgY2hhcmFjdGVyLlxyXG4gICAgX3VwID0gcGMuVmVjMy5VUDtcclxuXHJcbiAgICAvLyBFbmFibGVzL2Rpc2FibGVzIHRoZSB1c2Ugb2YgbW90aW9uIHN0YXRlIGZvciB0aGUgY2hhcmFjdGVyLlxyXG4gICAgX3VzZU1vdGlvblN0YXRlID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBDaGFyYWN0ZXIgbGluZWFyIHZlbG9jaXR5LiBNdXN0IGJlIHNldCBieSB1c2VyLiBCYWNrZW5kIHdpbGwgdXNlIGl0IHRvIGNhbGN1bGF0ZSBuZXh0XHJcbiAgICAvLyBwb3NpdGlvbi5cclxuICAgIF9saW5lYXJWZWxvY2l0eSA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG4gICAgLy8gUGxhbmUsIGRlZmluZWQgaW4gbG9jYWwgc3BhY2UgcmVsYXRpdmUgdG8gdGhlIGNoYXJhY3Rlci4gRXZlcnkgY29udGFjdCBcclxuICAgIC8vIGJlaGluZCB0aGlzIHBsYW5lIGNhbiBzdXBwb3J0IHRoZSBjaGFyYWN0ZXIsIGV2ZXJ5IGNvbnRhY3QgaW4gZnJvbnQgb2YgXHJcbiAgICAvLyB0aGlzIHBsYW5lIGlzIHRyZWF0ZWQgYXMgb25seSBjb2xsaWRpbmcgd2l0aCB0aGUgcGxheWVyLiBEZWZhdWx0OiBBY2NlcHRcclxuICAgIC8vIGFueSBjb250YWN0LlxyXG4gICAgX3N1cHBvcnRpbmdWb2x1bWUgPSBuZXcgcGMuUGxhbmUocGMuVmVjMy5VUCwgLTEpO1xyXG5cclxuICAgIC8vIE1heGltdW0gYW5nbGUgb2Ygc2xvcGUgdGhhdCBjaGFyYWN0ZXIgY2FuIHN0aWxsIHdhbGsgb24gKHJhZGlhbnMpLlxyXG4gICAgX21heFNsb3BlQW5nbGUgPSA0NSAqIHBjLm1hdGguREVHX1RPX1JBRDtcclxuXHJcbiAgICAvLyBDaGFyYWN0ZXIgbWFzcyAoa2cpLiBVc2VkIHRvIHB1c2ggZG93biBvYmplY3RzIHdpdGggZ3Jhdml0eSB3aGVuIHRoZSBcclxuICAgIC8vIGNoYXJhY3RlciBpcyBzdGFuZGluZyBvbiB0b3AuXHJcbiAgICBfbWFzcyA9IDcwO1xyXG5cclxuICAgIC8vIE1heGltdW0gZm9yY2Ugd2l0aCB3aGljaCB0aGUgY2hhcmFjdGVyIGNhbiBwdXNoIG90aGVyIGJvZGllcyAoTikuXHJcbiAgICBfbWF4U3RyZW5ndGggPSAxMDA7XHJcblxyXG4gICAgLy8gQW4gZXh0cmEgb2Zmc2V0IGFwcGxpZWQgdG8gdGhlIHNoYXBlIGluIGxvY2FsIHNwYWNlLlxyXG4gICAgX3NoYXBlT2Zmc2V0ID0gcGMuVmVjMy5aRVJPO1xyXG5cclxuICAgIC8vIFdoZW4gY29sbGlkaW5nIHdpdGggYmFjayBmYWNlcywgdGhlIGNoYXJhY3RlciB3aWxsIG5vdCBiZSBhYmxlIHRvIG1vdmUgdGhyb3VnaFxyXG4gICAgLy8gYmFjayBmYWNpbmcgdHJpYW5nbGVzLiBVc2UgdGhpcyBpZiB5b3UgaGF2ZSB0cmlhbmdsZXMgdGhhdCBuZWVkIHRvIGNvbGxpZGVcclxuICAgIC8vIG9uIGJvdGggc2lkZXMuXHJcbiAgICBfYmFja0ZhY2VNb2RlID0gcGMuSk9MVF9CRk1fQ09MTElERV9CQUNLX0ZBQ0VTO1xyXG5cclxuICAgIC8vIEhvdyBmYXIgdG8gc2NhbiBvdXRzaWRlIG9mIHRoZSBzaGFwZSBmb3IgcHJlZGljdGl2ZSBjb250YWN0cy4gQSB2YWx1ZSBvZiAwIHdpbGxcclxuICAgIC8vIG1vc3QgbGlrZWx5IGNhdXNlIHRoZSBjaGFyYWN0ZXIgdG8gZ2V0IHN0dWNrIGFzIGl0IGNhbm5vdCBwcm9wZXJseSBjYWxjdWxhdGUgYSBzbGlkaW5nXHJcbiAgICAvLyBkaXJlY3Rpb24gYW55bW9yZS4gQSB2YWx1ZSB0aGF0J3MgdG9vIGhpZ2ggd2lsbCBjYXVzZSBnaG9zdCBjb2xsaXNpb25zLlxyXG4gICAgX3ByZWRpY3RpdmVDb250YWN0RGlzdGFuY2UgPSAwLjE7XHJcblxyXG4gICAgLy8gTWF4IGFtb3VudCBvZiBjb2xsaXNpb24gbG9vcHNcclxuICAgIF9tYXhDb2xsaXNpb25JdGVyYXRpb25zID0gNTtcclxuXHJcbiAgICAvLyBIb3cgb2Z0ZW4gdG8gdHJ5IHN0ZXBwaW5nIGluIHRoZSBjb25zdHJhaW50IHNvbHZpbmcuXHJcbiAgICBfbWF4Q29uc3RyYWludEl0ZXJhdGlvbnMgPSAxNTtcclxuXHJcbiAgICAvLyBFYXJseSBvdXQgY29uZGl0aW9uOiBJZiB0aGlzIG11Y2ggdGltZSBpcyBsZWZ0IHRvIHNpbXVsYXRlIHdlIGFyZSBkb25lLlxyXG4gICAgX21pblRpbWVSZW1haW5pbmcgPSAxLjBlLTQ7XHJcblxyXG4gICAgLy8gSG93IGZhciB3ZSdyZSB3aWxsaW5nIHRvIHBlbmV0cmF0ZSBnZW9tZXRyeVxyXG4gICAgX2NvbGxpc2lvblRvbGVyYW5jZSA9IDEuMGUtMztcclxuXHJcbiAgICAvLyBIb3cgZmFyIHdlIHRyeSB0byBzdGF5IGF3YXkgZnJvbSB0aGUgZ2VvbWV0cnksIHRoaXMgZW5zdXJlcyB0aGF0IHRoZSBzd2VlcCB3aWxsXHJcbiAgICAvLyBoaXQgYXMgbGl0dGxlIGFzIHBvc3NpYmxlIGxvd2VyaW5nIHRoZSBjb2xsaXNpb24gY29zdCBhbmQgcmVkdWNpbmcgdGhlIHJpc2sgb2ZcclxuICAgIC8vIGdldHRpbmcgc3R1Y2suXHJcbiAgICBfY2hhcmFjdGVyUGFkZGluZyA9IDAuMDI7XHJcblxyXG4gICAgLy8gTWF4IG51bSBoaXRzIHRvIGNvbGxlY3QgaW4gb3JkZXIgdG8gYXZvaWQgZXhjZXNzIG9mIGNvbnRhY3QgcG9pbnRzIGNvbGxlY3Rpb24uXHJcbiAgICBfbWF4TnVtSGl0cyA9IDI1NjtcclxuXHJcbiAgICAvLyBDb3MoYW5nbGUpIHdoZXJlIGFuZ2xlIGlzIHRoZSBtYXhpbXVtIGFuZ2xlIGJldHdlZW4gdHdvIGhpdHMgY29udGFjdCBub3JtYWxzIHRoYXQgXHJcbiAgICAvLyBhcmUgYWxsb3dlZCB0byBiZSBtZXJnZWQgZHVyaW5nIGhpdCByZWR1Y3Rpb24uIERlZmF1bHQgaXMgYXJvdW5kIDIuNSBkZWdyZWVzLiBTZXQgXHJcbiAgICAvLyB0byAtMSB0byB0dXJuIG9mZi5cclxuICAgIF9oaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSA9IDAuOTk5O1xyXG5cclxuICAgIC8vIFRoaXMgdmFsdWUgZ292ZXJucyBob3cgZmFzdCBhIHBlbmV0cmF0aW9uIHdpbGwgYmUgcmVzb2x2ZWQsIDAgPSBub3RoaW5nIGlzIHJlc29sdmVkLFxyXG4gICAgLy8gMSA9IGV2ZXJ5dGhpbmcgaW4gb25lIHVwZGF0ZS5cclxuICAgIF9wZW5ldHJhdGlvblJlY292ZXJ5U3BlZWQgPSAxO1xyXG5cclxuICAgIC8vIFJlYWQtb25seS4gVHJ1ZSBpZiB0aGUgY2hhcmFjdGVyIGlzIHN1cHBvcnRlZCBieSBub3JtYWwgb3Igc3RlZXAgZ3JvdW5kLlxyXG4gICAgX2lzU3VwcG9ydGVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gUmVhZC1vbmx5LiBUcnVlIGlmIHRoZSBncm91bmQgaXMgdG9vIHN0ZWVwIHRvIHdhbGsgb24uXHJcbiAgICBfaXNTbG9wZVRvb1N0ZWVwID0gZmFsc2U7XHJcblxyXG4gICAgLy8gUmVhZC1vbmx5LiBJZiB0aGUgY2hhcmFjdGVyIGlzIHN1cHBvcnRlZCwgdGhpcyB3aWxsIHRlbGwgdGhlIGdyb3VuZCBlbnRpdHkuXHJcbiAgICBfZ3JvdW5kRW50aXR5ID0gbnVsbDtcclxuXHJcbiAgICAvLyBSZWFkLW9ubHkuIElmIHRoZSBjaGFyYWN0ZXIgaXMgc3VwcG9ydGVkLCB0aGlzIHdpbGwgdGVsbCB0aGUgZ3JvdW5kIG5vcm1hbC4gT3RoZXJ3aXNlXHJcbiAgICAvLyB3aWxsIGJlIGEgemVybyB2ZWN0b3IuXHJcbiAgICBfZ3JvdW5kTm9ybWFsID0gbmV3IHBjLlZlYzMoKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzIG5vdCBzdXBwb3J0ZWQsIHdpbGwgYmUgYSB6ZXJvIHZlY3Rvci5cclxuICAgIF9ncm91bmRWZWxvY2l0eSA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG4gICAgLy8gR3JvdW5kIHN0YXRlLlxyXG4gICAgX3N0YXRlID0gcGMuSk9MVF9HUk9VTkRfU1RBVEVfTk9UX1NVUFBPUlRFRDtcclxuXHJcbiAgICAvLyBVc2VyIGRhdGEgdG8gYmUgYXNzb2NpYXRlZCB3aXRoIGEgc2hhcGUuXHJcbiAgICBfdXNlckRhdGEgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBsaW5lYXJWZWxvY2l0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGluZWFyVmVsb2NpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGxpbmVhclZlbG9jaXR5KHZlbCkge1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1ZlYyh2ZWwsIGBJbnZhbGlkIGNoYXJhY3RlciBsaW5lYXIgdmVsb2NpdHlgLCB2ZWwpO1xyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQ0hBUl9TRVRfTElOX1ZFTCwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIHZlbCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVzZXJEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdXNlckRhdGEobnVtKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KG51bSwgYEludmFsaWQgdXNlciBkYXRhIHZhbHVlLiBTaG91bGQgYmUgYSBudW1iZXI6ICR7IG51bSB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91c2VyRGF0YSA9IG51bTtcclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9TRVRfVVNFUl9EQVRBLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgbnVtLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2VcclxuICAgICAgICApOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2hhcGUoc2hhcGVJbmRleCA9IG51bGwsIGNhbGxiYWNrID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuc3lzdGVtO1xyXG5cclxuICAgICAgICBzeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9DSEFSX1NFVF9TSEFQRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgICEhY2FsbGJhY2ssIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSxcclxuICAgICAgICAgICAgc2hhcGVJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLl93cml0ZUNhbGxiYWNrKGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVDb21wb25lbnREYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgb2sgPSBTaGFwZUNvbXBvbmVudC53cml0ZVNoYXBlRGF0YShjYiwgdGhpcywgdHJ1ZSAvKiBmb3JjZSB3cml0ZSByb3RhdGlvbiAqLyk7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhb2spIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignRXJyb3IgY3JlYXRpbmcgYSBzaGFwZSBkYXRhLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9pbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VzZU1vdGlvblN0YXRlLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VwLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zdXBwb3J0aW5nVm9sdW1lLCBCVUZGRVJfV1JJVEVfUExBTkUsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhTbG9wZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21hc3MsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4U3RyZW5ndGgsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fc2hhcGVPZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2JhY2tGYWNlTW9kZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fcHJlZGljdGl2ZUNvbnRhY3REaXN0YW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhDb2xsaXNpb25JdGVyYXRpb25zLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4Q29uc3RyYWludEl0ZXJhdGlvbnMsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9taW5UaW1lUmVtYWluaW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2NvbGxpc2lvblRvbGVyYW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9jaGFyYWN0ZXJQYWRkaW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heE51bUhpdHMsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9oaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9wZW5ldHJhdGlvblJlY292ZXJ5U3BlZWQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG4gICAgICAgIGNvbnN0IHBvcyA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IHJvdCA9IGVudGl0eS5nZXRSb3RhdGlvbigpO1xyXG5cclxuICAgICAgICAvLyBMb3NzIG9mIHByZWNpc2lvbiBmb3IgcG9zL3JvdCAoNjQgLT4gMzIpXHJcbiAgICAgICAgY2Iud3JpdGUocG9zLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShyb3QsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgY2Iud3JpdGUodGhpcy5fZGVidWdEcmF3LCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVRyYW5zZm9ybXMoY2IsIG1hcCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0UG9zaXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0Um90YXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICB0aGlzLl9saW5lYXJWZWxvY2l0eS5zZXQoXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBpc1N1cHBvcnRlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgdGhpcy5faXNTdXBwb3J0ZWQgPSBpc1N1cHBvcnRlZDtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG5cclxuICAgICAgICBpZiAoaXNTdXBwb3J0ZWQgJiYgY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICBjb25zdCBncm91bmRJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgdGhpcy5fZ3JvdW5kRW50aXR5ID0gbWFwLmdldChncm91bmRJbmRleCkgfHwgbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5faXNTbG9wZVRvb1N0ZWVwID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgdGhpcy5fZ3JvdW5kVmVsb2NpdHkuc2V0KFxyXG4gICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyb3VuZE5vcm1hbC5zZXQoXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmRFbnRpdHkgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmROb3JtYWwuc2V0KDAsIDAsIDApO1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmRWZWxvY2l0eS5zZXQoMCwgMCwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRW5hYmxlKCkge1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuc3lzdGVtO1xyXG5cclxuICAgICAgICB0aGlzLl9pbmRleCA9IHN5c3RlbS5nZXRJbmRleCh0aGlzLmVudGl0eSk7XHJcblxyXG4gICAgICAgIHN5c3RlbS5jcmVhdGVDaGFyYWN0ZXIodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5zeXN0ZW07XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrSW5kZXggPSBzeXN0ZW0uZ2V0Q2FsbGJhY2tJbmRleChjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIHN5c3RlbS5hZGRDb21tYW5kQXJncyhjYWxsYmFja0luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBDaGFyQ29tcG9uZW50IH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/char/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/char/system.mjs":
/*!*****************************************************!*\
  !*** ./src/physics/components/jolt/char/system.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CharComponentSystem: () => (/* binding */ CharComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/char/component.mjs\");\n/* harmony import */ var _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../response-handler.mjs */ \"./src/physics/components/jolt/response-handler.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Jolt virtual character\r\n    'up',\r\n    'supportingVolume',\r\n    'maxSlopeAngle',\r\n    'mass',\r\n    'maxStrength',\r\n    'shapeOffset',\r\n    'backFaceMode',\r\n    'predictiveContactDistance',\r\n    'maxCollisionIterations',\r\n    'maxConstraintIterations',\r\n    'minTimeRemaining',\r\n    'collisionTolerance',\r\n    'characterPadding',\r\n    'maxNumHits',\r\n    'hitReductionCosMaxAngle',\r\n    'penetrationRecoverySpeed',\r\n    'isSupported',\r\n    'isSlopeTooSteep',\r\n    'groundEntity',\r\n    'groundNormal',\r\n    'groundVelocity',\r\n    'state'\r\n];\r\n\r\nclass CharComponentSystem extends _system_mjs__WEBPACK_IMPORTED_MODULE_6__.ShapeComponentSystem {\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'char';\r\n        this.schema = [...this.schema, ...schema];\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_4__.CharComponent;\r\n\r\n        this._queryMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_3__.IndexedCache();\r\n\r\n        this._exposeConstants();\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    getCallbackIndex(callback) {\r\n        return this._manager.queryMap.add(callback);\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.verifyProperties(data, this.schema);\r\n            if (!ok) return;\r\n        }\r\n\r\n        super.initializeComponentData(component, data);\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_UPDATE_TRANSFORMS:\r\n                this._updateCharTransforms(cb);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_CONTACTS:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__.ResponseHandler.handleCharContacts(cb, this.entityMap);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_SET_SHAPE:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__.ResponseHandler.handleCharSetShape(cb, this._manager.queryMap);\r\n                break;\r\n        }\r\n    }\r\n\r\n    createCharacter(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_CHAR);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n\r\n    overrideContacts(callbacks = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            !!callbacks.OnAdjustBodyVelocity && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnAdjustBodyVelocity === 'function', 'OnAdjustBodyVelocity must be a function', callbacks);\r\n            !!callbacks.OnContactValidate && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactValidate === 'function', 'OnContactValidate must be a function', callbacks);\r\n            !!callbacks.OnContactAdded && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactAdded === 'function', 'OnContactAdded must be a function', callbacks);\r\n            !!callbacks.OnContactSolve && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactSolve === 'function', 'OnContactSolve must be a function', callbacks);\r\n        }\r\n\r\n        const overrides = Object.create(null);\r\n        if (callbacks.OnAdjustBodyVelocity) {\r\n            overrides.OnAdjustBodyVelocity = new String(callbacks.OnAdjustBodyVelocity);\r\n        }\r\n        if (callbacks.OnContactValidate) {\r\n            overrides.OnContactValidate = new String(callbacks.OnContactValidate);\r\n        }\r\n        if (callbacks.OnContactAdded) {\r\n            overrides.OnContactAdded = new String(callbacks.OnContactAdded);\r\n        }\r\n        if (callbacks.OnContactSolve) {\r\n            overrides.OnContactSolve = new String(callbacks.OnContactSolve);\r\n        }\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'override-contacts';\r\n        msg.listener = 'char';\r\n        msg.overrides = overrides;\r\n        this._manager.sendUncompressed(msg);\r\n    }\r\n\r\n    _exposeConstants() { }\r\n\r\n    _updateCharTransforms(cb) {\r\n        const charsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n\r\n        for (let i = 0; i < charsCount; i++) {\r\n            const index = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n\r\n            const entity = this.entityMap.get(index);\r\n            if (!entity) continue;\r\n\r\n            entity.char.updateTransforms(cb, this.entityMap);\r\n        }\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY2hhci9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQW1EO0FBQ1I7QUFDdUk7QUFDeEg7QUFDVjtBQUNVO0FBQ0w7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDZEQUFvQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHlEQUFhO0FBQzFDO0FBQ0EsNkJBQTZCLDREQUFZO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHlEQUFjO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQix1QkFBdUIsNkNBQUs7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsaUVBQXFCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiwrREFBbUI7QUFDcEMsZ0JBQWdCLGtFQUFlO0FBQy9CO0FBQ0E7QUFDQSxpQkFBaUIsZ0VBQW9CO0FBQ3JDLGdCQUFnQixrRUFBZTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qiw0REFBZ0I7QUFDekMsd0JBQXdCLDJEQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DLFlBQVksNkNBQUs7QUFDakIsZ0RBQWdELDZDQUFLO0FBQ3JELDZDQUE2Qyw2Q0FBSztBQUNsRCwwQ0FBMEMsNkNBQUs7QUFDL0MsMENBQTBDLDZDQUFLO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsOERBQWtCO0FBQ3JEO0FBQ0Esd0JBQXdCLGdCQUFnQjtBQUN4QyxrQ0FBa0MsOERBQWtCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2NoYXIvc3lzdGVtLm1qcz9kYjFmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWwubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCVUZGRVJfUkVBRF9VSU5UMzIsIENNRF9DUkVBVEVfQ0hBUiwgQ01EX1JFUE9SVF9DT05UQUNUUywgQ01EX1JFUE9SVF9TRVRfU0hBUEUsIENNRF9VUERBVEVfVFJBTlNGT1JNUywgQ09NUE9ORU5UX1NZU1RFTV9DSEFSLCBPUEVSQVRPUl9DUkVBVE9SIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuaW1wb3J0IHsgSW5kZXhlZENhY2hlIH0gZnJvbSBcIi4uLy4uLy4uL2luZGV4ZWQtY2FjaGUubWpzXCI7XHJcbmltcG9ydCB7IENoYXJDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlSGFuZGxlciB9IGZyb20gXCIuLi9yZXNwb25zZS1oYW5kbGVyLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuLi9zeXN0ZW0ubWpzXCI7XHJcblxyXG5jb25zdCBzY2hlbWEgPSBbXHJcbiAgICAvLyBKb2x0IHZpcnR1YWwgY2hhcmFjdGVyXHJcbiAgICAndXAnLFxyXG4gICAgJ3N1cHBvcnRpbmdWb2x1bWUnLFxyXG4gICAgJ21heFNsb3BlQW5nbGUnLFxyXG4gICAgJ21hc3MnLFxyXG4gICAgJ21heFN0cmVuZ3RoJyxcclxuICAgICdzaGFwZU9mZnNldCcsXHJcbiAgICAnYmFja0ZhY2VNb2RlJyxcclxuICAgICdwcmVkaWN0aXZlQ29udGFjdERpc3RhbmNlJyxcclxuICAgICdtYXhDb2xsaXNpb25JdGVyYXRpb25zJyxcclxuICAgICdtYXhDb25zdHJhaW50SXRlcmF0aW9ucycsXHJcbiAgICAnbWluVGltZVJlbWFpbmluZycsXHJcbiAgICAnY29sbGlzaW9uVG9sZXJhbmNlJyxcclxuICAgICdjaGFyYWN0ZXJQYWRkaW5nJyxcclxuICAgICdtYXhOdW1IaXRzJyxcclxuICAgICdoaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZScsXHJcbiAgICAncGVuZXRyYXRpb25SZWNvdmVyeVNwZWVkJyxcclxuICAgICdpc1N1cHBvcnRlZCcsXHJcbiAgICAnaXNTbG9wZVRvb1N0ZWVwJyxcclxuICAgICdncm91bmRFbnRpdHknLFxyXG4gICAgJ2dyb3VuZE5vcm1hbCcsXHJcbiAgICAnZ3JvdW5kVmVsb2NpdHknLFxyXG4gICAgJ3N0YXRlJ1xyXG5dO1xyXG5cclxuY2xhc3MgQ2hhckNvbXBvbmVudFN5c3RlbSBleHRlbmRzIFNoYXBlQ29tcG9uZW50U3lzdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKGFwcCwgbWFuYWdlciwgaWQpIHtcclxuICAgICAgICBzdXBlcihhcHAsIG1hbmFnZXIpO1xyXG5cclxuICAgICAgICB0aGlzLmlkID0gJ2NoYXInO1xyXG4gICAgICAgIHRoaXMuc2NoZW1hID0gWy4uLnRoaXMuc2NoZW1hLCAuLi5zY2hlbWFdO1xyXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IENoYXJDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIHRoaXMuX3F1ZXJ5TWFwID0gbmV3IEluZGV4ZWRDYWNoZSgpO1xyXG5cclxuICAgICAgICB0aGlzLl9leHBvc2VDb25zdGFudHMoKTtcclxuXHJcbiAgICAgICAgbWFuYWdlci5zeXN0ZW1zLnNldChpZCwgdGhpcyk7XHJcblxyXG4gICAgICAgIGJ1aWxkQWNjZXNzb3JzKHRoaXMsIHRoaXMuc2NoZW1hKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDYWxsYmFja0luZGV4KGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21hbmFnZXIucXVlcnlNYXAuYWRkKGNhbGxiYWNrKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcudmVyaWZ5UHJvcGVydGllcyhkYXRhLCB0aGlzLnNjaGVtYSk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN1cGVyLmluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvY2Vzc0NvbW1hbmRzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IGNiLnJlYWRDb21tYW5kKCk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICBjYXNlIENNRF9VUERBVEVfVFJBTlNGT1JNUzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUNoYXJUcmFuc2Zvcm1zKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfUkVQT1JUX0NPTlRBQ1RTOlxyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VIYW5kbGVyLmhhbmRsZUNoYXJDb250YWN0cyhjYiwgdGhpcy5lbnRpdHlNYXApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9SRVBPUlRfU0VUX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VIYW5kbGVyLmhhbmRsZUNoYXJTZXRTaGFwZShjYiwgdGhpcy5fbWFuYWdlci5xdWVyeU1hcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ2hhcmFjdGVyKGNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fbWFuYWdlci5jb21tYW5kc0J1ZmZlcjtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9DSEFSKTtcclxuXHJcbiAgICAgICAgY29tcG9uZW50LndyaXRlQ29tcG9uZW50RGF0YShjYik7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGVDb250YWN0cyhjYWxsYmFja3MgPSB7fSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgISFjYWxsYmFja3MuT25BZGp1c3RCb2R5VmVsb2NpdHkgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25BZGp1c3RCb2R5VmVsb2NpdHkgPT09ICdmdW5jdGlvbicsICdPbkFkanVzdEJvZHlWZWxvY2l0eSBtdXN0IGJlIGEgZnVuY3Rpb24nLCBjYWxsYmFja3MpO1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSAmJiBEZWJ1Zy5hc3NlcnQodHlwZW9mIGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSA9PT0gJ2Z1bmN0aW9uJywgJ09uQ29udGFjdFZhbGlkYXRlIG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgICAgICEhY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkID09PSAnZnVuY3Rpb24nLCAnT25Db250YWN0QWRkZWQgbXVzdCBiZSBhIGZ1bmN0aW9uJywgY2FsbGJhY2tzKTtcclxuICAgICAgICAgICAgISFjYWxsYmFja3MuT25Db250YWN0U29sdmUgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25Db250YWN0U29sdmUgPT09ICdmdW5jdGlvbicsICdPbkNvbnRhY3RTb2x2ZSBtdXN0IGJlIGEgZnVuY3Rpb24nLCBjYWxsYmFja3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb3ZlcnJpZGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICBpZiAoY2FsbGJhY2tzLk9uQWRqdXN0Qm9keVZlbG9jaXR5KSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlcy5PbkFkanVzdEJvZHlWZWxvY2l0eSA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQWRqdXN0Qm9keVZlbG9jaXR5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgICBvdmVycmlkZXMuT25Db250YWN0VmFsaWRhdGUgPSBuZXcgU3RyaW5nKGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25Db250YWN0QWRkZWQpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQ29udGFjdEFkZGVkID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0QWRkZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2FsbGJhY2tzLk9uQ29udGFjdFNvbHZlKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlcy5PbkNvbnRhY3RTb2x2ZSA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQ29udGFjdFNvbHZlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1zZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgbXNnLnR5cGUgPSAnb3ZlcnJpZGUtY29udGFjdHMnO1xyXG4gICAgICAgIG1zZy5saXN0ZW5lciA9ICdjaGFyJztcclxuICAgICAgICBtc2cub3ZlcnJpZGVzID0gb3ZlcnJpZGVzO1xyXG4gICAgICAgIHRoaXMuX21hbmFnZXIuc2VuZFVuY29tcHJlc3NlZChtc2cpO1xyXG4gICAgfVxyXG5cclxuICAgIF9leHBvc2VDb25zdGFudHMoKSB7IH1cclxuXHJcbiAgICBfdXBkYXRlQ2hhclRyYW5zZm9ybXMoY2IpIHtcclxuICAgICAgICBjb25zdCBjaGFyc0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYXJzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5TWFwLmdldChpbmRleCk7XHJcbiAgICAgICAgICAgIGlmICghZW50aXR5KSBjb250aW51ZTtcclxuXHJcbiAgICAgICAgICAgIGVudGl0eS5jaGFyLnVwZGF0ZVRyYW5zZm9ybXMoY2IsIHRoaXMuZW50aXR5TWFwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IENoYXJDb21wb25lbnRTeXN0ZW0gfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/char/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/component.mjs":
/*!***************************************************!*\
  !*** ./src/physics/components/jolt/component.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ShapeComponent: () => (/* binding */ ShapeComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nconst quat = new pc.Quat();\r\n\r\nclass ShapeComponent extends pc.EventHandler {\r\n\r\n    // ---- COMPONENT PROPS ----\r\n\r\n    // Shape type\r\n    _shape = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_BOX;\r\n\r\n    // Enable / disable component\r\n    _enabled = true;\r\n\r\n    // Automatically moves dynamic bodies, when the position is set on entity.\r\n    _trackDynamic = true;\r\n\r\n    // Unique body index. This can change during entity lifecycle, e.g. every time entity is enabled, a new\r\n    // index is assigned and a new body is created. The index is used to map entity to body. Indices can be reused.\r\n    _index = -1;\r\n\r\n    // Render asset ID, used for mesh or convex hulls.\r\n    _renderAsset = null;\r\n\r\n    // Meshes used for mesh or convex hulls\r\n    _meshes = null;\r\n\r\n    // Tells if the component describes a compound child\r\n    _isCompoundChild = false;\r\n\r\n    // Applies entity scale on the shape\r\n    _useEntityScale = true;\r\n\r\n    // Read-only. Constraint indices applied on this body.\r\n    _constraints = new Map();    \r\n\r\n    // Debug draw\r\n    _debugDraw = false;\r\n\r\n    // ---- SHAPE PROPS ----\r\n\r\n    // Half extents for a box shape\r\n    _halfExtent = new pc.Vec3(0.5, 0.5, 0.5);\r\n\r\n    // Raidus for radius based shapes\r\n    _radius = 0.5;\r\n\r\n    // Internally the convex radius will be subtracted from the half extent so the total box will not grow with the convex radius\r\n    _convexRadius = 0.05;\r\n\r\n    // Half height of radius based shapes, e.g. cylinder, capsule\r\n    _halfHeight = 0.5;\r\n\r\n    // Density of the object in kg / m^3\r\n    _density = 1000;\r\n\r\n    // Shape local position offset\r\n    _shapePosition = pc.Vec3.ZERO;\r\n\r\n    // Shape local rotation offset\r\n    _shapeRotation = pc.Vec3.ZERO;\r\n\r\n    // Offset center of mass in local space of the body. Does not move the shape.\r\n    _massOffset = pc.Vec3.ZERO;\r\n\r\n    _hfSamples = null;\r\n\r\n    _hfSampleCount = 0;\r\n\r\n    // The HeightField is divided in blocks of hfBlockSize * hfBlockSize * 2 triangles and the\r\n    // acceleration structure culls blocks only, bigger block sizes reduce memory consumption\r\n    // but also reduce query performance. Sensible values are [2, 8], does not need to be a\r\n    // power of 2. Note that at run-time Jolt performs one more grid subdivision, so the effective\r\n    // block size is half of what is provided here.\r\n    _hfBlockSize = 2;\r\n\r\n    // How many bits per sample to use to compress the HeightField. Can be in the range [1, 8].\r\n    // Note that each sample is compressed relative to the min/max value of its block of\r\n    // hfBlockSize * hfBlockSize pixels so the effective precision is higher. Also note that\r\n    // increasing hfBlockSize saves more memory than reducing the amount of bits per sample.\r\n    _hfBitsPerSample = 8;\r\n\r\n    // Cosine of the threshold angle (if the angle between the two triangles in HeightField is\r\n    // bigger than this, the edge is active, note that a concave edge is always inactive). Setting\r\n    // this value too small can cause ghost collisions with edges, setting it too big can cause\r\n    // depenetration artifacts (objects not depenetrating quickly). Valid ranges are between\r\n    // cos(0 degrees) and cos(90 degrees). The default value is cos(5 degrees).\r\n    _hfActiveEdgeCosThresholdAngle = 0.996195;\r\n\r\n    _hfScale = pc.Vec3.ONE;\r\n\r\n    // The height field is a surface defined by: hfOffset + hfScale * (x, hfHeightSamples[y * hfSampleCount + x], y).\r\n    // where x and y are integers in the range x and y e [0, hfSampleCount - 1].\r\n    _hfOffset = pc.Vec3.ZERO;\r\n\r\n    // The ComponentSystem used to create this Component.\r\n    system;\r\n\r\n    // The Entity that this Component is attached to.\r\n    entity;\r\n\r\n    constructor(system, entity) {\r\n        super();\r\n\r\n        this.system = system;\r\n        this.entity = entity;\r\n\r\n        if (system.schema && !this._accessorsBuilt) {\r\n            (0,_util_mjs__WEBPACK_IMPORTED_MODULE_1__.buildAccessors)(this, system.schema);\r\n        }\r\n\r\n        this.on('set', function (name, oldValue, newValue) {\r\n            this.fire('set_' + name, name, oldValue, newValue);\r\n        });\r\n\r\n        this.on('set_enabled', this.onSetEnabled, this);\r\n    }\r\n\r\n\r\n    get constraints() {\r\n        return this._constraints;\r\n    }\r\n    \r\n    onSetEnabled(name, oldValue, newValue) {\r\n        if (oldValue !== newValue) {\r\n            if (this.entity.enabled) {\r\n                if (newValue) {\r\n                    this.onEnable();\r\n                } else {\r\n                    this.onDisable();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onEnable() {}\r\n\r\n    onDisable() {\r\n        const constraints = this._constraints;\r\n\r\n        constraints.forEach((entity2, index) => {\r\n            entity2?.body?.constraints.delete(index);\r\n            this.system.freeConstraintIndex(index);\r\n        });\r\n        constraints.clear();\r\n    }\r\n\r\n    onPostStateChange() {}\r\n\r\n    static writeShapeData(cb, props, forceWriteRotation = false) {\r\n        const shape = props.shape;\r\n        cb.write(shape, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n    \r\n        let useEntityScale = props.useEntityScale;\r\n        let scale;\r\n        if (useEntityScale) {\r\n            scale = props.scale || props.entity.getLocalScale();\r\n            if (scale.x === 1 && scale.y === 1 && scale.z === 1) {\r\n                useEntityScale = false;\r\n            }\r\n        }\r\n\r\n        cb.write(useEntityScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (useEntityScale || (\r\n            shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH ||\r\n            shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL)) {\r\n            // Potential precision loss 64 -> 32\r\n            cb.write(scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    \r\n        let ok = true;\r\n        switch (shape) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_BOX:\r\n                cb.write(props.halfExtent, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CAPSULE:\r\n                cb.write(props.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CYLINDER:\r\n                cb.write(props.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_SPHERE:\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_STATIC_COMPOUND:\r\n                ok = ShapeComponent.addCompoundChildren(cb, props.entity);\r\n                break;\r\n    \r\n            // intentional fall-through\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL:\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH:\r\n                ShapeComponent.addMeshes(props.meshes, cb);\r\n                break;\r\n            \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_HEIGHTFIELD:\r\n                cb.write(props.hfOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.hfScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.hfSampleCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n                cb.write(props.hfBlockSize, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                cb.write(props.hfBitsPerSample, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                cb.write(props.hfActiveEdgeCosThresholdAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.addBuffer(props.hfSamples.buffer);\r\n                break;\r\n    \r\n            default:\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Unsupperted shape type', shape);\r\n                return false;\r\n        }\r\n    \r\n        const isCompoundChild = props.isCompoundChild;\r\n        cb.write(isCompoundChild, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (!isCompoundChild) {\r\n            cb.write(props.density, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    \r\n        const position = props.shapePosition;\r\n        const rotation = props.shapeRotation;\r\n        const massOffset = props.massOffset;\r\n        const hasPositionOffset = !position.equals(pc.Vec3.ZERO);\r\n        const hasRotationOffset = forceWriteRotation || !rotation.equals(pc.Vec3.ZERO);\r\n        const hasShapeOffset = hasPositionOffset || hasRotationOffset;\r\n        const hasMassOffset = !massOffset.equals(pc.Vec3.ZERO);\r\n\r\n        cb.write(hasShapeOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (hasShapeOffset) {\r\n            quat.setFromEulerAngles(rotation);\r\n            cb.write(position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            cb.write(quat, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        cb.write(hasMassOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (hasMassOffset) {\r\n            cb.write(massOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    static addCompoundChildren(cb, parent) {\r\n        const components = parent.findComponents('body');\r\n        const count = components.length;\r\n        const childrenCount = count - 1; // -1 to exclude the parent\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && childrenCount === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Trying to create a static (immutable) compound body without children shapes. Aborting.');\r\n            return false;\r\n        }\r\n\r\n        cb.write(childrenCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const component = components[i];\r\n            if (component.entity === parent) {\r\n                continue;\r\n            }\r\n\r\n            const ok = ShapeComponent.writeShapeData(cb, component);\r\n            if (!ok) {\r\n                return false;\r\n            }\r\n\r\n            const entity = component.entity;\r\n            const pos = entity.getLocalPosition();\r\n            const rot = entity.getLocalRotation();\r\n\r\n            // Loss of precision for pos/rot (64 -> 32)\r\n            cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static addMeshes(meshes, cb) {\r\n        for (let i = 0; i < meshes.length; i++) {\r\n            const mesh = meshes[i];\r\n            const vb = mesh.vertexBuffer;\r\n            const ib = mesh.indexBuffer[0];\r\n            const format = vb.getFormat();\r\n\r\n            for (let i = 0; i < format.elements.length; i++) {\r\n                const element = format.elements[i];\r\n                if (element.name === pc.SEMANTIC_POSITION) {\r\n                    cb.write(mesh.primitive[0].base, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                    cb.write(element.offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n                    cb.write(element.stride / _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.FLOAT32_SIZE, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                    cb.addBuffer(vb.storage);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            cb.write(vb.numVertices, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(ib.numIndices, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // TODO\r\n            // workaround until this is fixed:\r\n            // https://github.com/playcanvas/engine/issues/5869\r\n            // buffer.addBuffer(ib.storage);\r\n\r\n            const storage = ib.storage;\r\n            const isView = ArrayBuffer.isView(storage);\r\n\r\n            let byteLength, byteOffset;\r\n            if (isView) {\r\n                byteLength = storage.byteLength;\r\n                byteOffset = storage.byteOffset;\r\n            } else {\r\n                byteLength = storage.byteLength / ib.bytesPerIndex;\r\n                byteOffset = 0;\r\n            }\r\n\r\n            cb.write(byteLength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(byteOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.addBuffer(isView ? storage.buffer : storage);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29tcG9uZW50Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXdDO0FBQ1E7QUFnQnZCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLHFEQUFTO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHlEQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qiw4REFBa0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsNkRBQWlCO0FBQ2xEO0FBQ0Esc0JBQXNCLHNEQUFVO0FBQ2hDLHNCQUFzQiw2REFBaUI7QUFDdkM7QUFDQSw0QkFBNEIsOERBQWtCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHFEQUFTO0FBQzFCLDJDQUEyQyw4REFBa0I7QUFDN0QsNkNBQTZDLGdFQUFvQjtBQUNqRTtBQUNBO0FBQ0EsaUJBQWlCLHlEQUFhO0FBQzlCLDJDQUEyQyxnRUFBb0I7QUFDL0QsdUNBQXVDLGdFQUFvQjtBQUMzRDtBQUNBO0FBQ0EsaUJBQWlCLDBEQUFjO0FBQy9CLDJDQUEyQyxnRUFBb0I7QUFDL0QsdUNBQXVDLGdFQUFvQjtBQUMzRCw2Q0FBNkMsZ0VBQW9CO0FBQ2pFO0FBQ0E7QUFDQSxpQkFBaUIsd0RBQVk7QUFDN0IsdUNBQXVDLGdFQUFvQjtBQUMzRDtBQUNBO0FBQ0EsaUJBQWlCLGlFQUFxQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw2REFBaUI7QUFDbEMsaUJBQWlCLHNEQUFVO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw2REFBaUI7QUFDbEMseUNBQXlDLDhEQUFrQjtBQUMzRCx3Q0FBd0MsOERBQWtCO0FBQzFELDhDQUE4QywrREFBbUI7QUFDakUsNENBQTRDLDhEQUFrQjtBQUM5RCxnREFBZ0QsOERBQWtCO0FBQ2xFLDhEQUE4RCxnRUFBb0I7QUFDbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkNBQUssUUFBUSw2Q0FBSztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyw2REFBaUI7QUFDbkQ7QUFDQSxvQ0FBb0MsZ0VBQW9CO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDZEQUFpQjtBQUNsRDtBQUNBO0FBQ0EsK0JBQStCLDhEQUFrQjtBQUNqRCwyQkFBMkIsOERBQWtCO0FBQzdDO0FBQ0E7QUFDQSxnQ0FBZ0MsNkRBQWlCO0FBQ2pEO0FBQ0EsaUNBQWlDLDhEQUFrQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQixZQUFZLDZDQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywrREFBbUI7QUFDbkQ7QUFDQSx3QkFBd0IsV0FBVztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsOERBQWtCO0FBQzVDLDBCQUEwQiw4REFBa0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG1CQUFtQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDRCQUE0QjtBQUN4RDtBQUNBO0FBQ0EscURBQXFELDhEQUFrQjtBQUN2RSw2Q0FBNkMsK0RBQW1CO0FBQ2hFLDhDQUE4Qyx3REFBWSxFQUFFLDhEQUFrQjtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLCtEQUFtQjtBQUN4RCxvQ0FBb0MsK0RBQW1CO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLCtEQUFtQjtBQUNwRCxpQ0FBaUMsK0RBQW1CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDMEI7QUFDMUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb21wb25lbnQubWpzP2VmMWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi4vLi4vZGVidWcubWpzXCI7XHJcbmltcG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH0gZnJvbSBcIi4uLy4uL3V0aWwubWpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBCVUZGRVJfV1JJVEVfQk9PTCxcclxuICAgIEJVRkZFUl9XUklURV9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UOCxcclxuICAgIEJVRkZFUl9XUklURV9WRUMzMixcclxuICAgIEZMT0FUMzJfU0laRSxcclxuICAgIFNIQVBFX0JPWCxcclxuICAgIFNIQVBFX0NBUFNVTEUsXHJcbiAgICBTSEFQRV9DT05WRVhfSFVMTCxcclxuICAgIFNIQVBFX0NZTElOREVSLFxyXG4gICAgU0hBUEVfSEVJR0hURklFTEQsXHJcbiAgICBTSEFQRV9NRVNILFxyXG4gICAgU0hBUEVfU1BIRVJFLFxyXG4gICAgU0hBUEVfU1RBVElDX0NPTVBPVU5EXHJcbn0gZnJvbSBcIi4vY29uc3RhbnRzLm1qc1wiO1xyXG5cclxuY29uc3QgcXVhdCA9IG5ldyBwYy5RdWF0KCk7XHJcblxyXG5jbGFzcyBTaGFwZUNvbXBvbmVudCBleHRlbmRzIHBjLkV2ZW50SGFuZGxlciB7XHJcblxyXG4gICAgLy8gLS0tLSBDT01QT05FTlQgUFJPUFMgLS0tLVxyXG5cclxuICAgIC8vIFNoYXBlIHR5cGVcclxuICAgIF9zaGFwZSA9IFNIQVBFX0JPWDtcclxuXHJcbiAgICAvLyBFbmFibGUgLyBkaXNhYmxlIGNvbXBvbmVudFxyXG4gICAgX2VuYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgIC8vIEF1dG9tYXRpY2FsbHkgbW92ZXMgZHluYW1pYyBib2RpZXMsIHdoZW4gdGhlIHBvc2l0aW9uIGlzIHNldCBvbiBlbnRpdHkuXHJcbiAgICBfdHJhY2tEeW5hbWljID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBVbmlxdWUgYm9keSBpbmRleC4gVGhpcyBjYW4gY2hhbmdlIGR1cmluZyBlbnRpdHkgbGlmZWN5Y2xlLCBlLmcuIGV2ZXJ5IHRpbWUgZW50aXR5IGlzIGVuYWJsZWQsIGEgbmV3XHJcbiAgICAvLyBpbmRleCBpcyBhc3NpZ25lZCBhbmQgYSBuZXcgYm9keSBpcyBjcmVhdGVkLiBUaGUgaW5kZXggaXMgdXNlZCB0byBtYXAgZW50aXR5IHRvIGJvZHkuIEluZGljZXMgY2FuIGJlIHJldXNlZC5cclxuICAgIF9pbmRleCA9IC0xO1xyXG5cclxuICAgIC8vIFJlbmRlciBhc3NldCBJRCwgdXNlZCBmb3IgbWVzaCBvciBjb252ZXggaHVsbHMuXHJcbiAgICBfcmVuZGVyQXNzZXQgPSBudWxsO1xyXG5cclxuICAgIC8vIE1lc2hlcyB1c2VkIGZvciBtZXNoIG9yIGNvbnZleCBodWxsc1xyXG4gICAgX21lc2hlcyA9IG51bGw7XHJcblxyXG4gICAgLy8gVGVsbHMgaWYgdGhlIGNvbXBvbmVudCBkZXNjcmliZXMgYSBjb21wb3VuZCBjaGlsZFxyXG4gICAgX2lzQ29tcG91bmRDaGlsZCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIEFwcGxpZXMgZW50aXR5IHNjYWxlIG9uIHRoZSBzaGFwZVxyXG4gICAgX3VzZUVudGl0eVNjYWxlID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBSZWFkLW9ubHkuIENvbnN0cmFpbnQgaW5kaWNlcyBhcHBsaWVkIG9uIHRoaXMgYm9keS5cclxuICAgIF9jb25zdHJhaW50cyA9IG5ldyBNYXAoKTsgICAgXHJcblxyXG4gICAgLy8gRGVidWcgZHJhd1xyXG4gICAgX2RlYnVnRHJhdyA9IGZhbHNlO1xyXG5cclxuICAgIC8vIC0tLS0gU0hBUEUgUFJPUFMgLS0tLVxyXG5cclxuICAgIC8vIEhhbGYgZXh0ZW50cyBmb3IgYSBib3ggc2hhcGVcclxuICAgIF9oYWxmRXh0ZW50ID0gbmV3IHBjLlZlYzMoMC41LCAwLjUsIDAuNSk7XHJcblxyXG4gICAgLy8gUmFpZHVzIGZvciByYWRpdXMgYmFzZWQgc2hhcGVzXHJcbiAgICBfcmFkaXVzID0gMC41O1xyXG5cclxuICAgIC8vIEludGVybmFsbHkgdGhlIGNvbnZleCByYWRpdXMgd2lsbCBiZSBzdWJ0cmFjdGVkIGZyb20gdGhlIGhhbGYgZXh0ZW50IHNvIHRoZSB0b3RhbCBib3ggd2lsbCBub3QgZ3JvdyB3aXRoIHRoZSBjb252ZXggcmFkaXVzXHJcbiAgICBfY29udmV4UmFkaXVzID0gMC4wNTtcclxuXHJcbiAgICAvLyBIYWxmIGhlaWdodCBvZiByYWRpdXMgYmFzZWQgc2hhcGVzLCBlLmcuIGN5bGluZGVyLCBjYXBzdWxlXHJcbiAgICBfaGFsZkhlaWdodCA9IDAuNTtcclxuXHJcbiAgICAvLyBEZW5zaXR5IG9mIHRoZSBvYmplY3QgaW4ga2cgLyBtXjNcclxuICAgIF9kZW5zaXR5ID0gMTAwMDtcclxuXHJcbiAgICAvLyBTaGFwZSBsb2NhbCBwb3NpdGlvbiBvZmZzZXRcclxuICAgIF9zaGFwZVBvc2l0aW9uID0gcGMuVmVjMy5aRVJPO1xyXG5cclxuICAgIC8vIFNoYXBlIGxvY2FsIHJvdGF0aW9uIG9mZnNldFxyXG4gICAgX3NoYXBlUm90YXRpb24gPSBwYy5WZWMzLlpFUk87XHJcblxyXG4gICAgLy8gT2Zmc2V0IGNlbnRlciBvZiBtYXNzIGluIGxvY2FsIHNwYWNlIG9mIHRoZSBib2R5LiBEb2VzIG5vdCBtb3ZlIHRoZSBzaGFwZS5cclxuICAgIF9tYXNzT2Zmc2V0ID0gcGMuVmVjMy5aRVJPO1xyXG5cclxuICAgIF9oZlNhbXBsZXMgPSBudWxsO1xyXG5cclxuICAgIF9oZlNhbXBsZUNvdW50ID0gMDtcclxuXHJcbiAgICAvLyBUaGUgSGVpZ2h0RmllbGQgaXMgZGl2aWRlZCBpbiBibG9ja3Mgb2YgaGZCbG9ja1NpemUgKiBoZkJsb2NrU2l6ZSAqIDIgdHJpYW5nbGVzIGFuZCB0aGVcclxuICAgIC8vIGFjY2VsZXJhdGlvbiBzdHJ1Y3R1cmUgY3VsbHMgYmxvY2tzIG9ubHksIGJpZ2dlciBibG9jayBzaXplcyByZWR1Y2UgbWVtb3J5IGNvbnN1bXB0aW9uXHJcbiAgICAvLyBidXQgYWxzbyByZWR1Y2UgcXVlcnkgcGVyZm9ybWFuY2UuIFNlbnNpYmxlIHZhbHVlcyBhcmUgWzIsIDhdLCBkb2VzIG5vdCBuZWVkIHRvIGJlIGFcclxuICAgIC8vIHBvd2VyIG9mIDIuIE5vdGUgdGhhdCBhdCBydW4tdGltZSBKb2x0IHBlcmZvcm1zIG9uZSBtb3JlIGdyaWQgc3ViZGl2aXNpb24sIHNvIHRoZSBlZmZlY3RpdmVcclxuICAgIC8vIGJsb2NrIHNpemUgaXMgaGFsZiBvZiB3aGF0IGlzIHByb3ZpZGVkIGhlcmUuXHJcbiAgICBfaGZCbG9ja1NpemUgPSAyO1xyXG5cclxuICAgIC8vIEhvdyBtYW55IGJpdHMgcGVyIHNhbXBsZSB0byB1c2UgdG8gY29tcHJlc3MgdGhlIEhlaWdodEZpZWxkLiBDYW4gYmUgaW4gdGhlIHJhbmdlIFsxLCA4XS5cclxuICAgIC8vIE5vdGUgdGhhdCBlYWNoIHNhbXBsZSBpcyBjb21wcmVzc2VkIHJlbGF0aXZlIHRvIHRoZSBtaW4vbWF4IHZhbHVlIG9mIGl0cyBibG9jayBvZlxyXG4gICAgLy8gaGZCbG9ja1NpemUgKiBoZkJsb2NrU2l6ZSBwaXhlbHMgc28gdGhlIGVmZmVjdGl2ZSBwcmVjaXNpb24gaXMgaGlnaGVyLiBBbHNvIG5vdGUgdGhhdFxyXG4gICAgLy8gaW5jcmVhc2luZyBoZkJsb2NrU2l6ZSBzYXZlcyBtb3JlIG1lbW9yeSB0aGFuIHJlZHVjaW5nIHRoZSBhbW91bnQgb2YgYml0cyBwZXIgc2FtcGxlLlxyXG4gICAgX2hmQml0c1BlclNhbXBsZSA9IDg7XHJcblxyXG4gICAgLy8gQ29zaW5lIG9mIHRoZSB0aHJlc2hvbGQgYW5nbGUgKGlmIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSB0d28gdHJpYW5nbGVzIGluIEhlaWdodEZpZWxkIGlzXHJcbiAgICAvLyBiaWdnZXIgdGhhbiB0aGlzLCB0aGUgZWRnZSBpcyBhY3RpdmUsIG5vdGUgdGhhdCBhIGNvbmNhdmUgZWRnZSBpcyBhbHdheXMgaW5hY3RpdmUpLiBTZXR0aW5nXHJcbiAgICAvLyB0aGlzIHZhbHVlIHRvbyBzbWFsbCBjYW4gY2F1c2UgZ2hvc3QgY29sbGlzaW9ucyB3aXRoIGVkZ2VzLCBzZXR0aW5nIGl0IHRvbyBiaWcgY2FuIGNhdXNlXHJcbiAgICAvLyBkZXBlbmV0cmF0aW9uIGFydGlmYWN0cyAob2JqZWN0cyBub3QgZGVwZW5ldHJhdGluZyBxdWlja2x5KS4gVmFsaWQgcmFuZ2VzIGFyZSBiZXR3ZWVuXHJcbiAgICAvLyBjb3MoMCBkZWdyZWVzKSBhbmQgY29zKDkwIGRlZ3JlZXMpLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBjb3MoNSBkZWdyZWVzKS5cclxuICAgIF9oZkFjdGl2ZUVkZ2VDb3NUaHJlc2hvbGRBbmdsZSA9IDAuOTk2MTk1O1xyXG5cclxuICAgIF9oZlNjYWxlID0gcGMuVmVjMy5PTkU7XHJcblxyXG4gICAgLy8gVGhlIGhlaWdodCBmaWVsZCBpcyBhIHN1cmZhY2UgZGVmaW5lZCBieTogaGZPZmZzZXQgKyBoZlNjYWxlICogKHgsIGhmSGVpZ2h0U2FtcGxlc1t5ICogaGZTYW1wbGVDb3VudCArIHhdLCB5KS5cclxuICAgIC8vIHdoZXJlIHggYW5kIHkgYXJlIGludGVnZXJzIGluIHRoZSByYW5nZSB4IGFuZCB5IGUgWzAsIGhmU2FtcGxlQ291bnQgLSAxXS5cclxuICAgIF9oZk9mZnNldCA9IHBjLlZlYzMuWkVSTztcclxuXHJcbiAgICAvLyBUaGUgQ29tcG9uZW50U3lzdGVtIHVzZWQgdG8gY3JlYXRlIHRoaXMgQ29tcG9uZW50LlxyXG4gICAgc3lzdGVtO1xyXG5cclxuICAgIC8vIFRoZSBFbnRpdHkgdGhhdCB0aGlzIENvbXBvbmVudCBpcyBhdHRhY2hlZCB0by5cclxuICAgIGVudGl0eTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzeXN0ZW0sIGVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtID0gc3lzdGVtO1xyXG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xyXG5cclxuICAgICAgICBpZiAoc3lzdGVtLnNjaGVtYSAmJiAhdGhpcy5fYWNjZXNzb3JzQnVpbHQpIHtcclxuICAgICAgICAgICAgYnVpbGRBY2Nlc3NvcnModGhpcywgc3lzdGVtLnNjaGVtYSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9uKCdzZXQnLCBmdW5jdGlvbiAobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnc2V0XycgKyBuYW1lLCBuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm9uKCdzZXRfZW5hYmxlZCcsIHRoaXMub25TZXRFbmFibGVkLCB0aGlzKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0IGNvbnN0cmFpbnRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50cztcclxuICAgIH1cclxuICAgIFxyXG4gICAgb25TZXRFbmFibGVkKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xyXG4gICAgICAgIGlmIChvbGRWYWx1ZSAhPT0gbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5LmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25FbmFibGUoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRpc2FibGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkVuYWJsZSgpIHt9XHJcblxyXG4gICAgb25EaXNhYmxlKCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gdGhpcy5fY29uc3RyYWludHM7XHJcblxyXG4gICAgICAgIGNvbnN0cmFpbnRzLmZvckVhY2goKGVudGl0eTIsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGVudGl0eTI/LmJvZHk/LmNvbnN0cmFpbnRzLmRlbGV0ZShpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0cmFpbnRzLmNsZWFyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Qb3N0U3RhdGVDaGFuZ2UoKSB7fVxyXG5cclxuICAgIHN0YXRpYyB3cml0ZVNoYXBlRGF0YShjYiwgcHJvcHMsIGZvcmNlV3JpdGVSb3RhdGlvbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBwcm9wcy5zaGFwZTtcclxuICAgICAgICBjYi53cml0ZShzaGFwZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICBcclxuICAgICAgICBsZXQgdXNlRW50aXR5U2NhbGUgPSBwcm9wcy51c2VFbnRpdHlTY2FsZTtcclxuICAgICAgICBsZXQgc2NhbGU7XHJcbiAgICAgICAgaWYgKHVzZUVudGl0eVNjYWxlKSB7XHJcbiAgICAgICAgICAgIHNjYWxlID0gcHJvcHMuc2NhbGUgfHwgcHJvcHMuZW50aXR5LmdldExvY2FsU2NhbGUoKTtcclxuICAgICAgICAgICAgaWYgKHNjYWxlLnggPT09IDEgJiYgc2NhbGUueSA9PT0gMSAmJiBzY2FsZS56ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB1c2VFbnRpdHlTY2FsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZSh1c2VFbnRpdHlTY2FsZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAodXNlRW50aXR5U2NhbGUgfHwgKFxyXG4gICAgICAgICAgICBzaGFwZSA9PT0gU0hBUEVfTUVTSCB8fFxyXG4gICAgICAgICAgICBzaGFwZSA9PT0gU0hBUEVfQ09OVkVYX0hVTEwpKSB7XHJcbiAgICAgICAgICAgIC8vIFBvdGVudGlhbCBwcmVjaXNpb24gbG9zcyA2NCAtPiAzMlxyXG4gICAgICAgICAgICBjYi53cml0ZShzY2FsZSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICBzd2l0Y2ggKHNoYXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQk9YOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGFsZkV4dGVudCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5jb252ZXhSYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0NBUFNVTEU6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5oYWxmSGVpZ2h0LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMucmFkaXVzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9DWUxJTkRFUjpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmhhbGZIZWlnaHQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5yYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5jb252ZXhSYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX1NQSEVSRTpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLnJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfU1RBVElDX0NPTVBPVU5EOlxyXG4gICAgICAgICAgICAgICAgb2sgPSBTaGFwZUNvbXBvbmVudC5hZGRDb21wb3VuZENoaWxkcmVuKGNiLCBwcm9wcy5lbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gaW50ZW50aW9uYWwgZmFsbC10aHJvdWdoXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ09OVkVYX0hVTEw6XHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfTUVTSDpcclxuICAgICAgICAgICAgICAgIFNoYXBlQ29tcG9uZW50LmFkZE1lc2hlcyhwcm9wcy5tZXNoZXMsIGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9IRUlHSFRGSUVMRDpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmhmT2Zmc2V0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmhmU2NhbGUsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZTYW1wbGVDb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZCbG9ja1NpemUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZCaXRzUGVyU2FtcGxlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmhmQWN0aXZlRWRnZUNvc1RocmVzaG9sZEFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2IuYWRkQnVmZmVyKHByb3BzLmhmU2FtcGxlcy5idWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy53YXJuKCdVbnN1cHBlcnRlZCBzaGFwZSB0eXBlJywgc2hhcGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGNvbnN0IGlzQ29tcG91bmRDaGlsZCA9IHByb3BzLmlzQ29tcG91bmRDaGlsZDtcclxuICAgICAgICBjYi53cml0ZShpc0NvbXBvdW5kQ2hpbGQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKCFpc0NvbXBvdW5kQ2hpbGQpIHtcclxuICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuZGVuc2l0eSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHByb3BzLnNoYXBlUG9zaXRpb247XHJcbiAgICAgICAgY29uc3Qgcm90YXRpb24gPSBwcm9wcy5zaGFwZVJvdGF0aW9uO1xyXG4gICAgICAgIGNvbnN0IG1hc3NPZmZzZXQgPSBwcm9wcy5tYXNzT2Zmc2V0O1xyXG4gICAgICAgIGNvbnN0IGhhc1Bvc2l0aW9uT2Zmc2V0ID0gIXBvc2l0aW9uLmVxdWFscyhwYy5WZWMzLlpFUk8pO1xyXG4gICAgICAgIGNvbnN0IGhhc1JvdGF0aW9uT2Zmc2V0ID0gZm9yY2VXcml0ZVJvdGF0aW9uIHx8ICFyb3RhdGlvbi5lcXVhbHMocGMuVmVjMy5aRVJPKTtcclxuICAgICAgICBjb25zdCBoYXNTaGFwZU9mZnNldCA9IGhhc1Bvc2l0aW9uT2Zmc2V0IHx8IGhhc1JvdGF0aW9uT2Zmc2V0O1xyXG4gICAgICAgIGNvbnN0IGhhc01hc3NPZmZzZXQgPSAhbWFzc09mZnNldC5lcXVhbHMocGMuVmVjMy5aRVJPKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUoaGFzU2hhcGVPZmZzZXQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGhhc1NoYXBlT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgIHF1YXQuc2V0RnJvbUV1bGVyQW5nbGVzKHJvdGF0aW9uKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUocG9zaXRpb24sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShxdWF0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNiLndyaXRlKGhhc01hc3NPZmZzZXQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGhhc01hc3NPZmZzZXQpIHtcclxuICAgICAgICAgICAgY2Iud3JpdGUobWFzc09mZnNldCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFkZENvbXBvdW5kQ2hpbGRyZW4oY2IsIHBhcmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSBwYXJlbnQuZmluZENvbXBvbmVudHMoJ2JvZHknKTtcclxuICAgICAgICBjb25zdCBjb3VudCA9IGNvbXBvbmVudHMubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuQ291bnQgPSBjb3VudCAtIDE7IC8vIC0xIHRvIGV4Y2x1ZGUgdGhlIHBhcmVudFxyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmIGNoaWxkcmVuQ291bnQgPT09IDApIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignVHJ5aW5nIHRvIGNyZWF0ZSBhIHN0YXRpYyAoaW1tdXRhYmxlKSBjb21wb3VuZCBib2R5IHdpdGhvdXQgY2hpbGRyZW4gc2hhcGVzLiBBYm9ydGluZy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2Iud3JpdGUoY2hpbGRyZW5Db3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTtcclxuICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5lbnRpdHkgPT09IHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gU2hhcGVDb21wb25lbnQud3JpdGVTaGFwZURhdGEoY2IsIGNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gY29tcG9uZW50LmVudGl0eTtcclxuICAgICAgICAgICAgY29uc3QgcG9zID0gZW50aXR5LmdldExvY2FsUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3Qgcm90ID0gZW50aXR5LmdldExvY2FsUm90YXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIExvc3Mgb2YgcHJlY2lzaW9uIGZvciBwb3Mvcm90ICg2NCAtPiAzMilcclxuICAgICAgICAgICAgY2Iud3JpdGUocG9zLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhZGRNZXNoZXMobWVzaGVzLCBjYikge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVzaGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBtZXNoZXNbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IHZiID0gbWVzaC52ZXJ0ZXhCdWZmZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IGliID0gbWVzaC5pbmRleEJ1ZmZlclswXTtcclxuICAgICAgICAgICAgY29uc3QgZm9ybWF0ID0gdmIuZ2V0Rm9ybWF0KCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcm1hdC5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGZvcm1hdC5lbGVtZW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50Lm5hbWUgPT09IHBjLlNFTUFOVElDX1BPU0lUSU9OKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUobWVzaC5wcmltaXRpdmVbMF0uYmFzZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZWxlbWVudC5vZmZzZXQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShlbGVtZW50LnN0cmlkZSAvIEZMT0FUMzJfU0laRSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IuYWRkQnVmZmVyKHZiLnN0b3JhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjYi53cml0ZSh2Yi5udW1WZXJ0aWNlcywgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShpYi5udW1JbmRpY2VzLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgICAgIC8vIHdvcmthcm91bmQgdW50aWwgdGhpcyBpcyBmaXhlZDpcclxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BsYXljYW52YXMvZW5naW5lL2lzc3Vlcy81ODY5XHJcbiAgICAgICAgICAgIC8vIGJ1ZmZlci5hZGRCdWZmZXIoaWIuc3RvcmFnZSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzdG9yYWdlID0gaWIuc3RvcmFnZTtcclxuICAgICAgICAgICAgY29uc3QgaXNWaWV3ID0gQXJyYXlCdWZmZXIuaXNWaWV3KHN0b3JhZ2UpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGJ5dGVMZW5ndGgsIGJ5dGVPZmZzZXQ7XHJcbiAgICAgICAgICAgIGlmIChpc1ZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGggPSBzdG9yYWdlLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBieXRlT2Zmc2V0ID0gc3RvcmFnZS5ieXRlT2Zmc2V0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnl0ZUxlbmd0aCA9IHN0b3JhZ2UuYnl0ZUxlbmd0aCAvIGliLmJ5dGVzUGVySW5kZXg7XHJcbiAgICAgICAgICAgICAgICBieXRlT2Zmc2V0ID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2Iud3JpdGUoYnl0ZUxlbmd0aCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShieXRlT2Zmc2V0LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLmFkZEJ1ZmZlcihpc1ZpZXcgPyBzdG9yYWdlLmJ1ZmZlciA6IHN0b3JhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgU2hhcGVDb21wb25lbnQgfTtcclxuXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/constants.mjs":
/*!***************************************************!*\
  !*** ./src/physics/components/jolt/constants.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BP_LAYER_MOVING: () => (/* binding */ BP_LAYER_MOVING),\n/* harmony export */   BP_LAYER_NON_MOVING: () => (/* binding */ BP_LAYER_NON_MOVING),\n/* harmony export */   BUFFER_READ_BOOL: () => (/* binding */ BUFFER_READ_BOOL),\n/* harmony export */   BUFFER_READ_FLOAT32: () => (/* binding */ BUFFER_READ_FLOAT32),\n/* harmony export */   BUFFER_READ_INT32: () => (/* binding */ BUFFER_READ_INT32),\n/* harmony export */   BUFFER_READ_UINT16: () => (/* binding */ BUFFER_READ_UINT16),\n/* harmony export */   BUFFER_READ_UINT32: () => (/* binding */ BUFFER_READ_UINT32),\n/* harmony export */   BUFFER_READ_UINT8: () => (/* binding */ BUFFER_READ_UINT8),\n/* harmony export */   BUFFER_WRITE_BOOL: () => (/* binding */ BUFFER_WRITE_BOOL),\n/* harmony export */   BUFFER_WRITE_FLOAT32: () => (/* binding */ BUFFER_WRITE_FLOAT32),\n/* harmony export */   BUFFER_WRITE_INT32: () => (/* binding */ BUFFER_WRITE_INT32),\n/* harmony export */   BUFFER_WRITE_JOLTVEC32: () => (/* binding */ BUFFER_WRITE_JOLTVEC32),\n/* harmony export */   BUFFER_WRITE_PLANE: () => (/* binding */ BUFFER_WRITE_PLANE),\n/* harmony export */   BUFFER_WRITE_UINT16: () => (/* binding */ BUFFER_WRITE_UINT16),\n/* harmony export */   BUFFER_WRITE_UINT32: () => (/* binding */ BUFFER_WRITE_UINT32),\n/* harmony export */   BUFFER_WRITE_UINT8: () => (/* binding */ BUFFER_WRITE_UINT8),\n/* harmony export */   BUFFER_WRITE_VEC32: () => (/* binding */ BUFFER_WRITE_VEC32),\n/* harmony export */   CMD_ADD_ANGULAR_IMPULSE: () => (/* binding */ CMD_ADD_ANGULAR_IMPULSE),\n/* harmony export */   CMD_ADD_FORCE: () => (/* binding */ CMD_ADD_FORCE),\n/* harmony export */   CMD_ADD_IMPULSE: () => (/* binding */ CMD_ADD_IMPULSE),\n/* harmony export */   CMD_ADD_TORQUE: () => (/* binding */ CMD_ADD_TORQUE),\n/* harmony export */   CMD_APPLY_BUOYANCY_IMPULSE: () => (/* binding */ CMD_APPLY_BUOYANCY_IMPULSE),\n/* harmony export */   CMD_CAST_RAY: () => (/* binding */ CMD_CAST_RAY),\n/* harmony export */   CMD_CAST_SHAPE: () => (/* binding */ CMD_CAST_SHAPE),\n/* harmony export */   CMD_CHANGE_GRAVITY: () => (/* binding */ CMD_CHANGE_GRAVITY),\n/* harmony export */   CMD_CHAR_SET_LIN_VEL: () => (/* binding */ CMD_CHAR_SET_LIN_VEL),\n/* harmony export */   CMD_CHAR_SET_SHAPE: () => (/* binding */ CMD_CHAR_SET_SHAPE),\n/* harmony export */   CMD_CREATE_BODY: () => (/* binding */ CMD_CREATE_BODY),\n/* harmony export */   CMD_CREATE_CHAR: () => (/* binding */ CMD_CREATE_CHAR),\n/* harmony export */   CMD_CREATE_CONSTRAINT: () => (/* binding */ CMD_CREATE_CONSTRAINT),\n/* harmony export */   CMD_CREATE_GROUPS: () => (/* binding */ CMD_CREATE_GROUPS),\n/* harmony export */   CMD_CREATE_SHAPE: () => (/* binding */ CMD_CREATE_SHAPE),\n/* harmony export */   CMD_CREATE_SOFT_BODY: () => (/* binding */ CMD_CREATE_SOFT_BODY),\n/* harmony export */   CMD_CREATE_VEHICLE: () => (/* binding */ CMD_CREATE_VEHICLE),\n/* harmony export */   CMD_DESTROY_BODY: () => (/* binding */ CMD_DESTROY_BODY),\n/* harmony export */   CMD_DESTROY_CONSTRAINT: () => (/* binding */ CMD_DESTROY_CONSTRAINT),\n/* harmony export */   CMD_DESTROY_SHAPE: () => (/* binding */ CMD_DESTROY_SHAPE),\n/* harmony export */   CMD_MOVE_BODY: () => (/* binding */ CMD_MOVE_BODY),\n/* harmony export */   CMD_REPORT_CONTACTS: () => (/* binding */ CMD_REPORT_CONTACTS),\n/* harmony export */   CMD_REPORT_SET_SHAPE: () => (/* binding */ CMD_REPORT_SET_SHAPE),\n/* harmony export */   CMD_RESET_VELOCITIES: () => (/* binding */ CMD_RESET_VELOCITIES),\n/* harmony export */   CMD_SET_ANG_VEL: () => (/* binding */ CMD_SET_ANG_VEL),\n/* harmony export */   CMD_SET_CONSTRAINT_ENABLED: () => (/* binding */ CMD_SET_CONSTRAINT_ENABLED),\n/* harmony export */   CMD_SET_DRIVER_INPUT: () => (/* binding */ CMD_SET_DRIVER_INPUT),\n/* harmony export */   CMD_SET_LIN_VEL: () => (/* binding */ CMD_SET_LIN_VEL),\n/* harmony export */   CMD_SET_MOTION_TYPE: () => (/* binding */ CMD_SET_MOTION_TYPE),\n/* harmony export */   CMD_SET_USER_DATA: () => (/* binding */ CMD_SET_USER_DATA),\n/* harmony export */   CMD_TOGGLE_GROUP_PAIR: () => (/* binding */ CMD_TOGGLE_GROUP_PAIR),\n/* harmony export */   CMD_UPDATE_TRANSFORMS: () => (/* binding */ CMD_UPDATE_TRANSFORMS),\n/* harmony export */   CMD_USE_MOTION_STATE: () => (/* binding */ CMD_USE_MOTION_STATE),\n/* harmony export */   COMPONENT_SYSTEM_BODY: () => (/* binding */ COMPONENT_SYSTEM_BODY),\n/* harmony export */   COMPONENT_SYSTEM_CHAR: () => (/* binding */ COMPONENT_SYSTEM_CHAR),\n/* harmony export */   COMPONENT_SYSTEM_MANAGER: () => (/* binding */ COMPONENT_SYSTEM_MANAGER),\n/* harmony export */   COMPONENT_SYSTEM_SOFT_BODY: () => (/* binding */ COMPONENT_SYSTEM_SOFT_BODY),\n/* harmony export */   COMPONENT_SYSTEM_VEHICLE: () => (/* binding */ COMPONENT_SYSTEM_VEHICLE),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_X: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_X),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_Y: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_Y),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_Z: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_Z),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_X: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_X),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_Y: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_Y),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_Z: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_Z),\n/* harmony export */   CONSTRAINT_SPACE_LOCAL: () => (/* binding */ CONSTRAINT_SPACE_LOCAL),\n/* harmony export */   CONSTRAINT_SPACE_WORLD: () => (/* binding */ CONSTRAINT_SPACE_WORLD),\n/* harmony export */   CONSTRAINT_TYPE_CONE: () => (/* binding */ CONSTRAINT_TYPE_CONE),\n/* harmony export */   CONSTRAINT_TYPE_DISTANCE: () => (/* binding */ CONSTRAINT_TYPE_DISTANCE),\n/* harmony export */   CONSTRAINT_TYPE_FIXED: () => (/* binding */ CONSTRAINT_TYPE_FIXED),\n/* harmony export */   CONSTRAINT_TYPE_HINGE: () => (/* binding */ CONSTRAINT_TYPE_HINGE),\n/* harmony export */   CONSTRAINT_TYPE_POINT: () => (/* binding */ CONSTRAINT_TYPE_POINT),\n/* harmony export */   CONSTRAINT_TYPE_SIX_DOF: () => (/* binding */ CONSTRAINT_TYPE_SIX_DOF),\n/* harmony export */   CONSTRAINT_TYPE_SLIDER: () => (/* binding */ CONSTRAINT_TYPE_SLIDER),\n/* harmony export */   CONSTRAINT_TYPE_SWING_TWIST: () => (/* binding */ CONSTRAINT_TYPE_SWING_TWIST),\n/* harmony export */   CONTACT_TYPE_ADDED: () => (/* binding */ CONTACT_TYPE_ADDED),\n/* harmony export */   CONTACT_TYPE_PERSISTED: () => (/* binding */ CONTACT_TYPE_PERSISTED),\n/* harmony export */   CONTACT_TYPE_REMOVED: () => (/* binding */ CONTACT_TYPE_REMOVED),\n/* harmony export */   FLOAT32_SIZE: () => (/* binding */ FLOAT32_SIZE),\n/* harmony export */   INT32_SIZE: () => (/* binding */ INT32_SIZE),\n/* harmony export */   OBJ_LAYER_MOVING: () => (/* binding */ OBJ_LAYER_MOVING),\n/* harmony export */   OBJ_LAYER_NON_MOVING: () => (/* binding */ OBJ_LAYER_NON_MOVING),\n/* harmony export */   OPERATOR_CLEANER: () => (/* binding */ OPERATOR_CLEANER),\n/* harmony export */   OPERATOR_CREATOR: () => (/* binding */ OPERATOR_CREATOR),\n/* harmony export */   OPERATOR_MODIFIER: () => (/* binding */ OPERATOR_MODIFIER),\n/* harmony export */   OPERATOR_QUERIER: () => (/* binding */ OPERATOR_QUERIER),\n/* harmony export */   SHAPE_BOX: () => (/* binding */ SHAPE_BOX),\n/* harmony export */   SHAPE_CAPSULE: () => (/* binding */ SHAPE_CAPSULE),\n/* harmony export */   SHAPE_CONVEX_HULL: () => (/* binding */ SHAPE_CONVEX_HULL),\n/* harmony export */   SHAPE_CYLINDER: () => (/* binding */ SHAPE_CYLINDER),\n/* harmony export */   SHAPE_HEIGHTFIELD: () => (/* binding */ SHAPE_HEIGHTFIELD),\n/* harmony export */   SHAPE_MESH: () => (/* binding */ SHAPE_MESH),\n/* harmony export */   SHAPE_SPHERE: () => (/* binding */ SHAPE_SPHERE),\n/* harmony export */   SHAPE_STATIC_COMPOUND: () => (/* binding */ SHAPE_STATIC_COMPOUND),\n/* harmony export */   SPRING_MODE_FREQUENCY: () => (/* binding */ SPRING_MODE_FREQUENCY),\n/* harmony export */   SPRING_MODE_STIFFNESS: () => (/* binding */ SPRING_MODE_STIFFNESS),\n/* harmony export */   UINT16_SIZE: () => (/* binding */ UINT16_SIZE),\n/* harmony export */   UINT32_SIZE: () => (/* binding */ UINT32_SIZE),\n/* harmony export */   UINT8_SIZE: () => (/* binding */ UINT8_SIZE),\n/* harmony export */   VEHICLE_CAST_TYPE_CYLINDER: () => (/* binding */ VEHICLE_CAST_TYPE_CYLINDER),\n/* harmony export */   VEHICLE_CAST_TYPE_RAY: () => (/* binding */ VEHICLE_CAST_TYPE_RAY),\n/* harmony export */   VEHICLE_CAST_TYPE_SPHERE: () => (/* binding */ VEHICLE_CAST_TYPE_SPHERE),\n/* harmony export */   VEHICLE_TYPE_MOTORCYCLE: () => (/* binding */ VEHICLE_TYPE_MOTORCYCLE),\n/* harmony export */   VEHICLE_TYPE_TRACK: () => (/* binding */ VEHICLE_TYPE_TRACK),\n/* harmony export */   VEHICLE_TYPE_WHEEL: () => (/* binding */ VEHICLE_TYPE_WHEEL)\n/* harmony export */ });\nconst OPERATOR_CREATOR = 0;\r\nconst OPERATOR_MODIFIER = 1;\r\nconst OPERATOR_QUERIER = 2;\r\nconst OPERATOR_CLEANER = 3;\r\n\r\nconst CONSTRAINT_TYPE_FIXED = 0;\r\nconst CONSTRAINT_TYPE_POINT = 1;\r\nconst CONSTRAINT_TYPE_DISTANCE = 2;\r\nconst CONSTRAINT_TYPE_HINGE = 3;\r\nconst CONSTRAINT_TYPE_SLIDER = 4;\r\nconst CONSTRAINT_TYPE_CONE = 5;\r\nconst CONSTRAINT_TYPE_SWING_TWIST = 6;\r\nconst CONSTRAINT_TYPE_SIX_DOF = 7;\r\n\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_X = 0;\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_Y = 1;\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_Z = 2;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_X = 3;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_Y = 4;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_Z = 5;\r\n\r\nconst CONSTRAINT_SPACE_LOCAL = 0;\r\nconst CONSTRAINT_SPACE_WORLD = 1;\r\n\r\nconst SPRING_MODE_FREQUENCY = 0;\r\nconst SPRING_MODE_STIFFNESS = 1;\r\n\r\nconst VEHICLE_CAST_TYPE_RAY = 0;\r\nconst VEHICLE_CAST_TYPE_SPHERE = 1;\r\nconst VEHICLE_CAST_TYPE_CYLINDER = 2;\r\n\r\nconst OBJ_LAYER_NON_MOVING = 0;\r\nconst OBJ_LAYER_MOVING = 1;\r\n\r\nconst BP_LAYER_NON_MOVING = 0;\r\nconst BP_LAYER_MOVING = 1;\r\n\r\nconst SHAPE_BOX = 0;\r\nconst SHAPE_CAPSULE = 1;\r\nconst SHAPE_CYLINDER = 2;\r\nconst SHAPE_SPHERE = 3;\r\nconst SHAPE_MESH = 4;\r\nconst SHAPE_CONVEX_HULL = 5;\r\nconst SHAPE_STATIC_COMPOUND = 6;\r\nconst SHAPE_HEIGHTFIELD = 7;\r\n\r\nconst VEHICLE_TYPE_WHEEL = 0;\r\nconst VEHICLE_TYPE_TRACK = 1;\r\nconst VEHICLE_TYPE_MOTORCYCLE = 2;\r\n\r\nconst CONTACT_TYPE_ADDED = 0;\r\nconst CONTACT_TYPE_PERSISTED = 1;\r\nconst CONTACT_TYPE_REMOVED = 2;\r\n\r\nconst COMPONENT_SYSTEM_MANAGER = 0;\r\nconst COMPONENT_SYSTEM_BODY = 1;\r\nconst COMPONENT_SYSTEM_CHAR = 2;\r\nconst COMPONENT_SYSTEM_VEHICLE = 3;\r\nconst COMPONENT_SYSTEM_SOFT_BODY = 4;\r\n\r\nconst FLOAT32_SIZE = Float32Array.BYTES_PER_ELEMENT;\r\nconst INT32_SIZE = Int32Array.BYTES_PER_ELEMENT;\r\nconst UINT32_SIZE = Uint32Array.BYTES_PER_ELEMENT;\r\nconst UINT16_SIZE = Uint16Array.BYTES_PER_ELEMENT;\r\nconst UINT8_SIZE = Uint8Array.BYTES_PER_ELEMENT;\r\n\r\nconst BUFFER_WRITE_UINT8 = 'writeUint8';\r\nconst BUFFER_WRITE_UINT16 = 'writeUint16';\r\nconst BUFFER_WRITE_UINT32 = 'writeUint32';\r\nconst BUFFER_WRITE_INT32 = 'writeInt32';\r\nconst BUFFER_WRITE_VEC32 = 'writeVector32';\r\nconst BUFFER_WRITE_FLOAT32 = 'writeFloat32';\r\nconst BUFFER_WRITE_BOOL = 'writeBool';\r\nconst BUFFER_WRITE_PLANE = 'writePlane';\r\nconst BUFFER_WRITE_JOLTVEC32 = 'writeJoltVec32';\r\n\r\nconst BUFFER_READ_UINT8 = 'readUint8';\r\nconst BUFFER_READ_UINT16 = 'readUint16';\r\nconst BUFFER_READ_UINT32 = 'readUint32';\r\nconst BUFFER_READ_INT32 = 'readInt32';\r\nconst BUFFER_READ_FLOAT32 = 'readFloat32';\r\nconst BUFFER_READ_BOOL = 'readBool';\r\n\r\n\r\nlet i = 0;\r\n// frontend -> backend\r\nconst CMD_CREATE_BODY = i++;\r\nconst CMD_CREATE_CHAR = i++;\r\nconst CMD_CREATE_SHAPE = i++;\r\nconst CMD_CREATE_VEHICLE = i++;\r\nconst CMD_CREATE_SOFT_BODY = i++;\r\nconst CMD_ADD_FORCE = i++;\r\nconst CMD_ADD_IMPULSE = i++;\r\nconst CMD_APPLY_BUOYANCY_IMPULSE = i++;\r\nconst CMD_ADD_ANGULAR_IMPULSE = i++;\r\nconst CMD_ADD_TORQUE = i++;\r\nconst CMD_CAST_RAY = i++;\r\nconst CMD_CAST_SHAPE = i++;\r\nconst CMD_DESTROY_BODY = i++;\r\nconst CMD_DESTROY_SHAPE = i++;\r\nconst CMD_MOVE_BODY = i++;\r\nconst CMD_SET_LIN_VEL = i++;\r\nconst CMD_SET_ANG_VEL = i++;\r\nconst CMD_SET_MOTION_TYPE = i++;\r\nconst CMD_RESET_VELOCITIES = i++;\r\nconst CMD_TOGGLE_GROUP_PAIR = i++;\r\nconst CMD_CREATE_GROUPS = i++;\r\nconst CMD_CREATE_CONSTRAINT = i++;\r\nconst CMD_CHANGE_GRAVITY = i++;\r\nconst CMD_CHAR_SET_LIN_VEL = i++;\r\nconst CMD_CHAR_SET_SHAPE = i++;\r\nconst CMD_SET_USER_DATA = i++;\r\nconst CMD_USE_MOTION_STATE = i++;\r\nconst CMD_SET_CONSTRAINT_ENABLED = i++;\r\nconst CMD_DESTROY_CONSTRAINT = i++;\r\nconst CMD_SET_DRIVER_INPUT = i++;\r\n// backend -> frontend\r\nconst CMD_UPDATE_TRANSFORMS = i++;\r\nconst CMD_REPORT_CONTACTS = i++;\r\nconst CMD_REPORT_SET_SHAPE = i++;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFPO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDTztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDTztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDQTtBQUNQO0FBQ087QUFDQTtBQUNQO0FBQ087QUFDQTtBQUNQO0FBQ087QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNQO0FBQ087QUFDQTtBQUNBO0FBQ1A7QUFDTztBQUNBO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNQO0FBQ087QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDUDtBQUNPO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2NvbnN0YW50cy5tanM/MDExZSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgT1BFUkFUT1JfQ1JFQVRPUiA9IDA7XHJcbmV4cG9ydCBjb25zdCBPUEVSQVRPUl9NT0RJRklFUiA9IDE7XHJcbmV4cG9ydCBjb25zdCBPUEVSQVRPUl9RVUVSSUVSID0gMjtcclxuZXhwb3J0IGNvbnN0IE9QRVJBVE9SX0NMRUFORVIgPSAzO1xyXG5cclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfVFlQRV9GSVhFRCA9IDA7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfUE9JTlQgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9UWVBFX0RJU1RBTkNFID0gMjtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfVFlQRV9ISU5HRSA9IDM7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfU0xJREVSID0gNDtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfVFlQRV9DT05FID0gNTtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVCA9IDY7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfU0lYX0RPRiA9IDc7XHJcblxyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1ggPSAwO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1kgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1ogPSAyO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1ggPSAzO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1kgPSA0O1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1ogPSA1O1xyXG5cclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU1BBQ0VfTE9DQUwgPSAwO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9TUEFDRV9XT1JMRCA9IDE7XHJcblxyXG5leHBvcnQgY29uc3QgU1BSSU5HX01PREVfRlJFUVVFTkNZID0gMDtcclxuZXhwb3J0IGNvbnN0IFNQUklOR19NT0RFX1NUSUZGTkVTUyA9IDE7XHJcblxyXG5leHBvcnQgY29uc3QgVkVISUNMRV9DQVNUX1RZUEVfUkFZID0gMDtcclxuZXhwb3J0IGNvbnN0IFZFSElDTEVfQ0FTVF9UWVBFX1NQSEVSRSA9IDE7XHJcbmV4cG9ydCBjb25zdCBWRUhJQ0xFX0NBU1RfVFlQRV9DWUxJTkRFUiA9IDI7XHJcblxyXG5leHBvcnQgY29uc3QgT0JKX0xBWUVSX05PTl9NT1ZJTkcgPSAwO1xyXG5leHBvcnQgY29uc3QgT0JKX0xBWUVSX01PVklORyA9IDE7XHJcblxyXG5leHBvcnQgY29uc3QgQlBfTEFZRVJfTk9OX01PVklORyA9IDA7XHJcbmV4cG9ydCBjb25zdCBCUF9MQVlFUl9NT1ZJTkcgPSAxO1xyXG5cclxuZXhwb3J0IGNvbnN0IFNIQVBFX0JPWCA9IDA7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9DQVBTVUxFID0gMTtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX0NZTElOREVSID0gMjtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX1NQSEVSRSA9IDM7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9NRVNIID0gNDtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX0NPTlZFWF9IVUxMID0gNTtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX1NUQVRJQ19DT01QT1VORCA9IDY7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9IRUlHSFRGSUVMRCA9IDc7XHJcblxyXG5leHBvcnQgY29uc3QgVkVISUNMRV9UWVBFX1dIRUVMID0gMDtcclxuZXhwb3J0IGNvbnN0IFZFSElDTEVfVFlQRV9UUkFDSyA9IDE7XHJcbmV4cG9ydCBjb25zdCBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRSA9IDI7XHJcblxyXG5leHBvcnQgY29uc3QgQ09OVEFDVF9UWVBFX0FEREVEID0gMDtcclxuZXhwb3J0IGNvbnN0IENPTlRBQ1RfVFlQRV9QRVJTSVNURUQgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09OVEFDVF9UWVBFX1JFTU9WRUQgPSAyO1xyXG5cclxuZXhwb3J0IGNvbnN0IENPTVBPTkVOVF9TWVNURU1fTUFOQUdFUiA9IDA7XHJcbmV4cG9ydCBjb25zdCBDT01QT05FTlRfU1lTVEVNX0JPRFkgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09NUE9ORU5UX1NZU1RFTV9DSEFSID0gMjtcclxuZXhwb3J0IGNvbnN0IENPTVBPTkVOVF9TWVNURU1fVkVISUNMRSA9IDM7XHJcbmV4cG9ydCBjb25zdCBDT01QT05FTlRfU1lTVEVNX1NPRlRfQk9EWSA9IDQ7XHJcblxyXG5leHBvcnQgY29uc3QgRkxPQVQzMl9TSVpFID0gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xyXG5leHBvcnQgY29uc3QgSU5UMzJfU0laRSA9IEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XHJcbmV4cG9ydCBjb25zdCBVSU5UMzJfU0laRSA9IFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xyXG5leHBvcnQgY29uc3QgVUlOVDE2X1NJWkUgPSBVaW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVDtcclxuZXhwb3J0IGNvbnN0IFVJTlQ4X1NJWkUgPSBVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xyXG5cclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9VSU5UOCA9ICd3cml0ZVVpbnQ4JztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9VSU5UMTYgPSAnd3JpdGVVaW50MTYnO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX1VJTlQzMiA9ICd3cml0ZVVpbnQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfV1JJVEVfSU5UMzIgPSAnd3JpdGVJbnQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfV1JJVEVfVkVDMzIgPSAnd3JpdGVWZWN0b3IzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfV1JJVEVfRkxPQVQzMiA9ICd3cml0ZUZsb2F0MzInO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX0JPT0wgPSAnd3JpdGVCb29sJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9QTEFORSA9ICd3cml0ZVBsYW5lJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9KT0xUVkVDMzIgPSAnd3JpdGVKb2x0VmVjMzInO1xyXG5cclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9SRUFEX1VJTlQ4ID0gJ3JlYWRVaW50OCc7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfUkVBRF9VSU5UMTYgPSAncmVhZFVpbnQxNic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfUkVBRF9VSU5UMzIgPSAncmVhZFVpbnQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfUkVBRF9JTlQzMiA9ICdyZWFkSW50MzInO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1JFQURfRkxPQVQzMiA9ICdyZWFkRmxvYXQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfUkVBRF9CT09MID0gJ3JlYWRCb29sJztcclxuXHJcblxyXG5sZXQgaSA9IDA7XHJcbi8vIGZyb250ZW5kIC0+IGJhY2tlbmRcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfQk9EWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfQ0hBUiA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfU0hBUEUgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ1JFQVRFX1ZFSElDTEUgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ1JFQVRFX1NPRlRfQk9EWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9BRERfRk9SQ0UgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQUREX0lNUFVMU0UgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQVBQTFlfQlVPWUFOQ1lfSU1QVUxTRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9BRERfQU5HVUxBUl9JTVBVTFNFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0FERF9UT1JRVUUgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ0FTVF9SQVkgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ0FTVF9TSEFQRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9ERVNUUk9ZX0JPRFkgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfREVTVFJPWV9TSEFQRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9NT1ZFX0JPRFkgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfU0VUX0xJTl9WRUwgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfU0VUX0FOR19WRUwgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfU0VUX01PVElPTl9UWVBFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX1JFU0VUX1ZFTE9DSVRJRVMgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfVE9HR0xFX0dST1VQX1BBSVIgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ1JFQVRFX0dST1VQUyA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfQ09OU1RSQUlOVCA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DSEFOR0VfR1JBVklUWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DSEFSX1NFVF9MSU5fVkVMID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NIQVJfU0VUX1NIQVBFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX1NFVF9VU0VSX0RBVEEgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfVVNFX01PVElPTl9TVEFURSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9TRVRfQ09OU1RSQUlOVF9FTkFCTEVEID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0RFU1RST1lfQ09OU1RSQUlOVCA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9TRVRfRFJJVkVSX0lOUFVUID0gaSsrO1xyXG4vLyBiYWNrZW5kIC0+IGZyb250ZW5kXHJcbmV4cG9ydCBjb25zdCBDTURfVVBEQVRFX1RSQU5TRk9STVMgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfUkVQT1JUX0NPTlRBQ1RTID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX1JFUE9SVF9TRVRfU0hBUEUgPSBpKys7XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/constants.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/manager.mjs":
/*!*************************************************!*\
  !*** ./src/physics/components/jolt/manager.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JoltManager: () => (/* binding */ JoltManager)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _manager_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../manager.mjs */ \"./src/physics/manager.mjs\");\n/* harmony import */ var _body_system_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _char_system_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./char/system.mjs */ \"./src/physics/components/jolt/char/system.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _response_handler_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./response-handler.mjs */ \"./src/physics/components/jolt/response-handler.mjs\");\n/* harmony import */ var _softbody_system_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./softbody/system.mjs */ \"./src/physics/components/jolt/softbody/system.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n/* harmony import */ var _vehicle_system_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./vehicle/system.mjs */ \"./src/physics/components/jolt/vehicle/system.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass JoltManager extends _manager_mjs__WEBPACK_IMPORTED_MODULE_2__.PhysicsManager {\r\n    constructor(app, opts, resolve) {\r\n        super(app, 'jolt', opts);\r\n\r\n        // TODO\r\n        // component systems will use Jolt constants, which\r\n        // are not available until webworker responds with them.\r\n\r\n        app.systems.add(new _body_system_mjs__WEBPACK_IMPORTED_MODULE_3__.BodyComponentSystem(app, this, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.COMPONENT_SYSTEM_BODY));\r\n        app.systems.add(new _char_system_mjs__WEBPACK_IMPORTED_MODULE_4__.CharComponentSystem(app, this, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.COMPONENT_SYSTEM_CHAR));\r\n        app.systems.add(new _vehicle_system_mjs__WEBPACK_IMPORTED_MODULE_10__.VehicleComponentSystem(app, this, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.COMPONENT_SYSTEM_VEHICLE));\r\n        app.systems.add(new _softbody_system_mjs__WEBPACK_IMPORTED_MODULE_8__.SoftBodyComponentSystem(app, this, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.COMPONENT_SYSTEM_SOFT_BODY));\r\n\r\n        this._queryMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._constraintMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._shapeMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._gravity = new pc.Vec3(0, -9.81, 0);\r\n\r\n        this._resolve = resolve;\r\n\r\n        this._systems.set(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.COMPONENT_SYSTEM_MANAGER, this);\r\n    }\r\n\r\n    set gravity(gravity) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(gravity, `Invalid gravity vector`, gravity);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        if (!this._gravity.equals(gravity)) {\r\n            this._gravity.copy(gravity);\r\n\r\n            const cb = this._outBuffer;\r\n\r\n            cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_MODIFIER);\r\n            cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CHANGE_GRAVITY);\r\n            cb.write(gravity, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    }\r\n\r\n    get gravity() {\r\n        return this._gravity;\r\n    }\r\n\r\n    get queryMap() {\r\n        return this._queryMap;\r\n    }\r\n\r\n    onMessage(msg) {\r\n        const data = msg.data || msg;\r\n\r\n        super.onMessage(data);\r\n\r\n        if (data.constants) {\r\n            this._resolve();\r\n        }\r\n\r\n        if (data.drawViews) {\r\n            _system_mjs__WEBPACK_IMPORTED_MODULE_9__.ShapeComponentSystem.debugDraw(this._app, data.drawViews, this._config);\r\n        }\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CAST_RAY:\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CAST_SHAPE:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_7__.ResponseHandler.handleQuery(cb, this._queryMap);\r\n                break;\r\n        }\r\n    }    \r\n\r\n    createShape(type, options = {}) {\r\n        const cb = this._outBuffer;\r\n\r\n        const opts = {\r\n            // defaults\r\n            density: 1000,\r\n            shapePosition: new pc.Vec3(),\r\n            shapeRotation: new pc.Vec3(),\r\n            scale: new pc.Vec3(1, 1, 1),\r\n            halfExtent: new pc.Vec3(0.5, 0.5, 0.5),\r\n            convexRadius: 0.05,\r\n            halfHeight: 0.5,\r\n            radius: 0.5,\r\n\r\n            // user overrides\r\n            ...options,\r\n\r\n            // hard rules\r\n            shape: type,\r\n            useEntityScale: false,\r\n            isCompoundChild: false,\r\n            massOffset: pc.Vec3.ZERO\r\n        };\r\n\r\n        const index = this._shapeMap.add(opts);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CREATE_SHAPE);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n\r\n        _component_mjs__WEBPACK_IMPORTED_MODULE_5__.ShapeComponent.writeShapeData(cb, opts, true /* force write rotation */);\r\n\r\n        return index;\r\n    }\r\n\r\n    destroyShape(index) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid shape number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_CLEANER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_DESTROY_SHAPE);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n\r\n        this._shapeMap.free(index);\r\n    }    \r\n\r\n    createFilterGroups(groups) {\r\n        const cb = this._outBuffer;\r\n        const groupsCount = groups.length;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CREATE_GROUPS);\r\n        cb.write(groupsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < groupsCount; i++) {\r\n            // sub groups count\r\n            cb.write(groups[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n\r\n    toggleGroupPair(group, subGroup1, subGroup2, enable) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(group, `Invalid group 1: ${ group }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(subGroup1, `Invalid group 1: ${ subGroup1 }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(subGroup2, `Invalid group 2: ${ subGroup2 }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enable, `Invalid toggle flag: ${ enable }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_MODIFIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_TOGGLE_GROUP_PAIR);\r\n        cb.write(enable, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(group, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(subGroup1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(subGroup2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT16, false);\r\n    }    \r\n\r\n    castRay(origin, dir, callback, opts) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(origin,`Invalid origin vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(dir, `Invalid direction vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(callback, 'castRay requires a callback function castRay(origin, dir, callback, opts)');\r\n            if (ok && opts?.firstOnly != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.firstOnly);\r\n            if (ok && opts?.calculateNormal != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.calculateNormal);\r\n            if (ok && opts?.ignoreBackFaces != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.ignoreBackFaces);\r\n            if (ok && opts?.treatConvexAsSolid != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.treatConvexAsSolid);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const callbackIndex = this._queryMap.add(callback);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_QUERIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CAST_RAY);\r\n        cb.write(callbackIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(origin, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(dir, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(opts?.firstOnly, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.calculateNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.ignoreBackFaces, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.treatConvexAsSolid, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n    }\r\n\r\n    castShape(shapeIndex, pos, rot, dir, callback, opts) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkInt(shapeIndex, `Invalid shape index`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(pos, `Invalid cast shape position vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(dir, `Invalid cast shape direction vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkQuat(rot, `Invalid cast shape rotation`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const queryIndex = this._queryMap.add(callback);\r\n\r\n        // TODO\r\n        // get rid of flags\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_QUERIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CAST_SHAPE);\r\n        cb.write(queryIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(dir, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(opts?.scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts?.offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts?.backFaceModeTriangles, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts?.backFaceModeConvex, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts?.useShrunkenShapeAndConvexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.returnDeepestPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        // TODO\r\n        // separate a cast into [single result / multiple results] commands\r\n        // so we don't allocate new array for a single result query\r\n        // after we get back from the backend\r\n        cb.write(opts?.firstOnly, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.calculateNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        cb.write(shapeIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n    }\r\n\r\n    createConstraint(type, entity1, entity2, opts = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(!!entity1.c.body, `Entity has no Body Component. Cannot create constraint.`, entity1);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(!!entity2.c.body, `Entity has no Body Component. Cannot create constraint.`, entity2);\r\n            if (!ok) return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const index = this._constraintMap.add({ entity1, entity2 });\r\n\r\n        entity1.body.constraints.set(index, entity2);\r\n        entity2.body.constraints.set(index, entity1);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_CREATE_CONSTRAINT);\r\n        cb.write(type, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8, false);\r\n\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(entity1.c.body.index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(entity2.c.body.index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n\r\n        switch (type) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_FIXED:\r\n                JoltManager.writeFixedConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_POINT:\r\n                JoltManager.writePointConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_DISTANCE:\r\n                JoltManager.writeDistanceConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_HINGE:\r\n                JoltManager.writeHingeConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_SLIDER:\r\n                JoltManager.writeSliderConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_CONE:\r\n                JoltManager.writeConeConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_SWING_TWIST:\r\n                JoltManager.writeSwingTwistConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CONSTRAINT_TYPE_SIX_DOF:\r\n                JoltManager.writeSixDofConstraint(cb, opts);\r\n                break;\r\n\r\n            default:\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.error(`Unrecognized constraint type: ${ type }`);\r\n                return;\r\n        }\r\n\r\n        cb.write(opts.numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts.numPositionStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts.space, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n\r\n        return index;\r\n    }\r\n\r\n    destroyConstraint(index) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid index of a constraint trying to destroy: ${ index }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_CLEANER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_DESTROY_CONSTRAINT);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n\r\n        this.freeConstraintIndex(index);\r\n    }\r\n\r\n    freeConstraintIndex(index) {\r\n        this._constraintMap.free(index);\r\n    }\r\n\r\n    setConstraintEnabled(index, enabled, activate = true) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid constraint index: ${ index }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enabled, `Invalid constraint enable bool: ${ enabled }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enabled, `Invalid activate bool: ${ enabled }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.OPERATOR_MODIFIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_6__.CMD_SET_CONSTRAINT_ENABLED);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(enabled, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(activate, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_fixed_constraint_settings.html\r\n    static writeFixedConstraint(cb, opts) {\r\n        cb.write(opts.autoDetectPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        if (!opts.autoDetectPoint) {\r\n            cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n            cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        }\r\n        cb.write(opts.axisX1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_point_constraint_settings.html\r\n    static writePointConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_distance_constraint_settings.html\r\n    static writeDistanceConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.minDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_hinge_constraint_settings.html\r\n    static writeHingeConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.hingeAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.hingeAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_slider_constraint_settings.html\r\n    static writeSliderConstraint(cb, opts) {\r\n        cb.write(opts.autoDetectPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL);\r\n        if (!opts.autoDetectPoint) {\r\n            cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n            cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        }\r\n        cb.write(opts.sliderAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.sliderAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionForce, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_cone_constraint_settings.html\r\n    static writeConeConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.halfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_swing_twist_constraint_settings.html\r\n    static writeSwingTwistConstraint(cb, opts) {\r\n        cb.write(opts.position1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.planeAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.position2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.planeAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalHalfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.planeHalfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.twistMinAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.twistMaxAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeMotorSettings(cb, opts.swingMotorSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.twistMotorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_six_d_o_f_constraint_settings.html\r\n    static writeSixDofConstraint(cb, opts) {\r\n        JoltManager.writeAxes(cb, opts.freeAxes);\r\n        JoltManager.writeAxes(cb, opts.fixedAxes);\r\n        JoltManager.writeAxes(cb, opts.limitedAxes, true);\r\n\r\n        cb.write(opts.position1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY1, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.position2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY2, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.maxFriction, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    static writeAxes(cb, axes, limits) {\r\n        cb.write(!!axes, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n        if (axes) {\r\n            const count = axes.length;\r\n            if (limits) {\r\n                cb.write(count / 3, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8, false);\r\n                for (let i = 0; i < count; i += 3) {\r\n                    cb.write(axes[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8, false);\r\n                    cb.write(axes[i + 1], _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32, false);\r\n                    cb.write(axes[i + 2], _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32, false);\r\n                }\r\n            } else {\r\n                cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8, false);\r\n                for (let i = 0; i < count; i++) {\r\n                    cb.write(axes[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static writeSpringSettings(cb, springSettings) {\r\n        cb.write(!!springSettings, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n        if (springSettings != null) {\r\n            cb.write(springSettings.springMode, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_UINT8);\r\n            cb.write(springSettings.frequency, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(springSettings.stiffness, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(springSettings.damping, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        }\r\n    }\r\n\r\n    static writeMotorSettings(cb, motorSettings) {\r\n        cb.write(!!motorSettings, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_BOOL, false);\r\n        if (motorSettings != null) {\r\n            this._writeSpringSettings(cb, motorSettings.springSettings);\r\n            cb.write(motorSettings.minForceLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.maxForceLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.minTorqueLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.maxTorqueLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_6__.BUFFER_WRITE_FLOAT32);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvbWFuYWdlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXdDO0FBQ2U7QUFDSjtBQUNLO0FBQ0E7QUFDUDtBQVN4QjtBQUNnQztBQUNPO0FBQ1o7QUFDVTtBQUM5RDtBQUNBLDBCQUEwQix3REFBYztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixpRUFBbUIsWUFBWSxpRUFBcUI7QUFDaEYsNEJBQTRCLGlFQUFtQixZQUFZLGlFQUFxQjtBQUNoRiw0QkFBNEIsd0VBQXNCLFlBQVksb0VBQXdCO0FBQ3RGLDRCQUE0Qix5RUFBdUIsWUFBWSxzRUFBMEI7QUFDekY7QUFDQSw2QkFBNkIsNERBQVk7QUFDekMsa0NBQWtDLDREQUFZO0FBQzlDLDZCQUE2Qiw0REFBWTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixvRUFBd0I7QUFDbEQ7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQix1QkFBdUIsNkNBQUs7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDZEQUFpQjtBQUM5Qyw0QkFBNEIsOERBQWtCO0FBQzlDLDhCQUE4Qiw4REFBa0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2REFBb0I7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsd0RBQVk7QUFDN0IsaUJBQWlCLDBEQUFjO0FBQy9CLGdCQUFnQixrRUFBZTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q25FLDZDQUE2QyxnRUFBb0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNkRBQWlCO0FBQ25EO0FBQ0E7QUFDQSxrREFBa0QsZ0VBQW9CO0FBQ3RFLGtEQUFrRCxnRUFBb0I7QUFDdEUsbURBQW1ELGdFQUFvQjtBQUN2RSxtREFBbUQsZ0VBQW9CO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDdUI7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9tYW5hZ2VyLm1qcz9jYzM4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBJbmRleGVkQ2FjaGUgfSBmcm9tIFwiLi4vLi4vaW5kZXhlZC1jYWNoZS5tanNcIjtcclxuaW1wb3J0IHsgUGh5c2ljc01hbmFnZXIgfSBmcm9tIFwiLi4vLi4vbWFuYWdlci5tanNcIjtcclxuaW1wb3J0IHsgQm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2JvZHkvc3lzdGVtLm1qc1wiO1xyXG5pbXBvcnQgeyBDaGFyQ29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4vY2hhci9zeXN0ZW0ubWpzXCI7XHJcbmltcG9ydCB7IFNoYXBlQ29tcG9uZW50IH0gZnJvbSBcIi4vY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBCVUZGRVJfV1JJVEVfVUlOVDE2LFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMiwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBCVUZGRVJfV1JJVEVfVkVDMzIsXHJcbiAgICBDTURfQ0FTVF9SQVksIENNRF9DQVNUX1NIQVBFLCBDTURfQ0hBTkdFX0dSQVZJVFksIENNRF9DUkVBVEVfQ09OU1RSQUlOVCxcclxuICAgIENNRF9DUkVBVEVfR1JPVVBTLCBDTURfQ1JFQVRFX1NIQVBFLCBDTURfREVTVFJPWV9DT05TVFJBSU5ULCBDTURfREVTVFJPWV9TSEFQRSwgQ01EX1NFVF9DT05TVFJBSU5UX0VOQUJMRUQsIENNRF9UT0dHTEVfR1JPVVBfUEFJUiwgQ09NUE9ORU5UX1NZU1RFTV9CT0RZLCBDT01QT05FTlRfU1lTVEVNX0NIQVIsIENPTVBPTkVOVF9TWVNURU1fTUFOQUdFUiwgQ09NUE9ORU5UX1NZU1RFTV9TT0ZUX0JPRFksIENPTVBPTkVOVF9TWVNURU1fVkVISUNMRSwgQ09OU1RSQUlOVF9UWVBFX0NPTkUsXHJcbiAgICBDT05TVFJBSU5UX1RZUEVfRElTVEFOQ0UsIENPTlNUUkFJTlRfVFlQRV9GSVhFRCwgQ09OU1RSQUlOVF9UWVBFX0hJTkdFLFxyXG4gICAgQ09OU1RSQUlOVF9UWVBFX1BPSU5ULCBDT05TVFJBSU5UX1RZUEVfU0lYX0RPRiwgQ09OU1RSQUlOVF9UWVBFX1NMSURFUixcclxuICAgIENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVCwgT1BFUkFUT1JfQ0xFQU5FUiwgT1BFUkFUT1JfQ1JFQVRPUiwgT1BFUkFUT1JfTU9ESUZJRVIsIE9QRVJBVE9SX1FVRVJJRVJcclxufSBmcm9tIFwiLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlSGFuZGxlciB9IGZyb20gXCIuL3Jlc3BvbnNlLWhhbmRsZXIubWpzXCI7XHJcbmltcG9ydCB7IFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4vc29mdGJvZHkvc3lzdGVtLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgVmVoaWNsZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL3ZlaGljbGUvc3lzdGVtLm1qc1wiO1xyXG5cclxuY2xhc3MgSm9sdE1hbmFnZXIgZXh0ZW5kcyBQaHlzaWNzTWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIG9wdHMsIHJlc29sdmUpIHtcclxuICAgICAgICBzdXBlcihhcHAsICdqb2x0Jywgb3B0cyk7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyBjb21wb25lbnQgc3lzdGVtcyB3aWxsIHVzZSBKb2x0IGNvbnN0YW50cywgd2hpY2hcclxuICAgICAgICAvLyBhcmUgbm90IGF2YWlsYWJsZSB1bnRpbCB3ZWJ3b3JrZXIgcmVzcG9uZHMgd2l0aCB0aGVtLlxyXG5cclxuICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IEJvZHlDb21wb25lbnRTeXN0ZW0oYXBwLCB0aGlzLCBDT01QT05FTlRfU1lTVEVNX0JPRFkpKTtcclxuICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IENoYXJDb21wb25lbnRTeXN0ZW0oYXBwLCB0aGlzLCBDT01QT05FTlRfU1lTVEVNX0NIQVIpKTtcclxuICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IFZlaGljbGVDb21wb25lbnRTeXN0ZW0oYXBwLCB0aGlzLCBDT01QT05FTlRfU1lTVEVNX1ZFSElDTEUpKTtcclxuICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtKGFwcCwgdGhpcywgQ09NUE9ORU5UX1NZU1RFTV9TT0ZUX0JPRFkpKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcXVlcnlNYXAgPSBuZXcgSW5kZXhlZENhY2hlKCk7XHJcbiAgICAgICAgdGhpcy5fY29uc3RyYWludE1hcCA9IG5ldyBJbmRleGVkQ2FjaGUoKTtcclxuICAgICAgICB0aGlzLl9zaGFwZU1hcCA9IG5ldyBJbmRleGVkQ2FjaGUoKTtcclxuICAgICAgICB0aGlzLl9ncmF2aXR5ID0gbmV3IHBjLlZlYzMoMCwgLTkuODEsIDApO1xyXG5cclxuICAgICAgICB0aGlzLl9yZXNvbHZlID0gcmVzb2x2ZTtcclxuXHJcbiAgICAgICAgdGhpcy5fc3lzdGVtcy5zZXQoQ09NUE9ORU5UX1NZU1RFTV9NQU5BR0VSLCB0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZ3Jhdml0eShncmF2aXR5KSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrVmVjKGdyYXZpdHksIGBJbnZhbGlkIGdyYXZpdHkgdmVjdG9yYCwgZ3Jhdml0eSk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuX2dyYXZpdHkuZXF1YWxzKGdyYXZpdHkpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyYXZpdHkuY29weShncmF2aXR5KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9NT0RJRklFUik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ0hBTkdFX0dSQVZJVFkpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShncmF2aXR5LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGdyYXZpdHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dyYXZpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHF1ZXJ5TWFwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeU1hcDtcclxuICAgIH1cclxuXHJcbiAgICBvbk1lc3NhZ2UobXNnKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IG1zZy5kYXRhIHx8IG1zZztcclxuXHJcbiAgICAgICAgc3VwZXIub25NZXNzYWdlKGRhdGEpO1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5jb25zdGFudHMpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRhdGEuZHJhd1ZpZXdzKSB7XHJcbiAgICAgICAgICAgIFNoYXBlQ29tcG9uZW50U3lzdGVtLmRlYnVnRHJhdyh0aGlzLl9hcHAsIGRhdGEuZHJhd1ZpZXdzLCB0aGlzLl9jb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm9jZXNzQ29tbWFuZHMoY2IpIHtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NBU1RfUkFZOlxyXG4gICAgICAgICAgICBjYXNlIENNRF9DQVNUX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VIYW5kbGVyLmhhbmRsZVF1ZXJ5KGNiLCB0aGlzLl9xdWVyeU1hcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIGNyZWF0ZVNoYXBlKHR5cGUsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICBjb25zdCBvcHRzID0ge1xyXG4gICAgICAgICAgICAvLyBkZWZhdWx0c1xyXG4gICAgICAgICAgICBkZW5zaXR5OiAxMDAwLFxyXG4gICAgICAgICAgICBzaGFwZVBvc2l0aW9uOiBuZXcgcGMuVmVjMygpLFxyXG4gICAgICAgICAgICBzaGFwZVJvdGF0aW9uOiBuZXcgcGMuVmVjMygpLFxyXG4gICAgICAgICAgICBzY2FsZTogbmV3IHBjLlZlYzMoMSwgMSwgMSksXHJcbiAgICAgICAgICAgIGhhbGZFeHRlbnQ6IG5ldyBwYy5WZWMzKDAuNSwgMC41LCAwLjUpLFxyXG4gICAgICAgICAgICBjb252ZXhSYWRpdXM6IDAuMDUsXHJcbiAgICAgICAgICAgIGhhbGZIZWlnaHQ6IDAuNSxcclxuICAgICAgICAgICAgcmFkaXVzOiAwLjUsXHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIG92ZXJyaWRlc1xyXG4gICAgICAgICAgICAuLi5vcHRpb25zLFxyXG5cclxuICAgICAgICAgICAgLy8gaGFyZCBydWxlc1xyXG4gICAgICAgICAgICBzaGFwZTogdHlwZSxcclxuICAgICAgICAgICAgdXNlRW50aXR5U2NhbGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc0NvbXBvdW5kQ2hpbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBtYXNzT2Zmc2V0OiBwYy5WZWMzLlpFUk9cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3NoYXBlTWFwLmFkZChvcHRzKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9TSEFQRSk7XHJcbiAgICAgICAgY2Iud3JpdGUoaW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgU2hhcGVDb21wb25lbnQud3JpdGVTaGFwZURhdGEoY2IsIG9wdHMsIHRydWUgLyogZm9yY2Ugd3JpdGUgcm90YXRpb24gKi8pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveVNoYXBlKGluZGV4KSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrVWludChpbmRleCwgYEludmFsaWQgc2hhcGUgbnVtYmVyOiAkeyBudW0gfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9vdXRCdWZmZXI7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfQ0xFQU5FUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9ERVNUUk9ZX1NIQVBFKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLl9zaGFwZU1hcC5mcmVlKGluZGV4KTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgY3JlYXRlRmlsdGVyR3JvdXBzKGdyb3Vwcykge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGdyb3Vwc0NvdW50ID0gZ3JvdXBzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9HUk9VUFMpO1xyXG4gICAgICAgIGNiLndyaXRlKGdyb3Vwc0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBzdWIgZ3JvdXBzIGNvdW50XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGdyb3Vwc1tpXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVHcm91cFBhaXIoZ3JvdXAsIHN1Ykdyb3VwMSwgc3ViR3JvdXAyLCBlbmFibGUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVWludChncm91cCwgYEludmFsaWQgZ3JvdXAgMTogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVWludChzdWJHcm91cDEsIGBJbnZhbGlkIGdyb3VwIDE6ICR7IHN1Ykdyb3VwMSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KHN1Ykdyb3VwMiwgYEludmFsaWQgZ3JvdXAgMjogJHsgc3ViR3JvdXAyIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Jvb2woZW5hYmxlLCBgSW52YWxpZCB0b2dnbGUgZmxhZzogJHsgZW5hYmxlIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX01PRElGSUVSKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX1RPR0dMRV9HUk9VUF9QQUlSKTtcclxuICAgICAgICBjYi53cml0ZShlbmFibGUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUoZ3JvdXAsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShzdWJHcm91cDEsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShzdWJHcm91cDIsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgY2FzdFJheShvcmlnaW4sIGRpciwgY2FsbGJhY2ssIG9wdHMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVmVjKG9yaWdpbixgSW52YWxpZCBvcmlnaW4gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMoZGlyLCBgSW52YWxpZCBkaXJlY3Rpb24gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KGNhbGxiYWNrLCAnY2FzdFJheSByZXF1aXJlcyBhIGNhbGxiYWNrIGZ1bmN0aW9uIGNhc3RSYXkob3JpZ2luLCBkaXIsIGNhbGxiYWNrLCBvcHRzKScpO1xyXG4gICAgICAgICAgICBpZiAob2sgJiYgb3B0cz8uZmlyc3RPbmx5ICE9IG51bGwpIG9rID0gRGVidWcuY2hlY2tCb29sKG9wdHMuZmlyc3RPbmx5KTtcclxuICAgICAgICAgICAgaWYgKG9rICYmIG9wdHM/LmNhbGN1bGF0ZU5vcm1hbCAhPSBudWxsKSBvayA9IERlYnVnLmNoZWNrQm9vbChvcHRzLmNhbGN1bGF0ZU5vcm1hbCk7XHJcbiAgICAgICAgICAgIGlmIChvayAmJiBvcHRzPy5pZ25vcmVCYWNrRmFjZXMgIT0gbnVsbCkgb2sgPSBEZWJ1Zy5jaGVja0Jvb2wob3B0cy5pZ25vcmVCYWNrRmFjZXMpO1xyXG4gICAgICAgICAgICBpZiAob2sgJiYgb3B0cz8udHJlYXRDb252ZXhBc1NvbGlkICE9IG51bGwpIG9rID0gRGVidWcuY2hlY2tCb29sKG9wdHMudHJlYXRDb252ZXhBc1NvbGlkKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrSW5kZXggPSB0aGlzLl9xdWVyeU1hcC5hZGQoY2FsbGJhY2spO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX1FVRVJJRVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ0FTVF9SQVkpO1xyXG4gICAgICAgIGNiLndyaXRlKGNhbGxiYWNrSW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShvcmlnaW4sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGRpciwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uZmlyc3RPbmx5LCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uY2FsY3VsYXRlTm9ybWFsLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uaWdub3JlQmFja0ZhY2VzLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8udHJlYXRDb252ZXhBc1NvbGlkLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FzdFNoYXBlKHNoYXBlSW5kZXgsIHBvcywgcm90LCBkaXIsIGNhbGxiYWNrLCBvcHRzKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0ludChzaGFwZUluZGV4LCBgSW52YWxpZCBzaGFwZSBpbmRleGApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKHBvcywgYEludmFsaWQgY2FzdCBzaGFwZSBwb3NpdGlvbiB2ZWN0b3JgKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhkaXIsIGBJbnZhbGlkIGNhc3Qgc2hhcGUgZGlyZWN0aW9uIHZlY3RvcmApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrUXVhdChyb3QsIGBJbnZhbGlkIGNhc3Qgc2hhcGUgcm90YXRpb25gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IHF1ZXJ5SW5kZXggPSB0aGlzLl9xdWVyeU1hcC5hZGQoY2FsbGJhY2spO1xyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gZ2V0IHJpZCBvZiBmbGFnc1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX1FVRVJJRVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ0FTVF9TSEFQRSk7XHJcbiAgICAgICAgY2Iud3JpdGUocXVlcnlJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHBvcywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShkaXIsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LnNjYWxlLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/Lm9mZnNldCwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5iYWNrRmFjZU1vZGVUcmlhbmdsZXMsIEJVRkZFUl9XUklURV9VSU5UOCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uYmFja0ZhY2VNb2RlQ29udmV4LCBCVUZGRVJfV1JJVEVfVUlOVDgpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LnVzZVNocnVua2VuU2hhcGVBbmRDb252ZXhSYWRpdXMsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5yZXR1cm5EZWVwZXN0UG9pbnQsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gc2VwYXJhdGUgYSBjYXN0IGludG8gW3NpbmdsZSByZXN1bHQgLyBtdWx0aXBsZSByZXN1bHRzXSBjb21tYW5kc1xyXG4gICAgICAgIC8vIHNvIHdlIGRvbid0IGFsbG9jYXRlIG5ldyBhcnJheSBmb3IgYSBzaW5nbGUgcmVzdWx0IHF1ZXJ5XHJcbiAgICAgICAgLy8gYWZ0ZXIgd2UgZ2V0IGJhY2sgZnJvbSB0aGUgYmFja2VuZFxyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LmZpcnN0T25seSwgQlVGRkVSX1dSSVRFX0JPT0wpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LmNhbGN1bGF0ZU5vcm1hbCwgQlVGRkVSX1dSSVRFX0JPT0wpO1xyXG4gICAgICAgIGNiLndyaXRlKHNoYXBlSW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb25zdHJhaW50KHR5cGUsIGVudGl0eTEsIGVudGl0eTIsIG9wdHMgPSB7fSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuYXNzZXJ0KCEhZW50aXR5MS5jLmJvZHksIGBFbnRpdHkgaGFzIG5vIEJvZHkgQ29tcG9uZW50LiBDYW5ub3QgY3JlYXRlIGNvbnN0cmFpbnQuYCwgZW50aXR5MSk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhZW50aXR5Mi5jLmJvZHksIGBFbnRpdHkgaGFzIG5vIEJvZHkgQ29tcG9uZW50LiBDYW5ub3QgY3JlYXRlIGNvbnN0cmFpbnQuYCwgZW50aXR5Mik7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fY29uc3RyYWludE1hcC5hZGQoeyBlbnRpdHkxLCBlbnRpdHkyIH0pO1xyXG5cclxuICAgICAgICBlbnRpdHkxLmJvZHkuY29uc3RyYWludHMuc2V0KGluZGV4LCBlbnRpdHkyKTtcclxuICAgICAgICBlbnRpdHkyLmJvZHkuY29uc3RyYWludHMuc2V0KGluZGV4LCBlbnRpdHkxKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9DT05TVFJBSU5UKTtcclxuICAgICAgICBjYi53cml0ZSh0eXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUoaW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShlbnRpdHkxLmMuYm9keS5pbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGVudGl0eTIuYy5ib2R5LmluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9GSVhFRDpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlRml4ZWRDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfUE9JTlQ6XHJcbiAgICAgICAgICAgICAgICBKb2x0TWFuYWdlci53cml0ZVBvaW50Q29uc3RyYWludChjYiwgb3B0cyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0RJU1RBTkNFOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVEaXN0YW5jZUNvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9ISU5HRTpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlSGluZ2VDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfU0xJREVSOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTbGlkZXJDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfQ09ORTpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlQ29uZUNvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVDpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3dpbmdUd2lzdENvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TSVhfRE9GOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTaXhEb2ZDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgVW5yZWNvZ25pemVkIGNvbnN0cmFpbnQgdHlwZTogJHsgdHlwZSB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZShvcHRzLm51bVZlbG9jaXR5U3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQ4KTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm51bVBvc2l0aW9uU3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQ4KTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnNwYWNlLCBCVUZGRVJfV1JJVEVfVUlOVDgpO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveUNvbnN0cmFpbnQoaW5kZXgpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tVaW50KGluZGV4LCBgSW52YWxpZCBpbmRleCBvZiBhIGNvbnN0cmFpbnQgdHJ5aW5nIHRvIGRlc3Ryb3k6ICR7IGluZGV4IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NMRUFORVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfREVTVFJPWV9DT05TVFJBSU5UKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLmZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpIHtcclxuICAgICAgICB0aGlzLl9jb25zdHJhaW50TWFwLmZyZWUoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbnN0cmFpbnRFbmFibGVkKGluZGV4LCBlbmFibGVkLCBhY3RpdmF0ZSA9IHRydWUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVWludChpbmRleCwgYEludmFsaWQgY29uc3RyYWludCBpbmRleDogJHsgaW5kZXggfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrQm9vbChlbmFibGVkLCBgSW52YWxpZCBjb25zdHJhaW50IGVuYWJsZSBib29sOiAkeyBlbmFibGVkIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Jvb2woZW5hYmxlZCwgYEludmFsaWQgYWN0aXZhdGUgYm9vbDogJHsgZW5hYmxlZCB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX291dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9NT0RJRklFUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9TRVRfQ09OU1RSQUlOVF9FTkFCTEVEKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGVuYWJsZWQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUoYWN0aXZhdGUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX2ZpeGVkX2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlRml4ZWRDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5hdXRvRGV0ZWN0UG9pbnQsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBpZiAoIW9wdHMuYXV0b0RldGVjdFBvaW50KSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShvcHRzLnBvaW50MiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5heGlzWDEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5heGlzWTEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5heGlzWDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5heGlzWTIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX3BvaW50X2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlUG9pbnRDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX2Rpc3RhbmNlX2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlRGlzdGFuY2VDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5taW5EaXN0YW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWF4RGlzdGFuY2UsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTcHJpbmdTZXR0aW5ncyhjYiwgb3B0cy5zcHJpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX2hpbmdlX2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlSGluZ2VDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5oaW5nZUF4aXMxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubm9ybWFsQXhpczEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5oaW5nZUF4aXMyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubm9ybWFsQXhpczIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5saW1pdHNNaW4sIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmxpbWl0c01heCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWF4RnJpY3Rpb25Ub3JxdWUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTcHJpbmdTZXR0aW5ncyhjYiwgb3B0cy5zcHJpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVNb3RvclNldHRpbmdzKGNiLCBvcHRzLm1vdG9yU2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19zbGlkZXJfY29uc3RyYWludF9zZXR0aW5ncy5odG1sXHJcbiAgICBzdGF0aWMgd3JpdGVTbGlkZXJDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5hdXRvRGV0ZWN0UG9pbnQsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBpZiAoIW9wdHMuYXV0b0RldGVjdFBvaW50KSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShvcHRzLnBvaW50MiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5zbGlkZXJBeGlzMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm5vcm1hbEF4aXMxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuc2xpZGVyQXhpczIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5ub3JtYWxBeGlzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmxpbWl0c01pbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubGltaXRzTWF4LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5tYXhGcmljdGlvbkZvcmNlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIG9wdHMuc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlTW90b3JTZXR0aW5ncyhjYiwgb3B0cy5tb3RvclNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBodHRwczovL2pyb3V3ZS5naXRodWIuaW8vSm9sdFBoeXNpY3MvY2xhc3NfY29uZV9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZUNvbmVDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy50d2lzdEF4aXMxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RBeGlzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmhhbGZDb25lQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBodHRwczovL2pyb3V3ZS5naXRodWIuaW8vSm9sdFBoeXNpY3MvY2xhc3Nfc3dpbmdfdHdpc3RfY29uc3RyYWludF9zZXR0aW5ncy5odG1sXHJcbiAgICBzdGF0aWMgd3JpdGVTd2luZ1R3aXN0Q29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9zaXRpb24xLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RBeGlzMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBsYW5lQXhpczEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wb3NpdGlvbjIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy50d2lzdEF4aXMyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucGxhbmVBeGlzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm5vcm1hbEhhbGZDb25lQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBsYW5lSGFsZkNvbmVBbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RNaW5BbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RNYXhBbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWF4RnJpY3Rpb25Ub3JxdWUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVNb3RvclNldHRpbmdzKGNiLCBvcHRzLnN3aW5nTW90b3JTZXR0aW5ncyk7XHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVNb3RvclNldHRpbmdzKGNiLCBvcHRzLnR3aXN0TW90b3JTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX3NpeF9kX29fZl9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZVNpeERvZkNvbnN0cmFpbnQoY2IsIG9wdHMpIHtcclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZUF4ZXMoY2IsIG9wdHMuZnJlZUF4ZXMpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlQXhlcyhjYiwgb3B0cy5maXhlZEF4ZXMpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlQXhlcyhjYiwgb3B0cy5saW1pdGVkQXhlcywgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9zaXRpb24xLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1gxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1kxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9zaXRpb24yLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1gyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1kyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWF4RnJpY3Rpb24sIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmxpbWl0c01pbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubGltaXRzTWF4LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIG9wdHMuc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlTW90b3JTZXR0aW5ncyhjYiwgb3B0cy5tb3RvclNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgd3JpdGVBeGVzKGNiLCBheGVzLCBsaW1pdHMpIHtcclxuICAgICAgICBjYi53cml0ZSghIWF4ZXMsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGF4ZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBheGVzLmxlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGxpbWl0cykge1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoY291bnQgLyAzLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKz0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGF4ZXNbaV0sIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGF4ZXNbaSArIDFdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGF4ZXNbaSArIDJdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoYXhlc1tpXSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIHNwcmluZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUoISFzcHJpbmdTZXR0aW5ncywgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAoc3ByaW5nU2V0dGluZ3MgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmdTZXR0aW5ncy5zcHJpbmdNb2RlLCBCVUZGRVJfV1JJVEVfVUlOVDgpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmdTZXR0aW5ncy5mcmVxdWVuY3ksIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoc3ByaW5nU2V0dGluZ3Muc3RpZmZuZXNzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNwcmluZ1NldHRpbmdzLmRhbXBpbmcsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlTW90b3JTZXR0aW5ncyhjYiwgbW90b3JTZXR0aW5ncykge1xyXG4gICAgICAgIGNiLndyaXRlKCEhbW90b3JTZXR0aW5ncywgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAobW90b3JTZXR0aW5ncyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3dyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIG1vdG9yU2V0dGluZ3Muc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShtb3RvclNldHRpbmdzLm1pbkZvcmNlTGltaXQsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUobW90b3JTZXR0aW5ncy5tYXhGb3JjZUxpbWl0LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKG1vdG9yU2V0dGluZ3MubWluVG9ycXVlTGltaXQsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUobW90b3JTZXR0aW5ncy5tYXhUb3JxdWVMaW1pdCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEpvbHRNYW5hZ2VyIH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/manager.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/response-handler.mjs":
/*!**********************************************************!*\
  !*** ./src/physics/components/jolt/response-handler.mjs ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ResponseHandler: () => (/* binding */ ResponseHandler)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\nclass ContactResult {\r\n    constructor(entity, normal, depth, point = null, offset = null, points1 = null, points2 = null) {\r\n        this.entity = entity;\r\n        this.normal = normal;\r\n        this.penetrationDepth = depth;\r\n        if (point) this.point = point;\r\n        if (offset) this.offset = offset;\r\n        if (points1) this.points1 = points1;\r\n        if (points2) this.points2 = points2;\r\n    }\r\n}\r\n\r\nclass CharContactResult {\r\n    constructor(entity, contactPosition, contactNormal, contactVelocity, newCharVelocity) {\r\n        this.entity = entity;\r\n        this.contactPosition = contactPosition;\r\n        this.contactNormal = contactNormal;\r\n        this.contactVelocity = contactVelocity;\r\n        this.newCharVelocity = newCharVelocity;\r\n    }\r\n}\r\n\r\nclass RaycastResult {\r\n    constructor(entity, point, normal) {\r\n        this.entity = entity;\r\n        this.point = point;\r\n        if (normal) {\r\n            this.normal = normal;\r\n        }\r\n    }\r\n}\r\n\r\nclass ResponseHandler {\r\n    static handleContact(cb, map) {\r\n        const count = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const type = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT8);\r\n            const isValidBody1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n            const isValidBody2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n\r\n            let idx1 = null;\r\n            if (isValidBody1) {\r\n                idx1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            }\r\n\r\n            let idx2 = null;\r\n            if (isValidBody2) {\r\n                idx2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            }\r\n\r\n            const entity1 = map.get(idx1);\r\n            const entity2 = map.get(idx2);\r\n\r\n            switch (type) {\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_ADDED: {\r\n                    const normal = pc.Vec3.fromBuffer(cb);\r\n                    const depth = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n                    const contactPoints = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n                    let point, points1, points2, offset;\r\n\r\n                    if (contactPoints) {\r\n                        const averaged = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n\r\n                        if (averaged) {\r\n                            point = pc.Vec3.fromBuffer(cb);\r\n                        } else {\r\n                            offset = pc.Vec3.fromBuffer(cb);\r\n                            const count1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n                            const count2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n                            points1 = [];\r\n                            points2 = [];\r\n                            for (let i = 0; i < count1; i++) {\r\n                                points1.push(pc.Vec3.fromBuffer(cb));\r\n                            }\r\n                            for (let i = 0; i < count2; i++) {\r\n                                points2.push(pc.Vec3.fromBuffer(cb));\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    const event = 'contact:added';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        const contactResult = new ContactResult(entity2, normal, depth, point, offset, points1, points2);\r\n                        entity1.fire(event, contactResult);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        const contactResult = new ContactResult(entity1, normal, depth, point, offset, points1, points2);\r\n                        entity2.fire(event, contactResult);\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_PERSISTED: {\r\n                    const event = 'contact:persisted';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        entity1.fire(event, entity2);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        entity2.fire(event, entity1);\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_REMOVED: {\r\n                    const event = 'contact:removed';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        entity1.fire(event, entity2);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        entity2.fire(event, entity1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static handleCharContacts(cb, map) {\r\n        const charsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n        for (let c = 0; c < charsCount; c++) {\r\n            const charIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            const contactsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            const charEntity = map.get(charIndex);\r\n            const results = [];\r\n\r\n            if (!charEntity.hasEvent('contact:char')) {\r\n                cb.skip(1 * contactsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE);\r\n                cb.skip(13 * contactsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n                continue;\r\n            }\r\n\r\n            for (let i = 0; i < contactsCount; i++) {\r\n                const isValidBody2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n                const otherIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n                let otherEntity = null;\r\n                if (isValidBody2) {\r\n                    otherEntity = map.get(otherIndex) || null;\r\n                }\r\n    \r\n                const cp = pc.Vec3.fromBuffer(cb); // contact position\r\n                const cn = pc.Vec3.fromBuffer(cb); // contact normal\r\n                const cv = pc.Vec3.fromBuffer(cb); // contact velocity\r\n                const nv = pc.Vec3.fromBuffer(cb); // new char velocity\r\n    \r\n                const result = new CharContactResult(otherEntity, cp, cn, cv, nv);    \r\n                results.push(result);\r\n            }\r\n\r\n            charEntity.fire('contact:char', results);\r\n        }\r\n    }\r\n\r\n    static handleQuery(buffer, queryMap) {\r\n        const results = [];\r\n\r\n        const queryIndex = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16);\r\n        const hitsCount = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16);\r\n\r\n        for (let i = 0; i < hitsCount; i++) {\r\n            const bodyIndex = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n            const point = new pc.Vec3(\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n\r\n            let normal;\r\n            if (buffer.flag) {\r\n                normal = new pc.Vec3(\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n            }\r\n\r\n            const entity = _system_mjs__WEBPACK_IMPORTED_MODULE_2__.ShapeComponentSystem.entityMap.get(bodyIndex);\r\n            if (!entity) {\r\n                // Entity could have been deleted by the time the raycast result arrived.\r\n                // We just ignore this result then.\r\n                continue;\r\n            }\r\n\r\n            results.push(new RaycastResult(entity, point, normal));\r\n        }\r\n\r\n        const callback = queryMap.get(queryIndex);\r\n        queryMap.free(queryIndex);\r\n        callback?.(results);\r\n    }\r\n\r\n    static handleCharSetShape(cb, queryMap) {\r\n        const cbIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n        const callback = queryMap.get(cbIndex);\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !callback) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn(`Unable to locate callback with index: ${ cbIndex }`);\r\n            return;\r\n        }\r\n\r\n        queryMap.free(cbIndex);\r\n        callback();\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvcmVzcG9uc2UtaGFuZGxlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF3QztBQUtmO0FBQzJCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsOERBQWtCO0FBQ2hEO0FBQ0Esd0JBQXdCLFdBQVc7QUFDbkMsaUNBQWlDLDZEQUFpQjtBQUNsRCx5Q0FBeUMsNERBQWdCO0FBQ3pELHlDQUF5Qyw0REFBZ0I7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDhEQUFrQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiw4REFBa0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDhEQUFrQjtBQUN2QztBQUNBLDBDQUEwQywrREFBbUI7QUFDN0Qsa0RBQWtELDREQUFnQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsNERBQWdCO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBLG1EQUFtRCw4REFBa0I7QUFDckUsbURBQW1ELDhEQUFrQjtBQUNyRTtBQUNBO0FBQ0EsNENBQTRDLFlBQVk7QUFDeEQ7QUFDQTtBQUNBLDRDQUE0QyxZQUFZO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsa0VBQXNCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLGdFQUFvQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyw4REFBa0I7QUFDckQ7QUFDQSx3QkFBd0IsZ0JBQWdCO0FBQ3hDLHNDQUFzQyw4REFBa0I7QUFDeEQsMENBQTBDLDhEQUFrQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxzREFBVTtBQUNyRCw0Q0FBNEMsd0RBQVk7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG1CQUFtQjtBQUMvQyw2Q0FBNkMsNERBQWdCO0FBQzdELDJDQUEyQyw4REFBa0I7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25ELG1EQUFtRDtBQUNuRCxtREFBbUQ7QUFDbkQsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1Qyw4REFBa0I7QUFDekQsc0NBQXNDLDhEQUFrQjtBQUN4RDtBQUNBLHdCQUF3QixlQUFlO0FBQ3ZDLDBDQUEwQyw4REFBa0I7QUFDNUQ7QUFDQTtBQUNBLDRCQUE0QiwrREFBbUI7QUFDL0MsNEJBQTRCLCtEQUFtQjtBQUMvQyw0QkFBNEIsK0RBQW1CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsK0RBQW1CO0FBQ25ELGdDQUFnQywrREFBbUI7QUFDbkQsZ0NBQWdDLCtEQUFtQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsNkRBQW9CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyw4REFBa0I7QUFDbEQ7QUFDQTtBQUNBLFlBQVksNkNBQUs7QUFDakIsWUFBWSw2Q0FBSyxnREFBZ0QsU0FBUztBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvcmVzcG9uc2UtaGFuZGxlci5tanM/ODYzNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHtcclxuICAgIENPTlRBQ1RfVFlQRV9BRERFRCwgQ09OVEFDVF9UWVBFX1BFUlNJU1RFRCwgQ09OVEFDVF9UWVBFX1JFTU9WRUQsXHJcbiAgICBCVUZGRVJfUkVBRF9CT09MLCBCVUZGRVJfUkVBRF9GTE9BVDMyLCBCVUZGRVJfUkVBRF9VSU5UMTYsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UMzIsIEJVRkZFUl9SRUFEX1VJTlQ4LCBGTE9BVDMyX1NJWkUsIFVJTlQ4X1NJWkVcclxufSBmcm9tIFwiLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFNoYXBlQ29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4vc3lzdGVtLm1qc1wiO1xyXG5cclxuY2xhc3MgQ29udGFjdFJlc3VsdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbnRpdHksIG5vcm1hbCwgZGVwdGgsIHBvaW50ID0gbnVsbCwgb2Zmc2V0ID0gbnVsbCwgcG9pbnRzMSA9IG51bGwsIHBvaW50czIgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICAgICAgdGhpcy5ub3JtYWwgPSBub3JtYWw7XHJcbiAgICAgICAgdGhpcy5wZW5ldHJhdGlvbkRlcHRoID0gZGVwdGg7XHJcbiAgICAgICAgaWYgKHBvaW50KSB0aGlzLnBvaW50ID0gcG9pbnQ7XHJcbiAgICAgICAgaWYgKG9mZnNldCkgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7XHJcbiAgICAgICAgaWYgKHBvaW50czEpIHRoaXMucG9pbnRzMSA9IHBvaW50czE7XHJcbiAgICAgICAgaWYgKHBvaW50czIpIHRoaXMucG9pbnRzMiA9IHBvaW50czI7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIENoYXJDb250YWN0UmVzdWx0IHtcclxuICAgIGNvbnN0cnVjdG9yKGVudGl0eSwgY29udGFjdFBvc2l0aW9uLCBjb250YWN0Tm9ybWFsLCBjb250YWN0VmVsb2NpdHksIG5ld0NoYXJWZWxvY2l0eSkge1xyXG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xyXG4gICAgICAgIHRoaXMuY29udGFjdFBvc2l0aW9uID0gY29udGFjdFBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMuY29udGFjdE5vcm1hbCA9IGNvbnRhY3ROb3JtYWw7XHJcbiAgICAgICAgdGhpcy5jb250YWN0VmVsb2NpdHkgPSBjb250YWN0VmVsb2NpdHk7XHJcbiAgICAgICAgdGhpcy5uZXdDaGFyVmVsb2NpdHkgPSBuZXdDaGFyVmVsb2NpdHk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFJheWNhc3RSZXN1bHQge1xyXG4gICAgY29uc3RydWN0b3IoZW50aXR5LCBwb2ludCwgbm9ybWFsKSB7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICAgICAgdGhpcy5wb2ludCA9IHBvaW50O1xyXG4gICAgICAgIGlmIChub3JtYWwpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3JtYWwgPSBub3JtYWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBSZXNwb25zZUhhbmRsZXIge1xyXG4gICAgc3RhdGljIGhhbmRsZUNvbnRhY3QoY2IsIG1hcCkge1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgdHlwZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkQm9keTEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkQm9keTIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGlkeDEgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoaXNWYWxpZEJvZHkxKSB7XHJcbiAgICAgICAgICAgICAgICBpZHgxID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgaWR4MiA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTIpIHtcclxuICAgICAgICAgICAgICAgIGlkeDIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eTEgPSBtYXAuZ2V0KGlkeDEpO1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkyID0gbWFwLmdldChpZHgyKTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBDT05UQUNUX1RZUEVfQURERUQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBub3JtYWwgPSBwYy5WZWMzLmZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWN0UG9pbnRzID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcG9pbnQsIHBvaW50czEsIHBvaW50czIsIG9mZnNldDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhY3RQb2ludHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZlcmFnZWQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2ZXJhZ2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludCA9IHBjLlZlYzMuZnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBwYy5WZWMzLmZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQxID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzMSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzMiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50czEucHVzaChwYy5WZWMzLmZyb21CdWZmZXIoY2IpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQyOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMyLnB1c2gocGMuVmVjMy5mcm9tQnVmZmVyKGNiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gJ2NvbnRhY3Q6YWRkZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkxPy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGFjdFJlc3VsdCA9IG5ldyBDb250YWN0UmVzdWx0KGVudGl0eTIsIG5vcm1hbCwgZGVwdGgsIHBvaW50LCBvZmZzZXQsIHBvaW50czEsIHBvaW50czIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkxLmZpcmUoZXZlbnQsIGNvbnRhY3RSZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5Mj8uaGFzRXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhY3RSZXN1bHQgPSBuZXcgQ29udGFjdFJlc3VsdChlbnRpdHkxLCBub3JtYWwsIGRlcHRoLCBwb2ludCwgb2Zmc2V0LCBwb2ludHMxLCBwb2ludHMyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5Mi5maXJlKGV2ZW50LCBjb250YWN0UmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBDT05UQUNUX1RZUEVfUEVSU0lTVEVEOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSAnY29udGFjdDpwZXJzaXN0ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkxPy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5MS5maXJlKGV2ZW50LCBlbnRpdHkyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eTI/Lmhhc0V2ZW50KGV2ZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkyLmZpcmUoZXZlbnQsIGVudGl0eTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIENPTlRBQ1RfVFlQRV9SRU1PVkVEOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSAnY29udGFjdDpyZW1vdmVkJztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5MT8uaGFzRXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eTEuZmlyZShldmVudCwgZW50aXR5Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkyPy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5Mi5maXJlKGV2ZW50LCBlbnRpdHkxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhbmRsZUNoYXJDb250YWN0cyhjYiwgbWFwKSB7XHJcbiAgICAgICAgY29uc3QgY2hhcnNDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjaGFyc0NvdW50OyBjKyspIHtcclxuICAgICAgICAgICAgY29uc3QgY2hhckluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWN0c0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICBjb25zdCBjaGFyRW50aXR5ID0gbWFwLmdldChjaGFySW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAoIWNoYXJFbnRpdHkuaGFzRXZlbnQoJ2NvbnRhY3Q6Y2hhcicpKSB7XHJcbiAgICAgICAgICAgICAgICBjYi5za2lwKDEgKiBjb250YWN0c0NvdW50LCBVSU5UOF9TSVpFKTtcclxuICAgICAgICAgICAgICAgIGNiLnNraXAoMTMgKiBjb250YWN0c0NvdW50LCBGTE9BVDMyX1NJWkUpO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29udGFjdHNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkQm9keTIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgb3RoZXJFbnRpdHkgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRCb2R5Mikge1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyRW50aXR5ID0gbWFwLmdldChvdGhlckluZGV4KSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjcCA9IHBjLlZlYzMuZnJvbUJ1ZmZlcihjYik7IC8vIGNvbnRhY3QgcG9zaXRpb25cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNuID0gcGMuVmVjMy5mcm9tQnVmZmVyKGNiKTsgLy8gY29udGFjdCBub3JtYWxcclxuICAgICAgICAgICAgICAgIGNvbnN0IGN2ID0gcGMuVmVjMy5mcm9tQnVmZmVyKGNiKTsgLy8gY29udGFjdCB2ZWxvY2l0eVxyXG4gICAgICAgICAgICAgICAgY29uc3QgbnYgPSBwYy5WZWMzLmZyb21CdWZmZXIoY2IpOyAvLyBuZXcgY2hhciB2ZWxvY2l0eVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgQ2hhckNvbnRhY3RSZXN1bHQob3RoZXJFbnRpdHksIGNwLCBjbiwgY3YsIG52KTsgICAgXHJcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2hhckVudGl0eS5maXJlKCdjb250YWN0OmNoYXInLCByZXN1bHRzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhbmRsZVF1ZXJ5KGJ1ZmZlciwgcXVlcnlNYXApIHtcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gW107XHJcblxyXG4gICAgICAgIGNvbnN0IHF1ZXJ5SW5kZXggPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIGNvbnN0IGhpdHNDb3VudCA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0c0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgYm9keUluZGV4ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBvaW50ID0gbmV3IHBjLlZlYzMoXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBub3JtYWw7XHJcbiAgICAgICAgICAgIGlmIChidWZmZXIuZmxhZykge1xyXG4gICAgICAgICAgICAgICAgbm9ybWFsID0gbmV3IHBjLlZlYzMoXHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eSA9IFNoYXBlQ29tcG9uZW50U3lzdGVtLmVudGl0eU1hcC5nZXQoYm9keUluZGV4KTtcclxuICAgICAgICAgICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgICAgICAgICAgIC8vIEVudGl0eSBjb3VsZCBoYXZlIGJlZW4gZGVsZXRlZCBieSB0aGUgdGltZSB0aGUgcmF5Y2FzdCByZXN1bHQgYXJyaXZlZC5cclxuICAgICAgICAgICAgICAgIC8vIFdlIGp1c3QgaWdub3JlIHRoaXMgcmVzdWx0IHRoZW4uXHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKG5ldyBSYXljYXN0UmVzdWx0KGVudGl0eSwgcG9pbnQsIG5vcm1hbCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBxdWVyeU1hcC5nZXQocXVlcnlJbmRleCk7XHJcbiAgICAgICAgcXVlcnlNYXAuZnJlZShxdWVyeUluZGV4KTtcclxuICAgICAgICBjYWxsYmFjaz8uKHJlc3VsdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBoYW5kbGVDaGFyU2V0U2hhcGUoY2IsIHF1ZXJ5TWFwKSB7XHJcbiAgICAgICAgY29uc3QgY2JJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IHF1ZXJ5TWFwLmdldChjYkluZGV4KTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgRGVidWcud2FybihgVW5hYmxlIHRvIGxvY2F0ZSBjYWxsYmFjayB3aXRoIGluZGV4OiAkeyBjYkluZGV4IH1gKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcXVlcnlNYXAuZnJlZShjYkluZGV4KTtcclxuICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBSZXNwb25zZUhhbmRsZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/response-handler.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/softbody/component.mjs":
/*!************************************************************!*\
  !*** ./src/physics/components/jolt/softbody/component.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SoftBodyComponent: () => (/* binding */ SoftBodyComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\n\r\nclass SoftBodyComponent extends _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponent {\r\n    // amount of substance * ideal gass constant * absolute temperature\r\n    // n * R * T\r\n    // see https://en.wikipedia.org/wiki/Pressure\r\n    _pressure = 0;\r\n\r\n    // Update the position of the body while simulating (set to false for something\r\n    // that is attached to the static world)\r\n    _updatePosition = true;\r\n\r\n    // Bake specified mRotation in the vertices and set the body rotation to identity (simulation is slightly more accurate if the rotation of a soft body is kept to identity)\r\n    _makeRotationIdentity = true;\r\n\r\n    // Number of solver iterations\r\n    _numIterations = 5;\r\n\r\n    // Inverse of the stiffness of the spring.\r\n    _compliance = 0;\r\n\r\n    // Number of cells comprising a row. Think of a grid divided plane.\r\n    _width = 0;\r\n\r\n    // Number of cells comprising a column. Think of a grid divided plane.\r\n    _length = 0;\r\n\r\n    _fixedIndices = [];\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        this._writeShapeData(cb, this);\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // We always use world position and rotation from the current entity the component\r\n        // is attached to (instead of default zero vectors)\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // TODO\r\n        // get rid of flags\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n\r\n        cb.write(this._collisionGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32);\r\n        cb.write(this._subGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32);\r\n\r\n        cb.write(this._objectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._numIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._linearDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxLinearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._restitution, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._friction, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._pressure, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._gravityFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._updatePosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._makeRotationIdentity, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._allowSleeping, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n\r\n    onEnable() {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            if (!this._renderAsset && !this._meshes) {\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Unable to locate mesh data for a soft body', this);\r\n                return;\r\n            }\r\n        }\r\n\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        if (this._renderAsset && !this._meshes) {\r\n            this._addMeshes();\r\n        } else {\r\n            system.createBody(this);\r\n        }\r\n    }\r\n\r\n    _writeShapeData(cb) {\r\n        let useEntityScale = this._useEntityScale;\r\n        let scale;\r\n        if (useEntityScale) {\r\n            scale = this.entity.getLocalScale();\r\n            if (scale.x === 1 && scale.y === 1 && scale.z === 1) {\r\n                useEntityScale = false;\r\n            }\r\n        }\r\n\r\n        cb.write(useEntityScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        if (useEntityScale) {\r\n            // Potential precision loss 64 -> 32\r\n            cb.write(scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    \r\n        _component_mjs__WEBPACK_IMPORTED_MODULE_2__.ShapeComponent.addMeshes(this._meshes, cb);\r\n\r\n        cb.write(this._width, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._length, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._compliance, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        const fixed = this._fixedIndices;\r\n        const count = fixed.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        for (let i = 0; i < count; i++) {\r\n            cb.write(fixed[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvY29tcG9uZW50Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEyQztBQUNXO0FBQ0o7QUFDdUY7QUFDekk7QUFDQSxnQ0FBZ0MsOERBQWE7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLCtEQUFtQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDhEQUFrQjtBQUN4QyxzQkFBc0IsOERBQWtCO0FBQ3hDO0FBQ0EsdUNBQXVDLCtEQUFtQjtBQUMxRCxpQ0FBaUMsK0RBQW1CO0FBQ3BEO0FBQ0Esb0NBQW9DLCtEQUFtQjtBQUN2RCxzQ0FBc0MsK0RBQW1CO0FBQ3pELHNDQUFzQyxnRUFBb0I7QUFDMUQsMENBQTBDLGdFQUFvQjtBQUM5RCxvQ0FBb0MsZ0VBQW9CO0FBQ3hELGlDQUFpQyxnRUFBb0I7QUFDckQsaUNBQWlDLGdFQUFvQjtBQUNyRCxzQ0FBc0MsZ0VBQW9CO0FBQzFELHVDQUF1Qyw2REFBaUI7QUFDeEQsNkNBQTZDLDZEQUFpQjtBQUM5RCxzQ0FBc0MsNkRBQWlCO0FBQ3ZEO0FBQ0EsUUFBUSw2Q0FBSyxrQ0FBa0MsNkRBQWlCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBLFlBQVksNkNBQUs7QUFDakI7QUFDQSxnQkFBZ0IsNkNBQUs7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw2REFBaUI7QUFDbEQ7QUFDQTtBQUNBLDRCQUE0Qiw4REFBa0I7QUFDOUM7QUFDQTtBQUNBLFFBQVEsMERBQWM7QUFDdEI7QUFDQSw4QkFBOEIsK0RBQW1CO0FBQ2pELCtCQUErQiwrREFBbUI7QUFDbEQsbUNBQW1DLGdFQUFvQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwrREFBbUI7QUFDM0Msd0JBQXdCLFdBQVc7QUFDbkMsK0JBQStCLCtEQUFtQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvY29tcG9uZW50Lm1qcz8wOGJjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCb2R5Q29tcG9uZW50IH0gZnJvbSBcIi4uL2JvZHkvY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7IEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuXHJcbmNsYXNzIFNvZnRCb2R5Q29tcG9uZW50IGV4dGVuZHMgQm9keUNvbXBvbmVudCB7XHJcbiAgICAvLyBhbW91bnQgb2Ygc3Vic3RhbmNlICogaWRlYWwgZ2FzcyBjb25zdGFudCAqIGFic29sdXRlIHRlbXBlcmF0dXJlXHJcbiAgICAvLyBuICogUiAqIFRcclxuICAgIC8vIHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QcmVzc3VyZVxyXG4gICAgX3ByZXNzdXJlID0gMDtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5IHdoaWxlIHNpbXVsYXRpbmcgKHNldCB0byBmYWxzZSBmb3Igc29tZXRoaW5nXHJcbiAgICAvLyB0aGF0IGlzIGF0dGFjaGVkIHRvIHRoZSBzdGF0aWMgd29ybGQpXHJcbiAgICBfdXBkYXRlUG9zaXRpb24gPSB0cnVlO1xyXG5cclxuICAgIC8vIEJha2Ugc3BlY2lmaWVkIG1Sb3RhdGlvbiBpbiB0aGUgdmVydGljZXMgYW5kIHNldCB0aGUgYm9keSByb3RhdGlvbiB0byBpZGVudGl0eSAoc2ltdWxhdGlvbiBpcyBzbGlnaHRseSBtb3JlIGFjY3VyYXRlIGlmIHRoZSByb3RhdGlvbiBvZiBhIHNvZnQgYm9keSBpcyBrZXB0IHRvIGlkZW50aXR5KVxyXG4gICAgX21ha2VSb3RhdGlvbklkZW50aXR5ID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBOdW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnNcclxuICAgIF9udW1JdGVyYXRpb25zID0gNTtcclxuXHJcbiAgICAvLyBJbnZlcnNlIG9mIHRoZSBzdGlmZm5lc3Mgb2YgdGhlIHNwcmluZy5cclxuICAgIF9jb21wbGlhbmNlID0gMDtcclxuXHJcbiAgICAvLyBOdW1iZXIgb2YgY2VsbHMgY29tcHJpc2luZyBhIHJvdy4gVGhpbmsgb2YgYSBncmlkIGRpdmlkZWQgcGxhbmUuXHJcbiAgICBfd2lkdGggPSAwO1xyXG5cclxuICAgIC8vIE51bWJlciBvZiBjZWxscyBjb21wcmlzaW5nIGEgY29sdW1uLiBUaGluayBvZiBhIGdyaWQgZGl2aWRlZCBwbGFuZS5cclxuICAgIF9sZW5ndGggPSAwO1xyXG5cclxuICAgIF9maXhlZEluZGljZXMgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzeXN0ZW0sIGVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKHN5c3RlbSwgZW50aXR5KTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZUNvbXBvbmVudERhdGEoY2IpIHtcclxuICAgICAgICB0aGlzLl93cml0ZVNoYXBlRGF0YShjYiwgdGhpcyk7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIFdlIGFsd2F5cyB1c2Ugd29ybGQgcG9zaXRpb24gYW5kIHJvdGF0aW9uIGZyb20gdGhlIGN1cnJlbnQgZW50aXR5IHRoZSBjb21wb25lbnRcclxuICAgICAgICAvLyBpcyBhdHRhY2hlZCB0byAoaW5zdGVhZCBvZiBkZWZhdWx0IHplcm8gdmVjdG9ycylcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eTtcclxuICAgICAgICBjb25zdCBwb3MgPSBlbnRpdHkuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICBjb25zdCByb3QgPSBlbnRpdHkuZ2V0Um90YXRpb24oKTtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGdldCByaWQgb2YgZmxhZ3NcclxuXHJcbiAgICAgICAgLy8gTG9zcyBvZiBwcmVjaXNpb24gZm9yIHBvcy9yb3QgKDY0IC0+IDMyKVxyXG4gICAgICAgIGNiLndyaXRlKHBvcywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY29sbGlzaW9uR3JvdXAsIEJVRkZFUl9XUklURV9VSU5UMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3N1Ykdyb3VwLCBCVUZGRVJfV1JJVEVfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fb2JqZWN0TGF5ZXIsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9udW1JdGVyYXRpb25zLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbGluZWFyRGFtcGluZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhMaW5lYXJWZWxvY2l0eSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9yZXN0aXR1dGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9mcmljdGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9wcmVzc3VyZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9ncmF2aXR5RmFjdG9yLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VwZGF0ZVBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21ha2VSb3RhdGlvbklkZW50aXR5LCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FsbG93U2xlZXBpbmcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIERlYnVnLmRldiAmJiBjYi53cml0ZSh0aGlzLl9kZWJ1Z0RyYXcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25FbmFibGUoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3JlbmRlckFzc2V0ICYmICF0aGlzLl9tZXNoZXMpIHtcclxuICAgICAgICAgICAgICAgIERlYnVnLndhcm4oJ1VuYWJsZSB0byBsb2NhdGUgbWVzaCBkYXRhIGZvciBhIHNvZnQgYm9keScsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLnN5c3RlbTtcclxuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSBzeXN0ZW0uZ2V0SW5kZXgodGhpcy5lbnRpdHkpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcmVuZGVyQXNzZXQgJiYgIXRoaXMuX21lc2hlcykge1xyXG4gICAgICAgICAgICB0aGlzLl9hZGRNZXNoZXMoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzeXN0ZW0uY3JlYXRlQm9keSh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlU2hhcGVEYXRhKGNiKSB7XHJcbiAgICAgICAgbGV0IHVzZUVudGl0eVNjYWxlID0gdGhpcy5fdXNlRW50aXR5U2NhbGU7XHJcbiAgICAgICAgbGV0IHNjYWxlO1xyXG4gICAgICAgIGlmICh1c2VFbnRpdHlTY2FsZSkge1xyXG4gICAgICAgICAgICBzY2FsZSA9IHRoaXMuZW50aXR5LmdldExvY2FsU2NhbGUoKTtcclxuICAgICAgICAgICAgaWYgKHNjYWxlLnggPT09IDEgJiYgc2NhbGUueSA9PT0gMSAmJiBzY2FsZS56ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB1c2VFbnRpdHlTY2FsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZSh1c2VFbnRpdHlTY2FsZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAodXNlRW50aXR5U2NhbGUpIHtcclxuICAgICAgICAgICAgLy8gUG90ZW50aWFsIHByZWNpc2lvbiBsb3NzIDY0IC0+IDMyXHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNjYWxlLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBTaGFwZUNvbXBvbmVudC5hZGRNZXNoZXModGhpcy5fbWVzaGVzLCBjYik7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3dpZHRoLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVuZ3RoLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY29tcGxpYW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLl9maXhlZEluZGljZXM7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBmaXhlZC5sZW5ndGg7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGZpeGVkW2ldLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgU29mdEJvZHlDb21wb25lbnQgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/softbody/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/softbody/system.mjs":
/*!*********************************************************!*\
  !*** ./src/physics/components/jolt/softbody/system.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SoftBodyComponentSystem: () => (/* binding */ SoftBodyComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/softbody/component.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Component\r\n    'enabled',\r\n    'debugDraw',\r\n    'renderAsset',\r\n    'meshes',\r\n    'useEntityScale',\r\n\r\n    // Soft Body\r\n\t'position',\r\n\t'rotation',\r\n\t'objectLayer',\r\n\t'collisionGroup',\r\n    'subGroup',\r\n\t'numIterations',\r\n\t'linearDamping',\r\n\t'maxLinearVelocity',\r\n\t'restitution',\r\n\t'friction',\r\n\t'pressure',\r\n\t'gravityFactor',\r\n\t'updatePosition',\r\n\t'makeRotationIdentity',\r\n    'allowSleeping',\r\n\r\n    // Shape Data\r\n    'width',\r\n    'length',\r\n    'fixedIndices',\r\n    'compliance'\r\n];\r\n\r\nconst vec = new pc.Vec3();\r\nconst quat = new pc.Quat()\r\nconst positions = [];\r\nconst indices = [];\r\n\r\nclass SoftBodyComponentSystem extends _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponentSystem {\r\n\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'softbody';\r\n        this.schema = schema;\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_4__.SoftBodyComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    createBody(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_SOFT_BODY);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_UPDATE_TRANSFORMS:\r\n                this._updateVertices(cb);\r\n            break;\r\n        }\r\n    }\r\n\r\n    _updateVertices(cb) {\r\n        const index = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n        const count = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n\r\n        const entity = this.entityMap.get(index);\r\n\r\n        positions.length = 0;\r\n        indices.length = 0;\r\n\r\n        const component = entity?.c.softbody;\r\n        const mesh = component?.meshes[0];\r\n        if (!mesh) {\r\n            return;\r\n        }\r\n\r\n        mesh.getIndices(indices);\r\n\r\n        let sx = 1;\r\n        let sy = 1;\r\n        let sz = 1;\r\n        \r\n        if (component.useEntityScale ) {\r\n            const s = entity.getLocalScale();\r\n            sx = s.x || 1; sy = s.y || 1; sz = s.z || 1;\r\n        }\r\n\r\n        quat.copy(entity.getRotation()).invert();\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            vec.set(\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32) / sx,\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32) / sy,\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32) / sz\r\n            );\r\n\r\n            quat.transformVector(vec, vec);\r\n\r\n            positions.push(vec.x, vec.y, vec.z);\r\n        }\r\n\r\n        mesh.setNormals(pc.calculateNormals(positions, indices));\r\n        mesh.setPositions(positions);\r\n        mesh.update();\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvc3lzdGVtLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBbUQ7QUFDTTtBQUNpRjtBQUNyRjtBQUNEO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsaUVBQW1CO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qiw2REFBaUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0EsUUFBUSx5REFBYztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLDREQUFnQjtBQUN6Qyx3QkFBd0IsZ0VBQW9CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsaUVBQXFCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw4REFBa0I7QUFDaEQsOEJBQThCLDhEQUFrQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGVBQWU7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsV0FBVztBQUNuQztBQUNBLHdCQUF3QiwrREFBbUI7QUFDM0Msd0JBQXdCLCtEQUFtQjtBQUMzQyx3QkFBd0IsK0RBQW1CO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvc3lzdGVtLm1qcz82N2ExIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWwubWpzXCI7XHJcbmltcG9ydCB7IEJvZHlDb21wb25lbnRTeXN0ZW0gfSBmcm9tIFwiLi4vYm9keS9zeXN0ZW0ubWpzXCI7XHJcbmltcG9ydCB7IEJVRkZFUl9SRUFEX0ZMT0FUMzIsIEJVRkZFUl9SRUFEX1VJTlQzMiwgQ01EX0NSRUFURV9TT0ZUX0JPRFksIENNRF9VUERBVEVfVFJBTlNGT1JNUywgT1BFUkFUT1JfQ1JFQVRPUiB9IGZyb20gXCIuLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFNoYXBlQ29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4uL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgU29mdEJvZHlDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnQubWpzXCI7XHJcblxyXG5jb25zdCBzY2hlbWEgPSBbXHJcbiAgICAvLyBDb21wb25lbnRcclxuICAgICdlbmFibGVkJyxcclxuICAgICdkZWJ1Z0RyYXcnLFxyXG4gICAgJ3JlbmRlckFzc2V0JyxcclxuICAgICdtZXNoZXMnLFxyXG4gICAgJ3VzZUVudGl0eVNjYWxlJyxcclxuXHJcbiAgICAvLyBTb2Z0IEJvZHlcclxuXHQncG9zaXRpb24nLFxyXG5cdCdyb3RhdGlvbicsXHJcblx0J29iamVjdExheWVyJyxcclxuXHQnY29sbGlzaW9uR3JvdXAnLFxyXG4gICAgJ3N1Ykdyb3VwJyxcclxuXHQnbnVtSXRlcmF0aW9ucycsXHJcblx0J2xpbmVhckRhbXBpbmcnLFxyXG5cdCdtYXhMaW5lYXJWZWxvY2l0eScsXHJcblx0J3Jlc3RpdHV0aW9uJyxcclxuXHQnZnJpY3Rpb24nLFxyXG5cdCdwcmVzc3VyZScsXHJcblx0J2dyYXZpdHlGYWN0b3InLFxyXG5cdCd1cGRhdGVQb3NpdGlvbicsXHJcblx0J21ha2VSb3RhdGlvbklkZW50aXR5JyxcclxuICAgICdhbGxvd1NsZWVwaW5nJyxcclxuXHJcbiAgICAvLyBTaGFwZSBEYXRhXHJcbiAgICAnd2lkdGgnLFxyXG4gICAgJ2xlbmd0aCcsXHJcbiAgICAnZml4ZWRJbmRpY2VzJyxcclxuICAgICdjb21wbGlhbmNlJ1xyXG5dO1xyXG5cclxuY29uc3QgdmVjID0gbmV3IHBjLlZlYzMoKTtcclxuY29uc3QgcXVhdCA9IG5ldyBwYy5RdWF0KClcclxuY29uc3QgcG9zaXRpb25zID0gW107XHJcbmNvbnN0IGluZGljZXMgPSBbXTtcclxuXHJcbmNsYXNzIFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQm9keUNvbXBvbmVudFN5c3RlbSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwLCBtYW5hZ2VyLCBpZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgbWFuYWdlcik7XHJcblxyXG4gICAgICAgIHRoaXMuaWQgPSAnc29mdGJvZHknO1xyXG4gICAgICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hO1xyXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IFNvZnRCb2R5Q29tcG9uZW50O1xyXG5cclxuICAgICAgICBtYW5hZ2VyLnN5c3RlbXMuc2V0KGlkLCB0aGlzKTtcclxuXHJcbiAgICAgICAgYnVpbGRBY2Nlc3NvcnModGhpcywgdGhpcy5zY2hlbWEpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJvZHkoY29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9tYW5hZ2VyLmNvbW1hbmRzQnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NSRUFUT1IpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ1JFQVRFX1NPRlRfQk9EWSk7XHJcblxyXG4gICAgICAgIGNvbXBvbmVudC53cml0ZUNvbXBvbmVudERhdGEoY2IpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb2Nlc3NDb21tYW5kcyhjYikge1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjYi5yZWFkQ29tbWFuZCgpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfVVBEQVRFX1RSQU5TRk9STVM6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVWZXJ0aWNlcyhjYik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfdXBkYXRlVmVydGljZXMoY2IpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5lbnRpdHlNYXAuZ2V0KGluZGV4KTtcclxuXHJcbiAgICAgICAgcG9zaXRpb25zLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgaW5kaWNlcy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlbnRpdHk/LmMuc29mdGJvZHk7XHJcbiAgICAgICAgY29uc3QgbWVzaCA9IGNvbXBvbmVudD8ubWVzaGVzWzBdO1xyXG4gICAgICAgIGlmICghbWVzaCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtZXNoLmdldEluZGljZXMoaW5kaWNlcyk7XHJcblxyXG4gICAgICAgIGxldCBzeCA9IDE7XHJcbiAgICAgICAgbGV0IHN5ID0gMTtcclxuICAgICAgICBsZXQgc3ogPSAxO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChjb21wb25lbnQudXNlRW50aXR5U2NhbGUgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHMgPSBlbnRpdHkuZ2V0TG9jYWxTY2FsZSgpO1xyXG4gICAgICAgICAgICBzeCA9IHMueCB8fCAxOyBzeSA9IHMueSB8fCAxOyBzeiA9IHMueiB8fCAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcXVhdC5jb3B5KGVudGl0eS5nZXRSb3RhdGlvbigpKS5pbnZlcnQoKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZlYy5zZXQoXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpIC8gc3gsXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpIC8gc3ksXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpIC8gc3pcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHF1YXQudHJhbnNmb3JtVmVjdG9yKHZlYywgdmVjKTtcclxuXHJcbiAgICAgICAgICAgIHBvc2l0aW9ucy5wdXNoKHZlYy54LCB2ZWMueSwgdmVjLnopO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbWVzaC5zZXROb3JtYWxzKHBjLmNhbGN1bGF0ZU5vcm1hbHMocG9zaXRpb25zLCBpbmRpY2VzKSk7XHJcbiAgICAgICAgbWVzaC5zZXRQb3NpdGlvbnMocG9zaXRpb25zKTtcclxuICAgICAgICBtZXNoLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBTb2Z0Qm9keUNvbXBvbmVudFN5c3RlbSB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/softbody/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/system.mjs":
/*!************************************************!*\
  !*** ./src/physics/components/jolt/system.mjs ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ShapeComponentSystem: () => (/* binding */ ShapeComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nlet v1, v2, v3;\r\n\r\nfunction getColor(type, config) {\r\n    switch (type) {\r\n        case pc.JOLT_MOTION_TYPE_STATIC:\r\n            return config.debugColorStatic;\r\n        case pc.JOLT_MOTION_TYPE_KINEMATIC:\r\n            return config.debugColorKinematic;\r\n        case pc.JOLT_MOTION_TYPE_DYNAMIC:\r\n            return config.debugColorDynamic;\r\n        default:\r\n            return pc.Color.WHITE;\r\n    }\r\n}\r\n\r\nconst schema = [\r\n    // component\r\n    'enabled',\r\n    'index',\r\n    'trackDynamic',\r\n    'renderAsset',\r\n    'meshes',\r\n    'isCompoundChild',\r\n    'useEntityScale',\r\n    'useMotionState',\r\n    'debugDraw',\r\n\r\n    // Jolt shape\r\n    'shape',\r\n    'halfExtent',\r\n    'radius',\r\n    'convexRadius',\r\n    'halfHeight',\r\n    'density',\r\n    'shapePosition',\r\n    'shapeRotation',\r\n    'massOffset',\r\n    'hfScale',\r\n    'hfOffset',\r\n    'hfSamples',\r\n    'hfSampleCount',\r\n    'hfBlockSize',\r\n    'hfBitsPerSample',\r\n    'hfActiveEdgeCosThresholdAngle'\r\n];\r\n\r\nclass ShapeComponentSystem extends pc.ComponentSystem {\r\n    static entityMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_0__.IndexedCache();\r\n\r\n    constructor(app, manager) {\r\n        super(app);\r\n\r\n        // The store where all ComponentData objects are kept\r\n        this.store = {};\r\n        this.schema = schema;\r\n\r\n        this._manager = manager;\r\n\r\n        this.entityMap = ShapeComponentSystem.entityMap;\r\n\r\n        this._exposeConstants();\r\n    }\r\n\r\n    addCommand() {\r\n        const cb = this._manager.commandsBuffer;\r\n        \r\n        cb.writeOperator(arguments[0]);\r\n        cb.writeCommand(arguments[1]);\r\n\r\n        // component index\r\n        cb.write(arguments[2], _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 3, end = arguments.length; i < end; i += 3) {\r\n            cb.write(arguments[i], arguments[i + 1], arguments[i + 2]);\r\n        }\r\n    }\r\n\r\n    addCommandArgs() {\r\n        const cb = this._manager.commandsBuffer;\r\n        for (let i = 0, end = arguments.length; i < end; i += 3) {\r\n            cb.write(arguments[i], arguments[i + 1], arguments[i + 2]);\r\n        }\r\n    }\r\n\r\n    addComponent(entity, data = {}) {\r\n        const component = new this.ComponentType(this, entity);\r\n\r\n        this.store[entity.getGuid()] = { entity };\r\n\r\n        entity[this.id] = component;\r\n        entity.c[this.id] = component;\r\n\r\n        this.initializeComponentData(component, data);\r\n\r\n        return component;\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        component.enabled = true;\r\n\r\n        for (const [key, value] of Object.entries(data)) {\r\n            component[`_${ key }`] = value;\r\n        }\r\n\r\n        if (component.entity.enabled && !component.isCompoundChild) {\r\n            component.onEnable();\r\n        }\r\n    }\r\n\r\n    freeConstraintIndex(index) {\r\n        this._manager.freeConstraintIndex(index);\r\n    }\r\n\r\n    getIndex(entity) {\r\n        return this.entityMap.add(entity);\r\n    }\r\n\r\n    setIndexFree(index) {\r\n        this.entityMap.free(index);\r\n    }\r\n\r\n    _exposeConstants() {\r\n        if (typeof window !== 'undefined' && window.pc) {\r\n            pc.JOLT_SHAPE_BOX = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_BOX;\r\n            pc.JOLT_SHAPE_CAPSULE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CAPSULE;\r\n            pc.JOLT_SHAPE_CYLINDER = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CYLINDER;\r\n            pc.JOLT_SHAPE_SPHERE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_SPHERE;\r\n            pc.JOLT_SHAPE_MESH = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_MESH;\r\n            pc.JOLT_SHAPE_CONVEX_HULL = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CONVEX_HULL;\r\n            pc.JOLT_SHAPE_STATIC_COMPOUND = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_STATIC_COMPOUND;\r\n            pc.JOLT_SHAPE_HEIGHTFIELD = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_HEIGHTFIELD;\r\n            pc.JOLT_OBJ_LAYER_NON_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_NON_MOVING;\r\n            pc.JOLT_OBJ_LAYER_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJ_LAYER_MOVING;\r\n            pc.JOLT_BP_LAYER_NON_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_NON_MOVING;\r\n            pc.JOLT_BP_LAYER_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BP_LAYER_MOVING;\r\n            pc.JOLT_VEHICLE_TYPE_WHEEL = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_WHEEL;\r\n            pc.JOLT_VEHICLE_TYPE_TRACK = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_TRACK;\r\n            pc.JOLT_VEHICLE_TYPE_MOTORCYCLE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_MOTORCYCLE;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_RAY = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_RAY;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_CYLINDER = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_CYLINDER;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_SPHERE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_SPHERE;\r\n        }\r\n    }\r\n\r\n    static updateDynamic(cb) {\r\n        const index = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n        const entity = this.entityMap.get(index);\r\n        const vehicleComponent = entity?.c.vehicle;\r\n\r\n        if (!entity) {\r\n            cb.skip(13 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n            if (vehicleComponent) {\r\n                cb.skip(vehicleComponent.wheels.length * 7 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n            }\r\n            return;\r\n        }\r\n\r\n        entity.setPosition(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        entity.setRotation(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        const component = entity.c.body || vehicleComponent;\r\n        component._linearVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n        component._angularVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        if (vehicleComponent) {\r\n            const wheels = vehicleComponent.wheels;\r\n            const wheelsCount = wheels.length;\r\n\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                const wheel = wheels[i];\r\n                const entity = wheel.entity;\r\n\r\n                if (!entity) {\r\n                    cb.skip(7 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n                    continue;\r\n                }\r\n\r\n                entity.setLocalPosition(\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n\r\n                entity.setLocalRotation(\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    static debugDraw(app, data, config) {\r\n        const useDepth = config.debugDrawDepth;\r\n        const layer = app.scene.layers.getLayerById(config.debugDrawLayerId);\r\n\r\n        if (!v1) {\r\n            v1 = new pc.Vec3();\r\n            v2 = new pc.Vec3();\r\n            v3 = new pc.Vec3();\r\n        }\r\n    \r\n        for (let d = 0, total = data.length; d < total; d += 5) {\r\n            const index = data[d];\r\n            const length = data[d + 1];\r\n            const byteOffset = data[d + 2];\r\n            const motionType = data[d + 3];\r\n            const buffer = data[d + 4];\r\n    \r\n            const view = new Float32Array(buffer, byteOffset, length);\r\n            const entity = this.entityMap.get(index);\r\n            const color = getColor(motionType, config);\r\n    \r\n            const p = entity.getPosition();\r\n            const r = entity.getRotation();\r\n    \r\n            for (let i = 0, end = view.length; i < end; i += 9) {\r\n                v1.set(view[i], view[i + 1], view[i + 2]);\r\n                v2.set(view[i + 3], view[i + 4], view[i + 5]);\r\n                v3.set(view[i + 6], view[i + 7], view[i + 8]);\r\n    \r\n                r.transformVector(v1, v1);\r\n                r.transformVector(v2, v2);\r\n                r.transformVector(v3, v3);\r\n                v1.add(p);\r\n                v2.add(p);\r\n                v3.add(p);\r\n    \r\n                app.drawLine(v1, v2, color, useDepth, layer);\r\n                app.drawLine(v2, v3, color, useDepth, layer);\r\n                app.drawLine(v3, v1, color, useDepth, layer);\r\n            }\r\n        }\r\n    }    \r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc3lzdGVtLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBdUQ7QUFDdkQ7QUFTeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDREQUFZO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLCtEQUFtQjtBQUNsRDtBQUNBLGdEQUFnRCxTQUFTO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxTQUFTO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsS0FBSztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MscURBQVM7QUFDekMsb0NBQW9DLHlEQUFhO0FBQ2pELHFDQUFxQywwREFBYztBQUNuRCxtQ0FBbUMsd0RBQVk7QUFDL0MsaUNBQWlDLHNEQUFVO0FBQzNDLHdDQUF3Qyw2REFBaUI7QUFDekQsNENBQTRDLGlFQUFxQjtBQUNqRSx3Q0FBd0MsNkRBQWlCO0FBQ3pELDJDQUEyQyxnRUFBb0I7QUFDL0QsdUNBQXVDLDREQUFnQjtBQUN2RCwwQ0FBMEMsK0RBQW1CO0FBQzdELHNDQUFzQywyREFBZTtBQUNyRCx5Q0FBeUMsOERBQWtCO0FBQzNELHlDQUF5Qyw4REFBa0I7QUFDM0QsOENBQThDLG1FQUF1QjtBQUNyRSw0Q0FBNEMsaUVBQXFCO0FBQ2pFLGlEQUFpRCxzRUFBMEI7QUFDM0UsK0NBQStDLG9FQUF3QjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw4REFBa0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsd0RBQVk7QUFDckM7QUFDQSw2REFBNkQsd0RBQVk7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QyxvQkFBb0IsK0RBQW1CO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QyxvQkFBb0IsK0RBQW1CO0FBQ3ZDLG9CQUFvQiwrREFBbUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsK0RBQW1CO0FBQ3ZDLG9CQUFvQiwrREFBbUI7QUFDdkMsb0JBQW9CLCtEQUFtQjtBQUN2QztBQUNBO0FBQ0Esb0JBQW9CLCtEQUFtQjtBQUN2QyxvQkFBb0IsK0RBQW1CO0FBQ3ZDLG9CQUFvQiwrREFBbUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlCQUFpQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx3REFBWTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBbUI7QUFDL0MsNEJBQTRCLCtEQUFtQjtBQUMvQyw0QkFBNEIsK0RBQW1CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBbUI7QUFDL0MsNEJBQTRCLCtEQUFtQjtBQUMvQyw0QkFBNEIsK0RBQW1CO0FBQy9DLDRCQUE0QiwrREFBbUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLFdBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsU0FBUztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNnQztBQUNoQyIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3N5c3RlbS5tanM/NjBjZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmRleGVkQ2FjaGUgfSBmcm9tIFwiLi4vLi4vaW5kZXhlZC1jYWNoZS5tanNcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgICBCUF9MQVlFUl9NT1ZJTkcsXHJcbiAgICBCUF9MQVlFUl9OT05fTU9WSU5HLFxyXG4gICAgQlVGRkVSX1JFQURfRkxPQVQzMiwgQlVGRkVSX1JFQURfVUlOVDMyLCBCVUZGRVJfV1JJVEVfVUlOVDMyLFxyXG4gICAgRkxPQVQzMl9TSVpFLE9CSl9MQVlFUl9NT1ZJTkcsT0JKX0xBWUVSX05PTl9NT1ZJTkcsU0hBUEVfQk9YLCBTSEFQRV9DQVBTVUxFLFxyXG4gICAgU0hBUEVfQ09OVkVYX0hVTEwsIFNIQVBFX0NZTElOREVSLCBTSEFQRV9IRUlHSFRGSUVMRCwgU0hBUEVfTUVTSCwgU0hBUEVfU1BIRVJFLFxyXG4gICAgU0hBUEVfU1RBVElDX0NPTVBPVU5ELCBWRUhJQ0xFX0NBU1RfVFlQRV9DWUxJTkRFUiwgVkVISUNMRV9DQVNUX1RZUEVfUkFZLFxyXG4gICAgVkVISUNMRV9DQVNUX1RZUEVfU1BIRVJFLCBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRSwgVkVISUNMRV9UWVBFX1RSQUNLLCBWRUhJQ0xFX1RZUEVfV0hFRUxcclxufSBmcm9tIFwiLi9jb25zdGFudHMubWpzXCI7XHJcblxyXG5sZXQgdjEsIHYyLCB2MztcclxuXHJcbmZ1bmN0aW9uIGdldENvbG9yKHR5cGUsIGNvbmZpZykge1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgY2FzZSBwYy5KT0xUX01PVElPTl9UWVBFX1NUQVRJQzpcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kZWJ1Z0NvbG9yU3RhdGljO1xyXG4gICAgICAgIGNhc2UgcGMuSk9MVF9NT1RJT05fVFlQRV9LSU5FTUFUSUM6XHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZGVidWdDb2xvcktpbmVtYXRpYztcclxuICAgICAgICBjYXNlIHBjLkpPTFRfTU9USU9OX1RZUEVfRFlOQU1JQzpcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kZWJ1Z0NvbG9yRHluYW1pYztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gcGMuQ29sb3IuV0hJVEU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHNjaGVtYSA9IFtcclxuICAgIC8vIGNvbXBvbmVudFxyXG4gICAgJ2VuYWJsZWQnLFxyXG4gICAgJ2luZGV4JyxcclxuICAgICd0cmFja0R5bmFtaWMnLFxyXG4gICAgJ3JlbmRlckFzc2V0JyxcclxuICAgICdtZXNoZXMnLFxyXG4gICAgJ2lzQ29tcG91bmRDaGlsZCcsXHJcbiAgICAndXNlRW50aXR5U2NhbGUnLFxyXG4gICAgJ3VzZU1vdGlvblN0YXRlJyxcclxuICAgICdkZWJ1Z0RyYXcnLFxyXG5cclxuICAgIC8vIEpvbHQgc2hhcGVcclxuICAgICdzaGFwZScsXHJcbiAgICAnaGFsZkV4dGVudCcsXHJcbiAgICAncmFkaXVzJyxcclxuICAgICdjb252ZXhSYWRpdXMnLFxyXG4gICAgJ2hhbGZIZWlnaHQnLFxyXG4gICAgJ2RlbnNpdHknLFxyXG4gICAgJ3NoYXBlUG9zaXRpb24nLFxyXG4gICAgJ3NoYXBlUm90YXRpb24nLFxyXG4gICAgJ21hc3NPZmZzZXQnLFxyXG4gICAgJ2hmU2NhbGUnLFxyXG4gICAgJ2hmT2Zmc2V0JyxcclxuICAgICdoZlNhbXBsZXMnLFxyXG4gICAgJ2hmU2FtcGxlQ291bnQnLFxyXG4gICAgJ2hmQmxvY2tTaXplJyxcclxuICAgICdoZkJpdHNQZXJTYW1wbGUnLFxyXG4gICAgJ2hmQWN0aXZlRWRnZUNvc1RocmVzaG9sZEFuZ2xlJ1xyXG5dO1xyXG5cclxuY2xhc3MgU2hhcGVDb21wb25lbnRTeXN0ZW0gZXh0ZW5kcyBwYy5Db21wb25lbnRTeXN0ZW0ge1xyXG4gICAgc3RhdGljIGVudGl0eU1hcCA9IG5ldyBJbmRleGVkQ2FjaGUoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIG1hbmFnZXIpIHtcclxuICAgICAgICBzdXBlcihhcHApO1xyXG5cclxuICAgICAgICAvLyBUaGUgc3RvcmUgd2hlcmUgYWxsIENvbXBvbmVudERhdGEgb2JqZWN0cyBhcmUga2VwdFxyXG4gICAgICAgIHRoaXMuc3RvcmUgPSB7fTtcclxuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcclxuXHJcbiAgICAgICAgdGhpcy5fbWFuYWdlciA9IG1hbmFnZXI7XHJcblxyXG4gICAgICAgIHRoaXMuZW50aXR5TWFwID0gU2hhcGVDb21wb25lbnRTeXN0ZW0uZW50aXR5TWFwO1xyXG5cclxuICAgICAgICB0aGlzLl9leHBvc2VDb25zdGFudHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRDb21tYW5kKCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fbWFuYWdlci5jb21tYW5kc0J1ZmZlcjtcclxuICAgICAgICBcclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKGFyZ3VtZW50c1swXSk7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKGFyZ3VtZW50c1sxXSk7XHJcblxyXG4gICAgICAgIC8vIGNvbXBvbmVudCBpbmRleFxyXG4gICAgICAgIGNiLndyaXRlKGFyZ3VtZW50c1syXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMywgZW5kID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGVuZDsgaSArPSAzKSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGFyZ3VtZW50c1tpXSwgYXJndW1lbnRzW2kgKyAxXSwgYXJndW1lbnRzW2kgKyAyXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZENvbW1hbmRBcmdzKCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fbWFuYWdlci5jb21tYW5kc0J1ZmZlcjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGVuZDsgaSArPSAzKSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGFyZ3VtZW50c1tpXSwgYXJndW1lbnRzW2kgKyAxXSwgYXJndW1lbnRzW2kgKyAyXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZENvbXBvbmVudChlbnRpdHksIGRhdGEgPSB7fSkge1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IG5ldyB0aGlzLkNvbXBvbmVudFR5cGUodGhpcywgZW50aXR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5zdG9yZVtlbnRpdHkuZ2V0R3VpZCgpXSA9IHsgZW50aXR5IH07XHJcblxyXG4gICAgICAgIGVudGl0eVt0aGlzLmlkXSA9IGNvbXBvbmVudDtcclxuICAgICAgICBlbnRpdHkuY1t0aGlzLmlkXSA9IGNvbXBvbmVudDtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gY29tcG9uZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgZGF0YSkge1xyXG4gICAgICAgIGNvbXBvbmVudC5lbmFibGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZGF0YSkpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50W2BfJHsga2V5IH1gXSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbXBvbmVudC5lbnRpdHkuZW5hYmxlZCAmJiAhY29tcG9uZW50LmlzQ29tcG91bmRDaGlsZCkge1xyXG4gICAgICAgICAgICBjb21wb25lbnQub25FbmFibGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnJlZUNvbnN0cmFpbnRJbmRleChpbmRleCkge1xyXG4gICAgICAgIHRoaXMuX21hbmFnZXIuZnJlZUNvbnN0cmFpbnRJbmRleChpbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SW5kZXgoZW50aXR5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5TWFwLmFkZChlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEluZGV4RnJlZShpbmRleCkge1xyXG4gICAgICAgIHRoaXMuZW50aXR5TWFwLmZyZWUoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIF9leHBvc2VDb25zdGFudHMoKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5wYykge1xyXG4gICAgICAgICAgICBwYy5KT0xUX1NIQVBFX0JPWCA9IFNIQVBFX0JPWDtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9DQVBTVUxFID0gU0hBUEVfQ0FQU1VMRTtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9DWUxJTkRFUiA9IFNIQVBFX0NZTElOREVSO1xyXG4gICAgICAgICAgICBwYy5KT0xUX1NIQVBFX1NQSEVSRSA9IFNIQVBFX1NQSEVSRTtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9NRVNIID0gU0hBUEVfTUVTSDtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9DT05WRVhfSFVMTCA9IFNIQVBFX0NPTlZFWF9IVUxMO1xyXG4gICAgICAgICAgICBwYy5KT0xUX1NIQVBFX1NUQVRJQ19DT01QT1VORCA9IFNIQVBFX1NUQVRJQ19DT01QT1VORDtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9IRUlHSFRGSUVMRCA9IFNIQVBFX0hFSUdIVEZJRUxEO1xyXG4gICAgICAgICAgICBwYy5KT0xUX09CSl9MQVlFUl9OT05fTU9WSU5HID0gT0JKX0xBWUVSX05PTl9NT1ZJTkc7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfT0JKX0xBWUVSX01PVklORyA9IE9CSl9MQVlFUl9NT1ZJTkc7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfQlBfTEFZRVJfTk9OX01PVklORyA9IEJQX0xBWUVSX05PTl9NT1ZJTkc7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfQlBfTEFZRVJfTU9WSU5HID0gQlBfTEFZRVJfTU9WSU5HO1xyXG4gICAgICAgICAgICBwYy5KT0xUX1ZFSElDTEVfVFlQRV9XSEVFTCA9IFZFSElDTEVfVFlQRV9XSEVFTDtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX1RZUEVfVFJBQ0sgPSBWRUhJQ0xFX1RZUEVfVFJBQ0s7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUgPSBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRTtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX0NBU1RfVFlQRV9SQVkgPSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVk7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVIgPSBWRUhJQ0xFX0NBU1RfVFlQRV9DWUxJTkRFUjtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkUgPSBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB1cGRhdGVEeW5hbWljKGNiKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5lbnRpdHlNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICBjb25zdCB2ZWhpY2xlQ29tcG9uZW50ID0gZW50aXR5Py5jLnZlaGljbGU7XHJcblxyXG4gICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgIGNiLnNraXAoMTMgKiBGTE9BVDMyX1NJWkUpO1xyXG4gICAgICAgICAgICBpZiAodmVoaWNsZUNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAgICAgY2Iuc2tpcCh2ZWhpY2xlQ29tcG9uZW50LndoZWVscy5sZW5ndGggKiA3ICogRkxPQVQzMl9TSVpFKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlbnRpdHkuc2V0UG9zaXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0Um90YXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlbnRpdHkuYy5ib2R5IHx8IHZlaGljbGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29tcG9uZW50Ll9saW5lYXJWZWxvY2l0eS5zZXQoXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbXBvbmVudC5fYW5ndWxhclZlbG9jaXR5LnNldChcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICh2ZWhpY2xlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHdoZWVscyA9IHZlaGljbGVDb21wb25lbnQud2hlZWxzO1xyXG4gICAgICAgICAgICBjb25zdCB3aGVlbHNDb3VudCA9IHdoZWVscy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxzW2ldO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gd2hlZWwuZW50aXR5O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iuc2tpcCg3ICogRkxPQVQzMl9TSVpFKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc2V0TG9jYWxQb3NpdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc2V0TG9jYWxSb3RhdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWJ1Z0RyYXcoYXBwLCBkYXRhLCBjb25maWcpIHtcclxuICAgICAgICBjb25zdCB1c2VEZXB0aCA9IGNvbmZpZy5kZWJ1Z0RyYXdEZXB0aDtcclxuICAgICAgICBjb25zdCBsYXllciA9IGFwcC5zY2VuZS5sYXllcnMuZ2V0TGF5ZXJCeUlkKGNvbmZpZy5kZWJ1Z0RyYXdMYXllcklkKTtcclxuXHJcbiAgICAgICAgaWYgKCF2MSkge1xyXG4gICAgICAgICAgICB2MSA9IG5ldyBwYy5WZWMzKCk7XHJcbiAgICAgICAgICAgIHYyID0gbmV3IHBjLlZlYzMoKTtcclxuICAgICAgICAgICAgdjMgPSBuZXcgcGMuVmVjMygpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGZvciAobGV0IGQgPSAwLCB0b3RhbCA9IGRhdGEubGVuZ3RoOyBkIDwgdG90YWw7IGQgKz0gNSkge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGRhdGFbZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGRhdGFbZCArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gZGF0YVtkICsgMl07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vdGlvblR5cGUgPSBkYXRhW2QgKyAzXTtcclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gZGF0YVtkICsgNF07XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgdmlldyA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGgpO1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eU1hcC5nZXQoaW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCBjb2xvciA9IGdldENvbG9yKG1vdGlvblR5cGUsIGNvbmZpZyk7XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgcCA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gZW50aXR5LmdldFJvdGF0aW9uKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGVuZCA9IHZpZXcubGVuZ3RoOyBpIDwgZW5kOyBpICs9IDkpIHtcclxuICAgICAgICAgICAgICAgIHYxLnNldCh2aWV3W2ldLCB2aWV3W2kgKyAxXSwgdmlld1tpICsgMl0pO1xyXG4gICAgICAgICAgICAgICAgdjIuc2V0KHZpZXdbaSArIDNdLCB2aWV3W2kgKyA0XSwgdmlld1tpICsgNV0pO1xyXG4gICAgICAgICAgICAgICAgdjMuc2V0KHZpZXdbaSArIDZdLCB2aWV3W2kgKyA3XSwgdmlld1tpICsgOF0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByLnRyYW5zZm9ybVZlY3Rvcih2MSwgdjEpO1xyXG4gICAgICAgICAgICAgICAgci50cmFuc2Zvcm1WZWN0b3IodjIsIHYyKTtcclxuICAgICAgICAgICAgICAgIHIudHJhbnNmb3JtVmVjdG9yKHYzLCB2Myk7XHJcbiAgICAgICAgICAgICAgICB2MS5hZGQocCk7XHJcbiAgICAgICAgICAgICAgICB2Mi5hZGQocCk7XHJcbiAgICAgICAgICAgICAgICB2My5hZGQocCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGFwcC5kcmF3TGluZSh2MSwgdjIsIGNvbG9yLCB1c2VEZXB0aCwgbGF5ZXIpO1xyXG4gICAgICAgICAgICAgICAgYXBwLmRyYXdMaW5lKHYyLCB2MywgY29sb3IsIHVzZURlcHRoLCBsYXllcik7XHJcbiAgICAgICAgICAgICAgICBhcHAuZHJhd0xpbmUodjMsIHYxLCBjb2xvciwgdXNlRGVwdGgsIGxheWVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0gICAgXHJcbn1cclxuXHJcbmV4cG9ydCB7IFNoYXBlQ29tcG9uZW50U3lzdGVtIH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/vehicle/component.mjs":
/*!***********************************************************!*\
  !*** ./src/physics/components/jolt/vehicle/component.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VehicleComponent: () => (/* binding */ VehicleComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nclass VehicleComponent extends _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponent {\r\n    // Used only when the constraint is active. Override for the number of solver \r\n    // velocity iterations to run, 0 means use the default in PhysicsSettings.numVelocitySteps.\r\n    // The number of iterations to use is the max of all contacts and constraints in the island.\r\n    _numVelocityStepsOverride = 0;\r\n\r\n    // Used only when the constraint is active. Override for the number of solver\r\n    // position iterations to run, 0 means use the default in PhysicsSettings.numPositionSteps.\r\n    // The number of iterations to use is the max of all contacts and constraints in the island.\r\n    _numPositionStepsOverride = 0;\r\n\r\n    // Vector indicating the up direction of the vehicle (in local space to the body)\r\n    _up = pc.Vec3.UP;\r\n\r\n    // Vector indicating forward direction of the vehicle (in local space to the body)\r\n    _forward = pc.Vec3.BACK;\r\n\r\n    // Defines the maximum pitch/roll angle (rad), can be used to avoid the car from getting upside\r\n    // down. The vehicle up direction will stay within a cone centered around the up axis with half\r\n    // top angle maxPitchRollAngle, set to pi to turn off. Defaults to ~1.04 rad (60 degrees)\r\n    _maxPitchRollAngle = 1.0471975511965976;\r\n\r\n    // An array of arrays. Each array represents a track and lists indices of wheels that are inside\r\n    // that track. The last element in each track array will become a driven wheel (an index that points\r\n    // to a wheel that is connected to the engine).\r\n    // Example with 2 tracks, and each having 4 wheels: [[0, 1, 2, 3], [4, 5, 6, 7]]\r\n    _tracks = [];\r\n\r\n    // An array of objects that describe each wheel. See _writeWheelsData().\r\n    _wheels = [];\r\n\r\n    // Vehicle type. Can be wheeled (VEHICLE_TYPE_WHEEL) or tracked (VEHICLE_TYPE_TRACK).\r\n    _type = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL;\r\n\r\n    // Max amount of torque (Nm) that the engine can deliver.\r\n    _maxTorque = 500;\r\n    \r\n    // Min amount of revolutions per minute (rpm) the engine can produce without stalling.\r\n    _minRPM = 1000;\r\n\r\n    // Max amount of revolutions per minute (rpm) the engine can generate.\r\n    _maxRPM = 6000;\r\n\r\n    // Moment of inertia (kg m^2) of the engine.\r\n    _inertia = 0.5;\r\n\r\n    // Angular damping factor of the wheel: dw/dt = -c * w.\r\n    _angularDamping = 0.2;\r\n\r\n    // Curve that describes a ratio of the max torque the engine can produce vs the fraction of the max RPM of the engine.\r\n    _normalizedTorque = new pc.Curve([0, 0.8, 0, 0.8]);\r\n\r\n    // How to switch gears.\r\n    _mode = pc.JOLT_TRANSMISSION_AUTO;\r\n\r\n    // Ratio in rotation rate between engine and gear box, first element is 1st gear, 2nd element 2nd gear etc.\r\n    _gearRatios = [2.66, 1.78, 1.3, 1, 0.74];\r\n\r\n    // Ratio in rotation rate between engine and gear box when driving in reverse.\r\n    _reverseGearRatios = [-2.9];\r\n\r\n    // How long it takes to switch gears (s), only used in auto mode.\r\n    _switchTime = 0.5;\r\n\r\n    // How long it takes to release the clutch (go to full friction), only used in auto mode\r\n    _clutchReleaseTime = 0.3;\r\n\r\n    // How long to wait after releasing the clutch before another switch is attempted (s), only used in auto mode.\r\n    _switchLatency = 0.5;\r\n\r\n    // If RPM of engine is bigger then this we will shift a gear up, only used in auto mode.\r\n    _shiftUpRPM = 4000;\r\n\r\n    // If RPM of engine is smaller then this we will shift a gear down, only used in auto mode.\r\n    _shiftDownRPM = 2000;\r\n\r\n    // Strength of the clutch when fully engaged. Total torque a clutch applies is \r\n    // Torque = ClutchStrength * (Velocity Engine - Avg Velocity Wheels At Clutch) (units: k m^2 s^-1)\r\n    _clutchStrength = 10;\r\n\r\n    // List of differentials and their properties\r\n    _differentials = [];\r\n\r\n    // Used when vehicle is of wheeled type. Ratio max / min average wheel speed of each differential\r\n    // (measured at the clutch). When the ratio is exceeded all torque gets distributed to the differential\r\n    // with the minimal average velocity. This allows implementing a limited slip differential between\r\n    // differentials. Set to Number.MAX_VALUE for an open differential. Value should be > 1.\r\n    _differentialLimitedSlipRatio = 1.4;\r\n\r\n    // An anti rollbar is a stiff spring that connects two wheels to reduce the amount of roll the\r\n    // vehicle makes in sharp corners See: https://en.wikipedia.org/wiki/Anti-roll_bar\r\n    _antiRollBars = [];    \r\n\r\n    // Collision tester that tests wheels collision.\r\n    // - VEHICLE_CAST_TYPE_RAY\r\n    // - VEHICLE_CAST_TYPE_SPHERE\r\n    // - VEHICLE_CAST_TYPE_CYLINDER \r\n    _castType = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_RAY;\r\n\r\n    // Object layer to test collision with.\r\n    _castObjectLayer = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OBJ_LAYER_MOVING;\r\n\r\n    // World space up vector, used to avoid colliding with vertical walls.\r\n    _castUp = pc.Vec3.UP;\r\n\r\n    // Max angle (rad) that is considered for colliding wheels. This is to avoid colliding\r\n    // with vertical walls. Defaults to ~1.4 rad (80 degrees).\r\n    _castMaxSlopeAngle = 1.3962634015954636;\r\n\r\n    // Sets the radius of the sphere used in cast.\r\n    _castRadius = 0.3;\r\n\r\n    // Fraction of half the wheel width (or wheel radius if it is smaller) that is used as the convex radius\r\n    _castFraction = 0.1;\r\n\r\n    // How far we're willing to make the bike lean over in turns (in radians)\r\n    _maxLeanAngle = 45;\r\n    \r\n    // Spring constant for the lean spring.\r\n    _leanSpringConstant = 5000;\r\n\r\n    // Spring damping constant for the lean spring.\r\n    _leanSpringDamping = 1000;\r\n\r\n    // The lean spring applies an additional force equal to this coefficient * Integral(delta angle, 0, t),\r\n    // this effectively makes the lean spring a PID controller.\r\n    _leanSpringIntegrationCoefficient = 0;\r\n\r\n    // How much to decay the angle integral when the wheels are not touching the floor:\r\n    // new_value = e^(-decay * t) * initial_value.\r\n    _leanSpringIntegrationCoefficientDecay = 4;\r\n\r\n    // How much to smooth the lean angle (0 = no smoothing, 1 = lean angle never changes). Note that this\r\n    // is frame rate dependent because the formula is: smoothing_factor * previous + (1 - smoothing_factor) * current\r\n    _leanSmoothingFactor = 0.8;\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    writeVehicleData(cb) {\r\n        const type = this._type;\r\n\r\n        // general vehicle data\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(type, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._up, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._forward, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._maxPitchRollAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        // engine data\r\n        cb.write(this._maxTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._minRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._inertia, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._angularDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        VehicleComponent.writeCurvePoints(cb, this._normalizedTorque);\r\n\r\n        // transmission data\r\n        cb.write(this._mode, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._switchTime, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._clutchReleaseTime, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._switchLatency, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shiftUpRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shiftDownRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._clutchStrength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        VehicleComponent.writeGears(cb, this._gearRatios);\r\n        VehicleComponent.writeGears(cb, this._reverseGearRatios);\r\n\r\n        // wheels data\r\n        const isWheeled = type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE;\r\n        if (isWheeled) {\r\n            this._writeWheelsData(cb);\r\n        } else {\r\n            this._writeTracksData(cb);\r\n        }\r\n\r\n        if (isWheeled) {\r\n            // differentials\r\n            this._writeDifferentials(cb);\r\n            cb.write(this._differentialLimitedSlipRatio, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            if (type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                cb.write(this._maxLeanAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringConstant, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringIntegrationCoefficient, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringIntegrationCoefficientDecay, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSmoothingFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n\r\n        this._writeAntiRollBars(cb);\r\n\r\n        // cast type\r\n        const castType = this._castType;\r\n        cb.write(castType, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._castObjectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        switch (castType) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_RAY:\r\n                cb.write(this._castUp, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._castMaxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_SPHERE:\r\n                cb.write(this._castUp, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._castMaxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._castRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_CYLINDER:\r\n                cb.write(this._castFraction, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Any type:\r\n    //      input0 - Value between -1 and 1 for auto transmission and value between 0 and 1 indicating \r\n    //              desired driving direction and amount the gas pedal is pressed\r\n    // Wheeled:\r\n    //      input1 - Value between -1 and 1 indicating desired steering angle (1 = right)\r\n    //      input2 - Value between 0 and 1 indicating how strong the brake pedal is pressed\r\n    //      input3 - Value between 0 and 1 indicating how strong the hand brake is pulled\r\n    // Tracked:\r\n    //      input1 - Value between -1 and 1 indicating an extra multiplier to the rotation rate of the left track (used for steering)\r\n    //      input2 - Value between -1 and 1 indicating an extra multiplier to the rotation rate of the right track (used for steering)\r\n    //      input3 - Value between 0 and 1 indicating how strong the brake pedal is pressed\r\n    setDriverInput(input0, input1, input2, input3) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input0, -1, 1, `Invalid driver input for forward (input0). Expected a number in [-1:1] range. Received: ${ input0 }`);\r\n            if (this._type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || this._type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input1, -1, 1, `Invalid driver input for right (input1). Expected a number in [-1:1] range. Received: ${ input1 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input2, 0, 1, `Invalid driver input for brake (input2). Expected a number in [0:1] range. Received: ${ input2 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input3, 0, 1, `Invalid driver input for hand brake (input3). Expected a number in [0:1] range. Received: ${ input3 }`);\r\n            } else {\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input1, -1, 1, `Invalid driver input for left ratio (input1). Expected a number in [-1:1] range. Received: ${ input1 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input2, -1, 1, `Invalid driver input for right ratio (input2). Expected a number in [-1:1] range. Received: ${ input2 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input3, 0, 1, `Invalid driver input for brake (input3). Expected a number in [0:1] range. Received: ${ input3 }`);\r\n            }\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_DRIVER_INPUT, this._index,\r\n            input0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input2, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        system.createVehicle(this);\r\n    }\r\n\r\n    _writeTracksData(cb) {\r\n        const tracks = this._tracks;\r\n        const count = tracks.length;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && count === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Invalid tracks data. Need at least one track.', tracks);\r\n            return;\r\n        }\r\n\r\n        this._writeWheelsData(cb);\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        \r\n        for (let t = 0; t < count; t++) {\r\n            const track = tracks[t];\r\n            const wheelsCount = track.length;\r\n\r\n            cb.write(wheelsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                cb.write(track[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeWheelsData(cb) {\r\n        const wheels = this._wheels;\r\n        const count = wheels.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const desc = wheels[i];\r\n\r\n            if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n                let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(desc.position, \r\n                    'A wheel description requires an attachment position of wheel' +\r\n                    'suspension in local space of the vehicle', desc);\r\n                const spring = desc.spring;\r\n                if (spring) {\r\n                    const { stiffness, frequency } = spring;\r\n                    if (stiffness != null) {\r\n                        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(stiffness !== 0, 'Wheel spring stiffness cannot be zero', spring);\r\n                    }\r\n                    if (frequency != null) {\r\n                        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(frequency !== 0, 'Wheel spring frequency cannot be zero', spring);\r\n                    }\r\n                }\r\n                if (!ok)\r\n                    return;\r\n            }\r\n\r\n            // Attachment point of wheel suspension in local space of the body.\r\n            cb.write(desc.position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Where tire forces (suspension and traction) are applied, in local space of the body. \r\n            // A good default is the center of the wheel in its neutral pose. See enableSuspensionForcePoint.\r\n            cb.write(desc.suspensionForcePoint || pc.Vec3.ZERO, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Direction of the suspension in local space of the body, should point down.\r\n            cb.write(desc.suspensionDirection || pc.Vec3.DOWN, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Direction of the steering axis in local space of the body, should point up (e.g. for a \r\n            // bike would be -suspensionDirection)\r\n            cb.write(desc.steeringAxis || pc.Vec3.UP, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Up direction when the wheel is in the neutral steering position (usually \r\n            // component.up but can be used to give the wheel camber or for a bike would be -suspensionDirection)\r\n            cb.write(desc.wheelUp || pc.Vec3.UP, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Forward direction when the wheel is in the neutral steering position (usually \r\n            // component.forward but can be used to give the wheel toe, does not need to be perpendicular\r\n            // to wheelUp)\r\n            cb.write(desc.wheelForward || pc.Vec3.BACK, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // How long the suspension is in max raised position relative to the attachment point (m)\r\n            cb.write(desc.suspensionMinLength ?? 0.3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // How long the suspension is in max droop position relative to the attachment point (m)\r\n            cb.write(desc.suspensionMaxLength ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // The natural length (m) of the suspension spring is defined as suspensionMaxLength + \r\n            // suspensionPreloadLength. Can be used to preload the suspension as the spring is compressed\r\n            // by suspensionPreloadLength when the suspension is in max droop position. Note that this means\r\n            // when the vehicle touches the ground there is a discontinuity so it will also make the vehicle\r\n            // more bouncy as we're updating with discrete time steps.\r\n            cb.write(desc.suspensionPreloadLength ?? 0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Radius of the wheel (m)\r\n            cb.write(desc.radius ?? 0.3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Width of the wheel (m)\r\n            cb.write(desc.width ?? 0.1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // If disabled, the forces are applied at the collision contact point. This leads to a more\r\n            // accurate simulation when interacting with dynamic objects but makes the vehicle less stable.\r\n            // When setting this to true, all forces will be applied to a fixed point on the vehicle body.\r\n            cb.write(desc.enableSuspensionForcePoint ?? false, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n            // wheel spring data\r\n            const spring = desc.spring || {};\r\n            cb.write(spring.mode ?? pc.JOLT_SPRING_MODE_FREQUENCY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n            cb.write(spring.frequency ?? 1.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            cb.write(spring.stiffness ?? 1.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            cb.write(spring.damping ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Friction in forward direction of tire as a function of the slip ratio (fraction):\r\n            // (omega_wheel * r_wheel - v_longitudinal) / |v_longitudinal|.\r\n            // Slip ratio here is a ratio of wheel spinning relative to the floor. At 0 the wheel has full\r\n            // traction and is rolling perfectly in sync with the ground. At 1 the wheel is locked and\r\n            // is sliding over the ground.\r\n            VehicleComponent.writeCurvePoints(cb, desc.longitudinalFriction);\r\n\r\n            // Friction in sideway direction of tire as a function of the slip angle (degrees):\r\n            // angle between relative contact velocity and vehicle direction.\r\n            // If tire forward matches the vehicle direction, then the angle is 0 degrees. If the \r\n            // vehicle is sliding sideways, e.g. on ice, then the angle is 90 degrees. Example curve keys could\r\n            // be: [[0, 1], [90, 0.3]] - full friction at zero degrees, and 0.3 friction at 90.\r\n            VehicleComponent.writeCurvePoints(cb, desc.lateralFriction);\r\n\r\n            const type = this._type;\r\n            if (type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n\r\n                // Moment of inertia (kg m^2), for a cylinder this would be 0.5 * M * R^2 which is \r\n                // 0.9 for a wheel with a mass of 20 kg and radius 0.3 m.\r\n                cb.write(desc.inertia ?? 0.9, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // Angular damping factor of the wheel: dw/dt = -c * w.\r\n                cb.write(desc.angularDamping ?? 0.2, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // How much this wheel can steer (radians). Defaults to ~1.22 rad (70 degrees).\r\n                cb.write(desc.maxSteerAngle ?? 1.2217304763960306, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                \r\n                // How much torque (Nm) the brakes can apply to this wheel.\r\n                cb.write(desc.maxBrakeTorque ?? 1500, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // How much torque (Nm) the hand brake can apply to this wheel (usually only applied\r\n                // to the rear wheels)\r\n                cb.write(desc.maxHandBrakeTorque ?? 4000, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeDifferentials(cb) {\r\n        const differentials = this._differentials;\r\n        const count = differentials.length;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && count === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Vehicle component is missing wheels differentials.' +\r\n                'Default values will make a vehicle without wheels.');\r\n        }\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const diff = differentials[i];\r\n\r\n            // Index (in mWheels) that represents the left wheel of this \r\n            // differential (can be -1 to indicate no wheel)\r\n            cb.write(diff.leftWheel ?? -1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_INT32, false);\r\n\r\n            // Same as leftWheel, but for the right one.\r\n            cb.write(diff.rightWheel ?? -1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_INT32, false);\r\n\r\n            // Ratio between rotation speed of gear box and wheels.\r\n            cb.write(diff.differentialRatio ?? 3.42, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Defines how the engine torque is split across the left and right \r\n            // wheel (0 = left, 0.5 = center, 1 = right)\r\n            cb.write(diff.leftRightSplit ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Ratio max / min wheel speed. When this ratio is exceeded, all\r\n            // torque gets distributed to the slowest moving wheel. This allows\r\n            // implementing a limited slip differential. Set to Number.MAX_VALUE\r\n            // for an open differential. Value should be > 1.\r\n            cb.write(diff.limitedSlipRatio ?? 1.4, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // How much of the engines torque is applied to this differential\r\n            // (0 = none, 1 = full), make sure the sum of all differentials is 1.\r\n            cb.write(diff.engineTorqueRatio ?? 1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }\r\n\r\n    _writeAntiRollBars(cb) {\r\n        const bars = this._antiRollBars;\r\n        const count = bars.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const bar = bars[i];\r\n\r\n            // Index (in wheels) that represents the left wheel of this anti-rollbar.\r\n            cb.write(bar.leftWheel ?? 0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // Index (in wheels) that represents the right wheel of this anti-rollbar.\r\n            cb.write(bar.rightWheel ?? 1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // Stiffness (spring constant in N/m) of anti rollbar, can be 0 to disable the anti-rollbar.\r\n            cb.write(bar.stiffness ?? 1000, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }\r\n\r\n    static writeCurvePoints(cb, curve) {\r\n        cb.write(!!curve, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n        if (curve) {\r\n            const keys = curve.keys;\r\n            const count = keys.length;\r\n\r\n            cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0; i < keys.length; i++) {\r\n                const key = keys[i];\r\n\r\n                cb.write(key[0], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(key[1], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    static writeGears(cb, gears) {\r\n        const count = gears.length;\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        for (let i = 0; i < count; i++) {\r\n            cb.write(gears[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }    \r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvdmVoaWNsZS9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBMkM7QUFDVztBQU81QjtBQUMxQjtBQUNBLCtCQUErQiw4REFBYTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksOERBQWtCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlFQUFxQjtBQUNyQztBQUNBO0FBQ0EsdUJBQXVCLDREQUFnQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhC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O0FBQ0EsMERBQTBELGdFQUFvQjtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQixZQUFZLDZDQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwrREFBbUI7QUFDM0M7QUFDQSx3QkFBd0IsV0FBVztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyw4REFBa0I7QUFDN0Q7QUFDQTtBQUNBLDRDQUE0Qyw4REFBa0I7QUFDOUQ7QUFDQTtBQUNBLHFEQUFxRCxnRUFBb0I7QUFDekU7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGdFQUFvQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGdFQUFvQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsZ0VBQW9CO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLCtEQUFtQjtBQUMzQztBQUNBLHdCQUF3QixXQUFXO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QywrREFBbUI7QUFDNUQ7QUFDQTtBQUNBLDBDQUEwQywrREFBbUI7QUFDN0Q7QUFDQTtBQUNBLDRDQUE0QyxnRUFBb0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsNkRBQWlCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQW1CO0FBQy9DO0FBQ0EsNEJBQTRCLGlCQUFpQjtBQUM3QztBQUNBO0FBQ0EsaUNBQWlDLGdFQUFvQjtBQUNyRCxpQ0FBaUMsZ0VBQW9CO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwrREFBbUI7QUFDM0Msd0JBQXdCLFdBQVc7QUFDbkMsK0JBQStCLGdFQUFvQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUM0QjtBQUM1QiIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3ZlaGljbGUvY29tcG9uZW50Lm1qcz9iMmQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCb2R5Q29tcG9uZW50IH0gZnJvbSBcIi4uL2JvZHkvY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBCVUZGRVJfV1JJVEVfSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UMTYsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDMyLCBCVUZGRVJfV1JJVEVfVUlOVDgsIEJVRkZFUl9XUklURV9WRUMzMiwgQ01EX1NFVF9EUklWRVJfSU5QVVQsXHJcbiAgICBPQkpfTEFZRVJfTU9WSU5HLFxyXG4gICAgT1BFUkFUT1JfTU9ESUZJRVIsIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSLCBWRUhJQ0xFX0NBU1RfVFlQRV9SQVksXHJcbiAgICBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkUsIFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFLCBWRUhJQ0xFX1RZUEVfV0hFRUxcclxufSBmcm9tIFwiLi4vY29uc3RhbnRzLm1qc1wiO1xyXG5cclxuY2xhc3MgVmVoaWNsZUNvbXBvbmVudCBleHRlbmRzIEJvZHlDb21wb25lbnQge1xyXG4gICAgLy8gVXNlZCBvbmx5IHdoZW4gdGhlIGNvbnN0cmFpbnQgaXMgYWN0aXZlLiBPdmVycmlkZSBmb3IgdGhlIG51bWJlciBvZiBzb2x2ZXIgXHJcbiAgICAvLyB2ZWxvY2l0eSBpdGVyYXRpb25zIHRvIHJ1biwgMCBtZWFucyB1c2UgdGhlIGRlZmF1bHQgaW4gUGh5c2ljc1NldHRpbmdzLm51bVZlbG9jaXR5U3RlcHMuXHJcbiAgICAvLyBUaGUgbnVtYmVyIG9mIGl0ZXJhdGlvbnMgdG8gdXNlIGlzIHRoZSBtYXggb2YgYWxsIGNvbnRhY3RzIGFuZCBjb25zdHJhaW50cyBpbiB0aGUgaXNsYW5kLlxyXG4gICAgX251bVZlbG9jaXR5U3RlcHNPdmVycmlkZSA9IDA7XHJcblxyXG4gICAgLy8gVXNlZCBvbmx5IHdoZW4gdGhlIGNvbnN0cmFpbnQgaXMgYWN0aXZlLiBPdmVycmlkZSBmb3IgdGhlIG51bWJlciBvZiBzb2x2ZXJcclxuICAgIC8vIHBvc2l0aW9uIGl0ZXJhdGlvbnMgdG8gcnVuLCAwIG1lYW5zIHVzZSB0aGUgZGVmYXVsdCBpbiBQaHlzaWNzU2V0dGluZ3MubnVtUG9zaXRpb25TdGVwcy5cclxuICAgIC8vIFRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byB1c2UgaXMgdGhlIG1heCBvZiBhbGwgY29udGFjdHMgYW5kIGNvbnN0cmFpbnRzIGluIHRoZSBpc2xhbmQuXHJcbiAgICBfbnVtUG9zaXRpb25TdGVwc092ZXJyaWRlID0gMDtcclxuXHJcbiAgICAvLyBWZWN0b3IgaW5kaWNhdGluZyB0aGUgdXAgZGlyZWN0aW9uIG9mIHRoZSB2ZWhpY2xlIChpbiBsb2NhbCBzcGFjZSB0byB0aGUgYm9keSlcclxuICAgIF91cCA9IHBjLlZlYzMuVVA7XHJcblxyXG4gICAgLy8gVmVjdG9yIGluZGljYXRpbmcgZm9yd2FyZCBkaXJlY3Rpb24gb2YgdGhlIHZlaGljbGUgKGluIGxvY2FsIHNwYWNlIHRvIHRoZSBib2R5KVxyXG4gICAgX2ZvcndhcmQgPSBwYy5WZWMzLkJBQ0s7XHJcblxyXG4gICAgLy8gRGVmaW5lcyB0aGUgbWF4aW11bSBwaXRjaC9yb2xsIGFuZ2xlIChyYWQpLCBjYW4gYmUgdXNlZCB0byBhdm9pZCB0aGUgY2FyIGZyb20gZ2V0dGluZyB1cHNpZGVcclxuICAgIC8vIGRvd24uIFRoZSB2ZWhpY2xlIHVwIGRpcmVjdGlvbiB3aWxsIHN0YXkgd2l0aGluIGEgY29uZSBjZW50ZXJlZCBhcm91bmQgdGhlIHVwIGF4aXMgd2l0aCBoYWxmXHJcbiAgICAvLyB0b3AgYW5nbGUgbWF4UGl0Y2hSb2xsQW5nbGUsIHNldCB0byBwaSB0byB0dXJuIG9mZi4gRGVmYXVsdHMgdG8gfjEuMDQgcmFkICg2MCBkZWdyZWVzKVxyXG4gICAgX21heFBpdGNoUm9sbEFuZ2xlID0gMS4wNDcxOTc1NTExOTY1OTc2O1xyXG5cclxuICAgIC8vIEFuIGFycmF5IG9mIGFycmF5cy4gRWFjaCBhcnJheSByZXByZXNlbnRzIGEgdHJhY2sgYW5kIGxpc3RzIGluZGljZXMgb2Ygd2hlZWxzIHRoYXQgYXJlIGluc2lkZVxyXG4gICAgLy8gdGhhdCB0cmFjay4gVGhlIGxhc3QgZWxlbWVudCBpbiBlYWNoIHRyYWNrIGFycmF5IHdpbGwgYmVjb21lIGEgZHJpdmVuIHdoZWVsIChhbiBpbmRleCB0aGF0IHBvaW50c1xyXG4gICAgLy8gdG8gYSB3aGVlbCB0aGF0IGlzIGNvbm5lY3RlZCB0byB0aGUgZW5naW5lKS5cclxuICAgIC8vIEV4YW1wbGUgd2l0aCAyIHRyYWNrcywgYW5kIGVhY2ggaGF2aW5nIDQgd2hlZWxzOiBbWzAsIDEsIDIsIDNdLCBbNCwgNSwgNiwgN11dXHJcbiAgICBfdHJhY2tzID0gW107XHJcblxyXG4gICAgLy8gQW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGRlc2NyaWJlIGVhY2ggd2hlZWwuIFNlZSBfd3JpdGVXaGVlbHNEYXRhKCkuXHJcbiAgICBfd2hlZWxzID0gW107XHJcblxyXG4gICAgLy8gVmVoaWNsZSB0eXBlLiBDYW4gYmUgd2hlZWxlZCAoVkVISUNMRV9UWVBFX1dIRUVMKSBvciB0cmFja2VkIChWRUhJQ0xFX1RZUEVfVFJBQ0spLlxyXG4gICAgX3R5cGUgPSBWRUhJQ0xFX1RZUEVfV0hFRUw7XHJcblxyXG4gICAgLy8gTWF4IGFtb3VudCBvZiB0b3JxdWUgKE5tKSB0aGF0IHRoZSBlbmdpbmUgY2FuIGRlbGl2ZXIuXHJcbiAgICBfbWF4VG9ycXVlID0gNTAwO1xyXG4gICAgXHJcbiAgICAvLyBNaW4gYW1vdW50IG9mIHJldm9sdXRpb25zIHBlciBtaW51dGUgKHJwbSkgdGhlIGVuZ2luZSBjYW4gcHJvZHVjZSB3aXRob3V0IHN0YWxsaW5nLlxyXG4gICAgX21pblJQTSA9IDEwMDA7XHJcblxyXG4gICAgLy8gTWF4IGFtb3VudCBvZiByZXZvbHV0aW9ucyBwZXIgbWludXRlIChycG0pIHRoZSBlbmdpbmUgY2FuIGdlbmVyYXRlLlxyXG4gICAgX21heFJQTSA9IDYwMDA7XHJcblxyXG4gICAgLy8gTW9tZW50IG9mIGluZXJ0aWEgKGtnIG1eMikgb2YgdGhlIGVuZ2luZS5cclxuICAgIF9pbmVydGlhID0gMC41O1xyXG5cclxuICAgIC8vIEFuZ3VsYXIgZGFtcGluZyBmYWN0b3Igb2YgdGhlIHdoZWVsOiBkdy9kdCA9IC1jICogdy5cclxuICAgIF9hbmd1bGFyRGFtcGluZyA9IDAuMjtcclxuXHJcbiAgICAvLyBDdXJ2ZSB0aGF0IGRlc2NyaWJlcyBhIHJhdGlvIG9mIHRoZSBtYXggdG9ycXVlIHRoZSBlbmdpbmUgY2FuIHByb2R1Y2UgdnMgdGhlIGZyYWN0aW9uIG9mIHRoZSBtYXggUlBNIG9mIHRoZSBlbmdpbmUuXHJcbiAgICBfbm9ybWFsaXplZFRvcnF1ZSA9IG5ldyBwYy5DdXJ2ZShbMCwgMC44LCAwLCAwLjhdKTtcclxuXHJcbiAgICAvLyBIb3cgdG8gc3dpdGNoIGdlYXJzLlxyXG4gICAgX21vZGUgPSBwYy5KT0xUX1RSQU5TTUlTU0lPTl9BVVRPO1xyXG5cclxuICAgIC8vIFJhdGlvIGluIHJvdGF0aW9uIHJhdGUgYmV0d2VlbiBlbmdpbmUgYW5kIGdlYXIgYm94LCBmaXJzdCBlbGVtZW50IGlzIDFzdCBnZWFyLCAybmQgZWxlbWVudCAybmQgZ2VhciBldGMuXHJcbiAgICBfZ2VhclJhdGlvcyA9IFsyLjY2LCAxLjc4LCAxLjMsIDEsIDAuNzRdO1xyXG5cclxuICAgIC8vIFJhdGlvIGluIHJvdGF0aW9uIHJhdGUgYmV0d2VlbiBlbmdpbmUgYW5kIGdlYXIgYm94IHdoZW4gZHJpdmluZyBpbiByZXZlcnNlLlxyXG4gICAgX3JldmVyc2VHZWFyUmF0aW9zID0gWy0yLjldO1xyXG5cclxuICAgIC8vIEhvdyBsb25nIGl0IHRha2VzIHRvIHN3aXRjaCBnZWFycyAocyksIG9ubHkgdXNlZCBpbiBhdXRvIG1vZGUuXHJcbiAgICBfc3dpdGNoVGltZSA9IDAuNTtcclxuXHJcbiAgICAvLyBIb3cgbG9uZyBpdCB0YWtlcyB0byByZWxlYXNlIHRoZSBjbHV0Y2ggKGdvIHRvIGZ1bGwgZnJpY3Rpb24pLCBvbmx5IHVzZWQgaW4gYXV0byBtb2RlXHJcbiAgICBfY2x1dGNoUmVsZWFzZVRpbWUgPSAwLjM7XHJcblxyXG4gICAgLy8gSG93IGxvbmcgdG8gd2FpdCBhZnRlciByZWxlYXNpbmcgdGhlIGNsdXRjaCBiZWZvcmUgYW5vdGhlciBzd2l0Y2ggaXMgYXR0ZW1wdGVkIChzKSwgb25seSB1c2VkIGluIGF1dG8gbW9kZS5cclxuICAgIF9zd2l0Y2hMYXRlbmN5ID0gMC41O1xyXG5cclxuICAgIC8vIElmIFJQTSBvZiBlbmdpbmUgaXMgYmlnZ2VyIHRoZW4gdGhpcyB3ZSB3aWxsIHNoaWZ0IGEgZ2VhciB1cCwgb25seSB1c2VkIGluIGF1dG8gbW9kZS5cclxuICAgIF9zaGlmdFVwUlBNID0gNDAwMDtcclxuXHJcbiAgICAvLyBJZiBSUE0gb2YgZW5naW5lIGlzIHNtYWxsZXIgdGhlbiB0aGlzIHdlIHdpbGwgc2hpZnQgYSBnZWFyIGRvd24sIG9ubHkgdXNlZCBpbiBhdXRvIG1vZGUuXHJcbiAgICBfc2hpZnREb3duUlBNID0gMjAwMDtcclxuXHJcbiAgICAvLyBTdHJlbmd0aCBvZiB0aGUgY2x1dGNoIHdoZW4gZnVsbHkgZW5nYWdlZC4gVG90YWwgdG9ycXVlIGEgY2x1dGNoIGFwcGxpZXMgaXMgXHJcbiAgICAvLyBUb3JxdWUgPSBDbHV0Y2hTdHJlbmd0aCAqIChWZWxvY2l0eSBFbmdpbmUgLSBBdmcgVmVsb2NpdHkgV2hlZWxzIEF0IENsdXRjaCkgKHVuaXRzOiBrIG1eMiBzXi0xKVxyXG4gICAgX2NsdXRjaFN0cmVuZ3RoID0gMTA7XHJcblxyXG4gICAgLy8gTGlzdCBvZiBkaWZmZXJlbnRpYWxzIGFuZCB0aGVpciBwcm9wZXJ0aWVzXHJcbiAgICBfZGlmZmVyZW50aWFscyA9IFtdO1xyXG5cclxuICAgIC8vIFVzZWQgd2hlbiB2ZWhpY2xlIGlzIG9mIHdoZWVsZWQgdHlwZS4gUmF0aW8gbWF4IC8gbWluIGF2ZXJhZ2Ugd2hlZWwgc3BlZWQgb2YgZWFjaCBkaWZmZXJlbnRpYWxcclxuICAgIC8vIChtZWFzdXJlZCBhdCB0aGUgY2x1dGNoKS4gV2hlbiB0aGUgcmF0aW8gaXMgZXhjZWVkZWQgYWxsIHRvcnF1ZSBnZXRzIGRpc3RyaWJ1dGVkIHRvIHRoZSBkaWZmZXJlbnRpYWxcclxuICAgIC8vIHdpdGggdGhlIG1pbmltYWwgYXZlcmFnZSB2ZWxvY2l0eS4gVGhpcyBhbGxvd3MgaW1wbGVtZW50aW5nIGEgbGltaXRlZCBzbGlwIGRpZmZlcmVudGlhbCBiZXR3ZWVuXHJcbiAgICAvLyBkaWZmZXJlbnRpYWxzLiBTZXQgdG8gTnVtYmVyLk1BWF9WQUxVRSBmb3IgYW4gb3BlbiBkaWZmZXJlbnRpYWwuIFZhbHVlIHNob3VsZCBiZSA+IDEuXHJcbiAgICBfZGlmZmVyZW50aWFsTGltaXRlZFNsaXBSYXRpbyA9IDEuNDtcclxuXHJcbiAgICAvLyBBbiBhbnRpIHJvbGxiYXIgaXMgYSBzdGlmZiBzcHJpbmcgdGhhdCBjb25uZWN0cyB0d28gd2hlZWxzIHRvIHJlZHVjZSB0aGUgYW1vdW50IG9mIHJvbGwgdGhlXHJcbiAgICAvLyB2ZWhpY2xlIG1ha2VzIGluIHNoYXJwIGNvcm5lcnMgU2VlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BbnRpLXJvbGxfYmFyXHJcbiAgICBfYW50aVJvbGxCYXJzID0gW107ICAgIFxyXG5cclxuICAgIC8vIENvbGxpc2lvbiB0ZXN0ZXIgdGhhdCB0ZXN0cyB3aGVlbHMgY29sbGlzaW9uLlxyXG4gICAgLy8gLSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVlcclxuICAgIC8vIC0gVkVISUNMRV9DQVNUX1RZUEVfU1BIRVJFXHJcbiAgICAvLyAtIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSIFxyXG4gICAgX2Nhc3RUeXBlID0gVkVISUNMRV9DQVNUX1RZUEVfUkFZO1xyXG5cclxuICAgIC8vIE9iamVjdCBsYXllciB0byB0ZXN0IGNvbGxpc2lvbiB3aXRoLlxyXG4gICAgX2Nhc3RPYmplY3RMYXllciA9IE9CSl9MQVlFUl9NT1ZJTkc7XHJcblxyXG4gICAgLy8gV29ybGQgc3BhY2UgdXAgdmVjdG9yLCB1c2VkIHRvIGF2b2lkIGNvbGxpZGluZyB3aXRoIHZlcnRpY2FsIHdhbGxzLlxyXG4gICAgX2Nhc3RVcCA9IHBjLlZlYzMuVVA7XHJcblxyXG4gICAgLy8gTWF4IGFuZ2xlIChyYWQpIHRoYXQgaXMgY29uc2lkZXJlZCBmb3IgY29sbGlkaW5nIHdoZWVscy4gVGhpcyBpcyB0byBhdm9pZCBjb2xsaWRpbmdcclxuICAgIC8vIHdpdGggdmVydGljYWwgd2FsbHMuIERlZmF1bHRzIHRvIH4xLjQgcmFkICg4MCBkZWdyZWVzKS5cclxuICAgIF9jYXN0TWF4U2xvcGVBbmdsZSA9IDEuMzk2MjYzNDAxNTk1NDYzNjtcclxuXHJcbiAgICAvLyBTZXRzIHRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSB1c2VkIGluIGNhc3QuXHJcbiAgICBfY2FzdFJhZGl1cyA9IDAuMztcclxuXHJcbiAgICAvLyBGcmFjdGlvbiBvZiBoYWxmIHRoZSB3aGVlbCB3aWR0aCAob3Igd2hlZWwgcmFkaXVzIGlmIGl0IGlzIHNtYWxsZXIpIHRoYXQgaXMgdXNlZCBhcyB0aGUgY29udmV4IHJhZGl1c1xyXG4gICAgX2Nhc3RGcmFjdGlvbiA9IDAuMTtcclxuXHJcbiAgICAvLyBIb3cgZmFyIHdlJ3JlIHdpbGxpbmcgdG8gbWFrZSB0aGUgYmlrZSBsZWFuIG92ZXIgaW4gdHVybnMgKGluIHJhZGlhbnMpXHJcbiAgICBfbWF4TGVhbkFuZ2xlID0gNDU7XHJcbiAgICBcclxuICAgIC8vIFNwcmluZyBjb25zdGFudCBmb3IgdGhlIGxlYW4gc3ByaW5nLlxyXG4gICAgX2xlYW5TcHJpbmdDb25zdGFudCA9IDUwMDA7XHJcblxyXG4gICAgLy8gU3ByaW5nIGRhbXBpbmcgY29uc3RhbnQgZm9yIHRoZSBsZWFuIHNwcmluZy5cclxuICAgIF9sZWFuU3ByaW5nRGFtcGluZyA9IDEwMDA7XHJcblxyXG4gICAgLy8gVGhlIGxlYW4gc3ByaW5nIGFwcGxpZXMgYW4gYWRkaXRpb25hbCBmb3JjZSBlcXVhbCB0byB0aGlzIGNvZWZmaWNpZW50ICogSW50ZWdyYWwoZGVsdGEgYW5nbGUsIDAsIHQpLFxyXG4gICAgLy8gdGhpcyBlZmZlY3RpdmVseSBtYWtlcyB0aGUgbGVhbiBzcHJpbmcgYSBQSUQgY29udHJvbGxlci5cclxuICAgIF9sZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudCA9IDA7XHJcblxyXG4gICAgLy8gSG93IG11Y2ggdG8gZGVjYXkgdGhlIGFuZ2xlIGludGVncmFsIHdoZW4gdGhlIHdoZWVscyBhcmUgbm90IHRvdWNoaW5nIHRoZSBmbG9vcjpcclxuICAgIC8vIG5ld192YWx1ZSA9IGVeKC1kZWNheSAqIHQpICogaW5pdGlhbF92YWx1ZS5cclxuICAgIF9sZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudERlY2F5ID0gNDtcclxuXHJcbiAgICAvLyBIb3cgbXVjaCB0byBzbW9vdGggdGhlIGxlYW4gYW5nbGUgKDAgPSBubyBzbW9vdGhpbmcsIDEgPSBsZWFuIGFuZ2xlIG5ldmVyIGNoYW5nZXMpLiBOb3RlIHRoYXQgdGhpc1xyXG4gICAgLy8gaXMgZnJhbWUgcmF0ZSBkZXBlbmRlbnQgYmVjYXVzZSB0aGUgZm9ybXVsYSBpczogc21vb3RoaW5nX2ZhY3RvciAqIHByZXZpb3VzICsgKDEgLSBzbW9vdGhpbmdfZmFjdG9yKSAqIGN1cnJlbnRcclxuICAgIF9sZWFuU21vb3RoaW5nRmFjdG9yID0gMC44O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmVoaWNsZURhdGEoY2IpIHtcclxuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5fdHlwZTtcclxuXHJcbiAgICAgICAgLy8gZ2VuZXJhbCB2ZWhpY2xlIGRhdGFcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9pbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHR5cGUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX251bVZlbG9jaXR5U3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX251bVZlbG9jaXR5U3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VwLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9mb3J3YXJkLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhQaXRjaFJvbGxBbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgLy8gZW5naW5lIGRhdGFcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhUb3JxdWUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWluUlBNLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heFJQTSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9pbmVydGlhLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FuZ3VsYXJEYW1waW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIFZlaGljbGVDb21wb25lbnQud3JpdGVDdXJ2ZVBvaW50cyhjYiwgdGhpcy5fbm9ybWFsaXplZFRvcnF1ZSk7XHJcblxyXG4gICAgICAgIC8vIHRyYW5zbWlzc2lvbiBkYXRhXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbW9kZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fc3dpdGNoVGltZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9jbHV0Y2hSZWxlYXNlVGltZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zd2l0Y2hMYXRlbmN5LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3NoaWZ0VXBSUE0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fc2hpZnREb3duUlBNLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2NsdXRjaFN0cmVuZ3RoLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIFZlaGljbGVDb21wb25lbnQud3JpdGVHZWFycyhjYiwgdGhpcy5fZ2VhclJhdGlvcyk7XHJcbiAgICAgICAgVmVoaWNsZUNvbXBvbmVudC53cml0ZUdlYXJzKGNiLCB0aGlzLl9yZXZlcnNlR2VhclJhdGlvcyk7XHJcblxyXG4gICAgICAgIC8vIHdoZWVscyBkYXRhXHJcbiAgICAgICAgY29uc3QgaXNXaGVlbGVkID0gdHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMIHx8IHR5cGUgPT09IFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFO1xyXG4gICAgICAgIGlmIChpc1doZWVsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fd3JpdGVXaGVlbHNEYXRhKGNiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl93cml0ZVRyYWNrc0RhdGEoY2IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICAvLyBkaWZmZXJlbnRpYWxzXHJcbiAgICAgICAgICAgIHRoaXMuX3dyaXRlRGlmZmVyZW50aWFscyhjYik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2RpZmZlcmVudGlhbExpbWl0ZWRTbGlwUmF0aW8sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX21heExlYW5BbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2xlYW5TcHJpbmdDb25zdGFudCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2xlYW5TcHJpbmdEYW1waW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVhblNwcmluZ0ludGVncmF0aW9uQ29lZmZpY2llbnQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9sZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudERlY2F5LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVhblNtb290aGluZ0ZhY3RvciwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fd3JpdGVBbnRpUm9sbEJhcnMoY2IpO1xyXG5cclxuICAgICAgICAvLyBjYXN0IHR5cGVcclxuICAgICAgICBjb25zdCBjYXN0VHlwZSA9IHRoaXMuX2Nhc3RUeXBlO1xyXG4gICAgICAgIGNiLndyaXRlKGNhc3RUeXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9jYXN0T2JqZWN0TGF5ZXIsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBzd2l0Y2ggKGNhc3RUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfUkFZOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdFVwLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2Nhc3RNYXhTbG9wZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfU1BIRVJFOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdFVwLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2Nhc3RNYXhTbG9wZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdFJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdEZyYWN0aW9uLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFueSB0eXBlOlxyXG4gICAgLy8gICAgICBpbnB1dDAgLSBWYWx1ZSBiZXR3ZWVuIC0xIGFuZCAxIGZvciBhdXRvIHRyYW5zbWlzc2lvbiBhbmQgdmFsdWUgYmV0d2VlbiAwIGFuZCAxIGluZGljYXRpbmcgXHJcbiAgICAvLyAgICAgICAgICAgICAgZGVzaXJlZCBkcml2aW5nIGRpcmVjdGlvbiBhbmQgYW1vdW50IHRoZSBnYXMgcGVkYWwgaXMgcHJlc3NlZFxyXG4gICAgLy8gV2hlZWxlZDpcclxuICAgIC8vICAgICAgaW5wdXQxIC0gVmFsdWUgYmV0d2VlbiAtMSBhbmQgMSBpbmRpY2F0aW5nIGRlc2lyZWQgc3RlZXJpbmcgYW5nbGUgKDEgPSByaWdodClcclxuICAgIC8vICAgICAgaW5wdXQyIC0gVmFsdWUgYmV0d2VlbiAwIGFuZCAxIGluZGljYXRpbmcgaG93IHN0cm9uZyB0aGUgYnJha2UgcGVkYWwgaXMgcHJlc3NlZFxyXG4gICAgLy8gICAgICBpbnB1dDMgLSBWYWx1ZSBiZXR3ZWVuIDAgYW5kIDEgaW5kaWNhdGluZyBob3cgc3Ryb25nIHRoZSBoYW5kIGJyYWtlIGlzIHB1bGxlZFxyXG4gICAgLy8gVHJhY2tlZDpcclxuICAgIC8vICAgICAgaW5wdXQxIC0gVmFsdWUgYmV0d2VlbiAtMSBhbmQgMSBpbmRpY2F0aW5nIGFuIGV4dHJhIG11bHRpcGxpZXIgdG8gdGhlIHJvdGF0aW9uIHJhdGUgb2YgdGhlIGxlZnQgdHJhY2sgKHVzZWQgZm9yIHN0ZWVyaW5nKVxyXG4gICAgLy8gICAgICBpbnB1dDIgLSBWYWx1ZSBiZXR3ZWVuIC0xIGFuZCAxIGluZGljYXRpbmcgYW4gZXh0cmEgbXVsdGlwbGllciB0byB0aGUgcm90YXRpb24gcmF0ZSBvZiB0aGUgcmlnaHQgdHJhY2sgKHVzZWQgZm9yIHN0ZWVyaW5nKVxyXG4gICAgLy8gICAgICBpbnB1dDMgLSBWYWx1ZSBiZXR3ZWVuIDAgYW5kIDEgaW5kaWNhdGluZyBob3cgc3Ryb25nIHRoZSBicmFrZSBwZWRhbCBpcyBwcmVzc2VkXHJcbiAgICBzZXREcml2ZXJJbnB1dChpbnB1dDAsIGlucHV0MSwgaW5wdXQyLCBpbnB1dDMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrUmFuZ2UoaW5wdXQwLCAtMSwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciBmb3J3YXJkIChpbnB1dDApLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbLTE6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDAgfWApO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fdHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMIHx8IHRoaXMuX3R5cGUgPT09IFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFKSB7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrUmFuZ2UoaW5wdXQxLCAtMSwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciByaWdodCAoaW5wdXQxKS4gRXhwZWN0ZWQgYSBudW1iZXIgaW4gWy0xOjFdIHJhbmdlLiBSZWNlaXZlZDogJHsgaW5wdXQxIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tSYW5nZShpbnB1dDIsIDAsIDEsIGBJbnZhbGlkIGRyaXZlciBpbnB1dCBmb3IgYnJha2UgKGlucHV0MikuIEV4cGVjdGVkIGEgbnVtYmVyIGluIFswOjFdIHJhbmdlLiBSZWNlaXZlZDogJHsgaW5wdXQyIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tSYW5nZShpbnB1dDMsIDAsIDEsIGBJbnZhbGlkIGRyaXZlciBpbnB1dCBmb3IgaGFuZCBicmFrZSAoaW5wdXQzKS4gRXhwZWN0ZWQgYSBudW1iZXIgaW4gWzA6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDMgfWApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1JhbmdlKGlucHV0MSwgLTEsIDEsIGBJbnZhbGlkIGRyaXZlciBpbnB1dCBmb3IgbGVmdCByYXRpbyAoaW5wdXQxKS4gRXhwZWN0ZWQgYSBudW1iZXIgaW4gWy0xOjFdIHJhbmdlLiBSZWNlaXZlZDogJHsgaW5wdXQxIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tSYW5nZShpbnB1dDIsIC0xLCAxLCBgSW52YWxpZCBkcml2ZXIgaW5wdXQgZm9yIHJpZ2h0IHJhdGlvIChpbnB1dDIpLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbLTE6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDIgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1JhbmdlKGlucHV0MywgMCwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciBicmFrZSAoaW5wdXQzKS4gRXhwZWN0ZWQgYSBudW1iZXIgaW4gWzA6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDMgfWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX1NFVF9EUklWRVJfSU5QVVQsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBpbnB1dDAsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgaW5wdXQxLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGlucHV0MiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBpbnB1dDMsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgb25FbmFibGUoKSB7XHJcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5zeXN0ZW07XHJcblxyXG4gICAgICAgIHRoaXMuX2luZGV4ID0gc3lzdGVtLmdldEluZGV4KHRoaXMuZW50aXR5KTtcclxuXHJcbiAgICAgICAgc3lzdGVtLmNyZWF0ZVZlaGljbGUodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlVHJhY2tzRGF0YShjYikge1xyXG4gICAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMuX3RyYWNrcztcclxuICAgICAgICBjb25zdCBjb3VudCA9IHRyYWNrcy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgY291bnQgPT09IDApIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignSW52YWxpZCB0cmFja3MgZGF0YS4gTmVlZCBhdCBsZWFzdCBvbmUgdHJhY2suJywgdHJhY2tzKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fd3JpdGVXaGVlbHNEYXRhKGNiKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBcclxuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGNvdW50OyB0KyspIHtcclxuICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0cmFja3NbdF07XHJcbiAgICAgICAgICAgIGNvbnN0IHdoZWVsc0NvdW50ID0gdHJhY2subGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgY2Iud3JpdGUod2hlZWxzQ291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodHJhY2tbaV0sIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVXaGVlbHNEYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgd2hlZWxzID0gdGhpcy5fd2hlZWxzO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gd2hlZWxzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlc2MgPSB3aGVlbHNbaV07XHJcblxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5hc3NlcnQoZGVzYy5wb3NpdGlvbiwgXHJcbiAgICAgICAgICAgICAgICAgICAgJ0Egd2hlZWwgZGVzY3JpcHRpb24gcmVxdWlyZXMgYW4gYXR0YWNobWVudCBwb3NpdGlvbiBvZiB3aGVlbCcgK1xyXG4gICAgICAgICAgICAgICAgICAgICdzdXNwZW5zaW9uIGluIGxvY2FsIHNwYWNlIG9mIHRoZSB2ZWhpY2xlJywgZGVzYyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzcHJpbmcgPSBkZXNjLnNwcmluZztcclxuICAgICAgICAgICAgICAgIGlmIChzcHJpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHN0aWZmbmVzcywgZnJlcXVlbmN5IH0gPSBzcHJpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWZmbmVzcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChzdGlmZm5lc3MgIT09IDAsICdXaGVlbCBzcHJpbmcgc3RpZmZuZXNzIGNhbm5vdCBiZSB6ZXJvJywgc3ByaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZyZXF1ZW5jeSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChmcmVxdWVuY3kgIT09IDAsICdXaGVlbCBzcHJpbmcgZnJlcXVlbmN5IGNhbm5vdCBiZSB6ZXJvJywgc3ByaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQXR0YWNobWVudCBwb2ludCBvZiB3aGVlbCBzdXNwZW5zaW9uIGluIGxvY2FsIHNwYWNlIG9mIHRoZSBib2R5LlxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFdoZXJlIHRpcmUgZm9yY2VzIChzdXNwZW5zaW9uIGFuZCB0cmFjdGlvbikgYXJlIGFwcGxpZWQsIGluIGxvY2FsIHNwYWNlIG9mIHRoZSBib2R5LiBcclxuICAgICAgICAgICAgLy8gQSBnb29kIGRlZmF1bHQgaXMgdGhlIGNlbnRlciBvZiB0aGUgd2hlZWwgaW4gaXRzIG5ldXRyYWwgcG9zZS4gU2VlIGVuYWJsZVN1c3BlbnNpb25Gb3JjZVBvaW50LlxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnN1c3BlbnNpb25Gb3JjZVBvaW50IHx8IHBjLlZlYzMuWkVSTywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBEaXJlY3Rpb24gb2YgdGhlIHN1c3BlbnNpb24gaW4gbG9jYWwgc3BhY2Ugb2YgdGhlIGJvZHksIHNob3VsZCBwb2ludCBkb3duLlxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnN1c3BlbnNpb25EaXJlY3Rpb24gfHwgcGMuVmVjMy5ET1dOLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIERpcmVjdGlvbiBvZiB0aGUgc3RlZXJpbmcgYXhpcyBpbiBsb2NhbCBzcGFjZSBvZiB0aGUgYm9keSwgc2hvdWxkIHBvaW50IHVwIChlLmcuIGZvciBhIFxyXG4gICAgICAgICAgICAvLyBiaWtlIHdvdWxkIGJlIC1zdXNwZW5zaW9uRGlyZWN0aW9uKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnN0ZWVyaW5nQXhpcyB8fCBwYy5WZWMzLlVQLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwIGRpcmVjdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBpbiB0aGUgbmV1dHJhbCBzdGVlcmluZyBwb3NpdGlvbiAodXN1YWxseSBcclxuICAgICAgICAgICAgLy8gY29tcG9uZW50LnVwIGJ1dCBjYW4gYmUgdXNlZCB0byBnaXZlIHRoZSB3aGVlbCBjYW1iZXIgb3IgZm9yIGEgYmlrZSB3b3VsZCBiZSAtc3VzcGVuc2lvbkRpcmVjdGlvbilcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy53aGVlbFVwIHx8IHBjLlZlYzMuVVAsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gRm9yd2FyZCBkaXJlY3Rpb24gd2hlbiB0aGUgd2hlZWwgaXMgaW4gdGhlIG5ldXRyYWwgc3RlZXJpbmcgcG9zaXRpb24gKHVzdWFsbHkgXHJcbiAgICAgICAgICAgIC8vIGNvbXBvbmVudC5mb3J3YXJkIGJ1dCBjYW4gYmUgdXNlZCB0byBnaXZlIHRoZSB3aGVlbCB0b2UsIGRvZXMgbm90IG5lZWQgdG8gYmUgcGVycGVuZGljdWxhclxyXG4gICAgICAgICAgICAvLyB0byB3aGVlbFVwKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLndoZWVsRm9yd2FyZCB8fCBwYy5WZWMzLkJBQ0ssIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gSG93IGxvbmcgdGhlIHN1c3BlbnNpb24gaXMgaW4gbWF4IHJhaXNlZCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgYXR0YWNobWVudCBwb2ludCAobSlcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5zdXNwZW5zaW9uTWluTGVuZ3RoID8/IDAuMywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhvdyBsb25nIHRoZSBzdXNwZW5zaW9uIGlzIGluIG1heCBkcm9vcCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgYXR0YWNobWVudCBwb2ludCAobSlcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5zdXNwZW5zaW9uTWF4TGVuZ3RoID8/IDAuNSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRoZSBuYXR1cmFsIGxlbmd0aCAobSkgb2YgdGhlIHN1c3BlbnNpb24gc3ByaW5nIGlzIGRlZmluZWQgYXMgc3VzcGVuc2lvbk1heExlbmd0aCArIFxyXG4gICAgICAgICAgICAvLyBzdXNwZW5zaW9uUHJlbG9hZExlbmd0aC4gQ2FuIGJlIHVzZWQgdG8gcHJlbG9hZCB0aGUgc3VzcGVuc2lvbiBhcyB0aGUgc3ByaW5nIGlzIGNvbXByZXNzZWRcclxuICAgICAgICAgICAgLy8gYnkgc3VzcGVuc2lvblByZWxvYWRMZW5ndGggd2hlbiB0aGUgc3VzcGVuc2lvbiBpcyBpbiBtYXggZHJvb3AgcG9zaXRpb24uIE5vdGUgdGhhdCB0aGlzIG1lYW5zXHJcbiAgICAgICAgICAgIC8vIHdoZW4gdGhlIHZlaGljbGUgdG91Y2hlcyB0aGUgZ3JvdW5kIHRoZXJlIGlzIGEgZGlzY29udGludWl0eSBzbyBpdCB3aWxsIGFsc28gbWFrZSB0aGUgdmVoaWNsZVxyXG4gICAgICAgICAgICAvLyBtb3JlIGJvdW5jeSBhcyB3ZSdyZSB1cGRhdGluZyB3aXRoIGRpc2NyZXRlIHRpbWUgc3RlcHMuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2Muc3VzcGVuc2lvblByZWxvYWRMZW5ndGggPz8gMCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJhZGl1cyBvZiB0aGUgd2hlZWwgKG0pXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2MucmFkaXVzID8/IDAuMywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFdpZHRoIG9mIHRoZSB3aGVlbCAobSlcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy53aWR0aCA/PyAwLjEsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBJZiBkaXNhYmxlZCwgdGhlIGZvcmNlcyBhcmUgYXBwbGllZCBhdCB0aGUgY29sbGlzaW9uIGNvbnRhY3QgcG9pbnQuIFRoaXMgbGVhZHMgdG8gYSBtb3JlXHJcbiAgICAgICAgICAgIC8vIGFjY3VyYXRlIHNpbXVsYXRpb24gd2hlbiBpbnRlcmFjdGluZyB3aXRoIGR5bmFtaWMgb2JqZWN0cyBidXQgbWFrZXMgdGhlIHZlaGljbGUgbGVzcyBzdGFibGUuXHJcbiAgICAgICAgICAgIC8vIFdoZW4gc2V0dGluZyB0aGlzIHRvIHRydWUsIGFsbCBmb3JjZXMgd2lsbCBiZSBhcHBsaWVkIHRvIGEgZml4ZWQgcG9pbnQgb24gdGhlIHZlaGljbGUgYm9keS5cclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5lbmFibGVTdXNwZW5zaW9uRm9yY2VQb2ludCA/PyBmYWxzZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHdoZWVsIHNwcmluZyBkYXRhXHJcbiAgICAgICAgICAgIGNvbnN0IHNwcmluZyA9IGRlc2Muc3ByaW5nIHx8IHt9O1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmcubW9kZSA/PyBwYy5KT0xUX1NQUklOR19NT0RFX0ZSRVFVRU5DWSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNwcmluZy5mcmVxdWVuY3kgPz8gMS41LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmcuc3RpZmZuZXNzID8/IDEuNSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoc3ByaW5nLmRhbXBpbmcgPz8gMC41LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gRnJpY3Rpb24gaW4gZm9yd2FyZCBkaXJlY3Rpb24gb2YgdGlyZSBhcyBhIGZ1bmN0aW9uIG9mIHRoZSBzbGlwIHJhdGlvIChmcmFjdGlvbik6XHJcbiAgICAgICAgICAgIC8vIChvbWVnYV93aGVlbCAqIHJfd2hlZWwgLSB2X2xvbmdpdHVkaW5hbCkgLyB8dl9sb25naXR1ZGluYWx8LlxyXG4gICAgICAgICAgICAvLyBTbGlwIHJhdGlvIGhlcmUgaXMgYSByYXRpbyBvZiB3aGVlbCBzcGlubmluZyByZWxhdGl2ZSB0byB0aGUgZmxvb3IuIEF0IDAgdGhlIHdoZWVsIGhhcyBmdWxsXHJcbiAgICAgICAgICAgIC8vIHRyYWN0aW9uIGFuZCBpcyByb2xsaW5nIHBlcmZlY3RseSBpbiBzeW5jIHdpdGggdGhlIGdyb3VuZC4gQXQgMSB0aGUgd2hlZWwgaXMgbG9ja2VkIGFuZFxyXG4gICAgICAgICAgICAvLyBpcyBzbGlkaW5nIG92ZXIgdGhlIGdyb3VuZC5cclxuICAgICAgICAgICAgVmVoaWNsZUNvbXBvbmVudC53cml0ZUN1cnZlUG9pbnRzKGNiLCBkZXNjLmxvbmdpdHVkaW5hbEZyaWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEZyaWN0aW9uIGluIHNpZGV3YXkgZGlyZWN0aW9uIG9mIHRpcmUgYXMgYSBmdW5jdGlvbiBvZiB0aGUgc2xpcCBhbmdsZSAoZGVncmVlcyk6XHJcbiAgICAgICAgICAgIC8vIGFuZ2xlIGJldHdlZW4gcmVsYXRpdmUgY29udGFjdCB2ZWxvY2l0eSBhbmQgdmVoaWNsZSBkaXJlY3Rpb24uXHJcbiAgICAgICAgICAgIC8vIElmIHRpcmUgZm9yd2FyZCBtYXRjaGVzIHRoZSB2ZWhpY2xlIGRpcmVjdGlvbiwgdGhlbiB0aGUgYW5nbGUgaXMgMCBkZWdyZWVzLiBJZiB0aGUgXHJcbiAgICAgICAgICAgIC8vIHZlaGljbGUgaXMgc2xpZGluZyBzaWRld2F5cywgZS5nLiBvbiBpY2UsIHRoZW4gdGhlIGFuZ2xlIGlzIDkwIGRlZ3JlZXMuIEV4YW1wbGUgY3VydmUga2V5cyBjb3VsZFxyXG4gICAgICAgICAgICAvLyBiZTogW1swLCAxXSwgWzkwLCAwLjNdXSAtIGZ1bGwgZnJpY3Rpb24gYXQgemVybyBkZWdyZWVzLCBhbmQgMC4zIGZyaWN0aW9uIGF0IDkwLlxyXG4gICAgICAgICAgICBWZWhpY2xlQ29tcG9uZW50LndyaXRlQ3VydmVQb2ludHMoY2IsIGRlc2MubGF0ZXJhbEZyaWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLl90eXBlO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMIHx8IHR5cGUgPT09IFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9tZW50IG9mIGluZXJ0aWEgKGtnIG1eMiksIGZvciBhIGN5bGluZGVyIHRoaXMgd291bGQgYmUgMC41ICogTSAqIFJeMiB3aGljaCBpcyBcclxuICAgICAgICAgICAgICAgIC8vIDAuOSBmb3IgYSB3aGVlbCB3aXRoIGEgbWFzcyBvZiAyMCBrZyBhbmQgcmFkaXVzIDAuMyBtLlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5pbmVydGlhID8/IDAuOSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBbmd1bGFyIGRhbXBpbmcgZmFjdG9yIG9mIHRoZSB3aGVlbDogZHcvZHQgPSAtYyAqIHcuXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkZXNjLmFuZ3VsYXJEYW1waW5nID8/IDAuMiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBIb3cgbXVjaCB0aGlzIHdoZWVsIGNhbiBzdGVlciAocmFkaWFucykuIERlZmF1bHRzIHRvIH4xLjIyIHJhZCAoNzAgZGVncmVlcykuXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkZXNjLm1heFN0ZWVyQW5nbGUgPz8gMS4yMjE3MzA0NzYzOTYwMzA2LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBIb3cgbXVjaCB0b3JxdWUgKE5tKSB0aGUgYnJha2VzIGNhbiBhcHBseSB0byB0aGlzIHdoZWVsLlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5tYXhCcmFrZVRvcnF1ZSA/PyAxNTAwLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEhvdyBtdWNoIHRvcnF1ZSAoTm0pIHRoZSBoYW5kIGJyYWtlIGNhbiBhcHBseSB0byB0aGlzIHdoZWVsICh1c3VhbGx5IG9ubHkgYXBwbGllZFxyXG4gICAgICAgICAgICAgICAgLy8gdG8gdGhlIHJlYXIgd2hlZWxzKVxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5tYXhIYW5kQnJha2VUb3JxdWUgPz8gNDAwMCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVEaWZmZXJlbnRpYWxzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgZGlmZmVyZW50aWFscyA9IHRoaXMuX2RpZmZlcmVudGlhbHM7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBkaWZmZXJlbnRpYWxzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiBjb3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICBEZWJ1Zy53YXJuT25jZSgnVmVoaWNsZSBjb21wb25lbnQgaXMgbWlzc2luZyB3aGVlbHMgZGlmZmVyZW50aWFscy4nICtcclxuICAgICAgICAgICAgICAgICdEZWZhdWx0IHZhbHVlcyB3aWxsIG1ha2UgYSB2ZWhpY2xlIHdpdGhvdXQgd2hlZWxzLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBkaWZmZXJlbnRpYWxzW2ldO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5kZXggKGluIG1XaGVlbHMpIHRoYXQgcmVwcmVzZW50cyB0aGUgbGVmdCB3aGVlbCBvZiB0aGlzIFxyXG4gICAgICAgICAgICAvLyBkaWZmZXJlbnRpYWwgKGNhbiBiZSAtMSB0byBpbmRpY2F0ZSBubyB3aGVlbClcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGlmZi5sZWZ0V2hlZWwgPz8gLTEsIEJVRkZFUl9XUklURV9JTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gU2FtZSBhcyBsZWZ0V2hlZWwsIGJ1dCBmb3IgdGhlIHJpZ2h0IG9uZS5cclxuICAgICAgICAgICAgY2Iud3JpdGUoZGlmZi5yaWdodFdoZWVsID8/IC0xLCBCVUZGRVJfV1JJVEVfSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJhdGlvIGJldHdlZW4gcm90YXRpb24gc3BlZWQgb2YgZ2VhciBib3ggYW5kIHdoZWVscy5cclxuICAgICAgICAgICAgY2Iud3JpdGUoZGlmZi5kaWZmZXJlbnRpYWxSYXRpbyA/PyAzLjQyLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gRGVmaW5lcyBob3cgdGhlIGVuZ2luZSB0b3JxdWUgaXMgc3BsaXQgYWNyb3NzIHRoZSBsZWZ0IGFuZCByaWdodCBcclxuICAgICAgICAgICAgLy8gd2hlZWwgKDAgPSBsZWZ0LCAwLjUgPSBjZW50ZXIsIDEgPSByaWdodClcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGlmZi5sZWZ0UmlnaHRTcGxpdCA/PyAwLjUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBSYXRpbyBtYXggLyBtaW4gd2hlZWwgc3BlZWQuIFdoZW4gdGhpcyByYXRpbyBpcyBleGNlZWRlZCwgYWxsXHJcbiAgICAgICAgICAgIC8vIHRvcnF1ZSBnZXRzIGRpc3RyaWJ1dGVkIHRvIHRoZSBzbG93ZXN0IG1vdmluZyB3aGVlbC4gVGhpcyBhbGxvd3NcclxuICAgICAgICAgICAgLy8gaW1wbGVtZW50aW5nIGEgbGltaXRlZCBzbGlwIGRpZmZlcmVudGlhbC4gU2V0IHRvIE51bWJlci5NQVhfVkFMVUVcclxuICAgICAgICAgICAgLy8gZm9yIGFuIG9wZW4gZGlmZmVyZW50aWFsLiBWYWx1ZSBzaG91bGQgYmUgPiAxLlxyXG4gICAgICAgICAgICBjYi53cml0ZShkaWZmLmxpbWl0ZWRTbGlwUmF0aW8gPz8gMS40LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gSG93IG11Y2ggb2YgdGhlIGVuZ2luZXMgdG9ycXVlIGlzIGFwcGxpZWQgdG8gdGhpcyBkaWZmZXJlbnRpYWxcclxuICAgICAgICAgICAgLy8gKDAgPSBub25lLCAxID0gZnVsbCksIG1ha2Ugc3VyZSB0aGUgc3VtIG9mIGFsbCBkaWZmZXJlbnRpYWxzIGlzIDEuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRpZmYuZW5naW5lVG9ycXVlUmF0aW8gPz8gMSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlQW50aVJvbGxCYXJzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFycyA9IHRoaXMuX2FudGlSb2xsQmFycztcclxuICAgICAgICBjb25zdCBjb3VudCA9IGJhcnMubGVuZ3RoO1xyXG5cclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgYmFyID0gYmFyc1tpXTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluZGV4IChpbiB3aGVlbHMpIHRoYXQgcmVwcmVzZW50cyB0aGUgbGVmdCB3aGVlbCBvZiB0aGlzIGFudGktcm9sbGJhci5cclxuICAgICAgICAgICAgY2Iud3JpdGUoYmFyLmxlZnRXaGVlbCA/PyAwLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBJbmRleCAoaW4gd2hlZWxzKSB0aGF0IHJlcHJlc2VudHMgdGhlIHJpZ2h0IHdoZWVsIG9mIHRoaXMgYW50aS1yb2xsYmFyLlxyXG4gICAgICAgICAgICBjYi53cml0ZShiYXIucmlnaHRXaGVlbCA/PyAxLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBTdGlmZm5lc3MgKHNwcmluZyBjb25zdGFudCBpbiBOL20pIG9mIGFudGkgcm9sbGJhciwgY2FuIGJlIDAgdG8gZGlzYWJsZSB0aGUgYW50aS1yb2xsYmFyLlxyXG4gICAgICAgICAgICBjYi53cml0ZShiYXIuc3RpZmZuZXNzID8/IDEwMDAsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3cml0ZUN1cnZlUG9pbnRzKGNiLCBjdXJ2ZSkge1xyXG4gICAgICAgIGNiLndyaXRlKCEhY3VydmUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGlmIChjdXJ2ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBrZXlzID0gY3VydmUua2V5cztcclxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBrZXlzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoa2V5WzBdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoa2V5WzFdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3cml0ZUdlYXJzKGNiLCBnZWFycykge1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gZ2VhcnMubGVuZ3RoO1xyXG4gICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGdlYXJzW2ldLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH0gICAgXHJcbn1cclxuXHJcbmV4cG9ydCB7IFZlaGljbGVDb21wb25lbnQgfTtcclxuXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/vehicle/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/vehicle/system.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/vehicle/system.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VehicleComponentSystem: () => (/* binding */ VehicleComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/vehicle/component.mjs\");\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    'antiRollBars',\r\n    'angularDamping',\r\n    'castFraction',\r\n    'castMaxSlopeAngle',\r\n    'castObjectLayer',\r\n    'castRadius',\r\n    'castType',\r\n    'castUp',\r\n    'clutchReleaseTime',\r\n    'clutchStrength',\r\n    'differentialLimitedSlipRatio',\r\n    'differentials',\r\n    'forward',\r\n    'gearRatios',\r\n    'inertia',\r\n    'numVelocityStepsOverride',\r\n    'leanSmoothingFactor',\r\n    'leanSpringConstant',\r\n    'leanSpringDamping',\r\n    'leanSpringIntegrationCoefficient',\r\n    'leanSpringIntegrationCoefficientDecay',\r\n    'maxLeanAngle',\r\n    'numPositionStepsOverride',\r\n    'maxPitchRollAngle',\r\n    'maxTorque',\r\n    'maxRPM',\r\n    'minRPM',\r\n    'mode',\r\n    'normalizedTorque',\r\n    'reverseGearRatios',\r\n    'shiftDownRPM',\r\n    'shiftUpRPM',\r\n    'switchLatency',\r\n    'switchTime',\r\n    'tracks',\r\n    'type',\r\n    'wheels',\r\n    'up'\r\n\r\n];\r\n\r\nclass VehicleComponentSystem extends _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponentSystem {\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'vehicle';\r\n        this.schema = [...this.schema, ...schema];\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_3__.VehicleComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    createVehicle(component) {\r\n        super.createBody(component);\r\n\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_VEHICLE);\r\n\r\n        component.writeVehicleData(cb);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvdmVoaWNsZS9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQW1EO0FBQ007QUFDeUM7QUFDL0M7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsaUVBQW1CO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsNERBQWdCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLFFBQVEseURBQWM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsNERBQWdCO0FBQ3pDLHdCQUF3Qiw4REFBa0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3ZlaGljbGUvc3lzdGVtLm1qcz80ODE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWwubWpzXCI7XHJcbmltcG9ydCB7IEJvZHlDb21wb25lbnRTeXN0ZW0gfSBmcm9tIFwiLi4vYm9keS9zeXN0ZW0ubWpzXCI7XHJcbmltcG9ydCB7IENNRF9DUkVBVEVfVkVISUNMRSwgQ09NUE9ORU5UX1NZU1RFTV9WRUhJQ0xFLCBPUEVSQVRPUl9DUkVBVE9SIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuaW1wb3J0IHsgVmVoaWNsZUNvbXBvbmVudCB9IGZyb20gXCIuL2NvbXBvbmVudC5tanNcIjtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IFtcclxuICAgICdhbnRpUm9sbEJhcnMnLFxyXG4gICAgJ2FuZ3VsYXJEYW1waW5nJyxcclxuICAgICdjYXN0RnJhY3Rpb24nLFxyXG4gICAgJ2Nhc3RNYXhTbG9wZUFuZ2xlJyxcclxuICAgICdjYXN0T2JqZWN0TGF5ZXInLFxyXG4gICAgJ2Nhc3RSYWRpdXMnLFxyXG4gICAgJ2Nhc3RUeXBlJyxcclxuICAgICdjYXN0VXAnLFxyXG4gICAgJ2NsdXRjaFJlbGVhc2VUaW1lJyxcclxuICAgICdjbHV0Y2hTdHJlbmd0aCcsXHJcbiAgICAnZGlmZmVyZW50aWFsTGltaXRlZFNsaXBSYXRpbycsXHJcbiAgICAnZGlmZmVyZW50aWFscycsXHJcbiAgICAnZm9yd2FyZCcsXHJcbiAgICAnZ2VhclJhdGlvcycsXHJcbiAgICAnaW5lcnRpYScsXHJcbiAgICAnbnVtVmVsb2NpdHlTdGVwc092ZXJyaWRlJyxcclxuICAgICdsZWFuU21vb3RoaW5nRmFjdG9yJyxcclxuICAgICdsZWFuU3ByaW5nQ29uc3RhbnQnLFxyXG4gICAgJ2xlYW5TcHJpbmdEYW1waW5nJyxcclxuICAgICdsZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudCcsXHJcbiAgICAnbGVhblNwcmluZ0ludGVncmF0aW9uQ29lZmZpY2llbnREZWNheScsXHJcbiAgICAnbWF4TGVhbkFuZ2xlJyxcclxuICAgICdudW1Qb3NpdGlvblN0ZXBzT3ZlcnJpZGUnLFxyXG4gICAgJ21heFBpdGNoUm9sbEFuZ2xlJyxcclxuICAgICdtYXhUb3JxdWUnLFxyXG4gICAgJ21heFJQTScsXHJcbiAgICAnbWluUlBNJyxcclxuICAgICdtb2RlJyxcclxuICAgICdub3JtYWxpemVkVG9ycXVlJyxcclxuICAgICdyZXZlcnNlR2VhclJhdGlvcycsXHJcbiAgICAnc2hpZnREb3duUlBNJyxcclxuICAgICdzaGlmdFVwUlBNJyxcclxuICAgICdzd2l0Y2hMYXRlbmN5JyxcclxuICAgICdzd2l0Y2hUaW1lJyxcclxuICAgICd0cmFja3MnLFxyXG4gICAgJ3R5cGUnLFxyXG4gICAgJ3doZWVscycsXHJcbiAgICAndXAnXHJcblxyXG5dO1xyXG5cclxuY2xhc3MgVmVoaWNsZUNvbXBvbmVudFN5c3RlbSBleHRlbmRzIEJvZHlDb21wb25lbnRTeXN0ZW0ge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBtYW5hZ2VyLCBpZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgbWFuYWdlcik7XHJcblxyXG4gICAgICAgIHRoaXMuaWQgPSAndmVoaWNsZSc7XHJcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBbLi4udGhpcy5zY2hlbWEsIC4uLnNjaGVtYV07XHJcbiAgICAgICAgdGhpcy5Db21wb25lbnRUeXBlID0gVmVoaWNsZUNvbXBvbmVudDtcclxuXHJcbiAgICAgICAgbWFuYWdlci5zeXN0ZW1zLnNldChpZCwgdGhpcyk7XHJcblxyXG4gICAgICAgIGJ1aWxkQWNjZXNzb3JzKHRoaXMsIHRoaXMuc2NoZW1hKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVWZWhpY2xlKGNvbXBvbmVudCkge1xyXG4gICAgICAgIHN1cGVyLmNyZWF0ZUJvZHkoY29tcG9uZW50KTtcclxuXHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9tYW5hZ2VyLmNvbW1hbmRzQnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NSRUFUT1IpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ1JFQVRFX1ZFSElDTEUpO1xyXG5cclxuICAgICAgICBjb21wb25lbnQud3JpdGVWZWhpY2xlRGF0YShjYik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFZlaGljbGVDb21wb25lbnRTeXN0ZW0gfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/vehicle/system.mjs\n");

/***/ }),

/***/ "./src/physics/debug.mjs":
/*!*******************************!*\
  !*** ./src/physics/debug.mjs ***!
  \*******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Debug: () => (/* binding */ Debug)\n/* harmony export */ });\nclass Debug {\r\n    static _logged = new Set();\r\n\r\n    static dev = (\"development\" === 'development');\r\n\r\n    static log(...attr) {\r\n        console.log(...attr);\r\n    }\r\n\r\n    static logOnce(msg, ...attr) {\r\n        if (!Debug._logged.has(msg)) {\r\n            Debug._logged.add(msg);\r\n            console.log(msg, ...attr);\r\n        }\r\n    }\r\n\r\n    static warn(...attr) {\r\n        console.warn(...attr);\r\n    }\r\n\r\n    static warnOnce(msg, ...attr) {\r\n        if (!Debug._logged.has(msg)) {\r\n            Debug._logged.add(msg);\r\n            console.warn(msg, ...attr);\r\n        }\r\n    }\r\n\r\n    static error(...attr) {\r\n        console.error(...attr);\r\n    }\r\n    \r\n    static errorOnce(...attr) {\r\n        if (!Debug._logged.has(attr[0])) {\r\n            Debug._logged.add(attr[0]);\r\n            Debug.error(...attr);\r\n        }\r\n    }\r\n\r\n    static assert(test, ...attr) {\r\n        if (!test) {\r\n            Debug.errorOnce('Assert Error:', test, ...attr);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    static checkRange(number, min, max, msg) {\r\n        let ok = Debug.checkFloat(number, msg);\r\n        ok = ok && Debug.assert(number >= min, msg);\r\n        ok = ok && Debug.assert(number <= max, msg);\r\n        return ok;\r\n    }   \r\n\r\n    static checkInt(number, msg) {\r\n        const ok = Debug.assert(Number.isInteger(number), msg);\r\n        return ok;\r\n    }    \r\n\r\n    static checkUint(number, msg) {\r\n        let ok = Debug.checkInt(number, msg);\r\n        ok = ok && Debug.assert(number >= 0, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkFloat(number, msg) {\r\n        let ok = Debug.assert(typeof number === 'number', msg);\r\n        ok = ok && Debug.assert(!isNaN(number), msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkFloatPositive(number, msg) {\r\n        let ok = Debug.checkFloat(number, msg);\r\n        ok = ok && Debug.assert(number >= 0, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkBool(bool, msg) {\r\n        return Debug.assert((bool === true || bool === false), msg);\r\n    }\r\n\r\n    static checkVec(vec, msg) {\r\n        let ok = Debug.checkFloat(vec.x, msg);\r\n        ok = ok && Debug.checkFloat(vec.y, msg);\r\n        ok = ok && Debug.checkFloat(vec.z, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkVecPositive(vec, msg) {\r\n        let ok = Debug.checkFloatPositive(vec.x, msg);\r\n        ok = ok && Debug.checkFloatPositive(vec.y, msg);\r\n        ok = ok && Debug.checkFloatPositive(vec.z, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkQuat(quat, msg) {\r\n        let ok = true;\r\n        ok = ok && Debug.checkVec(quat, msg);\r\n        ok = ok && Debug.checkFloat(quat.w, msg);\r\n        return ok;\r\n    }\r\n\r\n    static verifyProperties(data, schema) {\r\n        let ok = true;\r\n        Object.entries(data).forEach(entry => {\r\n            let found = false;\r\n            for (let i = 0, end = schema.length; i < end; i++) {\r\n                if (entry[0] === schema[i]) {\r\n                    found = true;\r\n                }\r\n            }\r\n            ok = ok && Debug.assert(found, `Component: Unrecognized options property: ${ entry }`);\r\n        });\r\n\r\n        return ok;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9kZWJ1Zy5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixhQUFvQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFNBQVM7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUYsT0FBTztBQUNoRyxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvZGVidWcubWpzPzY1MTIiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRGVidWcge1xyXG4gICAgc3RhdGljIF9sb2dnZWQgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgc3RhdGljIGRldiA9IChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jyk7XHJcblxyXG4gICAgc3RhdGljIGxvZyguLi5hdHRyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coLi4uYXR0cik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGxvZ09uY2UobXNnLCAuLi5hdHRyKSB7XHJcbiAgICAgICAgaWYgKCFEZWJ1Zy5fbG9nZ2VkLmhhcyhtc2cpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLl9sb2dnZWQuYWRkKG1zZyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZywgLi4uYXR0cik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3YXJuKC4uLmF0dHIpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oLi4uYXR0cik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdhcm5PbmNlKG1zZywgLi4uYXR0cikge1xyXG4gICAgICAgIGlmICghRGVidWcuX2xvZ2dlZC5oYXMobXNnKSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5fbG9nZ2VkLmFkZChtc2cpO1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4obXNnLCAuLi5hdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGVycm9yKC4uLmF0dHIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKC4uLmF0dHIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBzdGF0aWMgZXJyb3JPbmNlKC4uLmF0dHIpIHtcclxuICAgICAgICBpZiAoIURlYnVnLl9sb2dnZWQuaGFzKGF0dHJbMF0pKSB7XHJcbiAgICAgICAgICAgIERlYnVnLl9sb2dnZWQuYWRkKGF0dHJbMF0pO1xyXG4gICAgICAgICAgICBEZWJ1Zy5lcnJvciguLi5hdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzc2VydCh0ZXN0LCAuLi5hdHRyKSB7XHJcbiAgICAgICAgaWYgKCF0ZXN0KSB7XHJcbiAgICAgICAgICAgIERlYnVnLmVycm9yT25jZSgnQXNzZXJ0IEVycm9yOicsIHRlc3QsIC4uLmF0dHIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja1JhbmdlKG51bWJlciwgbWluLCBtYXgsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrRmxvYXQobnVtYmVyLCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KG51bWJlciA+PSBtaW4sIG1zZyk7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQobnVtYmVyIDw9IG1heCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9ICAgXHJcblxyXG4gICAgc3RhdGljIGNoZWNrSW50KG51bWJlciwgbXNnKSB7XHJcbiAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5hc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihudW1iZXIpLCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH0gICAgXHJcblxyXG4gICAgc3RhdGljIGNoZWNrVWludChudW1iZXIsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrSW50KG51bWJlciwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChudW1iZXIgPj0gMCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNoZWNrRmxvYXQobnVtYmVyLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5hc3NlcnQodHlwZW9mIG51bWJlciA9PT0gJ251bWJlcicsIG1zZyk7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoIWlzTmFOKG51bWJlciksIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja0Zsb2F0UG9zaXRpdmUobnVtYmVyLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KG51bWJlciwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChudW1iZXIgPj0gMCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNoZWNrQm9vbChib29sLCBtc2cpIHtcclxuICAgICAgICByZXR1cm4gRGVidWcuYXNzZXJ0KChib29sID09PSB0cnVlIHx8IGJvb2wgPT09IGZhbHNlKSwgbXNnKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY2hlY2tWZWModmVjLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHZlYy54LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdCh2ZWMueSwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQodmVjLnosIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja1ZlY1Bvc2l0aXZlKHZlYywgbXNnKSB7XHJcbiAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy54LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy55LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy56LCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY2hlY2tRdWF0KHF1YXQsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhxdWF0LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChxdWF0LncsIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB2ZXJpZnlQcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSkge1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoZGF0YSkuZm9yRWFjaChlbnRyeSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gc2NoZW1hLmxlbmd0aDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50cnlbMF0gPT09IHNjaGVtYVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChmb3VuZCwgYENvbXBvbmVudDogVW5yZWNvZ25pemVkIG9wdGlvbnMgcHJvcGVydHk6ICR7IGVudHJ5IH1gKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBEZWJ1ZyB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/debug.mjs\n");

/***/ }),

/***/ "./src/physics/dispatcher.mjs":
/*!************************************!*\
  !*** ./src/physics/dispatcher.mjs ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Dispatcher: () => (/* binding */ Dispatcher)\n/* harmony export */ });\n/* harmony import */ var _backends_jolt_backend_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../backends/jolt/backend.mjs */ \"./src/backends/jolt/backend.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nlet backend = null;\r\n\r\nfunction createBackend(messenger, data) {\r\n    // const { backendName, url, config } = data;\r\n    switch (data.backendName) {\r\n        case 'jolt':\r\n            backend = new _backends_jolt_backend_mjs__WEBPACK_IMPORTED_MODULE_0__.JoltBackend(messenger, data);\r\n            break;\r\n\r\n        // intentional fall-through\r\n        case 'ammo':\r\n        case 'rapier':\r\n        case 'physx':\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Invalid backend selection: ${ backend }`);\r\n            break;\r\n\r\n        default:\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Invalid backend selection: ${ backend }`);\r\n    }\r\n}\r\n\r\nclass Dispatcher {\r\n    constructor(manager = null) {\r\n        this._useMainThread = !!manager;\r\n        this._manager = manager;\r\n        this._destroying = false;\r\n\r\n        if (!manager) {\r\n            this.postMessage = self.postMessage;\r\n        }\r\n    }\r\n\r\n    postMessage(msg) {\r\n        this.handleMessage(msg);\r\n    }\r\n\r\n    handleMessage(data) {\r\n        if (this._destroying) return;\r\n\r\n        switch (data.type) {\r\n            case 'step':\r\n                backend?.step(data);\r\n                break;\r\n\r\n            case 'create-backend':\r\n                createBackend(this, data);\r\n                // If we don't use a Web Worker, expose the backend instance to main thread for dev convenience\r\n                if (this._manager) {\r\n                    this._manager.backend = backend;\r\n                }\r\n                break;\r\n\r\n            case 'override-contacts':\r\n                backend?.overrideContacts(data.listener, data.overrides);\r\n                break;\r\n\r\n            case 'destroy':\r\n                this.destroy();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this._destroying = true;\r\n\r\n        backend.destroy();\r\n        backend = null;\r\n        self.onmessage = (e) => {};\r\n        dispatcher = null;\r\n    }\r\n\r\n    respond(msg, buffers) {\r\n        if (this._useMainThread) {\r\n            this._manager.onMessage(msg);\r\n        } else {\r\n            self.postMessage(msg, buffers);\r\n        }\r\n    }\r\n}\r\n\r\nlet dispatcher = new Dispatcher();\r\n\r\nself.onmessage = function(event) {\r\n    const data = event.data;\r\n    if (data?.origin !== 'physics-manager') return;\r\n    dispatcher.handleMessage(data);\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9kaXNwYXRjaGVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBMkQ7QUFDdkI7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDJCQUEyQjtBQUMxQztBQUNBO0FBQ0EsMEJBQTBCLG1FQUFXO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNkNBQUsscUNBQXFDLFNBQVM7QUFDL0Q7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSyxxQ0FBcUMsU0FBUztBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9kaXNwYXRjaGVyLm1qcz8zNTQwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEpvbHRCYWNrZW5kIH0gZnJvbSBcIi4uL2JhY2tlbmRzL2pvbHQvYmFja2VuZC5tanNcIjtcclxuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi9kZWJ1Zy5tanNcIjtcclxuXHJcbmxldCBiYWNrZW5kID0gbnVsbDtcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUJhY2tlbmQobWVzc2VuZ2VyLCBkYXRhKSB7XHJcbiAgICAvLyBjb25zdCB7IGJhY2tlbmROYW1lLCB1cmwsIGNvbmZpZyB9ID0gZGF0YTtcclxuICAgIHN3aXRjaCAoZGF0YS5iYWNrZW5kTmFtZSkge1xyXG4gICAgICAgIGNhc2UgJ2pvbHQnOlxyXG4gICAgICAgICAgICBiYWNrZW5kID0gbmV3IEpvbHRCYWNrZW5kKG1lc3NlbmdlciwgZGF0YSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAvLyBpbnRlbnRpb25hbCBmYWxsLXRocm91Z2hcclxuICAgICAgICBjYXNlICdhbW1vJzpcclxuICAgICAgICBjYXNlICdyYXBpZXInOlxyXG4gICAgICAgIGNhc2UgJ3BoeXN4JzpcclxuICAgICAgICAgICAgRGVidWcud2FybihgSW52YWxpZCBiYWNrZW5kIHNlbGVjdGlvbjogJHsgYmFja2VuZCB9YCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBEZWJ1Zy53YXJuKGBJbnZhbGlkIGJhY2tlbmQgc2VsZWN0aW9uOiAkeyBiYWNrZW5kIH1gKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgRGlzcGF0Y2hlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihtYW5hZ2VyID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX3VzZU1haW5UaHJlYWQgPSAhIW1hbmFnZXI7XHJcbiAgICAgICAgdGhpcy5fbWFuYWdlciA9IG1hbmFnZXI7XHJcbiAgICAgICAgdGhpcy5fZGVzdHJveWluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoIW1hbmFnZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5wb3N0TWVzc2FnZSA9IHNlbGYucG9zdE1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBvc3RNZXNzYWdlKG1zZykge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlTWVzc2FnZShtc2cpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZU1lc3NhZ2UoZGF0YSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9kZXN0cm95aW5nKSByZXR1cm47XHJcblxyXG4gICAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0ZXAnOlxyXG4gICAgICAgICAgICAgICAgYmFja2VuZD8uc3RlcChkYXRhKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnY3JlYXRlLWJhY2tlbmQnOlxyXG4gICAgICAgICAgICAgICAgY3JlYXRlQmFja2VuZCh0aGlzLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGRvbid0IHVzZSBhIFdlYiBXb3JrZXIsIGV4cG9zZSB0aGUgYmFja2VuZCBpbnN0YW5jZSB0byBtYWluIHRocmVhZCBmb3IgZGV2IGNvbnZlbmllbmNlXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbWFuYWdlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuYmFja2VuZCA9IGJhY2tlbmQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ292ZXJyaWRlLWNvbnRhY3RzJzpcclxuICAgICAgICAgICAgICAgIGJhY2tlbmQ/Lm92ZXJyaWRlQ29udGFjdHMoZGF0YS5saXN0ZW5lciwgZGF0YS5vdmVycmlkZXMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdkZXN0cm95JzpcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5fZGVzdHJveWluZyA9IHRydWU7XHJcblxyXG4gICAgICAgIGJhY2tlbmQuZGVzdHJveSgpO1xyXG4gICAgICAgIGJhY2tlbmQgPSBudWxsO1xyXG4gICAgICAgIHNlbGYub25tZXNzYWdlID0gKGUpID0+IHt9O1xyXG4gICAgICAgIGRpc3BhdGNoZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc3BvbmQobXNnLCBidWZmZXJzKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3VzZU1haW5UaHJlYWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5vbk1lc3NhZ2UobXNnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKG1zZywgYnVmZmVycyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5sZXQgZGlzcGF0Y2hlciA9IG5ldyBEaXNwYXRjaGVyKCk7XHJcblxyXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICBjb25zdCBkYXRhID0gZXZlbnQuZGF0YTtcclxuICAgIGlmIChkYXRhPy5vcmlnaW4gIT09ICdwaHlzaWNzLW1hbmFnZXInKSByZXR1cm47XHJcbiAgICBkaXNwYXRjaGVyLmhhbmRsZU1lc3NhZ2UoZGF0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IERpc3BhdGNoZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/dispatcher.mjs\n");

/***/ }),

/***/ "./src/physics/indexed-cache.mjs":
/*!***************************************!*\
  !*** ./src/physics/indexed-cache.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   IndexedCache: () => (/* binding */ IndexedCache)\n/* harmony export */ });\nclass IndexedCache {\r\n    constructor() {\r\n        this._index = 0;\r\n        this._freed = [];\r\n        this._storage = [];\r\n    }\r\n\r\n    add(element) {\r\n        const index = this._freed.pop() ?? this._index++; \r\n        this._storage[index] = element;\r\n        return index;\r\n    }\r\n\r\n    get(index) {\r\n        return this._storage[index];\r\n    }\r\n\r\n    free(index) {\r\n        this._storage[index] = null;\r\n        this._freed.push(index);\r\n    }\r\n\r\n    clear() {\r\n        this._index = 0;\r\n        this._freed.length = 0;\r\n        this._storage.length = 0;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9pbmRleGVkLWNhY2hlLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvaW5kZXhlZC1jYWNoZS5tanM/NWEwZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBJbmRleGVkQ2FjaGUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMuX2ZyZWVkID0gW107XHJcbiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZChlbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9mcmVlZC5wb3AoKSA/PyB0aGlzLl9pbmRleCsrOyBcclxuICAgICAgICB0aGlzLl9zdG9yYWdlW2luZGV4XSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlW2luZGV4XTtcclxuICAgIH1cclxuXHJcbiAgICBmcmVlKGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5fc3RvcmFnZVtpbmRleF0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2ZyZWVkLnB1c2goaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuX2luZGV4ID0gMDtcclxuICAgICAgICB0aGlzLl9mcmVlZC5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX3N0b3JhZ2UubGVuZ3RoID0gMDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgSW5kZXhlZENhY2hlIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/indexed-cache.mjs\n");

/***/ }),

/***/ "./src/physics/init.mjs":
/*!******************************!*\
  !*** ./src/physics/init.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   init: () => (/* binding */ init)\n/* harmony export */ });\n/* harmony import */ var _components_jolt_body_system_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/jolt/body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _components_jolt_char_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./components/jolt/char/system.mjs */ \"./src/physics/components/jolt/char/system.mjs\");\n/* harmony import */ var _components_jolt_vehicle_system_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/jolt/vehicle/system.mjs */ \"./src/physics/components/jolt/vehicle/system.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _components_jolt_manager_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./components/jolt/manager.mjs */ \"./src/physics/components/jolt/manager.mjs\");\n/* harmony import */ var _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _components_jolt_softbody_system_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./components/jolt/softbody/system.mjs */ \"./src/physics/components/jolt/softbody/system.mjs\");\n/* harmony import */ var _math_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./math.mjs */ \"./src/physics/math.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Override chunk location in order for the engine to locate them in PlayCanvas Editor.\r\nconst oldFn = __webpack_require__.u;\r\n__webpack_require__.u = (chunkId) => {\r\n    const filename = oldFn(chunkId);\r\n    const app = pc.Application.getApplication();\r\n    const asset = app.assets.find(filename, 'script');\r\n    const url = asset.getFileUrl();\r\n    return url;\r\n};\r\n\r\n// TODO\r\n// Once we add webworker support, init should be changed to async\r\n// function and wait for worker response to resolve.\r\n\r\nfunction init(app = pc.Application.getApplication(), opts = {}) {\r\n    const options = {\r\n        backend: 'jolt',\r\n        propertyName: 'physics',\r\n        ...opts\r\n    };\r\n\r\n    (0,_math_mjs__WEBPACK_IMPORTED_MODULE_7__.extendPCMath)();\r\n\r\n    const { backend, propertyName } = options;\r\n\r\n    if (backend === 'jolt') {\r\n        if (app[propertyName]) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.warn(`Unable to initialize Physics Manager. Application has an existing property name that conflicts. ` + \r\n                `Tried to use \"app.${ propertyName }\". Use { propertyName: string } in init options to use a custom property name. Aborting.`);\r\n            return;\r\n        }\r\n\r\n        function onReady() {\r\n            app.on('destroy', () => destroy());\r\n\r\n            resolve();\r\n        }\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const manager = new _components_jolt_manager_mjs__WEBPACK_IMPORTED_MODULE_4__.JoltManager(app, options, resolve);\r\n            app[propertyName] = manager;\r\n        });\r\n    }\r\n\r\n    function destroy() {\r\n        app[propertyName].destroy();\r\n        app[propertyName] = null;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9pbml0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBd0U7QUFDQTtBQUNNO0FBQzFDO0FBQ3dCO0FBR25CO0FBQ3VDO0FBQ3RDO0FBQzFDO0FBQ0E7QUFDQSxjQUFjLHFCQUErQjtBQUM3QyxxQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHVEQUFZO0FBQ2hCO0FBQ0EsWUFBWSx3QkFBd0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSyxRQUFRLDZDQUFLO0FBQzlCLHNDQUFzQyxjQUFjLFNBQVMsdUJBQXVCO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHFFQUFXO0FBQzNDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2luaXQubWpzP2EwYzIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9ib2R5L3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgQ2hhckNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9jaGFyL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgVmVoaWNsZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC92ZWhpY2xlL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgSm9sdE1hbmFnZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL2pvbHQvbWFuYWdlci5tanNcIjtcclxuaW1wb3J0IHsgXHJcbiAgICBDT01QT05FTlRfU1lTVEVNX0JPRFksIENPTVBPTkVOVF9TWVNURU1fQ0hBUiwgQ09NUE9ORU5UX1NZU1RFTV9TT0ZUX0JPRFksIENPTVBPTkVOVF9TWVNURU1fVkVISUNMRVxyXG59IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4vY29tcG9uZW50cy9qb2x0L3NvZnRib2R5L3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgZXh0ZW5kUENNYXRoIH0gZnJvbSBcIi4vbWF0aC5tanNcIjtcclxuXHJcbi8vIE92ZXJyaWRlIGNodW5rIGxvY2F0aW9uIGluIG9yZGVyIGZvciB0aGUgZW5naW5lIHRvIGxvY2F0ZSB0aGVtIGluIFBsYXlDYW52YXMgRWRpdG9yLlxyXG5jb25zdCBvbGRGbiA9IF9fd2VicGFja19nZXRfc2NyaXB0X2ZpbGVuYW1lX187XHJcbl9fd2VicGFja19nZXRfc2NyaXB0X2ZpbGVuYW1lX18gPSAoY2h1bmtJZCkgPT4ge1xyXG4gICAgY29uc3QgZmlsZW5hbWUgPSBvbGRGbihjaHVua0lkKTtcclxuICAgIGNvbnN0IGFwcCA9IHBjLkFwcGxpY2F0aW9uLmdldEFwcGxpY2F0aW9uKCk7XHJcbiAgICBjb25zdCBhc3NldCA9IGFwcC5hc3NldHMuZmluZChmaWxlbmFtZSwgJ3NjcmlwdCcpO1xyXG4gICAgY29uc3QgdXJsID0gYXNzZXQuZ2V0RmlsZVVybCgpO1xyXG4gICAgcmV0dXJuIHVybDtcclxufTtcclxuXHJcbi8vIFRPRE9cclxuLy8gT25jZSB3ZSBhZGQgd2Vid29ya2VyIHN1cHBvcnQsIGluaXQgc2hvdWxkIGJlIGNoYW5nZWQgdG8gYXN5bmNcclxuLy8gZnVuY3Rpb24gYW5kIHdhaXQgZm9yIHdvcmtlciByZXNwb25zZSB0byByZXNvbHZlLlxyXG5cclxuZnVuY3Rpb24gaW5pdChhcHAgPSBwYy5BcHBsaWNhdGlvbi5nZXRBcHBsaWNhdGlvbigpLCBvcHRzID0ge30pIHtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgYmFja2VuZDogJ2pvbHQnLFxyXG4gICAgICAgIHByb3BlcnR5TmFtZTogJ3BoeXNpY3MnLFxyXG4gICAgICAgIC4uLm9wdHNcclxuICAgIH07XHJcblxyXG4gICAgZXh0ZW5kUENNYXRoKCk7XHJcblxyXG4gICAgY29uc3QgeyBiYWNrZW5kLCBwcm9wZXJ0eU5hbWUgfSA9IG9wdGlvbnM7XHJcblxyXG4gICAgaWYgKGJhY2tlbmQgPT09ICdqb2x0Jykge1xyXG4gICAgICAgIGlmIChhcHBbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcud2FybihgVW5hYmxlIHRvIGluaXRpYWxpemUgUGh5c2ljcyBNYW5hZ2VyLiBBcHBsaWNhdGlvbiBoYXMgYW4gZXhpc3RpbmcgcHJvcGVydHkgbmFtZSB0aGF0IGNvbmZsaWN0cy4gYCArIFxyXG4gICAgICAgICAgICAgICAgYFRyaWVkIHRvIHVzZSBcImFwcC4keyBwcm9wZXJ0eU5hbWUgfVwiLiBVc2UgeyBwcm9wZXJ0eU5hbWU6IHN0cmluZyB9IGluIGluaXQgb3B0aW9ucyB0byB1c2UgYSBjdXN0b20gcHJvcGVydHkgbmFtZS4gQWJvcnRpbmcuYCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG9uUmVhZHkoKSB7XHJcbiAgICAgICAgICAgIGFwcC5vbignZGVzdHJveScsICgpID0+IGRlc3Ryb3koKSk7XHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hbmFnZXIgPSBuZXcgSm9sdE1hbmFnZXIoYXBwLCBvcHRpb25zLCByZXNvbHZlKTtcclxuICAgICAgICAgICAgYXBwW3Byb3BlcnR5TmFtZV0gPSBtYW5hZ2VyO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgYXBwW3Byb3BlcnR5TmFtZV0uZGVzdHJveSgpO1xyXG4gICAgICAgIGFwcFtwcm9wZXJ0eU5hbWVdID0gbnVsbDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgaW5pdCB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/init.mjs\n");

/***/ }),

/***/ "./src/physics/manager.mjs":
/*!*********************************!*\
  !*** ./src/physics/manager.mjs ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PhysicsManager: () => (/* binding */ PhysicsManager)\n/* harmony export */ });\n/* harmony import */ var _package_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../package.json */ \"./package.json\");\n/* harmony import */ var _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../backends/jolt/commands-buffer.mjs */ \"./src/backends/jolt/commands-buffer.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _dispatcher_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dispatcher.mjs */ \"./src/physics/dispatcher.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass PhysicsManager {\r\n    constructor(app, backendName, opts = {}) {\r\n        const config = {\r\n            useSharedArrayBuffer: true,\r\n            commandsBufferSize: 10000, // bytes, 10k is enough to update about 150 active dynamic objects\r\n            allowCommandsBufferResize: true,\r\n            useWebWorker: false,\r\n            fixedStep: 1 / 30,\r\n            subSteps: 1,\r\n            useMotionStates: true,\r\n            debugColorStatic: pc.Color.GRAY,\r\n            debugColorKinematic: pc.Color.MAGENTA,\r\n            debugColorDynamic: pc.Color.YELLOW,\r\n            debugDrawLayerId: pc.LAYERID_IMMEDIATE,\r\n            debugDrawDepth: true,\r\n            ...opts\r\n        };\r\n\r\n        // Make sure requested features are supported\r\n        config.useSharedArrayBuffer = config.useSharedArrayBuffer && typeof SharedArrayBuffer !== 'undefined';\r\n        config.useWebWorker = config.useWebWorker && typeof Worker !== 'undefined';\r\n        config.useSAB = config.useWebWorker && config.useSharedArrayBuffer;\r\n\r\n        this._createDispatcher(config);\r\n\r\n        this._systems = new Map();\r\n        this._backend = null\r\n\r\n        const wasmAsset = app.assets.find('jolt-physics.wasm.wasm');\r\n        const glueAsset = app.assets.find('jolt-physics.wasm.js');\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'create-backend';\r\n        msg.glueUrl = glueAsset.getFileUrl();\r\n        msg.wasmUrl = wasmAsset.getFileUrl();\r\n        msg.backendName = backendName;\r\n        msg.config = config;\r\n        this.sendUncompressed(msg);\r\n\r\n        this._outBuffer = new _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__.CommandsBuffer(config);\r\n        this._outBuffers = [];\r\n        this._inBuffer = null;\r\n        this._updateEvent = null;\r\n        this._paused = false;\r\n        this._steps = 0;\r\n        this._stepMessage = {\r\n            type: 'step', buffer: null, inBuffer: null, origin: 'physics-manager'\r\n        };\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            this._perfCache = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_4__.IndexedCache();\r\n        }\r\n\r\n        this._frame = app.stats.frame;\r\n\r\n        this.version = _package_json__WEBPACK_IMPORTED_MODULE_0__.version;\r\n\r\n        this._config = config;\r\n        this._app = app;\r\n    }\r\n\r\n    set backend(instance) {\r\n        this._backend = instance;\r\n    }\r\n    get backend() {\r\n        return this._backend;\r\n    }\r\n\r\n    get systems() {\r\n        return this._systems;\r\n    }\r\n\r\n    set paused(bool) {\r\n        this._paused = bool;\r\n    }\r\n    get paused() {\r\n        return this._paused;\r\n    }\r\n\r\n    get commandsBuffer() {\r\n        return this._outBuffer;\r\n    }\r\n\r\n    get config() {\r\n        return this._config;\r\n    }\r\n\r\n    get steps() {\r\n        return this._steps;\r\n    }\r\n\r\n    onUpdate() {\r\n        if (this._paused) return;\r\n\r\n        let index;\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            const startTime = performance.now();\r\n            index = this._perfCache.add(startTime);\r\n        }\r\n        \r\n        // If the buffer has been sent to the web worker,\r\n        // it might not yet be available this frame, so we exit early.\r\n        if (this._outBuffer.buffer.byteLength === 0) {\r\n            return;\r\n        }\r\n\r\n        this._writeIsometry();\r\n        this._dispatchCommands(this._frame.dt, index);\r\n    }\r\n\r\n    sendUncompressed(msg) {\r\n        msg.origin = 'physics-manager';\r\n        this._dispatcher.postMessage(msg);\r\n    }\r\n\r\n    onMessage(msg) {\r\n        if (this._paused || msg.origin !== 'physics-worker') return;\r\n\r\n        const systems = this._systems;\r\n        let inBuffer = this._inBuffer;\r\n\r\n        if (msg.buffer) {\r\n            if (!inBuffer) {\r\n                inBuffer = this._inBuffer = new _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__.CommandsBuffer();\r\n            }\r\n\r\n            // Make sure to use the incoming buffer, as the old one could\r\n            // have been destroyed during resize.\r\n            inBuffer.buffer = msg.buffer;\r\n            if (msg.inBuffer) {\r\n                this._outBuffer.buffer = msg.inBuffer;\r\n            }\r\n\r\n            const count = inBuffer.commandsCount;\r\n            for (let i = 0; i < count; i++) {\r\n                const operator = inBuffer.readOperator();\r\n                if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n                    const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.assert(!!systems.get(operator), `Invalid component system: ${ operator }`);\r\n                    if (!ok) {\r\n                        this._updateEvent.off();\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                systems.get(operator).processCommands(inBuffer);\r\n            }\r\n\r\n            inBuffer.reset();\r\n        }\r\n\r\n        this._steps = msg.steps ?? 0;\r\n\r\n        // TODO\r\n        // handle properly when we are in a module, e.g. engine only\r\n        const constants = msg.constants;\r\n        if (constants) {\r\n            for (let i = 0, end = constants.length; i < end; i += 2) {\r\n                const key = constants[i];\r\n                const value = constants[i + 1];\r\n\r\n                window.pc[key] = value;\r\n            }\r\n\r\n            this._updateEvent = this._app.systems.on('postUpdate', this.onUpdate, this);\r\n        }\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            const perfIndex = msg.perfIndex;\r\n            if (perfIndex == null) return;\r\n\r\n            const cache = this._perfCache;\r\n            const startTime = cache.get(perfIndex);\r\n            const frame = this._app.stats.frame;\r\n            \r\n            cache.free(perfIndex);\r\n            frame.physicsTime = performance.now() - startTime + msg.time;\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this._systems.forEach(system => {\r\n            system.destroy();\r\n        });\r\n        this._systems.clear();\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'destroy';\r\n        this.sendUncompressed(msg);\r\n        this._backend = null;\r\n\r\n        this._commandsBuffer.destroy();\r\n        this._commandsBuffer = null;\r\n\r\n        this._dispatcher = null;\r\n        this._frame = null;\r\n\r\n        this._updateEvent?.off();\r\n        this._updateEvent = null;\r\n\r\n        this._app[this._config.propertyName] = null;\r\n    }\r\n\r\n    _writeIsometry() {\r\n        this._systems.forEach(system => {\r\n            system.requestIsometry?.();\r\n        })\r\n    }\r\n\r\n    _dispatchCommands(dt, perfIndex) {\r\n        const cb = this._outBuffer;\r\n        const inBuffer = this._inBuffer;\r\n        const msg = this._stepMessage;\r\n\r\n        msg.dt = dt;\r\n\r\n        if (!cb.dirty) {\r\n            msg.buffer = null;\r\n            if (inBuffer && inBuffer.buffer.byteLength > 0) {\r\n                const ib = inBuffer.buffer;\r\n                msg.inBuffer = ib;\r\n                this._dispatcher.postMessage(msg, [ ib ]);\r\n            } else {\r\n                msg.inBuffer = null;\r\n                this._dispatcher.postMessage(msg);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const buffer = cb.buffer;\r\n        const buffers = this._outBuffers;\r\n\r\n        msg.buffer = buffer;\r\n        buffers.length = 0;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            msg.perfIndex = perfIndex;\r\n        }\r\n\r\n        // Also add any potential mesh and convex hull shapes buffers\r\n        const meshBuffers = cb.meshBuffers;\r\n        if (meshBuffers.length > 0) {\r\n            msg.meshBuffers = meshBuffers;\r\n            buffers.push(...meshBuffers);\r\n        } else {\r\n            msg.meshBuffers = null;\r\n        }\r\n\r\n        if (this._config.useSAB) {\r\n            this._dispatcher.postMessage(msg);\r\n        } else {\r\n            buffers.push(buffer);\r\n            if (inBuffer) {\r\n                const ib = inBuffer.buffer;\r\n                msg.inBuffer = ib;\r\n                buffers.push(ib);\r\n            }\r\n            this._dispatcher.postMessage(msg, buffers);\r\n        }\r\n\r\n        cb.meshBuffers.length = 0;\r\n        cb.reset();\r\n    }\r\n\r\n    _createDispatcher(config) {\r\n        // TODO\r\n        // buffers detaching needs some work, before we can enable workers\r\n\r\n        // if (config.useWebWorker) {\r\n        //     this._dispatcher = new Worker(\r\n        //         /* webpackChunkName: \"worker\" */ new URL('./dispatcher.mjs', import.meta.url\r\n        //     ));\r\n        //     this._dispatcher.onmessage = this.onMessage.bind(this);\r\n        // } else {\r\n        //     this._dispatcher = new Dispatcher(this);\r\n        // }\r\n\r\n        this._dispatcher = new _dispatcher_mjs__WEBPACK_IMPORTED_MODULE_3__.Dispatcher(this);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9tYW5hZ2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0M7QUFDZ0M7QUFDbEM7QUFDVTtBQUNLO0FBQ25EO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsOEVBQWM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQixrQ0FBa0MsNERBQVk7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0RBQVk7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsOEVBQWM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsV0FBVztBQUN2QztBQUNBLG9CQUFvQiw2Q0FBSztBQUN6QiwrQkFBK0IsNkNBQUssK0RBQStELFVBQVU7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELFNBQVM7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNkNBQUs7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix1REFBVTtBQUN6QztBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL21hbmFnZXIubWpzPzU3YmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGluZm8gZnJvbSBcIi4uLy4uL3BhY2thZ2UuanNvblwiO1xyXG5pbXBvcnQgeyBDb21tYW5kc0J1ZmZlciB9IGZyb20gXCIuLi9iYWNrZW5kcy9qb2x0L2NvbW1hbmRzLWJ1ZmZlci5tanNcIjtcclxuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgRGlzcGF0Y2hlciB9IGZyb20gXCIuL2Rpc3BhdGNoZXIubWpzXCI7XHJcbmltcG9ydCB7IEluZGV4ZWRDYWNoZSB9IGZyb20gXCIuL2luZGV4ZWQtY2FjaGUubWpzXCI7XHJcblxyXG5jbGFzcyBQaHlzaWNzTWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIGJhY2tlbmROYW1lLCBvcHRzID0ge30pIHtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB7XHJcbiAgICAgICAgICAgIHVzZVNoYXJlZEFycmF5QnVmZmVyOiB0cnVlLFxyXG4gICAgICAgICAgICBjb21tYW5kc0J1ZmZlclNpemU6IDEwMDAwLCAvLyBieXRlcywgMTBrIGlzIGVub3VnaCB0byB1cGRhdGUgYWJvdXQgMTUwIGFjdGl2ZSBkeW5hbWljIG9iamVjdHNcclxuICAgICAgICAgICAgYWxsb3dDb21tYW5kc0J1ZmZlclJlc2l6ZTogdHJ1ZSxcclxuICAgICAgICAgICAgdXNlV2ViV29ya2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgZml4ZWRTdGVwOiAxIC8gMzAsXHJcbiAgICAgICAgICAgIHN1YlN0ZXBzOiAxLFxyXG4gICAgICAgICAgICB1c2VNb3Rpb25TdGF0ZXM6IHRydWUsXHJcbiAgICAgICAgICAgIGRlYnVnQ29sb3JTdGF0aWM6IHBjLkNvbG9yLkdSQVksXHJcbiAgICAgICAgICAgIGRlYnVnQ29sb3JLaW5lbWF0aWM6IHBjLkNvbG9yLk1BR0VOVEEsXHJcbiAgICAgICAgICAgIGRlYnVnQ29sb3JEeW5hbWljOiBwYy5Db2xvci5ZRUxMT1csXHJcbiAgICAgICAgICAgIGRlYnVnRHJhd0xheWVySWQ6IHBjLkxBWUVSSURfSU1NRURJQVRFLFxyXG4gICAgICAgICAgICBkZWJ1Z0RyYXdEZXB0aDogdHJ1ZSxcclxuICAgICAgICAgICAgLi4ub3B0c1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSByZXF1ZXN0ZWQgZmVhdHVyZXMgYXJlIHN1cHBvcnRlZFxyXG4gICAgICAgIGNvbmZpZy51c2VTaGFyZWRBcnJheUJ1ZmZlciA9IGNvbmZpZy51c2VTaGFyZWRBcnJheUJ1ZmZlciAmJiB0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnO1xyXG4gICAgICAgIGNvbmZpZy51c2VXZWJXb3JrZXIgPSBjb25maWcudXNlV2ViV29ya2VyICYmIHR5cGVvZiBXb3JrZXIgIT09ICd1bmRlZmluZWQnO1xyXG4gICAgICAgIGNvbmZpZy51c2VTQUIgPSBjb25maWcudXNlV2ViV29ya2VyICYmIGNvbmZpZy51c2VTaGFyZWRBcnJheUJ1ZmZlcjtcclxuXHJcbiAgICAgICAgdGhpcy5fY3JlYXRlRGlzcGF0Y2hlcihjb25maWcpO1xyXG5cclxuICAgICAgICB0aGlzLl9zeXN0ZW1zID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuX2JhY2tlbmQgPSBudWxsXHJcblxyXG4gICAgICAgIGNvbnN0IHdhc21Bc3NldCA9IGFwcC5hc3NldHMuZmluZCgnam9sdC1waHlzaWNzLndhc20ud2FzbScpO1xyXG4gICAgICAgIGNvbnN0IGdsdWVBc3NldCA9IGFwcC5hc3NldHMuZmluZCgnam9sdC1waHlzaWNzLndhc20uanMnKTtcclxuXHJcbiAgICAgICAgY29uc3QgbXNnID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICBtc2cudHlwZSA9ICdjcmVhdGUtYmFja2VuZCc7XHJcbiAgICAgICAgbXNnLmdsdWVVcmwgPSBnbHVlQXNzZXQuZ2V0RmlsZVVybCgpO1xyXG4gICAgICAgIG1zZy53YXNtVXJsID0gd2FzbUFzc2V0LmdldEZpbGVVcmwoKTtcclxuICAgICAgICBtc2cuYmFja2VuZE5hbWUgPSBiYWNrZW5kTmFtZTtcclxuICAgICAgICBtc2cuY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMuc2VuZFVuY29tcHJlc3NlZChtc2cpO1xyXG5cclxuICAgICAgICB0aGlzLl9vdXRCdWZmZXIgPSBuZXcgQ29tbWFuZHNCdWZmZXIoY29uZmlnKTtcclxuICAgICAgICB0aGlzLl9vdXRCdWZmZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5faW5CdWZmZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZUV2ZW50ID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9wYXVzZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9zdGVwcyA9IDA7XHJcbiAgICAgICAgdGhpcy5fc3RlcE1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdzdGVwJywgYnVmZmVyOiBudWxsLCBpbkJ1ZmZlcjogbnVsbCwgb3JpZ2luOiAncGh5c2ljcy1tYW5hZ2VyJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fcGVyZkNhY2hlID0gbmV3IEluZGV4ZWRDYWNoZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fZnJhbWUgPSBhcHAuc3RhdHMuZnJhbWU7XHJcblxyXG4gICAgICAgIHRoaXMudmVyc2lvbiA9IGluZm8udmVyc2lvbjtcclxuXHJcbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMuX2FwcCA9IGFwcDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYmFja2VuZChpbnN0YW5jZSkge1xyXG4gICAgICAgIHRoaXMuX2JhY2tlbmQgPSBpbnN0YW5jZTtcclxuICAgIH1cclxuICAgIGdldCBiYWNrZW5kKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9iYWNrZW5kO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzeXN0ZW1zKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zeXN0ZW1zO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwYXVzZWQoYm9vbCkge1xyXG4gICAgICAgIHRoaXMuX3BhdXNlZCA9IGJvb2w7XHJcbiAgICB9XHJcbiAgICBnZXQgcGF1c2VkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYXVzZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbW1hbmRzQnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbmZpZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzdGVwcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RlcHM7XHJcbiAgICB9XHJcblxyXG4gICAgb25VcGRhdGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BhdXNlZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBsZXQgaW5kZXg7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9wZXJmQ2FjaGUuYWRkKHN0YXJ0VGltZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIHRoZSBidWZmZXIgaGFzIGJlZW4gc2VudCB0byB0aGUgd2ViIHdvcmtlcixcclxuICAgICAgICAvLyBpdCBtaWdodCBub3QgeWV0IGJlIGF2YWlsYWJsZSB0aGlzIGZyYW1lLCBzbyB3ZSBleGl0IGVhcmx5LlxyXG4gICAgICAgIGlmICh0aGlzLl9vdXRCdWZmZXIuYnVmZmVyLmJ5dGVMZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fd3JpdGVJc29tZXRyeSgpO1xyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoQ29tbWFuZHModGhpcy5fZnJhbWUuZHQsIGluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBzZW5kVW5jb21wcmVzc2VkKG1zZykge1xyXG4gICAgICAgIG1zZy5vcmlnaW4gPSAncGh5c2ljcy1tYW5hZ2VyJztcclxuICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICB9XHJcblxyXG4gICAgb25NZXNzYWdlKG1zZykge1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXVzZWQgfHwgbXNnLm9yaWdpbiAhPT0gJ3BoeXNpY3Mtd29ya2VyJykgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25zdCBzeXN0ZW1zID0gdGhpcy5fc3lzdGVtcztcclxuICAgICAgICBsZXQgaW5CdWZmZXIgPSB0aGlzLl9pbkJ1ZmZlcjtcclxuXHJcbiAgICAgICAgaWYgKG1zZy5idWZmZXIpIHtcclxuICAgICAgICAgICAgaWYgKCFpbkJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgICAgaW5CdWZmZXIgPSB0aGlzLl9pbkJ1ZmZlciA9IG5ldyBDb21tYW5kc0J1ZmZlcigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdG8gdXNlIHRoZSBpbmNvbWluZyBidWZmZXIsIGFzIHRoZSBvbGQgb25lIGNvdWxkXHJcbiAgICAgICAgICAgIC8vIGhhdmUgYmVlbiBkZXN0cm95ZWQgZHVyaW5nIHJlc2l6ZS5cclxuICAgICAgICAgICAgaW5CdWZmZXIuYnVmZmVyID0gbXNnLmJ1ZmZlcjtcclxuICAgICAgICAgICAgaWYgKG1zZy5pbkJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb3V0QnVmZmVyLmJ1ZmZlciA9IG1zZy5pbkJ1ZmZlcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBpbkJ1ZmZlci5jb21tYW5kc0NvdW50O1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yID0gaW5CdWZmZXIucmVhZE9wZXJhdG9yKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5hc3NlcnQoISFzeXN0ZW1zLmdldChvcGVyYXRvciksIGBJbnZhbGlkIGNvbXBvbmVudCBzeXN0ZW06ICR7IG9wZXJhdG9yIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUV2ZW50Lm9mZigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHN5c3RlbXMuZ2V0KG9wZXJhdG9yKS5wcm9jZXNzQ29tbWFuZHMoaW5CdWZmZXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpbkJ1ZmZlci5yZXNldCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc3RlcHMgPSBtc2cuc3RlcHMgPz8gMDtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGhhbmRsZSBwcm9wZXJseSB3aGVuIHdlIGFyZSBpbiBhIG1vZHVsZSwgZS5nLiBlbmdpbmUgb25seVxyXG4gICAgICAgIGNvbnN0IGNvbnN0YW50cyA9IG1zZy5jb25zdGFudHM7XHJcbiAgICAgICAgaWYgKGNvbnN0YW50cykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gY29uc3RhbnRzLmxlbmd0aDsgaSA8IGVuZDsgaSArPSAyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBjb25zdGFudHNbaV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnN0YW50c1tpICsgMV07XHJcblxyXG4gICAgICAgICAgICAgICAgd2luZG93LnBjW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlRXZlbnQgPSB0aGlzLl9hcHAuc3lzdGVtcy5vbigncG9zdFVwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBwZXJmSW5kZXggPSBtc2cucGVyZkluZGV4O1xyXG4gICAgICAgICAgICBpZiAocGVyZkluZGV4ID09IG51bGwpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fcGVyZkNhY2hlO1xyXG4gICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBjYWNoZS5nZXQocGVyZkluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLl9hcHAuc3RhdHMuZnJhbWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYWNoZS5mcmVlKHBlcmZJbmRleCk7XHJcbiAgICAgICAgICAgIGZyYW1lLnBoeXNpY3NUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUgKyBtc2cudGltZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl9zeXN0ZW1zLmZvckVhY2goc3lzdGVtID0+IHtcclxuICAgICAgICAgICAgc3lzdGVtLmRlc3Ryb3koKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLl9zeXN0ZW1zLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1zZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgbXNnLnR5cGUgPSAnZGVzdHJveSc7XHJcbiAgICAgICAgdGhpcy5zZW5kVW5jb21wcmVzc2VkKG1zZyk7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbW1hbmRzQnVmZmVyLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9jb21tYW5kc0J1ZmZlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2ZyYW1lID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fdXBkYXRlRXZlbnQ/Lm9mZigpO1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZUV2ZW50ID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fYXBwW3RoaXMuX2NvbmZpZy5wcm9wZXJ0eU5hbWVdID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVJc29tZXRyeSgpIHtcclxuICAgICAgICB0aGlzLl9zeXN0ZW1zLmZvckVhY2goc3lzdGVtID0+IHtcclxuICAgICAgICAgICAgc3lzdGVtLnJlcXVlc3RJc29tZXRyeT8uKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBfZGlzcGF0Y2hDb21tYW5kcyhkdCwgcGVyZkluZGV4KSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICAgICAgY29uc3QgaW5CdWZmZXIgPSB0aGlzLl9pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBtc2cgPSB0aGlzLl9zdGVwTWVzc2FnZTtcclxuXHJcbiAgICAgICAgbXNnLmR0ID0gZHQ7XHJcblxyXG4gICAgICAgIGlmICghY2IuZGlydHkpIHtcclxuICAgICAgICAgICAgbXNnLmJ1ZmZlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChpbkJ1ZmZlciAmJiBpbkJ1ZmZlci5idWZmZXIuYnl0ZUxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGliID0gaW5CdWZmZXIuYnVmZmVyO1xyXG4gICAgICAgICAgICAgICAgbXNnLmluQnVmZmVyID0gaWI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLnBvc3RNZXNzYWdlKG1zZywgWyBpYiBdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1zZy5pbkJ1ZmZlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gY2IuYnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSB0aGlzLl9vdXRCdWZmZXJzO1xyXG5cclxuICAgICAgICBtc2cuYnVmZmVyID0gYnVmZmVyO1xyXG4gICAgICAgIGJ1ZmZlcnMubGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBtc2cucGVyZkluZGV4ID0gcGVyZkluZGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQWxzbyBhZGQgYW55IHBvdGVudGlhbCBtZXNoIGFuZCBjb252ZXggaHVsbCBzaGFwZXMgYnVmZmVyc1xyXG4gICAgICAgIGNvbnN0IG1lc2hCdWZmZXJzID0gY2IubWVzaEJ1ZmZlcnM7XHJcbiAgICAgICAgaWYgKG1lc2hCdWZmZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgbXNnLm1lc2hCdWZmZXJzID0gbWVzaEJ1ZmZlcnM7XHJcbiAgICAgICAgICAgIGJ1ZmZlcnMucHVzaCguLi5tZXNoQnVmZmVycyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbXNnLm1lc2hCdWZmZXJzID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9jb25maWcudXNlU0FCKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIucG9zdE1lc3NhZ2UobXNnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBidWZmZXJzLnB1c2goYnVmZmVyKTtcclxuICAgICAgICAgICAgaWYgKGluQnVmZmVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpYiA9IGluQnVmZmVyLmJ1ZmZlcjtcclxuICAgICAgICAgICAgICAgIG1zZy5pbkJ1ZmZlciA9IGliO1xyXG4gICAgICAgICAgICAgICAgYnVmZmVycy5wdXNoKGliKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLnBvc3RNZXNzYWdlKG1zZywgYnVmZmVycyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi5tZXNoQnVmZmVycy5sZW5ndGggPSAwO1xyXG4gICAgICAgIGNiLnJlc2V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZURpc3BhdGNoZXIoY29uZmlnKSB7XHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGJ1ZmZlcnMgZGV0YWNoaW5nIG5lZWRzIHNvbWUgd29yaywgYmVmb3JlIHdlIGNhbiBlbmFibGUgd29ya2Vyc1xyXG5cclxuICAgICAgICAvLyBpZiAoY29uZmlnLnVzZVdlYldvcmtlcikge1xyXG4gICAgICAgIC8vICAgICB0aGlzLl9kaXNwYXRjaGVyID0gbmV3IFdvcmtlcihcclxuICAgICAgICAvLyAgICAgICAgIC8qIHdlYnBhY2tDaHVua05hbWU6IFwid29ya2VyXCIgKi8gbmV3IFVSTCgnLi9kaXNwYXRjaGVyLm1qcycsIGltcG9ydC5tZXRhLnVybFxyXG4gICAgICAgIC8vICAgICApKTtcclxuICAgICAgICAvLyAgICAgdGhpcy5fZGlzcGF0Y2hlci5vbm1lc3NhZ2UgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBuZXcgRGlzcGF0Y2hlcih0aGlzKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBuZXcgRGlzcGF0Y2hlcih0aGlzKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgUGh5c2ljc01hbmFnZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/manager.mjs\n");

/***/ }),

/***/ "./src/physics/math.mjs":
/*!******************************!*\
  !*** ./src/physics/math.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extendJoltMath: () => (/* binding */ extendJoltMath),\n/* harmony export */   extendPCMath: () => (/* binding */ extendPCMath)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\nfunction extendPCMath() {\r\n    pc.Vec3.fromBuffer = function(buffer) {\r\n        return new pc.Vec3(\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n    };\r\n}\r\n\r\nfunction extendJoltMath(Jolt) {\r\n    Jolt.Vec3.prototype.FromBuffer = function(buffer, isPositive) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const x = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const y = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const z = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n\r\n            const test = isPositive ? _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloatPositive : _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat;\r\n\r\n            let ok = test(x, `invalid vector X component: ${ x }`);\r\n            ok = ok && test(y, `invalid vector Y component: ${ y }`);\r\n            ok = ok && test(z, `invalid vector Z component: ${ z }`);\r\n            if (!ok) return this;\r\n\r\n            this.Set(x, y, z);\r\n        } else {\r\n            this.Set(\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    Jolt.Vec3.prototype.set = function(x, y, z) {\r\n        this.Set(x, y, z);\r\n        return this;\r\n    };\r\n\r\n    Jolt.Vec3.prototype.print = function() {\r\n        console.log(this.GetX(), this.GetY(), this.GetZ());\r\n    };\r\n\r\n    Jolt.Quat.prototype.FromBuffer = function(buffer) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const x = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const y = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const z = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const w = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(x, `invalid quaternion X component: ${ x }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(y, `invalid quaternion Y component: ${ y }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(z, `invalid quaternion Z component: ${ z }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(w, `invalid quaternion W component: ${ w }`);\r\n            if (!ok) return this;\r\n\r\n            this.Set(x, y, z, w);\r\n        } else {\r\n            this.Set(\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    Jolt.Quat.prototype.set = function(x, y, z, w) {\r\n        this.Set(x, y, z, w);\r\n        return this;\r\n    };\r\n\r\n    Jolt.Quat.prototype.print = function() {\r\n        console.log(this.GetX(), this.GetY(), this.GetZ(), this.GetW());\r\n    };\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9tYXRoLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQW9DO0FBQ2tDO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLCtFQUFtQjtBQUMzQyx3QkFBd0IsK0VBQW1CO0FBQzNDLHdCQUF3QiwrRUFBbUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSw2Q0FBSztBQUNqQixrQ0FBa0MsK0VBQW1CO0FBQ3JELGtDQUFrQywrRUFBbUI7QUFDckQsa0NBQWtDLCtFQUFtQjtBQUNyRDtBQUNBLHNDQUFzQyw2Q0FBSyxzQkFBc0IsNkNBQUs7QUFDdEU7QUFDQSw2REFBNkQsR0FBRztBQUNoRSwrREFBK0QsR0FBRztBQUNsRSwrREFBK0QsR0FBRztBQUNsRTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSw0QkFBNEIsK0VBQW1CO0FBQy9DLDRCQUE0QiwrRUFBbUI7QUFDL0MsNEJBQTRCLCtFQUFtQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNkNBQUs7QUFDakIsa0NBQWtDLCtFQUFtQjtBQUNyRCxrQ0FBa0MsK0VBQW1CO0FBQ3JELGtDQUFrQywrRUFBbUI7QUFDckQsa0NBQWtDLCtFQUFtQjtBQUNyRDtBQUNBLHFCQUFxQiw2Q0FBSyxtREFBbUQsR0FBRztBQUNoRix1QkFBdUIsNkNBQUssbURBQW1ELEdBQUc7QUFDbEYsdUJBQXVCLDZDQUFLLG1EQUFtRCxHQUFHO0FBQ2xGLHVCQUF1Qiw2Q0FBSyxtREFBbUQsR0FBRztBQUNsRjtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSw0QkFBNEIsK0VBQW1CO0FBQy9DLDRCQUE0QiwrRUFBbUI7QUFDL0MsNEJBQTRCLCtFQUFtQjtBQUMvQyw0QkFBNEIsK0VBQW1CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9tYXRoLm1qcz84NGJmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4vZGVidWcubWpzXCI7XHJcbmltcG9ydCB7IEJVRkZFUl9SRUFEX0ZMT0FUMzIgfSBmcm9tIFwiLi9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5cclxuZnVuY3Rpb24gZXh0ZW5kUENNYXRoKCkge1xyXG4gICAgcGMuVmVjMy5mcm9tQnVmZmVyID0gZnVuY3Rpb24oYnVmZmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBwYy5WZWMzKFxyXG4gICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgKTtcclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dGVuZEpvbHRNYXRoKEpvbHQpIHtcclxuICAgIEpvbHQuVmVjMy5wcm90b3R5cGUuRnJvbUJ1ZmZlciA9IGZ1bmN0aW9uKGJ1ZmZlciwgaXNQb3NpdGl2ZSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgY29uc3QgeCA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjb25zdCB5ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IHogPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3QgPSBpc1Bvc2l0aXZlID8gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlIDogRGVidWcuY2hlY2tGbG9hdDtcclxuXHJcbiAgICAgICAgICAgIGxldCBvayA9IHRlc3QoeCwgYGludmFsaWQgdmVjdG9yIFggY29tcG9uZW50OiAkeyB4IH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiB0ZXN0KHksIGBpbnZhbGlkIHZlY3RvciBZIGNvbXBvbmVudDogJHsgeSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgdGVzdCh6LCBgaW52YWxpZCB2ZWN0b3IgWiBjb21wb25lbnQ6ICR7IHogfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm4gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuU2V0KHgsIHksIHopO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuU2V0KFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcblxyXG4gICAgSm9sdC5WZWMzLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbih4LCB5LCB6KSB7XHJcbiAgICAgICAgdGhpcy5TZXQoeCwgeSwgeik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG5cclxuICAgIEpvbHQuVmVjMy5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLkdldFgoKSwgdGhpcy5HZXRZKCksIHRoaXMuR2V0WigpKTtcclxuICAgIH07XHJcblxyXG4gICAgSm9sdC5RdWF0LnByb3RvdHlwZS5Gcm9tQnVmZmVyID0gZnVuY3Rpb24oYnVmZmVyKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCB4ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgeiA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjb25zdCB3ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHgsIGBpbnZhbGlkIHF1YXRlcm5pb24gWCBjb21wb25lbnQ6ICR7IHggfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoeSwgYGludmFsaWQgcXVhdGVybmlvbiBZIGNvbXBvbmVudDogJHsgeSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdCh6LCBgaW52YWxpZCBxdWF0ZXJuaW9uIFogY29tcG9uZW50OiAkeyB6IH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KHcsIGBpbnZhbGlkIHF1YXRlcm5pb24gVyBjb21wb25lbnQ6ICR7IHcgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm4gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuU2V0KHgsIHksIHosIHcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuU2V0KFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuXHJcbiAgICBKb2x0LlF1YXQucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKHgsIHksIHosIHcpIHtcclxuICAgICAgICB0aGlzLlNldCh4LCB5LCB6LCB3KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcblxyXG4gICAgSm9sdC5RdWF0LnByb3RvdHlwZS5wcmludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuR2V0WCgpLCB0aGlzLkdldFkoKSwgdGhpcy5HZXRaKCksIHRoaXMuR2V0VygpKTtcclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCB7IGV4dGVuZEpvbHRNYXRoLCBleHRlbmRQQ01hdGggfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/math.mjs\n");

/***/ }),

/***/ "./src/physics/util.mjs":
/*!******************************!*\
  !*** ./src/physics/util.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildAccessors: () => (/* binding */ buildAccessors)\n/* harmony export */ });\nfunction buildAccessors(obj, schema) {\r\n    // Create getter/setter pairs for each property defined in the schema\r\n    for (let i = 0, end = schema.length; i < end; i++) {\r\n        const property = schema[i];\r\n\r\n        // Don't override existing getters/setters\r\n        const etter = Object.getOwnPropertyDescriptor(obj, property);\r\n        if (etter != null) continue;\r\n\r\n        Object.defineProperty(obj, property, {\r\n            get: function () {\r\n                return this[`_${ property }`];\r\n            },\r\n            set: function (value) {\r\n                const oldValue = this[`_${ property }`];\r\n                this[`_${ property }`] = value;\r\n                this.fire('set', property, oldValue, value);\r\n            },\r\n            configurable: true\r\n        });\r\n    }\r\n\r\n    obj._accessorsBuilt = true;\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy91dGlsLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBLHlDQUF5QyxTQUFTO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsVUFBVTtBQUMzQyxhQUFhO0FBQ2I7QUFDQSwyQ0FBMkMsVUFBVTtBQUNyRCwwQkFBMEIsVUFBVTtBQUNwQztBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy91dGlsLm1qcz9lYzY5Il0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGJ1aWxkQWNjZXNzb3JzKG9iaiwgc2NoZW1hKSB7XHJcbiAgICAvLyBDcmVhdGUgZ2V0dGVyL3NldHRlciBwYWlycyBmb3IgZWFjaCBwcm9wZXJ0eSBkZWZpbmVkIGluIHRoZSBzY2hlbWFcclxuICAgIGZvciAobGV0IGkgPSAwLCBlbmQgPSBzY2hlbWEubGVuZ3RoOyBpIDwgZW5kOyBpKyspIHtcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHNjaGVtYVtpXTtcclxuXHJcbiAgICAgICAgLy8gRG9uJ3Qgb3ZlcnJpZGUgZXhpc3RpbmcgZ2V0dGVycy9zZXR0ZXJzXHJcbiAgICAgICAgY29uc3QgZXR0ZXIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcGVydHkpO1xyXG4gICAgICAgIGlmIChldHRlciAhPSBudWxsKSBjb250aW51ZTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcGVydHksIHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tgXyR7IHByb3BlcnR5IH1gXTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpc1tgXyR7IHByb3BlcnR5IH1gXTtcclxuICAgICAgICAgICAgICAgIHRoaXNbYF8keyBwcm9wZXJ0eSB9YF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnc2V0JywgcHJvcGVydHksIG9sZFZhbHVlLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9iai5fYWNjZXNzb3JzQnVpbHQgPSB0cnVlO1xyXG59XHJcblxyXG5leHBvcnQgeyBidWlsZEFjY2Vzc29ycyB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/util.mjs\n");

/***/ }),

/***/ "./node_modules/jolt-physics/package.json":
/*!************************************************!*\
  !*** ./node_modules/jolt-physics/package.json ***!
  \************************************************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"jolt-physics","version":"0.16.0","description":"A WebAssembly port of JoltPhysics, a rigid body physics and collision detection library, suitable for games and VR applications","type":"module","main":"dist/jolt-physics.wasm-compat.js","types":"dist/jolt-physics.wasm-compat.d.ts","exports":{".":{"types":"./dist/jolt-physics.wasm-compat.d.ts","default":"./dist/jolt-physics.wasm-compat.js"},"./wasm":{"types":"./dist/jolt-physics.wasm.d.ts","default":"./dist/jolt-physics.wasm.js"},"./wasm-compat":{"types":"./dist/jolt-physics.wasm-compat.d.ts","default":"./dist/jolt-physics.wasm-compat.js"},"./asm":{"types":"./dist/jolt-physics.d.ts","default":"./dist/jolt-physics.js"},"./jolt-physics.wasm.wasm":"./dist/jolt-physics.wasm.wasm","./package.json":"./package.json"},"scripts":{"build":"sh build.sh","examples":"http-server ./Examples"},"homepage":"https://github.com/jrouwe/JoltPhysics.js","repository":"https://github.com/jrouwe/JoltPhysics.js.git","author":"jrouwe","license":"MIT","files":["README.md","LICENSE","./dist/jolt-physics.js","./dist/jolt-physics.d.ts","./dist/jolt-physics.wasm-compat.js","./dist/jolt-physics.wasm-compat.d.ts","./dist/jolt-physics.wasm.js","./dist/jolt-physics.wasm.d.ts","./dist/jolt-physics.wasm.wasm","./dist/types.d.ts","asm","wasm","wasm-compat"],"keywords":["physics","physics-engine","physics-simulation","simulation","game-engine","vr","game-development","webassembly","wasm"],"devDependencies":{"http-server":"^14.1.1","webidl-dts-gen":"^1.7.0"}}');

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"jolt","version":"0.1.0","main":"index.js","license":"MIT","type":"module","scripts":{"build":"rimraf dist && webpack --mode=production && webpack --mode=development","build:dev":"rimraf dist && webpack --mode=development","build:prod":"rimraf dist && webpack --mode=production"},"dependencies":{"jolt-physics":"^0.16.0","playcanvas":"^1.66.1"},"devDependencies":{"rimraf":"^5.0.5","webpack":"^5.89.0","webpack-cli":"^5.1.4"}}');

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/get javascript chunk filename */
/******/ 	(() => {
/******/ 		// This function allow to reference async chunks
/******/ 		__webpack_require__.u = (chunkId) => {
/******/ 			// return url for filenames based on template
/******/ 			return undefined;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.mjs");
/******/ 	__webpack_exports__ = __webpack_exports__["default"];
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});