/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
var PhysicsComponents;
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/backends/jolt/backend.mjs":
/*!***************************************!*\
  !*** ./src/backends/jolt/backend.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JoltBackend: () => (/* binding */ JoltBackend)\n/* harmony export */ });\n/* harmony import */ var jolt_physics_package_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jolt-physics/package.json */ \"./node_modules/jolt-physics/package.json\");\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _physics_math_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../physics/math.mjs */ \"./src/physics/math.mjs\");\n/* harmony import */ var _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commands-buffer.mjs */ \"./src/backends/jolt/commands-buffer.mjs\");\n/* harmony import */ var _operators_cleaner_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./operators/cleaner.mjs */ \"./src/backends/jolt/operators/cleaner.mjs\");\n/* harmony import */ var _operators_creator_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./operators/creator.mjs */ \"./src/backends/jolt/operators/creator.mjs\");\n/* harmony import */ var _operators_drawer_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./operators/drawer.mjs */ \"./src/backends/jolt/operators/drawer.mjs\");\n/* harmony import */ var _operators_listener_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./operators/listener.mjs */ \"./src/backends/jolt/operators/listener.mjs\");\n/* harmony import */ var _operators_modifier_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./operators/modifier.mjs */ \"./src/backends/jolt/operators/modifier.mjs\");\n/* harmony import */ var _operators_querier_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./operators/querier.mjs */ \"./src/backends/jolt/operators/querier.mjs\");\n/* harmony import */ var _operators_tracker_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./operators/tracker.mjs */ \"./src/backends/jolt/operators/tracker.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass JoltBackend {\r\n    constructor(messenger, config) {\r\n        // TODO\r\n        // add webworker\r\n        if (!window || !window.Jolt) return;\r\n\r\n        config = {\r\n            // Physics Settings\r\n            // https://jrouwe.github.io/JoltPhysics/struct_physics_settings.html\r\n            baumgarte: 0.2,\r\n            bodyPairCacheCosMaxDeltaRotationDiv2: 0.9998476951563912,\r\n            bodyPairCacheMaxDeltaPositionSq: Math.sqrt(0.001),\r\n            contactNormalCosMaxDeltaRotation: 0.9961946980917455,\r\n            contactPointPreserveLambdaMaxDistSq: Math.sqrt(0.01),\r\n            deterministicSimulation: true,\r\n            linearCastMaxPenetration: 0.25,\r\n            linearCastThreshold: 0.75,\r\n            manifoldToleranceSq: 1.0e-6,\r\n            maxInFlightBodyPairs: 16384,\r\n            maxPenetrationDistance: 0.2,\r\n            minVelocityForRestitution: 1,\r\n            numPositionSteps: 2,\r\n            numVelocitySteps: 10,\r\n            penetrationSlop: 0.02,\r\n            pointVelocitySleepThreshold: 0.03,\r\n            speculativeContactDistance: 0.02,\r\n            stepListenerBatchesPerJob: 1,\r\n            stepListenersBatchSize: 8,\r\n            timeBeforeSleep: 0.5,\r\n            // for debugging\r\n            constraintWarmStart: true,\r\n            useBodyPairContactCache: true,\r\n            useManifoldReduction: true,\r\n            useLargeIslandSplitter: true,\r\n            allowSleeping: true,\r\n            checkActiveEdges: true,\r\n            // contact events\r\n            charContactEventsEnabled: true,\r\n            vehicleContactEventsEnabled: false,\r\n            contactEventsEnabled: true,\r\n            contactAddedEventsEnabled: true,\r\n            contactPersistedEventsEnabled: false,\r\n            contactRemovedEventsEnabled: true,\r\n            contactPoints: true,\r\n            contactPointsAveraged: true,\r\n            // object layers\r\n            layerPairs: [\r\n                [ 0, 1 ],   // non-moving, moving\r\n                [ 1, 1 ]    // moving, moving\r\n            ],\r\n            ...config\r\n        };\r\n        this._config = config;\r\n        this._time = 0;\r\n\r\n        // Transform filters to bit values\r\n        this._filterLayers = new Map();\r\n        this._filterToBits(config);\r\n\r\n        // Jolt specific\r\n        this._joltInterface = null;\r\n        this._physicsSystem = null;\r\n        this._bodyInterface = null;\r\n        this._bpFilter = null;\r\n        this._objFilter = null;\r\n        this._bodyFilter = null;\r\n        this._shapeFilter = null;\r\n        this._bodyList = null;\r\n        this._groupFilterTables = [];\r\n\r\n        // Physics operators\r\n        this._creator = new _operators_creator_mjs__WEBPACK_IMPORTED_MODULE_6__.Creator(this);\r\n        this._modifier = new _operators_modifier_mjs__WEBPACK_IMPORTED_MODULE_9__.Modifier(this);\r\n        this._cleaner = new _operators_cleaner_mjs__WEBPACK_IMPORTED_MODULE_5__.Cleaner(this);\r\n        this._querier = new _operators_querier_mjs__WEBPACK_IMPORTED_MODULE_10__.Querier(this);\r\n        this._tracker = new _operators_tracker_mjs__WEBPACK_IMPORTED_MODULE_11__.Tracker(this);\r\n        this._drawer = new _operators_drawer_mjs__WEBPACK_IMPORTED_MODULE_7__.Drawer();\r\n        \r\n        const listener = new _operators_listener_mjs__WEBPACK_IMPORTED_MODULE_8__.Listener(this);\r\n\r\n        if (config.contactEventsEnabled) {\r\n            listener.initEvents(config);\r\n        }\r\n\r\n        this._listener = listener;\r\n\r\n        this._outBuffer = new _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__.CommandsBuffer({ ...this._config, commandsBufferSize: 2000 });\r\n\r\n        // Util\r\n        (0,_physics_math_mjs__WEBPACK_IMPORTED_MODULE_3__.extendMath)();\r\n\r\n        this._stepTime = 0;\r\n        this._steps = 0;\r\n\r\n        this._responseMessage = { buffer: null };\r\n        this._dispatcher = messenger;\r\n        this._inBuffer = null;\r\n        this._fatalError = false;\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            this._perfIndex = null;\r\n        }\r\n\r\n        this._exposeConstants();\r\n    }\r\n\r\n    set joltInterface(joltInterface) {\r\n        this._joltInterface = joltInterface;\r\n    }\r\n\r\n    get joltInterface() {\r\n        return this._joltInterface;\r\n    }\r\n\r\n    get physicsSystem() {\r\n        return this._physicsSystem;\r\n    }\r\n    set physicsSystem(system) {\r\n        this._physicsSystem = system;\r\n        this._bodyInterface = system.GetBodyInterface();\r\n    }\r\n\r\n    get groupFilterTables() {\r\n        return this._groupFilterTables;\r\n    }\r\n\r\n    get bodyInterface() {\r\n        return this._bodyInterface;\r\n    }\r\n\r\n    get inBuffer() {\r\n        return this._inBuffer;\r\n    }\r\n\r\n    get outBuffer() {\r\n        return this._outBuffer;\r\n    }\r\n\r\n    get config() {\r\n        return this._config;\r\n    }\r\n\r\n    get tracker() {\r\n        return this._tracker;\r\n    }\r\n\r\n    get creator() {\r\n        return this._creator;\r\n    }\r\n\r\n    get listener() {\r\n        return this._listener;\r\n    }\r\n\r\n    get querier() {\r\n        return this._querier;\r\n    }\r\n\r\n    get bpFilter() {\r\n        return this._bpFilter;\r\n    }\r\n\r\n    set bpFilter(filter) {\r\n        this._bpFilter = filter;\r\n    }\r\n\r\n    get objFilter() {\r\n        return this._objFilter;\r\n    }\r\n\r\n    set objFilter(filter) {\r\n        this._objFilter = filter;\r\n    }\r\n\r\n    get bodyFilter() {\r\n        return this._bodyFilter;\r\n    }\r\n\r\n    set bodyFilter(filter) {\r\n        this._bodyFilter = filter;\r\n    }\r\n\r\n    get shapeFilter() {\r\n        return this._shapeFilter;\r\n    }\r\n\r\n    set shapeFilter(filter) {\r\n        this._shapeFilter = filter;\r\n    }\r\n\r\n    get bodyList() {\r\n        return this._bodyList;\r\n    }\r\n\r\n    set bodyList(list) {\r\n        this._bodyList = list;\r\n    }\r\n\r\n    step(data) {\r\n        if (this._fatalError) return;\r\n        \r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            this._stepTime = performance.now();\r\n            this._perfIndex = data.perfIndex;\r\n        }\r\n        \r\n        const { buffer, meshBuffers, dt } = data;\r\n        let inBuffer = this._inBuffer;\r\n\r\n        let ok = true;\r\n        if (buffer) {\r\n            if (!inBuffer) {\r\n                inBuffer = this._inBuffer = new _commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_4__.CommandsBuffer();\r\n                inBuffer.buffer = buffer;\r\n            }\r\n\r\n            // If commands buffer is provided, then execute commands, before stepping\r\n            try {\r\n                ok = ok && this._executeCommands(meshBuffers);\r\n            } catch (e) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n                ok = false;\r\n            }\r\n        }\r\n\r\n        if (!inBuffer) {\r\n            // The physics world is empty, as no commands were ever received yet,\r\n            // so nothing to report and no reason to step the physics.\r\n            return;\r\n        }\r\n\r\n        const outBuffer = this._outBuffer;\r\n\r\n        // potentially step physics system, update motion states\r\n        ok = ok && this._stepPhysics(dt);\r\n\r\n        // write the collected contact events\r\n        this._listener.write(outBuffer);\r\n\r\n        // write dynamic transforms to update entities\r\n        ok = ok && this._writeIsometry(outBuffer);\r\n\r\n        // write virtual characters state\r\n        ok = ok && this._writeCharacters(outBuffer);\r\n\r\n        // write debug draw data\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            // Write debug draw data\r\n            ok = ok && this._drawer.write(this._tracker);\r\n        }\r\n\r\n        // report sim results to frontend\r\n        ok = ok && this._send();\r\n\r\n        if (!ok) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error('Backend fatal error :(');\r\n            this._fatalError = true;\r\n        }\r\n    }\r\n\r\n    overrideContacts(listener, overrides) {\r\n        this._listener.overrideContacts(listener, overrides);\r\n    }\r\n\r\n    getBitValue(name) {\r\n        const layers = this._filterLayers;\r\n\r\n        if (!layers.has(name)) {\r\n            layers.set(name, layers.size ? 1 << layers.size - 1 : 0);\r\n        }\r\n\r\n        return layers.get(name);\r\n    }\r\n\r\n    destroy() {\r\n        this._creator.destroy();\r\n        this._creator = null;\r\n\r\n        this._modifier.destroy();\r\n        this._modifier = null;\r\n\r\n        this._cleaner.destroy();\r\n        this._cleaner = null;\r\n\r\n        this._querier.destroy();\r\n        this._querier = null;\r\n\r\n        this._tracker.destroy();\r\n        this._tracker = null;\r\n\r\n        this._dispatcher = null;\r\n\r\n        if (this._charUpdateSettings) {\r\n            Jolt.destroy(this._charUpdateSettings);\r\n            this._charUpdateSettings = null;\r\n        }\r\n\r\n        if (this._joltInterface) {\r\n            Jolt.destroy(this._joltInterface);\r\n            this._joltInterface = null;\r\n        }\r\n\r\n        const tables = this._groupFilterTables;\r\n        const len = tables.length;\r\n        if (len > 0) {\r\n            for (let i = 0; i < len; i++) {\r\n                const table = tables[i];\r\n                Jolt.destroy(table);\r\n            }\r\n            tables.length = 0;\r\n        }\r\n\r\n        Jolt.destroy(this._bodyList);\r\n        this._bodyList = null;\r\n\r\n        this._inBuffer?.destroy();\r\n        this._inBuffer = null;\r\n\r\n        this._outBuffer?.destroy();\r\n        this._outBuffer = null;\r\n    }\r\n\r\n    _stepPhysics(dt) {\r\n        const config = this._config;\r\n        const fixedStep = config.fixedStep;\r\n        const subSteps = config.subSteps;\r\n        const jolt = this._joltInterface;\r\n\r\n        let time = this._time;\r\n        let stepped = false;\r\n        let ok = true;\r\n\r\n        time += dt;\r\n\r\n        while (ok && time >= fixedStep) {\r\n            try {\r\n                // update characters before stepping\r\n                ok = this._updateCharacters(fixedStep);\r\n                // step the physics world\r\n                ok && jolt.Step(fixedStep, subSteps);\r\n                this._steps++;\r\n                stepped = true;\r\n            } catch (e) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n                ok = false;\r\n            }\r\n\r\n            time -= fixedStep;\r\n        }\r\n\r\n        if (ok && config.useMotionStates) {\r\n            ok = this._updateMotionStates(time / fixedStep, stepped);\r\n        }\r\n\r\n        this._time = time;\r\n\r\n        return ok;\r\n    }\r\n\r\n    _updateMotionStates(alpha, stepped) {\r\n        const tracker = this._tracker;\r\n        const system = this._physicsSystem;\r\n        const characters = tracker.character;\r\n        const dynamicType = Jolt.EBodyType_RigidBody;\r\n\r\n        // active dynamic and active kinematic\r\n        const numActiveBodies = system.GetNumActiveBodies(dynamicType);\r\n        if (numActiveBodies > 0) {\r\n            const bodyList = this._bodyList;\r\n\r\n            bodyList.clear();\r\n            system.GetActiveBodies(dynamicType, bodyList);\r\n            \r\n            for (let i = 0; i < numActiveBodies; i++) {\r\n                const bodyID = bodyList.at(i);\r\n                const body = system.GetBodyLockInterface().TryGetBody(bodyID);\r\n                if (Jolt.getPointer(body) === 0) {\r\n                    continue;\r\n                }\r\n\r\n                const ms = body.motionState;\r\n                if (ms) {\r\n                    ms.compute(alpha, stepped);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (const char of characters) {\r\n            const ms = char.motionState;\r\n            if (ms) {\r\n                const ok = ms.compute(alpha, stepped);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && !ok) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _updateCharacters(fixedStep) {\r\n        const characters = this._tracker.character;\r\n        if (characters.size === 0) return true;\r\n\r\n        const movingBPFilter = this._bpFilter;\r\n        const movingLayerFilter = this._objFilter;\r\n        const bodyFilter = this._bodyFilter;\r\n        const shapeFilter = this._shapeFilter;\r\n        let updateSettings = this._charUpdateSettings;\r\n\r\n        try {\r\n            if (!updateSettings) {\r\n                updateSettings = this._charUpdateSettings = new Jolt.ExtendedUpdateSettings();\r\n            }\r\n            const allocator = this._joltInterface.GetTempAllocator();\r\n    \r\n            characters.forEach(char => {\r\n                char.ExtendedUpdate(\r\n                    fixedStep,\r\n                    char.GetUp(),\r\n                    updateSettings,\r\n                    movingBPFilter,\r\n                    movingLayerFilter,\r\n                    bodyFilter,\r\n                    shapeFilter,\r\n                    allocator\r\n                );\r\n                char.UpdateGroundVelocity();\r\n            });\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _executeCommands(meshBuffers) {\r\n        const cb = this._inBuffer;\r\n        const creator = this._creator;\r\n        const modifier = this._modifier;\r\n        const querier = this._querier;\r\n        const cleaner = this._cleaner;\r\n        const count = cb.commandsCount;\r\n\r\n        let ok = true;\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const operator = cb.readOperator();\r\n\r\n            switch (operator) {\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_CREATOR:\r\n                    ok = ok && creator.create(meshBuffers);\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_MODIFIER:\r\n                    ok = ok && modifier.modify();\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_QUERIER:\r\n                    ok = ok && querier.query();\r\n                    break;\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OPERATOR_CLEANER:\r\n                    ok = ok && cleaner.clean();\r\n                    break;\r\n\r\n                default:\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(`Invalid operator: ${ operator }`);\r\n                    return false;\r\n            }\r\n        }\r\n\r\n        // Reset the cursors, so we can start from the buffer beginning on\r\n        // the next step request\r\n        cb.reset();\r\n\r\n        return ok;\r\n    }\r\n\r\n    _writeIsometry(cb) {\r\n        // Report transforms of dynamic bodies\r\n        const tracker = this._tracker;\r\n        const system = this._physicsSystem;\r\n        const dynamicType = Jolt.EBodyType_RigidBody;\r\n        const numActiveBodies = system.GetNumActiveBodies(dynamicType);\r\n        if (numActiveBodies > 0) {    \r\n            const useMotionStates = this._config.useMotionStates;\r\n            const bodyList = this._bodyList;\r\n\r\n            try {\r\n                bodyList.clear();\r\n                system.GetActiveBodies(dynamicType, bodyList);\r\n    \r\n                for (let i = 0; i < numActiveBodies; i++) {\r\n                    const bodyID = bodyList.at(i);\r\n                    const body = system.GetBodyLockInterface().TryGetBody(bodyID);\r\n                    const pointer = Jolt.getPointer(body);\r\n    \r\n                    if (pointer === 0)\r\n                        continue;\r\n    \r\n                    cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.COMPONENT_SYSTEM_BODY);\r\n                    cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CMD_UPDATE_TRANSFORMS);\r\n    \r\n                    const index = tracker.getPCID(Jolt.getPointer(body));\r\n                    cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n    \r\n                    const ms = body.motionState;\r\n                    if (useMotionStates && ms) {\r\n                        cb.write(ms.position, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                        cb.write(ms.rotation, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                    } else {\r\n                        cb.write(body.GetPosition(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                        cb.write(body.GetRotation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    }\r\n    \r\n                    cb.write(body.GetLinearVelocity(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(body.GetAngularVelocity(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n\r\n                    // If it is a vehicle, write wheels isometry as well\r\n                    if (body.isVehicle) {\r\n                        const data = tracker.constraintMap.get(index);\r\n                        const constraint = data.constraint;\r\n                        const wheelsCount = constraint.wheelsCount;\r\n                        const modifier = this._modifier;\r\n\r\n                        const jv1 = modifier.joltVec3_1;\r\n                        const jv2 = modifier.joltVec3_2;\r\n\r\n                        jv1.Set(0, 1, 0);\r\n                        jv2.Set(1, 0, 0);\r\n    \r\n                        for (let i = 0; i < wheelsCount; i++) {\r\n                            const transform = constraint.GetWheelLocalTransform(i, jv1, jv2);\r\n\r\n                            cb.write(transform.GetTranslation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                            cb.write(transform.GetRotation().GetQuaternion(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                        }\r\n                    }\r\n                }\r\n\r\n            } catch (e) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _writeCharacters(cb) {\r\n        const tracker = this._tracker;\r\n        const characters = tracker.character;\r\n        const count = characters.size;\r\n\r\n        if (count === 0)\r\n            return true;\r\n\r\n        const useMotionStates = this._config.useMotionStates;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.COMPONENT_SYSTEM_CHAR);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CMD_UPDATE_TRANSFORMS);\r\n        cb.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n        try {\r\n            characters.forEach(char => {\r\n                const index = tracker.getPCID(Jolt.getPointer(char));\r\n                const isSupported = char.IsSupported();\r\n                const state = char.GetGroundState();\r\n                const linVel = char.GetLinearVelocity();\r\n                const groundVelocity = char.GetGroundVelocity();\r\n                const groundNormal = char.GetGroundNormal();\r\n                const isTooSteep = char.IsSlopeTooSteep(groundNormal);\r\n\r\n                cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n                const ms = char.motionState;\r\n                if (useMotionStates && ms) {\r\n                    cb.write(ms.position, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                    cb.write(ms.rotation, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32, false);\r\n                } else {\r\n                    cb.write(char.GetPosition(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(char.GetRotation(), _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n\r\n                cb.write(linVel, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                cb.write(isSupported, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                cb.write(state, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT8, false);\r\n\r\n                if (isSupported) {\r\n                    const groundID = char.GetGroundBodyID();\r\n                    const bodyLockInterface = this._physicsSystem.GetBodyLockInterface();\r\n                    let bodyGround = bodyLockInterface.TryGetBody(groundID);\r\n                    if (Jolt.getPointer(bodyGround) === 0) {\r\n                        bodyGround = null;\r\n                    }\r\n                    cb.write(!!bodyGround, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                    if (bodyGround) {\r\n                        const groundIdx = tracker.getPCID(Jolt.getPointer(bodyGround));\r\n                        cb.write(groundIdx, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n                    }\r\n\r\n                    cb.write(isTooSteep, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL, false);\r\n                    cb.write(groundVelocity, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                    cb.write(groundNormal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32, false);\r\n                }\r\n            });\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _send() {\r\n        const dispatcher = this._dispatcher;\r\n        const msg = this._responseMessage;\r\n        const outBuffer = this._outBuffer;\r\n        const buffer = outBuffer.buffer;\r\n        const drawer = this._drawer;\r\n        const debugDraw = !!(drawer && drawer.dirty);\r\n\r\n        outBuffer.reset();\r\n        this._querier.reset();\r\n        this._listener.reset();\r\n\r\n        if (debugDraw) {\r\n            msg.drawViews = drawer.data;\r\n        } else {\r\n            msg.drawViews = null;\r\n        }\r\n\r\n        msg.buffer = buffer;\r\n        msg.steps = this._steps;\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            msg.perfIndex = this._perfIndex;\r\n            msg.time = performance.now() - this._stepTime;\r\n        }\r\n\r\n        if (debugDraw) {\r\n            dispatcher.respond(msg, [ buffer, ...drawer.buffers ]);\r\n            drawer.reset();\r\n        } else {\r\n            dispatcher.respond(msg, [ buffer ]);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _filterToBits(config) {\r\n        const filterLayers = this._filterLayers;\r\n        const pairs = config.layerPairs;\r\n        for (let i = 0, end = pairs.length; i < end; i++) {\r\n            const pair = pairs[i];\r\n            pair[0] = this.getBitValue(pair[0]);\r\n            pair[1] = this.getBitValue(pair[1]);\r\n        }\r\n\r\n        const layers = [];\r\n        filterLayers.forEach(key => {\r\n            layers.push(key);\r\n        });\r\n\r\n        config.layers = layers;\r\n    }\r\n\r\n    _exposeConstants() {\r\n        const dispatcher = this._dispatcher;\r\n        const msg = this._responseMessage;\r\n\r\n        msg.constants = [\r\n            'JOLT_VERSION', jolt_physics_package_json__WEBPACK_IMPORTED_MODULE_0__.version,\r\n\r\n            'JOLT_MOTION_TYPE_STATIC', Jolt.EMotionType_Static,\r\n            'JOLT_MOTION_TYPE_DYNAMIC', Jolt.EMotionType_Dynamic,\r\n            'JOLT_MOTION_TYPE_KINEMATIC', Jolt.EMotionType_Kinematic,\r\n\r\n            'JOLT_OMP_CALCULATE_INERTIA', Jolt.EOverrideMassProperties_CalculateInertia,\r\n            'JOLT_OMP_CALCULATE_MASS_AND_INERTIA', Jolt.EOverrideMassProperties_CalculateMassAndInertia,\r\n            'JOLT_OMP_MASS_AND_INERTIA_PROVIDED', Jolt.EOverrideMassProperties_MassAndInertiaProvided,\r\n\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_X', Jolt.EAllowedDOFs_TranslationX,\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_Y', Jolt.EAllowedDOFs_TranslationY,\r\n            'JOLT_ALLOWED_DOFS_TRANSLATION_Z', Jolt.EAllowedDOFs_TranslationZ,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_X', Jolt.EAllowedDOFs_RotationX,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_Y', Jolt.EAllowedDOFs_RotationY,\r\n            'JOLT_ALLOWED_DOFS_ROTATION_Z', Jolt.EAllowedDOFs_RotationZ,\r\n            'JOLT_ALLOWED_DOFS_PLANE_2D', Jolt.EAllowedDOFs_Plane2D,\r\n            'JOLT_ALLOWED_DOFS_ALL', Jolt.EAllowedDOFs_All,\r\n\r\n            'JOLT_MOTION_QUALITY_DISCRETE', Jolt.EMotionQuality_Discrete,\r\n            'JOLT_MOTION_QUALITY_LINEAR_CAST', Jolt.EMotionQuality_LinearCast,\r\n\r\n            'JOLT_BFM_IGNORE_BACK_FACES', Jolt.EBackFaceMode_IgnoreBackFaces,\r\n            'JOLT_BFM_COLLIDE_BACK_FACES', Jolt.EBackFaceMode_CollideWithBackFaces,\r\n            \r\n            'JOLT_GROUND_STATE_ON_GROUND', Jolt.EGroundState_OnGround,\r\n            'JOLT_GROUND_STATE_ON_STEEP_GROUND', Jolt.EGroundState_OnSteepGround,\r\n            'JOLT_GROUND_STATE_NOT_SUPPORTED', Jolt.EGroundState_NotSupported,\r\n            'JOLT_GROUND_STATE_IN_AIR', Jolt.EGroundState_InAir,\r\n\r\n            'JOLT_TRANSMISSION_AUTO', Jolt.ETransmissionMode_Auto,\r\n            'JOLT_TRANSMISSION_MANUAL', Jolt.ETransmissionMode_Manual,\r\n\r\n            'JOLT_SPRING_MODE_FREQUENCY', Jolt.ESpringMode_FrequencyAndDamping,\r\n            'JOLT_SPRING_MODE_STIFFNESS', Jolt.ESpringMode_StiffnessAndDamping,\r\n        ];\r\n\r\n        dispatcher.respond(msg);\r\n\r\n        msg.constants = null;\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9iYWNrZW5kLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9iYWNrZW5kcy9qb2x0L2JhY2tlbmQubWpzP2QxMjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGpvbHRJbmZvIGZyb20gXCJqb2x0LXBoeXNpY3MvcGFja2FnZS5qc29uXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsXHJcbiAgICBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMiwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBCVUZGRVJfV1JJVEVfVkVDMzIsXHJcbiAgICBDTURfVVBEQVRFX1RSQU5TRk9STVMsIENPTVBPTkVOVF9TWVNURU1fQk9EWSwgQ09NUE9ORU5UX1NZU1RFTV9DSEFSLFxyXG4gICAgT1BFUkFUT1JfQ0xFQU5FUiwgT1BFUkFUT1JfQ1JFQVRPUiwgT1BFUkFUT1JfTU9ESUZJRVIsIE9QRVJBVE9SX1FVRVJJRVJcclxufSBmcm9tIFwiLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBleHRlbmRNYXRoIH0gZnJvbSBcIi4uLy4uL3BoeXNpY3MvbWF0aC5tanNcIjtcclxuaW1wb3J0IHsgQ29tbWFuZHNCdWZmZXIgfSBmcm9tIFwiLi9jb21tYW5kcy1idWZmZXIubWpzXCI7XHJcbmltcG9ydCB7IENsZWFuZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvY2xlYW5lci5tanNcIjtcclxuaW1wb3J0IHsgQ3JlYXRvciB9IGZyb20gXCIuL29wZXJhdG9ycy9jcmVhdG9yLm1qc1wiO1xyXG5pbXBvcnQgeyBEcmF3ZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvZHJhd2VyLm1qc1wiO1xyXG5pbXBvcnQgeyBMaXN0ZW5lciB9IGZyb20gXCIuL29wZXJhdG9ycy9saXN0ZW5lci5tanNcIjtcclxuaW1wb3J0IHsgTW9kaWZpZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvbW9kaWZpZXIubWpzXCI7XHJcbmltcG9ydCB7IFF1ZXJpZXIgfSBmcm9tIFwiLi9vcGVyYXRvcnMvcXVlcmllci5tanNcIjtcclxuaW1wb3J0IHsgVHJhY2tlciB9IGZyb20gXCIuL29wZXJhdG9ycy90cmFja2VyLm1qc1wiO1xyXG5cclxuY2xhc3MgSm9sdEJhY2tlbmQge1xyXG4gICAgY29uc3RydWN0b3IobWVzc2VuZ2VyLCBjb25maWcpIHtcclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgLy8gYWRkIHdlYndvcmtlclxyXG4gICAgICAgIGlmICghd2luZG93IHx8ICF3aW5kb3cuSm9sdCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25maWcgPSB7XHJcbiAgICAgICAgICAgIC8vIFBoeXNpY3MgU2V0dGluZ3NcclxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL3N0cnVjdF9waHlzaWNzX3NldHRpbmdzLmh0bWxcclxuICAgICAgICAgICAgYmF1bWdhcnRlOiAwLjIsXHJcbiAgICAgICAgICAgIGJvZHlQYWlyQ2FjaGVDb3NNYXhEZWx0YVJvdGF0aW9uRGl2MjogMC45OTk4NDc2OTUxNTYzOTEyLFxyXG4gICAgICAgICAgICBib2R5UGFpckNhY2hlTWF4RGVsdGFQb3NpdGlvblNxOiBNYXRoLnNxcnQoMC4wMDEpLFxyXG4gICAgICAgICAgICBjb250YWN0Tm9ybWFsQ29zTWF4RGVsdGFSb3RhdGlvbjogMC45OTYxOTQ2OTgwOTE3NDU1LFxyXG4gICAgICAgICAgICBjb250YWN0UG9pbnRQcmVzZXJ2ZUxhbWJkYU1heERpc3RTcTogTWF0aC5zcXJ0KDAuMDEpLFxyXG4gICAgICAgICAgICBkZXRlcm1pbmlzdGljU2ltdWxhdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgbGluZWFyQ2FzdE1heFBlbmV0cmF0aW9uOiAwLjI1LFxyXG4gICAgICAgICAgICBsaW5lYXJDYXN0VGhyZXNob2xkOiAwLjc1LFxyXG4gICAgICAgICAgICBtYW5pZm9sZFRvbGVyYW5jZVNxOiAxLjBlLTYsXHJcbiAgICAgICAgICAgIG1heEluRmxpZ2h0Qm9keVBhaXJzOiAxNjM4NCxcclxuICAgICAgICAgICAgbWF4UGVuZXRyYXRpb25EaXN0YW5jZTogMC4yLFxyXG4gICAgICAgICAgICBtaW5WZWxvY2l0eUZvclJlc3RpdHV0aW9uOiAxLFxyXG4gICAgICAgICAgICBudW1Qb3NpdGlvblN0ZXBzOiAyLFxyXG4gICAgICAgICAgICBudW1WZWxvY2l0eVN0ZXBzOiAxMCxcclxuICAgICAgICAgICAgcGVuZXRyYXRpb25TbG9wOiAwLjAyLFxyXG4gICAgICAgICAgICBwb2ludFZlbG9jaXR5U2xlZXBUaHJlc2hvbGQ6IDAuMDMsXHJcbiAgICAgICAgICAgIHNwZWN1bGF0aXZlQ29udGFjdERpc3RhbmNlOiAwLjAyLFxyXG4gICAgICAgICAgICBzdGVwTGlzdGVuZXJCYXRjaGVzUGVySm9iOiAxLFxyXG4gICAgICAgICAgICBzdGVwTGlzdGVuZXJzQmF0Y2hTaXplOiA4LFxyXG4gICAgICAgICAgICB0aW1lQmVmb3JlU2xlZXA6IDAuNSxcclxuICAgICAgICAgICAgLy8gZm9yIGRlYnVnZ2luZ1xyXG4gICAgICAgICAgICBjb25zdHJhaW50V2FybVN0YXJ0OiB0cnVlLFxyXG4gICAgICAgICAgICB1c2VCb2R5UGFpckNvbnRhY3RDYWNoZTogdHJ1ZSxcclxuICAgICAgICAgICAgdXNlTWFuaWZvbGRSZWR1Y3Rpb246IHRydWUsXHJcbiAgICAgICAgICAgIHVzZUxhcmdlSXNsYW5kU3BsaXR0ZXI6IHRydWUsXHJcbiAgICAgICAgICAgIGFsbG93U2xlZXBpbmc6IHRydWUsXHJcbiAgICAgICAgICAgIGNoZWNrQWN0aXZlRWRnZXM6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIGNvbnRhY3QgZXZlbnRzXHJcbiAgICAgICAgICAgIGNoYXJDb250YWN0RXZlbnRzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgICAgdmVoaWNsZUNvbnRhY3RFdmVudHNFbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgY29udGFjdEV2ZW50c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRhY3RBZGRlZEV2ZW50c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRhY3RQZXJzaXN0ZWRFdmVudHNFbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgY29udGFjdFJlbW92ZWRFdmVudHNFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250YWN0UG9pbnRzOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250YWN0UG9pbnRzQXZlcmFnZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIG9iamVjdCBsYXllcnNcclxuICAgICAgICAgICAgbGF5ZXJQYWlyczogW1xyXG4gICAgICAgICAgICAgICAgWyAwLCAxIF0sICAgLy8gbm9uLW1vdmluZywgbW92aW5nXHJcbiAgICAgICAgICAgICAgICBbIDEsIDEgXSAgICAvLyBtb3ZpbmcsIG1vdmluZ1xyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAuLi5jb25maWdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLl90aW1lID0gMDtcclxuXHJcbiAgICAgICAgLy8gVHJhbnNmb3JtIGZpbHRlcnMgdG8gYml0IHZhbHVlc1xyXG4gICAgICAgIHRoaXMuX2ZpbHRlckxheWVycyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLl9maWx0ZXJUb0JpdHMoY29uZmlnKTtcclxuXHJcbiAgICAgICAgLy8gSm9sdCBzcGVjaWZpY1xyXG4gICAgICAgIHRoaXMuX2pvbHRJbnRlcmZhY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3BoeXNpY3NTeXN0ZW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2JvZHlJbnRlcmZhY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2JwRmlsdGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9vYmpGaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2JvZHlGaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3NoYXBlRmlsdGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9ib2R5TGlzdCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fZ3JvdXBGaWx0ZXJUYWJsZXMgPSBbXTtcclxuXHJcbiAgICAgICAgLy8gUGh5c2ljcyBvcGVyYXRvcnNcclxuICAgICAgICB0aGlzLl9jcmVhdG9yID0gbmV3IENyZWF0b3IodGhpcyk7XHJcbiAgICAgICAgdGhpcy5fbW9kaWZpZXIgPSBuZXcgTW9kaWZpZXIodGhpcyk7XHJcbiAgICAgICAgdGhpcy5fY2xlYW5lciA9IG5ldyBDbGVhbmVyKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuX3F1ZXJpZXIgPSBuZXcgUXVlcmllcih0aGlzKTtcclxuICAgICAgICB0aGlzLl90cmFja2VyID0gbmV3IFRyYWNrZXIodGhpcyk7XHJcbiAgICAgICAgdGhpcy5fZHJhd2VyID0gbmV3IERyYXdlcigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVyID0gbmV3IExpc3RlbmVyKHRoaXMpO1xyXG5cclxuICAgICAgICBpZiAoY29uZmlnLmNvbnRhY3RFdmVudHNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLmluaXRFdmVudHMoY29uZmlnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2xpc3RlbmVyID0gbGlzdGVuZXI7XHJcblxyXG4gICAgICAgIHRoaXMuX291dEJ1ZmZlciA9IG5ldyBDb21tYW5kc0J1ZmZlcih7IC4uLnRoaXMuX2NvbmZpZywgY29tbWFuZHNCdWZmZXJTaXplOiAyMDAwIH0pO1xyXG5cclxuICAgICAgICAvLyBVdGlsXHJcbiAgICAgICAgZXh0ZW5kTWF0aCgpO1xyXG5cclxuICAgICAgICB0aGlzLl9zdGVwVGltZSA9IDA7XHJcbiAgICAgICAgdGhpcy5fc3RlcHMgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLl9yZXNwb25zZU1lc3NhZ2UgPSB7IGJ1ZmZlcjogbnVsbCB9O1xyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBtZXNzZW5nZXI7XHJcbiAgICAgICAgdGhpcy5faW5CdWZmZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2ZhdGFsRXJyb3IgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICB0aGlzLl9wZXJmSW5kZXggPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fZXhwb3NlQ29uc3RhbnRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGpvbHRJbnRlcmZhY2Uoam9sdEludGVyZmFjZSkge1xyXG4gICAgICAgIHRoaXMuX2pvbHRJbnRlcmZhY2UgPSBqb2x0SW50ZXJmYWNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBqb2x0SW50ZXJmYWNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9qb2x0SW50ZXJmYWNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwaHlzaWNzU3lzdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9waHlzaWNzU3lzdGVtO1xyXG4gICAgfVxyXG4gICAgc2V0IHBoeXNpY3NTeXN0ZW0oc3lzdGVtKSB7XHJcbiAgICAgICAgdGhpcy5fcGh5c2ljc1N5c3RlbSA9IHN5c3RlbTtcclxuICAgICAgICB0aGlzLl9ib2R5SW50ZXJmYWNlID0gc3lzdGVtLkdldEJvZHlJbnRlcmZhY2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZ3JvdXBGaWx0ZXJUYWJsZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3VwRmlsdGVyVGFibGVzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib2R5SW50ZXJmYWNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ib2R5SW50ZXJmYWNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbkJ1ZmZlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5CdWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG91dEJ1ZmZlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb25maWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdHJhY2tlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tlcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY3JlYXRvcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGlzdGVuZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3RlbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBxdWVyaWVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyaWVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBicEZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnBGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGJwRmlsdGVyKGZpbHRlcikge1xyXG4gICAgICAgIHRoaXMuX2JwRmlsdGVyID0gZmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBvYmpGaWx0ZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX29iakZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgb2JqRmlsdGVyKGZpbHRlcikge1xyXG4gICAgICAgIHRoaXMuX29iakZpbHRlciA9IGZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYm9keUZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYm9keUZpbHRlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYm9keUZpbHRlcihmaWx0ZXIpIHtcclxuICAgICAgICB0aGlzLl9ib2R5RmlsdGVyID0gZmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaGFwZUZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2hhcGVGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHNoYXBlRmlsdGVyKGZpbHRlcikge1xyXG4gICAgICAgIHRoaXMuX3NoYXBlRmlsdGVyID0gZmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib2R5TGlzdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYm9keUxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGJvZHlMaXN0KGxpc3QpIHtcclxuICAgICAgICB0aGlzLl9ib2R5TGlzdCA9IGxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgc3RlcChkYXRhKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZhdGFsRXJyb3IpIHJldHVybjtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0ZXBUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3BlcmZJbmRleCA9IGRhdGEucGVyZkluZGV4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB7IGJ1ZmZlciwgbWVzaEJ1ZmZlcnMsIGR0IH0gPSBkYXRhO1xyXG4gICAgICAgIGxldCBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyO1xyXG5cclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgIGlmIChidWZmZXIpIHtcclxuICAgICAgICAgICAgaWYgKCFpbkJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgICAgaW5CdWZmZXIgPSB0aGlzLl9pbkJ1ZmZlciA9IG5ldyBDb21tYW5kc0J1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgaW5CdWZmZXIuYnVmZmVyID0gYnVmZmVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZiBjb21tYW5kcyBidWZmZXIgaXMgcHJvdmlkZWQsIHRoZW4gZXhlY3V0ZSBjb21tYW5kcywgYmVmb3JlIHN0ZXBwaW5nXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIHRoaXMuX2V4ZWN1dGVDb21tYW5kcyhtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgICAgIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghaW5CdWZmZXIpIHtcclxuICAgICAgICAgICAgLy8gVGhlIHBoeXNpY3Mgd29ybGQgaXMgZW1wdHksIGFzIG5vIGNvbW1hbmRzIHdlcmUgZXZlciByZWNlaXZlZCB5ZXQsXHJcbiAgICAgICAgICAgIC8vIHNvIG5vdGhpbmcgdG8gcmVwb3J0IGFuZCBubyByZWFzb24gdG8gc3RlcCB0aGUgcGh5c2ljcy5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb3V0QnVmZmVyID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICAvLyBwb3RlbnRpYWxseSBzdGVwIHBoeXNpY3Mgc3lzdGVtLCB1cGRhdGUgbW90aW9uIHN0YXRlc1xyXG4gICAgICAgIG9rID0gb2sgJiYgdGhpcy5fc3RlcFBoeXNpY3MoZHQpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSB0aGUgY29sbGVjdGVkIGNvbnRhY3QgZXZlbnRzXHJcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIud3JpdGUob3V0QnVmZmVyKTtcclxuXHJcbiAgICAgICAgLy8gd3JpdGUgZHluYW1pYyB0cmFuc2Zvcm1zIHRvIHVwZGF0ZSBlbnRpdGllc1xyXG4gICAgICAgIG9rID0gb2sgJiYgdGhpcy5fd3JpdGVJc29tZXRyeShvdXRCdWZmZXIpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSB2aXJ0dWFsIGNoYXJhY3RlcnMgc3RhdGVcclxuICAgICAgICBvayA9IG9rICYmIHRoaXMuX3dyaXRlQ2hhcmFjdGVycyhvdXRCdWZmZXIpO1xyXG5cclxuICAgICAgICAvLyB3cml0ZSBkZWJ1ZyBkcmF3IGRhdGFcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIC8vIFdyaXRlIGRlYnVnIGRyYXcgZGF0YVxyXG4gICAgICAgICAgICBvayA9IG9rICYmIHRoaXMuX2RyYXdlci53cml0ZSh0aGlzLl90cmFja2VyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJlcG9ydCBzaW0gcmVzdWx0cyB0byBmcm9udGVuZFxyXG4gICAgICAgIG9rID0gb2sgJiYgdGhpcy5fc2VuZCgpO1xyXG5cclxuICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcignQmFja2VuZCBmYXRhbCBlcnJvciA6KCcpO1xyXG4gICAgICAgICAgICB0aGlzLl9mYXRhbEVycm9yID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGVDb250YWN0cyhsaXN0ZW5lciwgb3ZlcnJpZGVzKSB7XHJcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIub3ZlcnJpZGVDb250YWN0cyhsaXN0ZW5lciwgb3ZlcnJpZGVzKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRCaXRWYWx1ZShuYW1lKSB7XHJcbiAgICAgICAgY29uc3QgbGF5ZXJzID0gdGhpcy5fZmlsdGVyTGF5ZXJzO1xyXG5cclxuICAgICAgICBpZiAoIWxheWVycy5oYXMobmFtZSkpIHtcclxuICAgICAgICAgICAgbGF5ZXJzLnNldChuYW1lLCBsYXllcnMuc2l6ZSA/IDEgPDwgbGF5ZXJzLnNpemUgLSAxIDogMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbGF5ZXJzLmdldChuYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuX2NyZWF0b3IuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuX2NyZWF0b3IgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9tb2RpZmllci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fbW9kaWZpZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9jbGVhbmVyLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9jbGVhbmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fcXVlcmllci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fcXVlcmllciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX3RyYWNrZXIuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuX3RyYWNrZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9kaXNwYXRjaGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2NoYXJVcGRhdGVTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fY2hhclVwZGF0ZVNldHRpbmdzKTtcclxuICAgICAgICAgICAgdGhpcy5fY2hhclVwZGF0ZVNldHRpbmdzID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9qb2x0SW50ZXJmYWNlKSB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0SW50ZXJmYWNlKTtcclxuICAgICAgICAgICAgdGhpcy5fam9sdEludGVyZmFjZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0YWJsZXMgPSB0aGlzLl9ncm91cEZpbHRlclRhYmxlcztcclxuICAgICAgICBjb25zdCBsZW4gPSB0YWJsZXMubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW4gPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gdGFibGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KHRhYmxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0YWJsZXMubGVuZ3RoID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9ib2R5TGlzdCk7XHJcbiAgICAgICAgdGhpcy5fYm9keUxpc3QgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9pbkJ1ZmZlcj8uZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuX2luQnVmZmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fb3V0QnVmZmVyPy5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fb3V0QnVmZmVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfc3RlcFBoeXNpY3MoZHQpIHtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLl9jb25maWc7XHJcbiAgICAgICAgY29uc3QgZml4ZWRTdGVwID0gY29uZmlnLmZpeGVkU3RlcDtcclxuICAgICAgICBjb25zdCBzdWJTdGVwcyA9IGNvbmZpZy5zdWJTdGVwcztcclxuICAgICAgICBjb25zdCBqb2x0ID0gdGhpcy5fam9sdEludGVyZmFjZTtcclxuXHJcbiAgICAgICAgbGV0IHRpbWUgPSB0aGlzLl90aW1lO1xyXG4gICAgICAgIGxldCBzdGVwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdGltZSArPSBkdDtcclxuXHJcbiAgICAgICAgd2hpbGUgKG9rICYmIHRpbWUgPj0gZml4ZWRTdGVwKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hhcmFjdGVycyBiZWZvcmUgc3RlcHBpbmdcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fdXBkYXRlQ2hhcmFjdGVycyhmaXhlZFN0ZXApO1xyXG4gICAgICAgICAgICAgICAgLy8gc3RlcCB0aGUgcGh5c2ljcyB3b3JsZFxyXG4gICAgICAgICAgICAgICAgb2sgJiYgam9sdC5TdGVwKGZpeGVkU3RlcCwgc3ViU3RlcHMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RlcHMrKztcclxuICAgICAgICAgICAgICAgIHN0ZXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgICAgICBvayA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aW1lIC09IGZpeGVkU3RlcDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvayAmJiBjb25maWcudXNlTW90aW9uU3RhdGVzKSB7XHJcbiAgICAgICAgICAgIG9rID0gdGhpcy5fdXBkYXRlTW90aW9uU3RhdGVzKHRpbWUgLyBmaXhlZFN0ZXAsIHN0ZXBwZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdGltZSA9IHRpbWU7XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBfdXBkYXRlTW90aW9uU3RhdGVzKGFscGhhLCBzdGVwcGVkKSB7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX3RyYWNrZXI7XHJcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5fcGh5c2ljc1N5c3RlbTtcclxuICAgICAgICBjb25zdCBjaGFyYWN0ZXJzID0gdHJhY2tlci5jaGFyYWN0ZXI7XHJcbiAgICAgICAgY29uc3QgZHluYW1pY1R5cGUgPSBKb2x0LkVCb2R5VHlwZV9SaWdpZEJvZHk7XHJcblxyXG4gICAgICAgIC8vIGFjdGl2ZSBkeW5hbWljIGFuZCBhY3RpdmUga2luZW1hdGljXHJcbiAgICAgICAgY29uc3QgbnVtQWN0aXZlQm9kaWVzID0gc3lzdGVtLkdldE51bUFjdGl2ZUJvZGllcyhkeW5hbWljVHlwZSk7XHJcbiAgICAgICAgaWYgKG51bUFjdGl2ZUJvZGllcyA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgYm9keUxpc3QgPSB0aGlzLl9ib2R5TGlzdDtcclxuXHJcbiAgICAgICAgICAgIGJvZHlMaXN0LmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHN5c3RlbS5HZXRBY3RpdmVCb2RpZXMoZHluYW1pY1R5cGUsIGJvZHlMaXN0KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQWN0aXZlQm9kaWVzOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlJRCA9IGJvZHlMaXN0LmF0KGkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYm9keSA9IHN5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpLlRyeUdldEJvZHkoYm9keUlEKTtcclxuICAgICAgICAgICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoYm9keSkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBtcyA9IGJvZHkubW90aW9uU3RhdGU7XHJcbiAgICAgICAgICAgICAgICBpZiAobXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBtcy5jb21wdXRlKGFscGhhLCBzdGVwcGVkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBjaGFyIG9mIGNoYXJhY3RlcnMpIHtcclxuICAgICAgICAgICAgY29uc3QgbXMgPSBjaGFyLm1vdGlvblN0YXRlO1xyXG4gICAgICAgICAgICBpZiAobXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gbXMuY29tcHV0ZShhbHBoYSwgc3RlcHBlZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoRGVidWcuZGV2ICYmICFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3VwZGF0ZUNoYXJhY3RlcnMoZml4ZWRTdGVwKSB7XHJcbiAgICAgICAgY29uc3QgY2hhcmFjdGVycyA9IHRoaXMuX3RyYWNrZXIuY2hhcmFjdGVyO1xyXG4gICAgICAgIGlmIChjaGFyYWN0ZXJzLnNpemUgPT09IDApIHJldHVybiB0cnVlO1xyXG5cclxuICAgICAgICBjb25zdCBtb3ZpbmdCUEZpbHRlciA9IHRoaXMuX2JwRmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IG1vdmluZ0xheWVyRmlsdGVyID0gdGhpcy5fb2JqRmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IGJvZHlGaWx0ZXIgPSB0aGlzLl9ib2R5RmlsdGVyO1xyXG4gICAgICAgIGNvbnN0IHNoYXBlRmlsdGVyID0gdGhpcy5fc2hhcGVGaWx0ZXI7XHJcbiAgICAgICAgbGV0IHVwZGF0ZVNldHRpbmdzID0gdGhpcy5fY2hhclVwZGF0ZVNldHRpbmdzO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXVwZGF0ZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVTZXR0aW5ncyA9IHRoaXMuX2NoYXJVcGRhdGVTZXR0aW5ncyA9IG5ldyBKb2x0LkV4dGVuZGVkVXBkYXRlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBhbGxvY2F0b3IgPSB0aGlzLl9qb2x0SW50ZXJmYWNlLkdldFRlbXBBbGxvY2F0b3IoKTtcclxuICAgIFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXJzLmZvckVhY2goY2hhciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjaGFyLkV4dGVuZGVkVXBkYXRlKFxyXG4gICAgICAgICAgICAgICAgICAgIGZpeGVkU3RlcCxcclxuICAgICAgICAgICAgICAgICAgICBjaGFyLkdldFVwKCksXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2V0dGluZ3MsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92aW5nQlBGaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92aW5nTGF5ZXJGaWx0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgYm9keUZpbHRlcixcclxuICAgICAgICAgICAgICAgICAgICBzaGFwZUZpbHRlcixcclxuICAgICAgICAgICAgICAgICAgICBhbGxvY2F0b3JcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBjaGFyLlVwZGF0ZUdyb3VuZFZlbG9jaXR5KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfZXhlY3V0ZUNvbW1hbmRzKG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjcmVhdG9yID0gdGhpcy5fY3JlYXRvcjtcclxuICAgICAgICBjb25zdCBtb2RpZmllciA9IHRoaXMuX21vZGlmaWVyO1xyXG4gICAgICAgIGNvbnN0IHF1ZXJpZXIgPSB0aGlzLl9xdWVyaWVyO1xyXG4gICAgICAgIGNvbnN0IGNsZWFuZXIgPSB0aGlzLl9jbGVhbmVyO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gY2IuY29tbWFuZHNDb3VudDtcclxuXHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yID0gY2IucmVhZE9wZXJhdG9yKCk7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIE9QRVJBVE9SX0NSRUFUT1I6XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBjcmVhdG9yLmNyZWF0ZShtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBPUEVSQVRPUl9NT0RJRklFUjpcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIG1vZGlmaWVyLm1vZGlmeSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgT1BFUkFUT1JfUVVFUklFUjpcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIHF1ZXJpZXIucXVlcnkoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIE9QRVJBVE9SX0NMRUFORVI6XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBjbGVhbmVyLmNsZWFuKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYEludmFsaWQgb3BlcmF0b3I6ICR7IG9wZXJhdG9yIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJlc2V0IHRoZSBjdXJzb3JzLCBzbyB3ZSBjYW4gc3RhcnQgZnJvbSB0aGUgYnVmZmVyIGJlZ2lubmluZyBvblxyXG4gICAgICAgIC8vIHRoZSBuZXh0IHN0ZXAgcmVxdWVzdFxyXG4gICAgICAgIGNiLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVJc29tZXRyeShjYikge1xyXG4gICAgICAgIC8vIFJlcG9ydCB0cmFuc2Zvcm1zIG9mIGR5bmFtaWMgYm9kaWVzXHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX3RyYWNrZXI7XHJcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5fcGh5c2ljc1N5c3RlbTtcclxuICAgICAgICBjb25zdCBkeW5hbWljVHlwZSA9IEpvbHQuRUJvZHlUeXBlX1JpZ2lkQm9keTtcclxuICAgICAgICBjb25zdCBudW1BY3RpdmVCb2RpZXMgPSBzeXN0ZW0uR2V0TnVtQWN0aXZlQm9kaWVzKGR5bmFtaWNUeXBlKTtcclxuICAgICAgICBpZiAobnVtQWN0aXZlQm9kaWVzID4gMCkgeyAgICBcclxuICAgICAgICAgICAgY29uc3QgdXNlTW90aW9uU3RhdGVzID0gdGhpcy5fY29uZmlnLnVzZU1vdGlvblN0YXRlcztcclxuICAgICAgICAgICAgY29uc3QgYm9keUxpc3QgPSB0aGlzLl9ib2R5TGlzdDtcclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBib2R5TGlzdC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgc3lzdGVtLkdldEFjdGl2ZUJvZGllcyhkeW5hbWljVHlwZSwgYm9keUxpc3QpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUFjdGl2ZUJvZGllczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9keUlEID0gYm9keUxpc3QuYXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9keSA9IHN5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpLlRyeUdldEJvZHkoYm9keUlEKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwb2ludGVyID0gSm9sdC5nZXRQb2ludGVyKGJvZHkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvaW50ZXIgPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX0JPRFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfVVBEQVRFX1RSQU5TRk9STVMpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkpKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbXMgPSBib2R5Lm1vdGlvblN0YXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VNb3Rpb25TdGF0ZXMgJiYgbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUobXMucG9zaXRpb24sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShtcy5yb3RhdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoYm9keS5HZXRQb3NpdGlvbigpLCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGJvZHkuR2V0Um90YXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGJvZHkuR2V0TGluZWFyVmVsb2NpdHkoKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGJvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgaXQgaXMgYSB2ZWhpY2xlLCB3cml0ZSB3aGVlbHMgaXNvbWV0cnkgYXMgd2VsbFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChib2R5LmlzVmVoaWNsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdHJhY2tlci5jb25zdHJhaW50TWFwLmdldChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBkYXRhLmNvbnN0cmFpbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdoZWVsc0NvdW50ID0gY29uc3RyYWludC53aGVlbHNDb3VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZXIgPSB0aGlzLl9tb2RpZmllcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGp2MSA9IG1vZGlmaWVyLmpvbHRWZWMzXzE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGp2MiA9IG1vZGlmaWVyLmpvbHRWZWMzXzI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBqdjEuU2V0KDAsIDEsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqdjIuU2V0KDEsIDAsIDApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gY29uc3RyYWludC5HZXRXaGVlbExvY2FsVHJhbnNmb3JtKGksIGp2MSwganYyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZSh0cmFuc2Zvcm0uR2V0VHJhbnNsYXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUodHJhbnNmb3JtLkdldFJvdGF0aW9uKCkuR2V0UXVhdGVybmlvbigpLCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF93cml0ZUNoYXJhY3RlcnMoY2IpIHtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gdGhpcy5fdHJhY2tlcjtcclxuICAgICAgICBjb25zdCBjaGFyYWN0ZXJzID0gdHJhY2tlci5jaGFyYWN0ZXI7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBjaGFyYWN0ZXJzLnNpemU7XHJcblxyXG4gICAgICAgIGlmIChjb3VudCA9PT0gMClcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZU1vdGlvblN0YXRlcyA9IHRoaXMuX2NvbmZpZy51c2VNb3Rpb25TdGF0ZXM7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoQ09NUE9ORU5UX1NZU1RFTV9DSEFSKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX1VQREFURV9UUkFOU0ZPUk1TKTtcclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXJzLmZvckVhY2goY2hhciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoY2hhcikpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNTdXBwb3J0ZWQgPSBjaGFyLklzU3VwcG9ydGVkKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGNoYXIuR2V0R3JvdW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpblZlbCA9IGNoYXIuR2V0TGluZWFyVmVsb2NpdHkoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZFZlbG9jaXR5ID0gY2hhci5HZXRHcm91bmRWZWxvY2l0eSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdW5kTm9ybWFsID0gY2hhci5HZXRHcm91bmROb3JtYWwoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzVG9vU3RlZXAgPSBjaGFyLklzU2xvcGVUb29TdGVlcChncm91bmROb3JtYWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbXMgPSBjaGFyLm1vdGlvblN0YXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZU1vdGlvblN0YXRlcyAmJiBtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKG1zLnBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShtcy5yb3RhdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGNoYXIuR2V0UG9zaXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGNoYXIuR2V0Um90YXRpb24oKSwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGxpblZlbCwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoaXNTdXBwb3J0ZWQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShzdGF0ZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdW5kSUQgPSBjaGFyLkdldEdyb3VuZEJvZHlJRCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlMb2NrSW50ZXJmYWNlID0gdGhpcy5fcGh5c2ljc1N5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBib2R5R3JvdW5kID0gYm9keUxvY2tJbnRlcmZhY2UuVHJ5R2V0Qm9keShncm91bmRJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihib2R5R3JvdW5kKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5R3JvdW5kID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoISFib2R5R3JvdW5kLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChib2R5R3JvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZElkeCA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoYm9keUdyb3VuZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShncm91bmRJZHgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGlzVG9vU3RlZXAsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZ3JvdW5kVmVsb2NpdHksIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShncm91bmROb3JtYWwsIEJVRkZFUl9XUklURV9KT0xUVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9zZW5kKCkge1xyXG4gICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9kaXNwYXRjaGVyO1xyXG4gICAgICAgIGNvbnN0IG1zZyA9IHRoaXMuX3Jlc3BvbnNlTWVzc2FnZTtcclxuICAgICAgICBjb25zdCBvdXRCdWZmZXIgPSB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gb3V0QnVmZmVyLmJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBkcmF3ZXIgPSB0aGlzLl9kcmF3ZXI7XHJcbiAgICAgICAgY29uc3QgZGVidWdEcmF3ID0gISEoZHJhd2VyICYmIGRyYXdlci5kaXJ0eSk7XHJcblxyXG4gICAgICAgIG91dEJ1ZmZlci5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMuX3F1ZXJpZXIucmVzZXQoKTtcclxuICAgICAgICB0aGlzLl9saXN0ZW5lci5yZXNldCgpO1xyXG5cclxuICAgICAgICBpZiAoZGVidWdEcmF3KSB7XHJcbiAgICAgICAgICAgIG1zZy5kcmF3Vmlld3MgPSBkcmF3ZXIuZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtc2cuZHJhd1ZpZXdzID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1zZy5idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgbXNnLnN0ZXBzID0gdGhpcy5fc3RlcHM7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbXNnLnBlcmZJbmRleCA9IHRoaXMuX3BlcmZJbmRleDtcclxuICAgICAgICAgICAgbXNnLnRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHRoaXMuX3N0ZXBUaW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRlYnVnRHJhdykge1xyXG4gICAgICAgICAgICBkaXNwYXRjaGVyLnJlc3BvbmQobXNnLCBbIGJ1ZmZlciwgLi4uZHJhd2VyLmJ1ZmZlcnMgXSk7XHJcbiAgICAgICAgICAgIGRyYXdlci5yZXNldCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucmVzcG9uZChtc2csIFsgYnVmZmVyIF0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2ZpbHRlclRvQml0cyhjb25maWcpIHtcclxuICAgICAgICBjb25zdCBmaWx0ZXJMYXllcnMgPSB0aGlzLl9maWx0ZXJMYXllcnM7XHJcbiAgICAgICAgY29uc3QgcGFpcnMgPSBjb25maWcubGF5ZXJQYWlycztcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gcGFpcnMubGVuZ3RoOyBpIDwgZW5kOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgcGFpciA9IHBhaXJzW2ldO1xyXG4gICAgICAgICAgICBwYWlyWzBdID0gdGhpcy5nZXRCaXRWYWx1ZShwYWlyWzBdKTtcclxuICAgICAgICAgICAgcGFpclsxXSA9IHRoaXMuZ2V0Qml0VmFsdWUocGFpclsxXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBsYXllcnMgPSBbXTtcclxuICAgICAgICBmaWx0ZXJMYXllcnMuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBsYXllcnMucHVzaChrZXkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25maWcubGF5ZXJzID0gbGF5ZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIF9leHBvc2VDb25zdGFudHMoKSB7XHJcbiAgICAgICAgY29uc3QgZGlzcGF0Y2hlciA9IHRoaXMuX2Rpc3BhdGNoZXI7XHJcbiAgICAgICAgY29uc3QgbXNnID0gdGhpcy5fcmVzcG9uc2VNZXNzYWdlO1xyXG5cclxuICAgICAgICBtc2cuY29uc3RhbnRzID0gW1xyXG4gICAgICAgICAgICAnSk9MVF9WRVJTSU9OJywgam9sdEluZm8udmVyc2lvbixcclxuXHJcbiAgICAgICAgICAgICdKT0xUX01PVElPTl9UWVBFX1NUQVRJQycsIEpvbHQuRU1vdGlvblR5cGVfU3RhdGljLFxyXG4gICAgICAgICAgICAnSk9MVF9NT1RJT05fVFlQRV9EWU5BTUlDJywgSm9sdC5FTW90aW9uVHlwZV9EeW5hbWljLFxyXG4gICAgICAgICAgICAnSk9MVF9NT1RJT05fVFlQRV9LSU5FTUFUSUMnLCBKb2x0LkVNb3Rpb25UeXBlX0tpbmVtYXRpYyxcclxuXHJcbiAgICAgICAgICAgICdKT0xUX09NUF9DQUxDVUxBVEVfSU5FUlRJQScsIEpvbHQuRU92ZXJyaWRlTWFzc1Byb3BlcnRpZXNfQ2FsY3VsYXRlSW5lcnRpYSxcclxuICAgICAgICAgICAgJ0pPTFRfT01QX0NBTENVTEFURV9NQVNTX0FORF9JTkVSVElBJywgSm9sdC5FT3ZlcnJpZGVNYXNzUHJvcGVydGllc19DYWxjdWxhdGVNYXNzQW5kSW5lcnRpYSxcclxuICAgICAgICAgICAgJ0pPTFRfT01QX01BU1NfQU5EX0lORVJUSUFfUFJPVklERUQnLCBKb2x0LkVPdmVycmlkZU1hc3NQcm9wZXJ0aWVzX01hc3NBbmRJbmVydGlhUHJvdmlkZWQsXHJcblxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfVFJBTlNMQVRJT05fWCcsIEpvbHQuRUFsbG93ZWRET0ZzX1RyYW5zbGF0aW9uWCxcclxuICAgICAgICAgICAgJ0pPTFRfQUxMT1dFRF9ET0ZTX1RSQU5TTEFUSU9OX1knLCBKb2x0LkVBbGxvd2VkRE9Gc19UcmFuc2xhdGlvblksXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19UUkFOU0xBVElPTl9aJywgSm9sdC5FQWxsb3dlZERPRnNfVHJhbnNsYXRpb25aLFxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfUk9UQVRJT05fWCcsIEpvbHQuRUFsbG93ZWRET0ZzX1JvdGF0aW9uWCxcclxuICAgICAgICAgICAgJ0pPTFRfQUxMT1dFRF9ET0ZTX1JPVEFUSU9OX1knLCBKb2x0LkVBbGxvd2VkRE9Gc19Sb3RhdGlvblksXHJcbiAgICAgICAgICAgICdKT0xUX0FMTE9XRURfRE9GU19ST1RBVElPTl9aJywgSm9sdC5FQWxsb3dlZERPRnNfUm90YXRpb25aLFxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfUExBTkVfMkQnLCBKb2x0LkVBbGxvd2VkRE9Gc19QbGFuZTJELFxyXG4gICAgICAgICAgICAnSk9MVF9BTExPV0VEX0RPRlNfQUxMJywgSm9sdC5FQWxsb3dlZERPRnNfQWxsLFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfTU9USU9OX1FVQUxJVFlfRElTQ1JFVEUnLCBKb2x0LkVNb3Rpb25RdWFsaXR5X0Rpc2NyZXRlLFxyXG4gICAgICAgICAgICAnSk9MVF9NT1RJT05fUVVBTElUWV9MSU5FQVJfQ0FTVCcsIEpvbHQuRU1vdGlvblF1YWxpdHlfTGluZWFyQ2FzdCxcclxuXHJcbiAgICAgICAgICAgICdKT0xUX0JGTV9JR05PUkVfQkFDS19GQUNFUycsIEpvbHQuRUJhY2tGYWNlTW9kZV9JZ25vcmVCYWNrRmFjZXMsXHJcbiAgICAgICAgICAgICdKT0xUX0JGTV9DT0xMSURFX0JBQ0tfRkFDRVMnLCBKb2x0LkVCYWNrRmFjZU1vZGVfQ29sbGlkZVdpdGhCYWNrRmFjZXMsXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAnSk9MVF9HUk9VTkRfU1RBVEVfT05fR1JPVU5EJywgSm9sdC5FR3JvdW5kU3RhdGVfT25Hcm91bmQsXHJcbiAgICAgICAgICAgICdKT0xUX0dST1VORF9TVEFURV9PTl9TVEVFUF9HUk9VTkQnLCBKb2x0LkVHcm91bmRTdGF0ZV9PblN0ZWVwR3JvdW5kLFxyXG4gICAgICAgICAgICAnSk9MVF9HUk9VTkRfU1RBVEVfTk9UX1NVUFBPUlRFRCcsIEpvbHQuRUdyb3VuZFN0YXRlX05vdFN1cHBvcnRlZCxcclxuICAgICAgICAgICAgJ0pPTFRfR1JPVU5EX1NUQVRFX0lOX0FJUicsIEpvbHQuRUdyb3VuZFN0YXRlX0luQWlyLFxyXG5cclxuICAgICAgICAgICAgJ0pPTFRfVFJBTlNNSVNTSU9OX0FVVE8nLCBKb2x0LkVUcmFuc21pc3Npb25Nb2RlX0F1dG8sXHJcbiAgICAgICAgICAgICdKT0xUX1RSQU5TTUlTU0lPTl9NQU5VQUwnLCBKb2x0LkVUcmFuc21pc3Npb25Nb2RlX01hbnVhbCxcclxuXHJcbiAgICAgICAgICAgICdKT0xUX1NQUklOR19NT0RFX0ZSRVFVRU5DWScsIEpvbHQuRVNwcmluZ01vZGVfRnJlcXVlbmN5QW5kRGFtcGluZyxcclxuICAgICAgICAgICAgJ0pPTFRfU1BSSU5HX01PREVfU1RJRkZORVNTJywgSm9sdC5FU3ByaW5nTW9kZV9TdGlmZm5lc3NBbmREYW1waW5nLFxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGRpc3BhdGNoZXIucmVzcG9uZChtc2cpO1xyXG5cclxuICAgICAgICBtc2cuY29uc3RhbnRzID0gbnVsbDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgSm9sdEJhY2tlbmQgfTtcclxuXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/backend.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/commands-buffer.mjs":
/*!***********************************************!*\
  !*** ./src/backends/jolt/commands-buffer.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CommandsBuffer: () => (/* binding */ CommandsBuffer)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\nclass CommandsBuffer {\r\n    constructor(config) {\r\n        if (config) {\r\n            let Buffer;\r\n            if (config.useSharedArrayBuffer) {\r\n                Buffer = SharedArrayBuffer;\r\n            } else {\r\n                Buffer = ArrayBuffer;\r\n            }\r\n            this._buffer = new Buffer(config.commandsBufferSize);\r\n            this._view = new DataView(this._buffer);\r\n            this._allowGrowth = config.allowCommandsBufferResize;\r\n        } else {\r\n            this._allowGrowth = true;\r\n        }\r\n\r\n        // First 2 bytes are for commands count, so we start from 2\r\n        this._bytesOffset = _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        this._commandsCount = 0;\r\n        this._dirty = false;\r\n        this._meshBuffers = [];\r\n    }\r\n\r\n    get buffer() {\r\n        return this._buffer;\r\n    }\r\n\r\n    set buffer(b) {\r\n        this._buffer = b;\r\n        this._view = new DataView(b);\r\n    }\r\n\r\n    get dirty() {\r\n        return this._dirty;\r\n    }\r\n\r\n    get flag() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    get commandsCount() {\r\n        return this._view.getUint16(0);\r\n    }\r\n\r\n    get meshBuffers() {\r\n        return this._meshBuffers;\r\n    }\r\n\r\n    writeJoltVec32(vec) {\r\n        this.writeFloat32(vec.GetX());\r\n        this.writeFloat32(vec.GetY());\r\n        this.writeFloat32(vec.GetZ());\r\n        if (vec.GetW) {\r\n            this.writeFloat32(vec.GetW());\r\n        }\r\n    }\r\n\r\n    readVec(vec) {\r\n        vec.x = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n        vec.y = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n        vec.z = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n    }\r\n\r\n    readQuat(quat) {\r\n        this.readVec(quat);\r\n        quat.w = this.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n    }\r\n\r\n    ignoreFlag() {\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n    }\r\n\r\n    reserveOffset(method) {\r\n        const offset = this._bytesOffset;\r\n        this[method](0);\r\n        return offset;\r\n    }\r\n\r\n    writeReserved(value, offset, method) {\r\n        this[method](value, offset);\r\n    }    \r\n\r\n    updateBuffer(buffer) {\r\n        if (this._buffer.byteLength !== buffer.byteLength) {\r\n            this._buffer = buffer;\r\n            this._view = new DataView(buffer);\r\n        }\r\n    }\r\n\r\n    read(method) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT8 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32 ||\r\n            method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_INT32,\r\n            `Invalid write command method: ${ method }`\r\n        );\r\n\r\n        return this[method]();\r\n    }\r\n\r\n    /**\r\n     * Writes value to buffer. Skips flag for uint8 values.\r\n     */\r\n    write(value, method, addFlag = true) {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_BOOL || \r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_FLOAT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT8 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT16 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_INT32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_VEC32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_JOLTVEC32 ||\r\n                method === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_PLANE,\r\n                `Invalid write command method: ${ method }`\r\n            );\r\n        }\r\n\r\n        if (value == null) {\r\n            this.writeUint8(0);\r\n        } else {\r\n            if (addFlag) this.writeUint8(1);\r\n            this[method](value);\r\n        }\r\n    }\r\n\r\n    readCommand() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} command Number in [0-255] range specifying a command variant for backend\r\n     */\r\n    writeCommand(command) {\r\n        this._increment();\r\n        this.writeUint8(command);\r\n        this._dirty = true;\r\n    }\r\n\r\n    readOperator() {\r\n        return this.readUint8();\r\n    }\r\n\r\n    writeOperator(operator) {\r\n        this.writeUint8(operator);\r\n    }\r\n\r\n    writeVector32(vector) {\r\n        this.writeFloat32(vector.x);\r\n        this.writeFloat32(vector.y);\r\n        this.writeFloat32(vector.z);\r\n        if (vector.w !== undefined) {\r\n            this.writeFloat32(vector.w);\r\n        }\r\n    }\r\n\r\n    readFloat32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getFloat32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeFloat32(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setFloat32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setFloat32(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint8() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint8(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeUint8(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setUint8(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint8(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint16() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint16(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Number} value \r\n     */\r\n    writeUint16(value, offset) {\r\n        if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE)) return;\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            this._view.setUint16(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint16(offset, value);\r\n        }\r\n    }\r\n\r\n    readUint32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return 0;\r\n        }\r\n        const value = this._view.getUint32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    writeUint32(value, offset) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE)) return;\r\n            this._view.setUint32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setUint32(offset, value);\r\n        }\r\n    }\r\n\r\n    readInt32() {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && this._isOutsideBounds(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE)) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: Aborting read outside buffer bounds.');\r\n            return null;\r\n        }\r\n        const value = this._view.getInt32(this._bytesOffset);\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkInt(value, `Got invalid value from buffer: ${ value }`);\r\n        this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE;\r\n        return value;\r\n    }\r\n\r\n    writeInt32(value, offset) {\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkInt(value, `Trying to write invalid value to buffer: ${ value }`);\r\n        if (offset == null) {\r\n            if (!this._canWrite(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE)) return;\r\n            this._view.setInt32(this._bytesOffset, value);\r\n            this._bytesOffset += _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE;\r\n        } else {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(this._buffer.byteLength >= (offset + _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.INT32_SIZE), 'Trying to write outside of buffer bounds.');\r\n            this._view.setInt32(offset, value);\r\n        }\r\n    }    \r\n\r\n    readBool() {\r\n        return this.readUint8() ? true : false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {Boolean} value \r\n     */\r\n    writeBool(value) {\r\n        this.writeUint8(value ? 1 : 0);\r\n    }\r\n\r\n    writePlane(plane) {\r\n        this.writeVector32(plane.normal);\r\n        this.writeFloat32(plane.distance);\r\n    }\r\n\r\n    addBuffer(buffer) {\r\n        this._meshBuffers.push(buffer);\r\n    }\r\n\r\n    skip(bytes, size) {\r\n        this._bytesOffset += (bytes * size);\r\n    }\r\n\r\n    reset() {\r\n        this._commandsCount = 0;\r\n        this._bytesOffset = _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT16_SIZE;\r\n        this._dirty = false;\r\n    }\r\n\r\n    destroy() {\r\n        this._view = null;\r\n        this._buffer = null;\r\n    }\r\n\r\n    _increment() {\r\n        this._view.setUint16(0, ++this._commandsCount);\r\n    }\r\n\r\n    _canWrite(increment) {\r\n        if (this._isOutsideBounds(increment)) {\r\n            if (this._allowGrowth) {\r\n                this._resize();\r\n            } else {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Commands Buffer: reached capacity limits. Not allowed to grow.' +\r\n                    ' Consider using \"allowCommandsBufferResize\" option or allocate a larger buffer' +\r\n                    ' using \"commandsBufferSize\". Current buffer' +\r\n                    ' size (bytes):', this._buffer.byteLength);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _resize(increment) {\r\n        const old = this._buffer;\r\n        const currentSize = old.byteLength;\r\n        const addendum = increment ? increment : currentSize * 0.5;\r\n        const buffer = new old.constructor(currentSize + addendum);\r\n\r\n        new Uint8Array(buffer).set(new Uint8Array(old));\r\n\r\n        this._buffer = buffer;\r\n        this._view = new DataView(buffer);\r\n    }\r\n\r\n    _isOutsideBounds(increment) {\r\n        if ((this._bytesOffset + increment) > this._buffer.byteLength) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9jb21tYW5kcy1idWZmZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9jb21tYW5kcy1idWZmZXIubWpzPzE3MDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9waHlzaWNzL2RlYnVnLm1qcyc7XHJcbmltcG9ydCB7XHJcbiAgICBGTE9BVDMyX1NJWkUsIFVJTlQzMl9TSVpFLCBVSU5UMTZfU0laRSwgVUlOVDhfU0laRSxcclxuICAgIEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgQlVGRkVSX1dSSVRFX1VJTlQxNixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsIEJVRkZFUl9XUklURV9WRUMzMiwgQlVGRkVSX1dSSVRFX1VJTlQ4LFxyXG4gICAgQlVGRkVSX1JFQURfQk9PTCwgQlVGRkVSX1JFQURfRkxPQVQzMiwgQlVGRkVSX1JFQURfVUlOVDgsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UMTYsIEJVRkZFUl9SRUFEX1VJTlQzMiwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgXHJcbiAgICBCVUZGRVJfV1JJVEVfUExBTkUsXHJcbiAgICBJTlQzMl9TSVpFLFxyXG4gICAgQlVGRkVSX1JFQURfSU5UMzIsXHJcbiAgICBCVUZGRVJfV1JJVEVfSU5UMzJcclxufSBmcm9tICcuLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzJztcclxuXHJcbmNsYXNzIENvbW1hbmRzQnVmZmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xyXG4gICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgbGV0IEJ1ZmZlcjtcclxuICAgICAgICAgICAgaWYgKGNvbmZpZy51c2VTaGFyZWRBcnJheUJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgICAgQnVmZmVyID0gU2hhcmVkQXJyYXlCdWZmZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBCdWZmZXIgPSBBcnJheUJ1ZmZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBuZXcgQnVmZmVyKGNvbmZpZy5jb21tYW5kc0J1ZmZlclNpemUpO1xyXG4gICAgICAgICAgICB0aGlzLl92aWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuX2J1ZmZlcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2FsbG93R3Jvd3RoID0gY29uZmlnLmFsbG93Q29tbWFuZHNCdWZmZXJSZXNpemU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fYWxsb3dHcm93dGggPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRmlyc3QgMiBieXRlcyBhcmUgZm9yIGNvbW1hbmRzIGNvdW50LCBzbyB3ZSBzdGFydCBmcm9tIDJcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCA9IFVJTlQxNl9TSVpFO1xyXG4gICAgICAgIHRoaXMuX2NvbW1hbmRzQ291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fbWVzaEJ1ZmZlcnMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGJ1ZmZlcihiKSB7XHJcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gYjtcclxuICAgICAgICB0aGlzLl92aWV3ID0gbmV3IERhdGFWaWV3KGIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkaXJ0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGlydHk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZsYWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVhZFVpbnQ4KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbW1hbmRzQ291bnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXcuZ2V0VWludDE2KDApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtZXNoQnVmZmVycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWVzaEJ1ZmZlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVKb2x0VmVjMzIodmVjKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFgoKSk7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFkoKSk7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjLkdldFooKSk7XHJcbiAgICAgICAgaWYgKHZlYy5HZXRXKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHZlYy5HZXRXKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkVmVjKHZlYykge1xyXG4gICAgICAgIHZlYy54ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHZlYy55ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHZlYy56ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRRdWF0KHF1YXQpIHtcclxuICAgICAgICB0aGlzLnJlYWRWZWMocXVhdCk7XHJcbiAgICAgICAgcXVhdC53ID0gdGhpcy5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlnbm9yZUZsYWcoKSB7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDhfU0laRTtcclxuICAgIH1cclxuXHJcbiAgICByZXNlcnZlT2Zmc2V0KG1ldGhvZCkge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuX2J5dGVzT2Zmc2V0O1xyXG4gICAgICAgIHRoaXNbbWV0aG9kXSgwKTtcclxuICAgICAgICByZXR1cm4gb2Zmc2V0O1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlUmVzZXJ2ZWQodmFsdWUsIG9mZnNldCwgbWV0aG9kKSB7XHJcbiAgICAgICAgdGhpc1ttZXRob2RdKHZhbHVlLCBvZmZzZXQpO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICB1cGRhdGVCdWZmZXIoYnVmZmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoICE9PSBidWZmZXIuYnl0ZUxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZChtZXRob2QpIHtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KFxyXG4gICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9SRUFEX0JPT0wgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9GTE9BVDMyIHx8XHJcbiAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1JFQURfVUlOVDggfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9VSU5UMTYgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9VSU5UMzIgfHxcclxuICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfUkVBRF9JTlQzMixcclxuICAgICAgICAgICAgYEludmFsaWQgd3JpdGUgY29tbWFuZCBtZXRob2Q6ICR7IG1ldGhvZCB9YFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzW21ldGhvZF0oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdyaXRlcyB2YWx1ZSB0byBidWZmZXIuIFNraXBzIGZsYWcgZm9yIHVpbnQ4IHZhbHVlcy5cclxuICAgICAqL1xyXG4gICAgd3JpdGUodmFsdWUsIG1ldGhvZCwgYWRkRmxhZyA9IHRydWUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1dSSVRFX0JPT0wgfHwgXHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9GTE9BVDMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9VSU5UOCB8fFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfV1JJVEVfVUlOVDE2IHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9VSU5UMzIgfHxcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9PT0gQlVGRkVSX1dSSVRFX0lOVDMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9WRUMzMiB8fFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kID09PSBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyIHx8XHJcbiAgICAgICAgICAgICAgICBtZXRob2QgPT09IEJVRkZFUl9XUklURV9QTEFORSxcclxuICAgICAgICAgICAgICAgIGBJbnZhbGlkIHdyaXRlIGNvbW1hbmQgbWV0aG9kOiAkeyBtZXRob2QgfWBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVVaW50OCgwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoYWRkRmxhZykgdGhpcy53cml0ZVVpbnQ4KDEpO1xyXG4gICAgICAgICAgICB0aGlzW21ldGhvZF0odmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkQ29tbWFuZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWFkVWludDgoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbW1hbmQgTnVtYmVyIGluIFswLTI1NV0gcmFuZ2Ugc3BlY2lmeWluZyBhIGNvbW1hbmQgdmFyaWFudCBmb3IgYmFja2VuZFxyXG4gICAgICovXHJcbiAgICB3cml0ZUNvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgIHRoaXMuX2luY3JlbWVudCgpO1xyXG4gICAgICAgIHRoaXMud3JpdGVVaW50OChjb21tYW5kKTtcclxuICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZE9wZXJhdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRVaW50OCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlT3BlcmF0b3Iob3BlcmF0b3IpIHtcclxuICAgICAgICB0aGlzLndyaXRlVWludDgob3BlcmF0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmVjdG9yMzIodmVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjdG9yLngpO1xyXG4gICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHZlY3Rvci55KTtcclxuICAgICAgICB0aGlzLndyaXRlRmxvYXQzMih2ZWN0b3Iueik7XHJcbiAgICAgICAgaWYgKHZlY3Rvci53ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZUZsb2F0MzIodmVjdG9yLncpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkRmxvYXQzMigpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmIHRoaXMuX2lzT3V0c2lkZUJvdW5kcyhGTE9BVDMyX1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldEZsb2F0MzIodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja0Zsb2F0KHZhbHVlLCBgR290IGludmFsaWQgdmFsdWUgZnJvbSBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSBGTE9BVDMyX1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlRmxvYXQzMih2YWx1ZSwgb2Zmc2V0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jYW5Xcml0ZShGTE9BVDMyX1NJWkUpKSByZXR1cm47XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrRmxvYXQodmFsdWUsIGBUcnlpbmcgdG8gd3JpdGUgaW52YWxpZCB2YWx1ZSB0byBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRGbG9hdDMyKHRoaXMuX2J5dGVzT2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IEZMT0FUMzJfU0laRTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoID49IChvZmZzZXQgKyBGTE9BVDMyX1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRGbG9hdDMyKG9mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkVWludDgoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDhfU0laRSkpIHtcclxuICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogQWJvcnRpbmcgcmVhZCBvdXRzaWRlIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3ZpZXcuZ2V0VWludDgodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1VpbnQodmFsdWUsIGBHb3QgaW52YWxpZCB2YWx1ZSBmcm9tIGJ1ZmZlcjogJHsgdmFsdWUgfWApO1xyXG4gICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IFVJTlQ4X1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlVWludDgodmFsdWUsIG9mZnNldCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoVUlOVDhfU0laRSkpIHJldHVybjtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuY2hlY2tVaW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDgodGhpcy5fYnl0ZXNPZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDhfU0laRTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuYXNzZXJ0KHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoID49IChvZmZzZXQgKyBVSU5UOF9TSVpFKSwgJ1RyeWluZyB0byB3cml0ZSBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDgob2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlYWRVaW50MTYoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDE2X1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldFVpbnQxNih0aGlzLl9ieXRlc09mZnNldCk7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDE2X1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHdyaXRlVWludDE2KHZhbHVlLCBvZmZzZXQpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2NhbldyaXRlKFVJTlQxNl9TSVpFKSkgcmV0dXJuO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1VpbnQodmFsdWUsIGBUcnlpbmcgdG8gd3JpdGUgaW52YWxpZCB2YWx1ZSB0byBidWZmZXI6ICR7IHZhbHVlIH1gKTtcclxuICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYodGhpcy5fYnl0ZXNPZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDE2X1NJWkU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmFzc2VydCh0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCA+PSAob2Zmc2V0ICsgVUlOVDE2X1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYob2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlYWRVaW50MzIoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoVUlOVDMyX1NJWkUpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdDb21tYW5kcyBCdWZmZXI6IEFib3J0aW5nIHJlYWQgb3V0c2lkZSBidWZmZXIgYm91bmRzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92aWV3LmdldFVpbnQzMih0aGlzLl9ieXRlc09mZnNldCk7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gVUlOVDMyX1NJWkU7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVWludDMyKHZhbHVlLCBvZmZzZXQpIHtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuY2hlY2tVaW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoVUlOVDMyX1NJWkUpKSByZXR1cm47XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDMyKHRoaXMuX2J5dGVzT2Zmc2V0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzT2Zmc2V0ICs9IFVJTlQzMl9TSVpFO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5hc3NlcnQodGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGggPj0gKG9mZnNldCArIFVJTlQzMl9TSVpFKSwgJ1RyeWluZyB0byB3cml0ZSBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZXcuc2V0VWludDMyKG9mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWFkSW50MzIoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiB0aGlzLl9pc091dHNpZGVCb3VuZHMoSU5UMzJfU0laRSkpIHtcclxuICAgICAgICAgICAgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogQWJvcnRpbmcgcmVhZCBvdXRzaWRlIGJ1ZmZlciBib3VuZHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3ZpZXcuZ2V0SW50MzIodGhpcy5fYnl0ZXNPZmZzZXQpO1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja0ludCh2YWx1ZSwgYEdvdCBpbnZhbGlkIHZhbHVlIGZyb20gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgdGhpcy5fYnl0ZXNPZmZzZXQgKz0gSU5UMzJfU0laRTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KSB7XHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrSW50KHZhbHVlLCBgVHJ5aW5nIHRvIHdyaXRlIGludmFsaWQgdmFsdWUgdG8gYnVmZmVyOiAkeyB2YWx1ZSB9YCk7XHJcbiAgICAgICAgaWYgKG9mZnNldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuV3JpdGUoSU5UMzJfU0laRSkpIHJldHVybjtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRJbnQzMih0aGlzLl9ieXRlc09mZnNldCwgdmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSBJTlQzMl9TSVpFO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5hc3NlcnQodGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGggPj0gKG9mZnNldCArIElOVDMyX1NJWkUpLCAnVHJ5aW5nIHRvIHdyaXRlIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcy4nKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5zZXRJbnQzMihvZmZzZXQsIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9ICAgIFxyXG5cclxuICAgIHJlYWRCb29sKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRVaW50OCgpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlIFxyXG4gICAgICovXHJcbiAgICB3cml0ZUJvb2wodmFsdWUpIHtcclxuICAgICAgICB0aGlzLndyaXRlVWludDgodmFsdWUgPyAxIDogMCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVQbGFuZShwbGFuZSkge1xyXG4gICAgICAgIHRoaXMud3JpdGVWZWN0b3IzMihwbGFuZS5ub3JtYWwpO1xyXG4gICAgICAgIHRoaXMud3JpdGVGbG9hdDMyKHBsYW5lLmRpc3RhbmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRCdWZmZXIoYnVmZmVyKSB7XHJcbiAgICAgICAgdGhpcy5fbWVzaEJ1ZmZlcnMucHVzaChidWZmZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNraXAoYnl0ZXMsIHNpemUpIHtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCArPSAoYnl0ZXMgKiBzaXplKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICB0aGlzLl9jb21tYW5kc0NvdW50ID0gMDtcclxuICAgICAgICB0aGlzLl9ieXRlc09mZnNldCA9IFVJTlQxNl9TSVpFO1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl92aWV3ID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9idWZmZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIF9pbmNyZW1lbnQoKSB7XHJcbiAgICAgICAgdGhpcy5fdmlldy5zZXRVaW50MTYoMCwgKyt0aGlzLl9jb21tYW5kc0NvdW50KTtcclxuICAgIH1cclxuXHJcbiAgICBfY2FuV3JpdGUoaW5jcmVtZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzT3V0c2lkZUJvdW5kcyhpbmNyZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9hbGxvd0dyb3d0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzaXplKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcud2Fybk9uY2UoJ0NvbW1hbmRzIEJ1ZmZlcjogcmVhY2hlZCBjYXBhY2l0eSBsaW1pdHMuIE5vdCBhbGxvd2VkIHRvIGdyb3cuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgJyBDb25zaWRlciB1c2luZyBcImFsbG93Q29tbWFuZHNCdWZmZXJSZXNpemVcIiBvcHRpb24gb3IgYWxsb2NhdGUgYSBsYXJnZXIgYnVmZmVyJyArXHJcbiAgICAgICAgICAgICAgICAgICAgJyB1c2luZyBcImNvbW1hbmRzQnVmZmVyU2l6ZVwiLiBDdXJyZW50IGJ1ZmZlcicgK1xyXG4gICAgICAgICAgICAgICAgICAgICcgc2l6ZSAoYnl0ZXMpOicsIHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3Jlc2l6ZShpbmNyZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBvbGQgPSB0aGlzLl9idWZmZXI7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFNpemUgPSBvbGQuYnl0ZUxlbmd0aDtcclxuICAgICAgICBjb25zdCBhZGRlbmR1bSA9IGluY3JlbWVudCA/IGluY3JlbWVudCA6IGN1cnJlbnRTaXplICogMC41O1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBvbGQuY29uc3RydWN0b3IoY3VycmVudFNpemUgKyBhZGRlbmR1bSk7XHJcblxyXG4gICAgICAgIG5ldyBVaW50OEFycmF5KGJ1ZmZlcikuc2V0KG5ldyBVaW50OEFycmF5KG9sZCkpO1xyXG5cclxuICAgICAgICB0aGlzLl9idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgdGhpcy5fdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIF9pc091dHNpZGVCb3VuZHMoaW5jcmVtZW50KSB7XHJcbiAgICAgICAgaWYgKCh0aGlzLl9ieXRlc09mZnNldCArIGluY3JlbWVudCkgPiB0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBDb21tYW5kc0J1ZmZlciB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/commands-buffer.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/motion-state.mjs":
/*!********************************************!*\
  !*** ./src/backends/jolt/motion-state.mjs ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MotionState: () => (/* binding */ MotionState)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\nconst v1 = { x: 0, y: 0, z: 0 };\r\nconst q1 = { x: 0, y: 0, z: 0, w: 1 };\r\nconst q2 = { x: 0, y: 0, z: 0, w: 1 };\r\n\r\nclass MotionState {\r\n    constructor(body) {\r\n        this._body = body;\r\n\r\n        this._updatePosition(body);\r\n        this._updateRotation(body);\r\n    }\r\n\r\n    compute(alpha, stepped) {\r\n        const body = this._body;\r\n        const position = this._position;\r\n        const op = this._oldPos;\r\n        const cp = this._currentPos;\r\n        \r\n        try {\r\n            if (stepped) {\r\n                const bp = body.GetPosition();\r\n                op.x = cp.x; op.y = cp.y; op.z = cp.z;\r\n                cp.x = bp.GetX(); cp.y = bp.GetY(); cp.z = bp.GetZ();\r\n            }\r\n\r\n            v1.x = cp.x * alpha;\r\n            v1.y = cp.y * alpha;\r\n            v1.z = cp.z * alpha;\r\n\r\n            position.x = v1.x;\r\n            position.y = v1.y;\r\n            position.z = v1.z;\r\n\r\n            v1.x = op.x * (1 - alpha);\r\n            v1.y = op.y * (1 - alpha);\r\n            v1.z = op.z * (1 - alpha);\r\n\r\n            position.x += v1.x;\r\n            position.y += v1.y;\r\n            position.z += v1.z;\r\n\r\n            if (!body.isCharacter) {\r\n                const r = this._rotation;\r\n                const cr = this._currentRot;\r\n                const or = this._oldRot;\r\n\r\n                if (stepped) {\r\n                    const br = body.GetRotation();\r\n                    or.x = cr.x; or.y = cr.y; or.z = cr.z; or.w = cr.w;\r\n                    cr.x = br.GetX(); cr.y = br.GetY(); cr.z = br.GetZ(); cr.w = br.GetW();\r\n                }\r\n\r\n                let q2x = cr.x;\r\n                let q2y = cr.y;\r\n                let q2z = cr.z;\r\n                let q2w = cr.w;\r\n\r\n                let dot = r.x * q2x + r.y * q2y + r.z * q2z + r.w * q2w;\r\n                if (dot < 0) {\r\n                    q2x = -q2x;\r\n                    q2y = -q2y;\r\n                    q2z = -q2z;\r\n                    q2w = -q2w;\r\n                    dot = -dot;\r\n                }\r\n\r\n                const theta = Math.acos(dot);\r\n                if (theta > 0.0001) {\r\n                    const invst = 1 / Math.sin(theta);\r\n                    const c0 = Math.sin((1 - alpha) * theta) * invst;\r\n                    const c1 = Math.sin(alpha * theta) * invst;\r\n                    r.x = c0 * or.x + c1 * q2x;\r\n                    r.y = c0 * or.y + c1 * q2y;\r\n                    r.z = c0 * or.z + c1 * q2z;\r\n                    r.w = c0 * or.w + c1 * q2w;\r\n                } else {\r\n                    r.x = r.x;\r\n                    r.y = r.y;\r\n                    r.z = r.z;\r\n                    r.w = r.w;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    get position() {\r\n        return this._position;\r\n    }\r\n\r\n    get rotation() {\r\n        return this._rotation;\r\n    }\r\n\r\n    _updatePosition(body) {\r\n        const bodyPos = body.GetPosition();\r\n        const p = { x: bodyPos.GetX(), y: bodyPos.GetY(), z: bodyPos.GetZ() };\r\n\r\n        this._position = p;\r\n        this._currentPos = { x: p.x, y: p.y, z: p.z };\r\n        this._oldPos = { x: p.x, y: p.y, z: p.z };\r\n    }\r\n\r\n    _updateRotation(body) {\r\n        const bodyRot = body.GetRotation();\r\n        const r = { x: bodyRot.GetX(), y: bodyRot.GetY(), z: bodyRot.GetZ(), w: bodyRot.GetW() };\r\n\r\n        this._rotation = r;\r\n        this._currentRot = { x: r.x, y: r.y, z: r.z, w: r.w };\r\n        this._oldRot = { x: r.x, y: r.y, z: r.z, w: r.w };\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9tb3Rpb24tc3RhdGUubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvbW90aW9uLXN0YXRlLm1qcz8xODU0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcblxyXG5jb25zdCB2MSA9IHsgeDogMCwgeTogMCwgejogMCB9O1xyXG5jb25zdCBxMSA9IHsgeDogMCwgeTogMCwgejogMCwgdzogMSB9O1xyXG5jb25zdCBxMiA9IHsgeDogMCwgeTogMCwgejogMCwgdzogMSB9O1xyXG5cclxuY2xhc3MgTW90aW9uU3RhdGUge1xyXG4gICAgY29uc3RydWN0b3IoYm9keSkge1xyXG4gICAgICAgIHRoaXMuX2JvZHkgPSBib2R5O1xyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGVQb3NpdGlvbihib2R5KTtcclxuICAgICAgICB0aGlzLl91cGRhdGVSb3RhdGlvbihib2R5KTtcclxuICAgIH1cclxuXHJcbiAgICBjb21wdXRlKGFscGhhLCBzdGVwcGVkKSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHRoaXMuX2JvZHk7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbjtcclxuICAgICAgICBjb25zdCBvcCA9IHRoaXMuX29sZFBvcztcclxuICAgICAgICBjb25zdCBjcCA9IHRoaXMuX2N1cnJlbnRQb3M7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHN0ZXBwZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJwID0gYm9keS5HZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgb3AueCA9IGNwLng7IG9wLnkgPSBjcC55OyBvcC56ID0gY3AuejtcclxuICAgICAgICAgICAgICAgIGNwLnggPSBicC5HZXRYKCk7IGNwLnkgPSBicC5HZXRZKCk7IGNwLnogPSBicC5HZXRaKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHYxLnggPSBjcC54ICogYWxwaGE7XHJcbiAgICAgICAgICAgIHYxLnkgPSBjcC55ICogYWxwaGE7XHJcbiAgICAgICAgICAgIHYxLnogPSBjcC56ICogYWxwaGE7XHJcblxyXG4gICAgICAgICAgICBwb3NpdGlvbi54ID0gdjEueDtcclxuICAgICAgICAgICAgcG9zaXRpb24ueSA9IHYxLnk7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uLnogPSB2MS56O1xyXG5cclxuICAgICAgICAgICAgdjEueCA9IG9wLnggKiAoMSAtIGFscGhhKTtcclxuICAgICAgICAgICAgdjEueSA9IG9wLnkgKiAoMSAtIGFscGhhKTtcclxuICAgICAgICAgICAgdjEueiA9IG9wLnogKiAoMSAtIGFscGhhKTtcclxuXHJcbiAgICAgICAgICAgIHBvc2l0aW9uLnggKz0gdjEueDtcclxuICAgICAgICAgICAgcG9zaXRpb24ueSArPSB2MS55O1xyXG4gICAgICAgICAgICBwb3NpdGlvbi56ICs9IHYxLno7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWJvZHkuaXNDaGFyYWN0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLl9yb3RhdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNyID0gdGhpcy5fY3VycmVudFJvdDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9yID0gdGhpcy5fb2xkUm90O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGVwcGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnIgPSBib2R5LkdldFJvdGF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3IueCA9IGNyLng7IG9yLnkgPSBjci55OyBvci56ID0gY3Iuejsgb3IudyA9IGNyLnc7XHJcbiAgICAgICAgICAgICAgICAgICAgY3IueCA9IGJyLkdldFgoKTsgY3IueSA9IGJyLkdldFkoKTsgY3IueiA9IGJyLkdldFooKTsgY3IudyA9IGJyLkdldFcoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgcTJ4ID0gY3IueDtcclxuICAgICAgICAgICAgICAgIGxldCBxMnkgPSBjci55O1xyXG4gICAgICAgICAgICAgICAgbGV0IHEyeiA9IGNyLno7XHJcbiAgICAgICAgICAgICAgICBsZXQgcTJ3ID0gY3IudztcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZG90ID0gci54ICogcTJ4ICsgci55ICogcTJ5ICsgci56ICogcTJ6ICsgci53ICogcTJ3O1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvdCA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBxMnggPSAtcTJ4O1xyXG4gICAgICAgICAgICAgICAgICAgIHEyeSA9IC1xMnk7XHJcbiAgICAgICAgICAgICAgICAgICAgcTJ6ID0gLXEyejtcclxuICAgICAgICAgICAgICAgICAgICBxMncgPSAtcTJ3O1xyXG4gICAgICAgICAgICAgICAgICAgIGRvdCA9IC1kb3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdGhldGEgPSBNYXRoLmFjb3MoZG90KTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGV0YSA+IDAuMDAwMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGludnN0ID0gMSAvIE1hdGguc2luKHRoZXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjMCA9IE1hdGguc2luKCgxIC0gYWxwaGEpICogdGhldGEpICogaW52c3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYzEgPSBNYXRoLnNpbihhbHBoYSAqIHRoZXRhKSAqIGludnN0O1xyXG4gICAgICAgICAgICAgICAgICAgIHIueCA9IGMwICogb3IueCArIGMxICogcTJ4O1xyXG4gICAgICAgICAgICAgICAgICAgIHIueSA9IGMwICogb3IueSArIGMxICogcTJ5O1xyXG4gICAgICAgICAgICAgICAgICAgIHIueiA9IGMwICogb3IueiArIGMxICogcTJ6O1xyXG4gICAgICAgICAgICAgICAgICAgIHIudyA9IGMwICogb3IudyArIGMxICogcTJ3O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByLnggPSByLng7XHJcbiAgICAgICAgICAgICAgICAgICAgci55ID0gci55O1xyXG4gICAgICAgICAgICAgICAgICAgIHIueiA9IHIuejtcclxuICAgICAgICAgICAgICAgICAgICByLncgPSByLnc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHBvc2l0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcm90YXRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JvdGF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIF91cGRhdGVQb3NpdGlvbihib2R5KSB7XHJcbiAgICAgICAgY29uc3QgYm9keVBvcyA9IGJvZHkuR2V0UG9zaXRpb24oKTtcclxuICAgICAgICBjb25zdCBwID0geyB4OiBib2R5UG9zLkdldFgoKSwgeTogYm9keVBvcy5HZXRZKCksIHo6IGJvZHlQb3MuR2V0WigpIH07XHJcblxyXG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcDtcclxuICAgICAgICB0aGlzLl9jdXJyZW50UG9zID0geyB4OiBwLngsIHk6IHAueSwgejogcC56IH07XHJcbiAgICAgICAgdGhpcy5fb2xkUG9zID0geyB4OiBwLngsIHk6IHAueSwgejogcC56IH07XHJcbiAgICB9XHJcblxyXG4gICAgX3VwZGF0ZVJvdGF0aW9uKGJvZHkpIHtcclxuICAgICAgICBjb25zdCBib2R5Um90ID0gYm9keS5HZXRSb3RhdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IHIgPSB7IHg6IGJvZHlSb3QuR2V0WCgpLCB5OiBib2R5Um90LkdldFkoKSwgejogYm9keVJvdC5HZXRaKCksIHc6IGJvZHlSb3QuR2V0VygpIH07XHJcblxyXG4gICAgICAgIHRoaXMuX3JvdGF0aW9uID0gcjtcclxuICAgICAgICB0aGlzLl9jdXJyZW50Um90ID0geyB4OiByLngsIHk6IHIueSwgejogci56LCB3OiByLncgfTtcclxuICAgICAgICB0aGlzLl9vbGRSb3QgPSB7IHg6IHIueCwgeTogci55LCB6OiByLnosIHc6IHIudyB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBNb3Rpb25TdGF0ZSB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/motion-state.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/cleaner.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/cleaner.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Cleaner: () => (/* binding */ Cleaner)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Cleaner {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n    }\r\n\r\n    clean() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_DESTROY_BODY:\r\n                ok = this._destroyBody(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_DESTROY_SHAPE:\r\n                ok = this._destroyShape(cb);\r\n                break;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        this._backend = null;\r\n    }\r\n\r\n    _destroyBody(cb) {\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const bodyInterface = backend.bodyInterface;\r\n        const physicsSystem = backend.physicsSystem;\r\n\r\n        const body = tracker.getBodyByPCID(index);\r\n\r\n        if (!body) {\r\n            // Body could have been destroyed already. For example:\r\n            // Disable parent, then manually disable child. The body\r\n            // would get destroyed when parent was disabled. The\r\n            // command for destroy would be issued again, when child is\r\n            // disabled.\r\n            return true;\r\n        }\r\n\r\n        if (body.debugDrawData) {\r\n            Jolt.destroy(body.triContext);\r\n            body.triContext = null;\r\n            body.debugDrawData = null;\r\n        }\r\n\r\n        tracker.stopTrackingBody(body);\r\n\r\n        if (body.motionState) {\r\n            body.motionState = null;\r\n        }\r\n\r\n        const constraints = body.constraints;\r\n        if (constraints) {\r\n            const constraintMap = tracker.constraintMap;\r\n            for (let i = 0, end = constraints.length; i < end; i++) {\r\n                const index = constraints[i];\r\n                const data = constraintMap.get(index);\r\n                const constraint = data.constraint;\r\n                const listener = constraint.listener; // vehicle\r\n                \r\n                constraintMap.delete(index);\r\n                if (listener && Jolt.getPointer(listener) !== 0) {\r\n                    physicsSystem.RemoveStepListener(listener);\r\n                    Jolt.destroy(listener);\r\n                    constraint.listener = null;\r\n                }\r\n                if (Jolt.getPointer(constraint) !== 0) {\r\n                    physicsSystem.RemoveConstraint(constraint);\r\n                }\r\n            }\r\n            body.constraints = null;\r\n\r\n            body.linked?.forEach(linkedBody => {\r\n                if (Jolt.getPointer(linkedBody) !== 0) {\r\n                    bodyInterface.ActivateBody(linkedBody.GetID());\r\n                }\r\n                linkedBody.linked.delete(body);\r\n            });\r\n            body.linked = null;\r\n        }\r\n\r\n        const id = body.GetID();\r\n        bodyInterface.RemoveBody(id);\r\n        bodyInterface.DestroyBody(id);\r\n\r\n        return true;\r\n    }\r\n\r\n    _destroyShape(cb) {\r\n        const tracker = this._backend.tracker;\r\n        const shapeNumber = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const shape = tracker.shapeMap.get(shapeNumber);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !shape) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn('Trying to destroy a shape that has already been destroyed');\r\n            return false;\r\n        }\r\n\r\n        Jolt.destroy(shape);\r\n\r\n        tracker.shapeMap.delete(shapeNumber);\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvY2xlYW5lci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9iYWNrZW5kcy9qb2x0L29wZXJhdG9ycy9jbGVhbmVyLm1qcz9jMzk0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJVRkZFUl9SRUFEX1VJTlQzMiwgQ01EX0RFU1RST1lfQk9EWSwgQ01EX0RFU1RST1lfU0hBUEUgfSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY2xhc3MgQ2xlYW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IGJhY2tlbmQ7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYW4oKSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9iYWNrZW5kLmluQnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjYi5yZWFkQ29tbWFuZCgpO1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICBjYXNlIENNRF9ERVNUUk9ZX0JPRFk6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2Rlc3Ryb3lCb2R5KGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfREVTVFJPWV9TSEFQRTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fZGVzdHJveVNoYXBlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgX2Rlc3Ryb3lCb2R5KGNiKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBib2R5SW50ZXJmYWNlID0gYmFja2VuZC5ib2R5SW50ZXJmYWNlO1xyXG4gICAgICAgIGNvbnN0IHBoeXNpY3NTeXN0ZW0gPSBiYWNrZW5kLnBoeXNpY3NTeXN0ZW07XHJcblxyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG5cclxuICAgICAgICBpZiAoIWJvZHkpIHtcclxuICAgICAgICAgICAgLy8gQm9keSBjb3VsZCBoYXZlIGJlZW4gZGVzdHJveWVkIGFscmVhZHkuIEZvciBleGFtcGxlOlxyXG4gICAgICAgICAgICAvLyBEaXNhYmxlIHBhcmVudCwgdGhlbiBtYW51YWxseSBkaXNhYmxlIGNoaWxkLiBUaGUgYm9keVxyXG4gICAgICAgICAgICAvLyB3b3VsZCBnZXQgZGVzdHJveWVkIHdoZW4gcGFyZW50IHdhcyBkaXNhYmxlZC4gVGhlXHJcbiAgICAgICAgICAgIC8vIGNvbW1hbmQgZm9yIGRlc3Ryb3kgd291bGQgYmUgaXNzdWVkIGFnYWluLCB3aGVuIGNoaWxkIGlzXHJcbiAgICAgICAgICAgIC8vIGRpc2FibGVkLlxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChib2R5LmRlYnVnRHJhd0RhdGEpIHtcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KGJvZHkudHJpQ29udGV4dCk7XHJcbiAgICAgICAgICAgIGJvZHkudHJpQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgIGJvZHkuZGVidWdEcmF3RGF0YSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cmFja2VyLnN0b3BUcmFja2luZ0JvZHkoYm9keSk7XHJcblxyXG4gICAgICAgIGlmIChib2R5Lm1vdGlvblN0YXRlKSB7XHJcbiAgICAgICAgICAgIGJvZHkubW90aW9uU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29uc3RyYWludHMgPSBib2R5LmNvbnN0cmFpbnRzO1xyXG4gICAgICAgIGlmIChjb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zdHJhaW50TWFwID0gdHJhY2tlci5jb25zdHJhaW50TWFwO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gY29uc3RyYWludHMubGVuZ3RoOyBpIDwgZW5kOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29uc3RyYWludHNbaV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gY29uc3RyYWludE1hcC5nZXQoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29uc3RyYWludCA9IGRhdGEuY29uc3RyYWludDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVyID0gY29uc3RyYWludC5saXN0ZW5lcjsgLy8gdmVoaWNsZVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50TWFwLmRlbGV0ZShpbmRleCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIgJiYgSm9sdC5nZXRQb2ludGVyKGxpc3RlbmVyKSAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBoeXNpY3NTeXN0ZW0uUmVtb3ZlU3RlcExpc3RlbmVyKGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kobGlzdGVuZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnQubGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihjb25zdHJhaW50KSAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBoeXNpY3NTeXN0ZW0uUmVtb3ZlQ29uc3RyYWludChjb25zdHJhaW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBib2R5LmNvbnN0cmFpbnRzID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGJvZHkubGlua2VkPy5mb3JFYWNoKGxpbmtlZEJvZHkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihsaW5rZWRCb2R5KSAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHlJbnRlcmZhY2UuQWN0aXZhdGVCb2R5KGxpbmtlZEJvZHkuR2V0SUQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsaW5rZWRCb2R5LmxpbmtlZC5kZWxldGUoYm9keSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBib2R5LmxpbmtlZCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBpZCA9IGJvZHkuR2V0SUQoKTtcclxuICAgICAgICBib2R5SW50ZXJmYWNlLlJlbW92ZUJvZHkoaWQpO1xyXG4gICAgICAgIGJvZHlJbnRlcmZhY2UuRGVzdHJveUJvZHkoaWQpO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfZGVzdHJveVNoYXBlKGNiKSB7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX2JhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBzaGFwZU51bWJlciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBzaGFwZSA9IHRyYWNrZXIuc2hhcGVNYXAuZ2V0KHNoYXBlTnVtYmVyKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhc2hhcGUpIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignVHJ5aW5nIHRvIGRlc3Ryb3kgYSBzaGFwZSB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gZGVzdHJveWVkJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveShzaGFwZSk7XHJcblxyXG4gICAgICAgIHRyYWNrZXIuc2hhcGVNYXAuZGVsZXRlKHNoYXBlTnVtYmVyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IENsZWFuZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/cleaner.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/creator.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/creator.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Creator: () => (/* binding */ Creator)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../motion-state.mjs */ \"./src/backends/jolt/motion-state.mjs\");\n\r\n\r\n\r\n\r\nclass Creator {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n\r\n        this.createPhysicsSystem();\r\n\r\n        this._joltVec3 = new Jolt.Vec3();\r\n        this._joltVec3_2 = new Jolt.Vec3();\r\n        this._joltQuat = new Jolt.Quat();\r\n    }\r\n\r\n    create(meshBuffers) {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_BODY:\r\n                ok = this._createBody(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_SOFT_BODY:\r\n                ok = this._createSoftBody(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_GROUPS:\r\n                ok = this._createGroups(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_CONSTRAINT:\r\n                ok = this._createConstraint(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_CHAR:\r\n                ok = this._createCharacter(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_SHAPE:\r\n                ok = this._createShape(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CREATE_VEHICLE:\r\n                ok = this._createVehicle(cb);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Invalid command: ${ command }`);\r\n                return false;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    createPhysicsSystem() {\r\n        const backend = this._backend;\r\n        const config = backend.config;\r\n        const layerPairs = config.layerPairs;\r\n        const layers = config.layers;\r\n        const layersCount = layers.length;\r\n\r\n        const objectFilter = new Jolt.ObjectLayerPairFilterTable(layersCount);\r\n        for (let i = 0; i < layersCount; i++) {\r\n            const pair = layerPairs[i];\r\n            objectFilter.EnableCollision(pair[0], pair[1]);\r\n        }\r\n\r\n        const bpInterface = new Jolt.BroadPhaseLayerInterfaceTable(layersCount, layersCount);\r\n        for (let i = 0; i < layersCount; i++) {\r\n            const objLayer = layers[i];\r\n            const bpLayer = new Jolt.BroadPhaseLayer(objLayer);\r\n            bpInterface.MapObjectToBroadPhaseLayer(objLayer, bpLayer);\r\n        }\r\n\r\n        const settings = new Jolt.JoltSettings();\r\n        settings.mObjectLayerPairFilter = objectFilter;\r\n        settings.mBroadPhaseLayerInterface = bpInterface;\r\n        settings.mObjectVsBroadPhaseLayerFilter = new Jolt.ObjectVsBroadPhaseLayerFilterTable(settings.mBroadPhaseLayerInterface, layersCount, settings.mObjectLayerPairFilter, layersCount);\r\n        const joltInterface = new Jolt.JoltInterface(settings);\r\n        Jolt.destroy(settings);\r\n\r\n        const physicsSystem = joltInterface.GetPhysicsSystem();\r\n        const systemSettings = physicsSystem.GetPhysicsSettings();\r\n        \r\n        systemSettings.mBaumgarte = config.baumgarte;\r\n        systemSettings.mBodyPairCacheCosMaxDeltaRotationDiv2 = config.bodyPairCacheCosMaxDeltaRotationDiv2;\r\n        systemSettings.mBodyPairCacheMaxDeltaPositionSq = config.bodyPairCacheMaxDeltaPositionSq;\r\n        systemSettings.mContactNormalCosMaxDeltaRotation = config.contactNormalCosMaxDeltaRotation;\r\n        systemSettings.mContactPointPreserveLambdaMaxDistSq = config.contactPointPreserveLambdaMaxDistSq;\r\n        systemSettings.mDeterministicSimulation = config.deterministicSimulation;\r\n        systemSettings.mLinearCastMaxPenetration = config.linearCastMaxPenetration;\r\n        systemSettings.mLinearCastThreshold = config.linearCastThreshold;\r\n        systemSettings.mManifoldToleranceSq = config.manifoldToleranceSq;\r\n        systemSettings.mMaxInFlightBodyPairs = config.maxInFlightBodyPairs;\r\n        systemSettings.mMaxPenetrationDistance = config.maxPenetrationDistance;\r\n        systemSettings.mMinVelocityForRestitution = config.minVelocityForRestitution;\r\n        systemSettings.mNumPositionSteps = config.numPositionSteps;\r\n        systemSettings.mNumVelocitySteps = config.numVelocitySteps;\r\n        systemSettings.mPenetrationSlop = config.penetrationSlop;\r\n        systemSettings.mPointVelocitySleepThreshold = config.pointVelocitySleepThreshold;\r\n        systemSettings.mSpeculativeContactDistance = config.speculativeContactDistance;\r\n        systemSettings.mStepListenerBatchesPerJob = config.stepListenerBatchesPerJob;\r\n        systemSettings.mStepListenersBatchSize = config.stepListenersBatchSize;\r\n        systemSettings.mTimeBeforeSleep = config.timeBeforeSleep;\r\n\r\n        systemSettings.mConstraintWarmStart = config.constraintWarmStart;\r\n        systemSettings.mUseBodyPairContactCache = config.useBodyPairContactCache;\r\n        systemSettings.mUseManifoldReduction = config.useManifoldReduction;\r\n        systemSettings.mUseLargeIslandSplitter = config.useLargeIslandSplitter;\r\n        systemSettings.mAllowSleeping = config.allowSleeping;\r\n        systemSettings.mCheckActiveEdges = config.checkActiveEdges;\r\n\r\n        physicsSystem.SetPhysicsSettings(systemSettings);\r\n        \r\n        backend.joltInterface = joltInterface;\r\n        backend.physicsSystem = physicsSystem;\r\n\r\n        backend.bpFilter = new Jolt.DefaultBroadPhaseLayerFilter(joltInterface.GetObjectVsBroadPhaseLayerFilter(), 1);\r\n        backend.objFilter = new Jolt.DefaultObjectLayerFilter(joltInterface.GetObjectLayerPairFilter(), 1);\r\n        backend.bodyFilter = new Jolt.BodyFilter();\r\n        backend.shapeFilter = new Jolt.ShapeFilter();\r\n        backend.bodyList = new Jolt.BodyIDVector();\r\n    }\r\n\r\n    createShapeSettings(shape, ...attr) {\r\n        switch (shape) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_BOX:\r\n                return new Jolt.BoxShapeSettings(attr[0] /* half extent */, attr[1] /* convex radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_SPHERE:\r\n                return new Jolt.SphereShapeSettings(attr[0] /* radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CAPSULE:\r\n                return new Jolt.CapsuleShapeSettings(attr[0] /* half height */, attr[1] /* radius */);\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CYLINDER:\r\n                return new Jolt.CylinderShapeSettings(attr[0] /* half height */, attr[1] /* radius */, attr[2] /* convex radius */);\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warnOnce(`Unrecognized shape: ${ shape }`);\r\n                return null;\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        Jolt.destroy(this._joltVec3);\r\n        Jolt.destroy(this._joltQuat);\r\n    }\r\n\r\n    // TODO\r\n    // convert creation methods to static\r\n\r\n    _createShape(cb, meshBuffers) {\r\n        // shape number\r\n        const num = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, meshBuffers);\r\n        if (!shapeSettings)\r\n            return false;\r\n\r\n        const shape = shapeSettings.Create().Get();\r\n\r\n        this._backend.tracker.shapeMap.set(num, shape);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createBody(cb, meshBuffers) {\r\n        const backend = this._backend;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n\r\n        // ------------ SHAPE PROPS ----------------\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, meshBuffers);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n        \r\n        const shape = shapeSettings.Create().Get();\r\n\r\n        // ------------ BODY PROPS ----------------\r\n\r\n        // PCID\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        // position\r\n        jv.FromBuffer(cb);\r\n\r\n        // rotation\r\n        jq.FromBuffer(cb);\r\n\r\n        // motion type\r\n        const motionType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        // use motion state\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        // object layer\r\n        const layer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const objectLayer = backend.getBitValue(layer);\r\n        const bodyCreationSettings = new Jolt.BodyCreationSettings(shape, jv, jq, motionType, objectLayer);\r\n\r\n        bodyCreationSettings.mLinearVelocity = jv.FromBuffer(cb);\r\n        bodyCreationSettings.mAngularVelocity = jv.FromBuffer(cb);\r\n        bodyCreationSettings.mMaxLinearVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mMaxAngularVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mRestitution = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mLinearDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mGravityFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mInertiaMultiplier = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        bodyCreationSettings.mAllowedDOFs = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        bodyCreationSettings.mAllowDynamicOrKinematic = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mIsSensor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        bodyCreationSettings.mMotionQuality = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        bodyCreationSettings.mAllowSleeping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        \r\n        // collision group\r\n        const group = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // collision sub group\r\n        const subGroup = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // debug draw\r\n        const debugDraw = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n\r\n        if (group !== null && subGroup !== null) {\r\n            const table = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(group, `Invalid filter group: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(subGroup, `Invalid filter group: ${ subGroup }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!table, `Trying to set a filter group that does not exist: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((subGroup <= table?.maxIndex), `Trying to set sub group that is over the filter group table size: ${ subGroup }`);\r\n                if (!ok) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            const mCollisionGroup = bodyCreationSettings.mCollisionGroup;\r\n            mCollisionGroup.SetGroupFilter(table);\r\n            mCollisionGroup.SetGroupID(group);\r\n            mCollisionGroup.SetSubGroupID(subGroup);\r\n        }\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(index, `invalid body index: ${ index }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(layer, `invalid object layer: ${ layer }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(motionType, `invalid motion type: ${ motionType }`);\r\n            if (!ok) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // override mass properties\r\n        const selectedMethod = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(selectedMethod, `invalid mass override method: ${ selectedMethod }`);\r\n            if (!ok) return false;\r\n        }\r\n        \r\n        if (selectedMethod !== Jolt.EOverrideMassProperties_CalculateMassAndInertia) {\r\n            bodyCreationSettings.mOverrideMassProperties = selectedMethod;\r\n\r\n            const mass = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(mass, `invalid mass: ${ mass }`);\r\n                if (!ok) return false;\r\n            }\r\n            bodyCreationSettings.mMassPropertiesOverride.mMass = mass;\r\n\r\n            if (selectedMethod === Jolt.EOverrideMassProperties_MassAndInertiaProvided) {\r\n                jv.FromBuffer(cb);\r\n                jq.FromBuffer(cb);\r\n\r\n                const m4 = Jolt.Mat44.sRotationTranslation(jq, jv);\r\n                bodyCreationSettings.mMassPropertiesOverride.mInertia = m4;\r\n                Jolt.destroy(m4);\r\n            }\r\n        }\r\n\r\n        const bodyInterface = backend.bodyInterface;\r\n        const body = bodyInterface.CreateBody(bodyCreationSettings);\r\n        bodyInterface.AddBody(body.GetID(), Jolt.Activate);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            body.debugDraw = debugDraw;\r\n        }\r\n\r\n        // Destroy shape settings after body is created:\r\n        Jolt.destroy(shapeSettings);\r\n        Jolt.destroy(bodyCreationSettings);\r\n\r\n        if (backend.config.useMotionStates) {\r\n            if (useMotionState && (motionType === Jolt.EMotionType_Dynamic || motionType === Jolt.EMotionType_Kinematic)) {\r\n                body.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(body);\r\n            }\r\n        }\r\n\r\n        backend.tracker.add(body, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createSoftBody(cb, meshBuffers) {\r\n        const backend = this._backend;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n\r\n        // ------------ SHAPE PROPS ----------------\r\n\r\n        const shapeSettings = Creator.createSoftBodyShapeSettings(cb, meshBuffers);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n        \r\n        // ------------ BODY PROPS ----------------\r\n\r\n        // PCID\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(index, `invalid body index: ${ index }`);\r\n            if (!ok) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // position\r\n        jv.FromBuffer(cb);\r\n\r\n        // rotation\r\n        jq.FromBuffer(cb);\r\n\r\n        // const objectLayer = backend.getBitValue(layer);\r\n        const bodyCreationSettings = new Jolt.SoftBodyCreationSettings(shapeSettings, jv, jq);\r\n\r\n        // collision group\r\n        const group = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        // collision sub group\r\n        const subGroup = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            const mObjectLayer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            const mNumIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            const mLinearDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mMaxLinearVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mRestitution = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mPressure = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mGravityFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const mUpdatePosition = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            const mMakeRotationIdentity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            const mAllowSleeping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n            bodyCreationSettings.mObjectLayer = mObjectLayer;\r\n            // bodyCreationSettings.mNumIterations = mNumIterations;\r\n            // bodyCreationSettings.mLinearDamping = mLinearDamping;\r\n            // bodyCreationSettings.mMaxLinearVelocity = mMaxLinearVelocity;\r\n            // bodyCreationSettings.mRestitution = mRestitution;\r\n            // bodyCreationSettings.mFriction = mFriction;\r\n            // bodyCreationSettings.mPressure = mPressure;\r\n            // bodyCreationSettings.mGravityFactor = mGravityFactor;\r\n            bodyCreationSettings.mUpdatePosition = mUpdatePosition;\r\n            // bodyCreationSettings.mMakeRotationIdentity = mMakeRotationIdentity;\r\n            // bodyCreationSettings.mAllowSleeping = mAllowSleeping;\r\n        } else {\r\n            bodyCreationSettings.mObjectLayer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            bodyCreationSettings.mNumIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            bodyCreationSettings.mLinearDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mMaxLinearVelocity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mRestitution = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mPressure = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mGravityFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            bodyCreationSettings.mUpdatePosition = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            bodyCreationSettings.mMakeRotationIdentity = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            bodyCreationSettings.mAllowSleeping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        }\r\n        \r\n        // debug draw\r\n        const debugDraw = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n\r\n        if (group !== null && subGroup !== null) {\r\n            const table = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(group, `Invalid filter group: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(subGroup, `Invalid filter group: ${ subGroup }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!table, `Trying to set a filter group that does not exist: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((subGroup <= table?.maxIndex), `Trying to set sub group that is over the filter group table size: ${ subGroup }`);\r\n                if (!ok) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            const mCollisionGroup = bodyCreationSettings.mCollisionGroup;\r\n            mCollisionGroup.SetGroupFilter(table);\r\n            mCollisionGroup.SetGroupID(group);\r\n            mCollisionGroup.SetSubGroupID(subGroup);\r\n        }\r\n\r\n        const bodyInterface = backend.bodyInterface;\r\n        const body = bodyInterface.CreateSoftBody(bodyCreationSettings);\r\n        bodyInterface.AddBody(body.GetID(), Jolt.Activate);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            body.debugDraw = debugDraw;\r\n        }\r\n\r\n        // Destroy shape settings after body is created:\r\n        Jolt.destroy(bodyCreationSettings);\r\n\r\n        backend.tracker.add(body, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    _createVehicle(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const physicsSystem = backend.physicsSystem;\r\n        const jv = this._joltVec3;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const isWheeled = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL || type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_MOTORCYCLE;\r\n\r\n        try {\r\n            const destroySettings = (list) => {\r\n                for (let i = 0; i < list.length; i++) {\r\n                    Jolt.destroy(list[i]);\r\n                }\r\n            };\r\n\r\n            const updateCurve = (curve) => {\r\n                curve.Clear();\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                for (let i = 0; i < count; i++) {\r\n                    curve.AddPoint(\r\n                        cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n                        cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32)\r\n                    );\r\n                }\r\n            };\r\n\r\n            const updateGears = (gears) => {\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                gears.clear();\r\n                for (let i = 0; i < count; i++) {\r\n                    gears.push_back(cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32));\r\n                }\r\n            }\r\n\r\n            const updateWheel = (wheel) => {\r\n                wheel.mPosition = jv.FromBuffer(cb);\r\n                wheel.mSuspensionForcePoint = jv.FromBuffer(cb);\r\n                wheel.mSuspensionDirection = jv.FromBuffer(cb);\r\n                wheel.mSteeringAxis = jv.FromBuffer(cb);\r\n                wheel.mWheelUp = jv.FromBuffer(cb);\r\n                wheel.mWheelForward = jv.FromBuffer(cb);\r\n                wheel.mSuspensionMinLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mSuspensionMaxLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mSuspensionPreloadLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mRadius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mWidth = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                wheel.mEnableSuspensionForcePoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n                const spring = wheel.mSuspensionSpring;\r\n                spring.mMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                spring.mFrequency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                spring.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                spring.mDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                // longitudinal friction\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    updateCurve(wheel.mLongitudinalFriction);\r\n                }\r\n\r\n                // lateral friction\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    updateCurve(wheel.mLateralFriction);\r\n                }                    \r\n\r\n                if (isWheeled) {\r\n                    wheel.mInertia = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxSteerAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxBrakeTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    wheel.mMaxHandBrakeTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                }\r\n            }\r\n\r\n            // general\r\n            const constraintSettings = new Jolt.VehicleConstraintSettings();\r\n            constraintSettings.mNumVelocityStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            constraintSettings.mNumPositionStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n            constraintSettings.mUp = jv.FromBuffer(cb);\r\n            constraintSettings.mForward = jv.FromBuffer(cb);\r\n            constraintSettings.mMaxPitchRollAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n            // controller\r\n            let controllerSettings;\r\n            if (isWheeled) {\r\n                controllerSettings = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL ?\r\n                    new Jolt.WheeledVehicleControllerSettings() :\r\n                    new Jolt.MotorcycleControllerSettings()\r\n            } else {\r\n                constraintSettings = new Jolt.TrackedVehicleControllerSettings();\r\n            }\r\n\r\n            // engine\r\n            const engine = controllerSettings.mEngine;\r\n            engine.mMaxTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mMinRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mMaxRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mInertia = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            engine.mAngularDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n            if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                updateCurve(engine.mNormalizedTorque);\r\n            }\r\n\r\n            // transmission\r\n            const transmission = controllerSettings.mTransmission;\r\n            transmission.mMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            transmission.mSwitchTime = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mClutchReleaseTime = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mSwitchLatency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mShiftUpRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mShiftDownRPM = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            transmission.mClutchStrength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            updateGears(transmission.mGearRatios);\r\n            updateGears(transmission.mReverseGearRatios);\r\n    \r\n            // wheels\r\n            const wheelsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            const mWheels = constraintSettings.mWheels;\r\n            const Wheel = isWheeled ? Jolt.WheelSettingsWV : Jolt.WheelSettingsTV;\r\n            mWheels.clear();\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                const wheel = new Wheel();\r\n                updateWheel(wheel);\r\n                mWheels.push_back(wheel);\r\n            }\r\n\r\n            if (!isWheeled) {\r\n                // get tracks and map wheels\r\n                const tracksCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                for (let t = 0; t < tracksCount; t++) {\r\n                    const track = controllerSettings.get_mTracks(t);\r\n                    const twc = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32); // track wheels count\r\n\r\n                    // Make the last wheel in the track to be a driven wheel (connected to engine)\r\n                    track.mDrivenWheel = twc - 1;\r\n\r\n                    for (let i = 0; i < twc; i++) {\r\n                        track.mWheels.push_back(cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32));\r\n                    }\r\n                }\r\n            }\r\n\r\n            const diffs = [];\r\n            if (isWheeled) {\r\n                // differentials\r\n                const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                if (count > 0) {\r\n                    const differentials = controllerSettings.mDifferentials;\r\n\r\n                    for (let i = 0; i < count; i++) {\r\n                        const settings = new Jolt.VehicleDifferentialSettings();\r\n\r\n                        settings.mLeftWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_INT32);\r\n                        settings.mRightWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_INT32);\r\n                        settings.mDifferentialRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mLeftRightSplit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mLimitedSlipRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        settings.mEngineTorqueRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                        diffs.push(settings);\r\n                        differentials.push_back(settings);\r\n                    }\r\n                }\r\n\r\n                controllerSettings.mDifferentialLimitedSlipRatio = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                if (type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                    controllerSettings.mMaxLeanAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringConstant = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringIntegrationCoefficient = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSpringIntegrationCoefficientDecay = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    controllerSettings.mLeanSmoothingFactor = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                }\r\n            }\r\n\r\n            // anti roll bars\r\n            const barsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            const mAntiRollBars = constraintSettings.mAntiRollBars;\r\n            const bars = [];\r\n            for (let i = 0; i < barsCount; i++) {\r\n                const bar = new Jolt.VehicleAntiRollBar();\r\n\r\n                bar.mLeftWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                bar.mRightWheel = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n                bar.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                bars.push(bar);\r\n                mAntiRollBars.push_back(bar);\r\n            }\r\n\r\n            constraintSettings.mController = controllerSettings;\r\n\r\n            // constraint\r\n            const body = tracker.getBodyByPCID(index);\r\n            const constraint = new Jolt.VehicleConstraint(body, constraintSettings);\r\n            const castType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            const layer = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n            // For backend to write wheels isometry\r\n            body.isVehicle = true;\r\n\r\n            // wheels contact tester\r\n            let tester;\r\n            switch (castType) {\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_RAY: {\r\n                    jv.FromBuffer(cb);\r\n                    const maxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterRay(layer, jv, maxAngle);\r\n                    break;\r\n                }\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_SPHERE: {\r\n                    jv.FromBuffer(cb);\r\n                    const maxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    const radius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterCastSphere(layer, radius, jv, maxAngle);\r\n                    break;\r\n                }\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_CAST_TYPE_CYLINDER: {\r\n                    const fraction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    tester = new Jolt.VehicleCollisionTesterCastCylinder(layer, fraction);\r\n                    break;\r\n                }\r\n                default:\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized cast type: ${ castType }`);\r\n                    return false;\r\n            }\r\n            constraint.SetVehicleCollisionTester(tester);\r\n\r\n            // events\r\n            if (backend.config.vehicleContactEventsEnabled) {\r\n                backend.listener.initVehicleEvents(constraint);\r\n            }\r\n            \r\n            physicsSystem.AddConstraint(constraint);\r\n            \r\n            const listener = new Jolt.VehicleConstraintStepListener(constraint);\r\n            physicsSystem.AddStepListener(listener);\r\n\r\n            // add references for Cleaner operator\r\n            body.constraints = [index];\r\n            constraint.listener = listener;\r\n\r\n            let Controller;\r\n            if (isWheeled) {\r\n                Controller = type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.VEHICLE_TYPE_WHEEL ? \r\n                    Jolt.WheeledVehicleController : \r\n                    Jolt.MotorcycleController;\r\n            } else {\r\n                Controller = Jolt.TrackedVehicleController;\r\n            }\r\n            constraint.controller = Jolt.castObject(constraint.GetController(), Controller);\r\n            constraint.wheelsCount = wheelsCount;\r\n\r\n            tracker.addConstraint(index, constraint, body);\r\n\r\n            destroySettings(diffs);\r\n            destroySettings(bars);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _createGroups(cb) {\r\n        const backend = this._backend;\r\n        const groupsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(groupsCount, `Invalid filter groups count: ${ groupsCount }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(groupsCount > 0, `Invalid filter groups count: ${ groupsCount }`);\r\n            if (!ok)\r\n                return false\r\n        }\r\n        \r\n        for (let i = 0; i < groupsCount; i++) {\r\n            const subGroupsCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32)\r\n            const table = new Jolt.GroupFilterTable(subGroupsCount);\r\n            backend.groupFilterTables.push(table);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(subGroupsCount, `Invalid sub group count: ${ subGroupsCount }`);\r\n                if (!ok)\r\n                    return false;\r\n                table.maxIndex = subGroupsCount - 1; // for debug test in debug mode when creating a body\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _createShapeSettings(cb, meshBuffers) {\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n        const shapeType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        // scale\r\n        const useScale = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        let sx, sy, sz\r\n        if (useScale) {\r\n            sx = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sz = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            \r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sx, `Invalid scale X: ${ sx }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sy, `Invalid scale Y: ${ sy }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sz, `Invalid scale Z: ${ sz }`);\r\n                if (!ok) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n\r\n        let settings, hh, r, cr;\r\n        switch (shapeType) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_BOX:\r\n                jv.FromBuffer(cb, true);\r\n                cr = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(cr, `invalid convex radius: ${ cr }`);\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, jv, cr);\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CAPSULE:\r\n                hh = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(hh, `invalid half height: ${ hh }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((sx === sy) && (sy === sz), `Capsule shape scale must be uniform: ${ sx }, ${ sy }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, hh, r);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CYLINDER:\r\n                hh = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                cr = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(hh, `invalid half height: ${ hh }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(cr, `invalid convex radius: ${ cr }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(sx === sz, `Cylinder shape scale must be uniform in XZ plane: ${ sx }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, hh, r, cr);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_SPHERE:\r\n                r = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                    let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(r, `invalid radius: ${ r }`);\r\n                    if (useScale) {\r\n                        ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert((sx === sy) && (sy === sz), `Sphere shape scale must be uniform: ${ sx }, ${ sy }, ${ sz }`);\r\n                    }\r\n                    if (!ok) {\r\n                        return null;\r\n                    }\r\n                }\r\n                settings = this.createShapeSettings(shapeType, r);\r\n                break;\r\n\r\n            // intentional fall-through\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_MESH:\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CONVEX_HULL:\r\n                settings = Creator.createMeshShapeSettings(cb, meshBuffers, shapeType);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_STATIC_COMPOUND:\r\n                settings = this._createStaticCompoundShapeSettings(cb, meshBuffers);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_HEIGHTFIELD:\r\n                settings = this._createHeightFieldSettings(cb, meshBuffers);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn('Invalid shape type', shapeType);\r\n                return null;\r\n        }\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_STATIC_COMPOUND) {\r\n            const compoundSettings = new Jolt.StaticCompoundShapeSettings();\r\n    \r\n            for (let i = 0, end = settings.length; i < end; i += 3) {\r\n                const childSettings = settings[i];\r\n                const pos = settings[i + 1];\r\n                const rot = settings[i + 2];\r\n    \r\n                jv.Set(pos.x, pos.y, pos.z);\r\n                jq.Set(rot.x, rot.y, rot.z, rot.w);\r\n    \r\n                compoundSettings.AddShape(jv, jq, childSettings);\r\n            }\r\n\r\n            settings = compoundSettings;\r\n        }\r\n        \r\n        const isCompoundChild = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        if (!isCompoundChild) {\r\n            const density = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloatPositive(density, `Invalid density value: ${ density }`);\r\n                if (!ok)\r\n                    return null;\r\n            }\r\n            settings.mDensity = density;\r\n        }\r\n\r\n        // shape offset\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            jv.FromBuffer(cb);\r\n            jq.FromBuffer(cb);\r\n\r\n            settings = new Jolt.RotatedTranslatedShapeSettings(jv, jq, settings);\r\n        }\r\n\r\n        // center of mass offset\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            jv.FromBuffer(cb);\r\n\r\n            settings = new Jolt.OffsetCenterOfMassShapeSettings(jv, settings);\r\n        }\r\n\r\n        if (useScale) {\r\n            jv.Set(sx, sy, sz);\r\n            settings = new Jolt.ScaledShapeSettings(settings, jv);\r\n        }\r\n\r\n        return settings;\r\n    } \r\n\r\n    _createStaticCompoundShapeSettings(cb, meshBuffers) {\r\n        const childrenCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const children = [];\r\n\r\n        for (let i = 0; i < childrenCount; i++) {\r\n            const settings = this._createShapeSettings(cb, meshBuffers);\r\n            if (!settings) return null;\r\n\r\n            const pos = {};\r\n            const rot = {};\r\n            \r\n            cb.readVec(pos);\r\n            cb.readQuat(rot);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = true;\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkVec(pos, `Invalid static compound child position vector`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkQuat(rot, `Invalid static compound child quaternion`);\r\n                return null;\r\n            }\r\n\r\n            children.push(settings, pos, rot);\r\n        }\r\n\r\n        return children;\r\n    }\r\n\r\n    _createHeightFieldSettings(cb, meshBuffers) {\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!meshBuffers, `Missing buffers to generate a HeightField shape: ${ meshBuffers }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(meshBuffers.length > 0, `Invalid buffers to generate HeightField shape: ${ meshBuffers }`);\r\n            if (!ok) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const jv = this._joltVec3;\r\n        const buffer = meshBuffers.shift();\r\n        const samples = new Float32Array(buffer);\r\n        const size = samples.length;\r\n\r\n        const settings = new Jolt.HeightFieldShapeSettings();\r\n        settings.mOffset = jv.FromBuffer(cb);\r\n        settings.mScale = jv.FromBuffer(cb);\r\n        settings.mSampleCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mBlockSize = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mBitsPerSample = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mActiveEdgeCosThresholdAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mHeightSamples.resize(size);\r\n\r\n        // Convert the height samples into a Float32Array\r\n        const heightSamples = new Float32Array(Jolt.HEAPF32.buffer, Jolt.getPointer(settings.mHeightSamples.data()), size);\r\n\r\n        for (let i = 0, end = heightSamples.length; i < end; i++) {\r\n            const height = samples[i];\r\n            heightSamples[i] = height >=0 ? height : Jolt.HeightFieldShapeConstantValues.prototype.cNoCollisionValue;\r\n        }\r\n\r\n        return settings;\r\n    }\r\n\r\n    _createConstraint(cb) {\r\n        const jv = this._joltVec3;\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const physicsSystem = backend.physicsSystem;\r\n\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idx1 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idx2 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const body1 = tracker.getBodyByPCID(idx1);\r\n        const body2 = tracker.getBodyByPCID(idx2);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!body1, `Unable to locate body to add constraint to: ${ idx1 }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!body2, `Unable to locate body to add constraint to: ${ idx2 }`);\r\n            if (!ok) return false;\r\n        }\r\n\r\n        // TODO\r\n        // refactor to own methods\r\n\r\n        let settings;\r\n        switch (type) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_FIXED:\r\n                settings = new Jolt.FixedConstraintSettings();\r\n                if (cb.flag) settings.mAutoDetectPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n                if (!settings.mAutoDetectPoint) {\r\n                    if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                    if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                }\r\n                if (cb.flag) settings.mAxisX1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY2 = jv.FromBuffer(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_POINT:\r\n                settings = new Jolt.PointConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_DISTANCE:\r\n                settings = new Jolt.DistanceConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mMinDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_HINGE:\r\n                settings = new Jolt.HingeConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHingeAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHingeAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mLimitsMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitsMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SLIDER:\r\n                settings = new Jolt.SliderConstraintSettings();\r\n                if (cb.flag) settings.mAutoDetectPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n                if (!settings.mAutoDetectPoint) {\r\n                    if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                    if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                }\r\n                if (cb.flag) settings.mSliderAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mSliderAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mLimitsMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitsMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionForce = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_CONE:\r\n                settings = new Jolt.ConeConstraintSettings();\r\n                if (cb.flag) settings.mPoint1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPoint2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SWING_TWIST:\r\n                settings = new Jolt.SwingTwistConstraintSettings();\r\n                if (cb.flag) settings.mPosition1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPlaneAxis1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPosition2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mTwistAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPlaneAxis2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mNormalHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mPlaneHalfConeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mTwistMinAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mTwistMaxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mMaxFrictionTorque = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const swingMotorSettings = this._createMotorSettings(cb);\r\n                    settings.mSwingMotorSettings = swingMotorSettings;\r\n                    Jolt.destroy(swingMotorSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const twistMotorSettings = this._createMotorSettings(cb);\r\n                    settings.mTwistMotorSettings = twistMotorSettings;\r\n                    Jolt.destroy(twistMotorSettings);\r\n                }\r\n                break;\r\n            \r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_TYPE_SIX_DOF:\r\n                settings = new Jolt.SixDOFConstraintSettings();\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.MakeFreeAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.MakeFixedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8)) {\r\n                    const count = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                    for (let i = 0; i < count; i++) {\r\n                        const axis = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n                        const min = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        const max = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n                        switch (axis) {\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_X:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationX, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Y:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationY, min, max);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_TRANSLATION_Z:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_TranslationZ, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_X:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationX, min, max);\r\n                                break;\r\n                            \r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Y:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationY, min, max);\r\n                                break;\r\n\r\n                            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SIX_DOF_ROTATION_Z:\r\n                                settings.SetLimitedAxis(Jolt.SixDOFConstraintSettings_EAxis_RotationZ, min, max);\r\n                                break;\r\n                            \r\n                            default:\r\n                                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized six dof constraint axis setting: ${ axis }`);\r\n                                return false;\r\n                        }\r\n                    }\r\n                }                \r\n                if (cb.flag) settings.mPosition1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY1 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mPosition2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisX2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mAxisY2 = jv.FromBuffer(cb);\r\n                if (cb.flag) settings.mMaxFriction = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitMin = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.flag) settings.mLimitMax = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const springSettings = this._createSpringSettings(cb);\r\n                    settings.mLimitsSpringSettings = springSettings;\r\n                    Jolt.destroy(springSettings);\r\n                }\r\n                if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n                    const motorSettings = this._createMotorSettings(cb);\r\n                    settings.mMotorSettings = motorSettings;\r\n                    Jolt.destroy(motorSettings);\r\n                }\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Unrecognized constraint type: ${ type }`);\r\n                return false;\r\n        }\r\n\r\n        if (cb.flag) settings.mNumVelocityStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (cb.flag) settings.mNumPositionStepsOverride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        if (cb.flag) {\r\n            const space = (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8) === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONSTRAINT_SPACE_WORLD) ? Jolt.EConstraintSpace_WorldSpace : Jolt.EConstraintSpace_LocalToBodyCOM;\r\n            settings.mSpace = space;\r\n        }\r\n\r\n        const constraint = settings.Create(body1, body2);\r\n\r\n        if (!body1.constraints) {\r\n            body1.constraints = [];\r\n            body1.linked = new Set();\r\n        }\r\n\r\n        if (!body2.constraints) {\r\n            body2.constraints = [];\r\n            body2.linked = new Set();\r\n        }\r\n\r\n        body1.constraints.push(index);\r\n        body2.constraints.push(index);\r\n\r\n        body1.linked.add(body2);\r\n        body2.linked.add(body1);\r\n\r\n        tracker.addConstraint(index, constraint, body1, body2);\r\n\r\n        physicsSystem.AddConstraint(constraint);\r\n        \r\n        return true;\r\n    }\r\n\r\n    _createSpringSettings(cb) {\r\n        const springSettings = new Jolt.SpringSettings();\r\n        const mode = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8) : _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SPRING_MODE_FREQUENCY;\r\n        springSettings.mMode = (mode === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SPRING_MODE_FREQUENCY) ? \r\n            Jolt.ESpringMode_FrequencyAndDamping : Jolt.ESpringMode_StiffnessAndDamping;\r\n        if (cb.flag) springSettings.mFrequency = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) springSettings.mStiffness = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) springSettings.mDamping = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        return springSettings;\r\n    }\r\n\r\n    _createMotorSettings(cb) {\r\n        const motorSettings = new Jolt.MotorSettings();\r\n        if (cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL)) {\r\n            const springsSettings = this._createSpringSettings(cb);\r\n            motorSettings.mSpringSettings = springsSettings;\r\n            Jolt.destroy(springsSettings);\r\n        }\r\n        if (cb.flag) motorSettings.mMinForceLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMaxForceLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMinTorqueLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        if (cb.flag) motorSettings.mMaxTorqueLimit = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        return motorSettings;\r\n    }\r\n\r\n    _createCharacter(cb) {\r\n        const backend = this._backend;\r\n        const listener = backend.listener;\r\n        const charEvents = backend.config.charContactEventsEnabled;\r\n        const jv = this._joltVec3;\r\n        const jq = this._joltQuat;\r\n        const settings = new Jolt.CharacterVirtualSettings();\r\n\r\n        const shapeSettings = this._createShapeSettings(cb, null);\r\n        if (!shapeSettings) {\r\n            return false;\r\n        }\r\n\r\n        const shape = shapeSettings.Create().Get();\r\n        \r\n        settings.mShape = shape;\r\n\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        jv.FromBuffer(cb);\r\n        settings.mUp = jv;\r\n\r\n        jv.FromBuffer(cb);\r\n        const distance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        const plane = new Jolt.Plane(jv, distance);\r\n        settings.mSupportingVolume = plane;\r\n        Jolt.destroy(plane);\r\n\r\n        settings.mMaxSlopeAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMass = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxStrength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        jv.FromBuffer(cb);\r\n        settings.mShapeOffset = jv;\r\n        settings.mBackFaceMode = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        settings.mPredictiveContactDistance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxCollisionIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mMaxConstraintIterations = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mMinTimeRemaining = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mCollisionTolerance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mCharacterPadding = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mMaxNumHits = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        settings.mHitReductionCosMaxAngle = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        settings.mPenetrationRecoverySpeed = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n\r\n        jv.FromBuffer(cb);\r\n        jq.FromBuffer(cb);\r\n\r\n        if (charEvents && !listener.charListener) {\r\n            listener.initCharacterEvents();\r\n        }\r\n\r\n        const character = new Jolt.CharacterVirtual(settings, jv, jq, backend.physicsSystem);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            character.debugDraw = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        }        \r\n\r\n        if (backend.config.useMotionStates && useMotionState) {\r\n            character.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(character);\r\n        }\r\n\r\n        if (charEvents) {\r\n            character.SetListener(listener.charListener);\r\n        }\r\n\r\n        // for motion state\r\n        character.isCharacter = true;\r\n\r\n        // for shape reset\r\n        character.originalShape = shape;\r\n\r\n        backend.tracker.addCharacter(character, index);\r\n\r\n        return true;\r\n    }\r\n\r\n    static createMeshShapeSettings(cb, meshBuffers, shapeType) {\r\n        const {\r\n            base, stride, numIndices, triCount, positions, indices\r\n        } = Creator.readMeshBuffers(cb, meshBuffers);\r\n\r\n        // TODO:\r\n        // add support for duplicate vertices test\r\n\r\n        const p = positions;\r\n        let i1, i2, i3;\r\n        let settings;\r\n\r\n        if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CONVEX_HULL) {\r\n            const cache = new Set();\r\n            const jv = this._joltVec3;\r\n\r\n            settings = new Jolt.ConvexHullShapeSettings();\r\n\r\n            for (let i = 0; i < numIndices; i++) {\r\n                const index = indices[i] * stride;\r\n                const x = p[index];\r\n                const y = p[index + 1];\r\n                const z = p[index + 2];\r\n\r\n                // deduplicate verts\r\n                const str = `${x}:${y}:${z}`;\r\n                if (!cache.has(str)) {\r\n                    cache.add(str);\r\n                    \r\n                    jv.Set(x, y, z);\r\n                    settings.mPoints.push_back(jv);\r\n                }\r\n            }\r\n        } else if (shapeType === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_MESH) {\r\n            const triangles = new Jolt.TriangleList();\r\n    \r\n            triangles.resize(triCount);\r\n            \r\n            let v1, v2, v3;\r\n            for (let i = 0; i < triCount; i++) {\r\n                i1 = indices[base + i * 3] * stride;\r\n                i2 = indices[base + i * 3 + 1] * stride;\r\n                i3 = indices[base + i * 3 + 2] * stride;\r\n    \r\n                const t = triangles.at(i);\r\n                \r\n                v1 = t.get_mV(0);\r\n                v2 = t.get_mV(1);\r\n                v3 = t.get_mV(2);\r\n    \r\n                v1.x = p[i1]; v1.y = p[i1 + 1]; v1.z = p[i1 + 2];\r\n                v2.x = p[i2]; v2.y = p[i2 + 1]; v2.z = p[i2 + 2];\r\n                v3.x = p[i3]; v3.y = p[i3 + 1]; v3.z = p[i3 + 2];\r\n            }\r\n\r\n            settings = new Jolt.MeshShapeSettings(triangles);\r\n        }\r\n        \r\n        return settings;\r\n    }\r\n\r\n    static createSoftBodyShapeSettings(cb, meshBuffers) {\r\n        // scale\r\n        const useScale = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        let sx = 1;\r\n        let sy = 1;\r\n        let sz = 1;\r\n        if (useScale) {\r\n            sx = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            sz = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            \r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sx, `Invalid scale X: ${ sx }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sy, `Invalid scale Y: ${ sy }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkFloat(sz, `Invalid scale Z: ${ sz }`);\r\n                if (!ok) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n\r\n        const {\r\n            base, vertexCount, triCount, positions, indices\r\n        } = Creator.readMeshBuffers(cb, meshBuffers);\r\n        \r\n        const settings = new Jolt.SoftBodySharedSettings();\r\n        \r\n        // Create vertices\r\n        const cache = new Set();\r\n        const jf = new Jolt.Float3();\r\n        const v = new Jolt.SoftBodySharedSettingsVertex();\r\n        for (let i = 0; i < vertexCount; i++) {\r\n            const i3 = i * 3;\r\n            const x = positions[i3];\r\n            const y = positions[i3 + 1];\r\n            const z = positions[i3 + 2];\r\n\r\n            // deduplicate verts\r\n            const str = `${x}:${y}:${z}`;\r\n            if (!cache.has(str)) {\r\n                cache.add(str);\r\n                \r\n                jf.x = x * sx;\r\n                jf.y = y * sy;\r\n                jf.z = z * sz;\r\n                v.mPosition = jf;\r\n\r\n                settings.mVertices.push_back(v);\r\n            }\r\n        }\r\n\r\n        const width = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const length = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const compliance = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n        const fixedCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const rowVerts = width + 1;\r\n        const colVerts = length + 1;\r\n        \r\n        // Create edges\r\n        const edge = new Jolt.SoftBodySharedSettingsEdge(0, 1, compliance);\r\n        const constraints = settings.mEdgeConstraints;\r\n        let v0, v1;\r\n        for (let x = 0; x < rowVerts; x++) {\r\n            for (let y = 0; y < colVerts; y++) {\r\n                v0 = y + x * colVerts;\r\n                edge.set_mVertex(0, v0);\r\n\r\n                if (y < length) {\r\n                    edge.set_mVertex(1, v0 + 1);\r\n                    constraints.push_back(edge);\r\n                }\r\n                if (x < width) {\r\n                    edge.set_mVertex(1, v0 + colVerts);\r\n                    constraints.push_back(edge);\r\n                }\r\n                if (y < length && x < width) {\r\n                    v1 = v0 + colVerts + 1;\r\n                    edge.set_mVertex(1, v1);\r\n                    constraints.push_back(edge);\r\n                    edge.set_mVertex(0, v0 + 1);\r\n                    edge.set_mVertex(1, v1 - 1);\r\n                    constraints.push_back(edge);\r\n                }\r\n            }\r\n        }\r\n        settings.CalculateEdgeLengths();\r\n        Jolt.destroy(edge);\r\n\r\n        // Fixed verts\r\n        for (let i = 0; i < fixedCount; i++) {\r\n            const fixedIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n            settings.mVertices.at(fixedIndex).mInvMass = 0;\r\n        }\r\n\r\n        // Create faces\r\n        for (let i = 0; i < triCount; i++) {\r\n            const i1 = indices[base + i * 3];\r\n            const i2 = indices[base + i * 3 + 1];\r\n            const i3 = indices[base + i * 3 + 2];\r\n\r\n            settings.AddFace(new Jolt.SoftBodySharedSettingsFace(i1, i2, i3, 0));\r\n        }\r\n        settings.Optimize();\r\n\r\n        Jolt.destroy(jf);\r\n        Jolt.destroy(v);\r\n\r\n        return settings;\r\n    }\r\n\r\n    static readMeshBuffers(cb, meshBuffers) {\r\n        const base = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const offset = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const stride = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n        const vertexCount = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const numIndices = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idxLength = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const idxOffset = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            let ok = _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(base, `Invalid buffer base to generate mesh/hull: ${ base }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(offset, `Invalid positions buffer offset to generate mesh/hull: ${ offset }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(stride, `Invalid positions buffer stride to generate mesh/hull: ${ stride }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(numIndices, `Invalid indices count to generate mesh/hull: ${ numIndices }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!meshBuffers, `No mesh buffers to generate a mesh/hull: ${ meshBuffers }`);\r\n            ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(meshBuffers.length > 1, `Invalid buffers to generate mesh/hull: ${ meshBuffers }`);\r\n            if (!ok) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const posBuffer = meshBuffers.shift();\r\n        const idxBuffer = meshBuffers.shift();\r\n        \r\n        const positions = new Float32Array(posBuffer, offset); // vertex positions\r\n        const arrayConstructor = numIndices > 65535 ? Uint32Array : Uint16Array;\r\n        const indices = new arrayConstructor(idxBuffer, idxOffset, idxLength);\r\n        const triCount = Math.floor(numIndices / 3);\r\n\r\n        return { base, stride, vertexCount, numIndices, triCount, positions, indices };\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvY3JlYXRvci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQXVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvb3BlcmF0b3JzL2NyZWF0b3IubWpzPzIzODciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9SRUFEX0JPT0wsIEJVRkZFUl9SRUFEX0ZMT0FUMzIsIEJVRkZFUl9SRUFEX0lOVDMyLCBCVUZGRVJfUkVBRF9VSU5UMTYsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UMzIsIEJVRkZFUl9SRUFEX1VJTlQ4LFxyXG4gICAgQ01EX0NSRUFURV9CT0RZLFxyXG4gICAgQ01EX0NSRUFURV9DSEFSLFxyXG4gICAgQ01EX0NSRUFURV9DT05TVFJBSU5ULFxyXG4gICAgQ01EX0NSRUFURV9HUk9VUFMsXHJcbiAgICBDTURfQ1JFQVRFX1NIQVBFLFxyXG4gICAgQ01EX0NSRUFURV9TT0ZUX0JPRFksXHJcbiAgICBDTURfQ1JFQVRFX1ZFSElDTEUsXHJcbiAgICBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWCwgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1ksIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aLFxyXG4gICAgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1gsIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9ZLCBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWixcclxuICAgIENPTlNUUkFJTlRfU1BBQ0VfV09STEQsIENPTlNUUkFJTlRfVFlQRV9DT05FLCBDT05TVFJBSU5UX1RZUEVfRElTVEFOQ0UsIENPTlNUUkFJTlRfVFlQRV9GSVhFRCxcclxuICAgIENPTlNUUkFJTlRfVFlQRV9ISU5HRSwgQ09OU1RSQUlOVF9UWVBFX1BPSU5ULCBDT05TVFJBSU5UX1RZUEVfU0lYX0RPRiwgQ09OU1RSQUlOVF9UWVBFX1NMSURFUixcclxuICAgIENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVCwgU0hBUEVfQk9YLCBTSEFQRV9DQVBTVUxFLFxyXG4gICAgU0hBUEVfQ09OVkVYX0hVTEwsXHJcbiAgICBTSEFQRV9DWUxJTkRFUiwgU0hBUEVfSEVJR0hURklFTEQsIFNIQVBFX01FU0gsIFNIQVBFX1NPRlRfQk9EWSwgU0hBUEVfU1BIRVJFLCBTSEFQRV9TVEFUSUNfQ09NUE9VTkQsXHJcbiAgICBTUFJJTkdfTU9ERV9GUkVRVUVOQ1ksXHJcbiAgICBWRUhJQ0xFX0NBU1RfVFlQRV9DWUxJTkRFUixcclxuICAgIFZFSElDTEVfQ0FTVF9UWVBFX1JBWSxcclxuICAgIFZFSElDTEVfQ0FTVF9UWVBFX1NQSEVSRSxcclxuICAgIFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFLFxyXG4gICAgVkVISUNMRV9UWVBFX1dIRUVMXHJcbn0gZnJvbSBcIi4uLy4uLy4uL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2NvbnN0YW50cy5tanNcIjtcclxuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgTW90aW9uU3RhdGUgfSBmcm9tIFwiLi4vbW90aW9uLXN0YXRlLm1qc1wiO1xyXG5cclxuY2xhc3MgQ3JlYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IGJhY2tlbmQ7XHJcblxyXG4gICAgICAgIHRoaXMuY3JlYXRlUGh5c2ljc1N5c3RlbSgpO1xyXG5cclxuICAgICAgICB0aGlzLl9qb2x0VmVjMyA9IG5ldyBKb2x0LlZlYzMoKTtcclxuICAgICAgICB0aGlzLl9qb2x0VmVjM18yID0gbmV3IEpvbHQuVmVjMygpO1xyXG4gICAgICAgIHRoaXMuX2pvbHRRdWF0ID0gbmV3IEpvbHQuUXVhdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZShtZXNoQnVmZmVycykge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fYmFja2VuZC5pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfQ1JFQVRFX0JPRFk6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2NyZWF0ZUJvZHkoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ1JFQVRFX1NPRlRfQk9EWTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlU29mdEJvZHkoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ1JFQVRFX0dST1VQUzpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlR3JvdXBzKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ1JFQVRFX0NPTlNUUkFJTlQ6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2NyZWF0ZUNvbnN0cmFpbnQoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfQ0hBUjpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlQ2hhcmFjdGVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ1JFQVRFX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jcmVhdGVTaGFwZShjYiwgbWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9DUkVBVEVfVkVISUNMRTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY3JlYXRlVmVoaWNsZShjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYEludmFsaWQgY29tbWFuZDogJHsgY29tbWFuZCB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlUGh5c2ljc1N5c3RlbSgpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBjb25maWcgPSBiYWNrZW5kLmNvbmZpZztcclxuICAgICAgICBjb25zdCBsYXllclBhaXJzID0gY29uZmlnLmxheWVyUGFpcnM7XHJcbiAgICAgICAgY29uc3QgbGF5ZXJzID0gY29uZmlnLmxheWVycztcclxuICAgICAgICBjb25zdCBsYXllcnNDb3VudCA9IGxheWVycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGNvbnN0IG9iamVjdEZpbHRlciA9IG5ldyBKb2x0Lk9iamVjdExheWVyUGFpckZpbHRlclRhYmxlKGxheWVyc0NvdW50KTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxheWVyc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgcGFpciA9IGxheWVyUGFpcnNbaV07XHJcbiAgICAgICAgICAgIG9iamVjdEZpbHRlci5FbmFibGVDb2xsaXNpb24ocGFpclswXSwgcGFpclsxXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBicEludGVyZmFjZSA9IG5ldyBKb2x0LkJyb2FkUGhhc2VMYXllckludGVyZmFjZVRhYmxlKGxheWVyc0NvdW50LCBsYXllcnNDb3VudCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXllcnNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iakxheWVyID0gbGF5ZXJzW2ldO1xyXG4gICAgICAgICAgICBjb25zdCBicExheWVyID0gbmV3IEpvbHQuQnJvYWRQaGFzZUxheWVyKG9iakxheWVyKTtcclxuICAgICAgICAgICAgYnBJbnRlcmZhY2UuTWFwT2JqZWN0VG9Ccm9hZFBoYXNlTGF5ZXIob2JqTGF5ZXIsIGJwTGF5ZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgSm9sdC5Kb2x0U2V0dGluZ3MoKTtcclxuICAgICAgICBzZXR0aW5ncy5tT2JqZWN0TGF5ZXJQYWlyRmlsdGVyID0gb2JqZWN0RmlsdGVyO1xyXG4gICAgICAgIHNldHRpbmdzLm1Ccm9hZFBoYXNlTGF5ZXJJbnRlcmZhY2UgPSBicEludGVyZmFjZTtcclxuICAgICAgICBzZXR0aW5ncy5tT2JqZWN0VnNCcm9hZFBoYXNlTGF5ZXJGaWx0ZXIgPSBuZXcgSm9sdC5PYmplY3RWc0Jyb2FkUGhhc2VMYXllckZpbHRlclRhYmxlKHNldHRpbmdzLm1Ccm9hZFBoYXNlTGF5ZXJJbnRlcmZhY2UsIGxheWVyc0NvdW50LCBzZXR0aW5ncy5tT2JqZWN0TGF5ZXJQYWlyRmlsdGVyLCBsYXllcnNDb3VudCk7XHJcbiAgICAgICAgY29uc3Qgam9sdEludGVyZmFjZSA9IG5ldyBKb2x0LkpvbHRJbnRlcmZhY2Uoc2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveShzZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHBoeXNpY3NTeXN0ZW0gPSBqb2x0SW50ZXJmYWNlLkdldFBoeXNpY3NTeXN0ZW0oKTtcclxuICAgICAgICBjb25zdCBzeXN0ZW1TZXR0aW5ncyA9IHBoeXNpY3NTeXN0ZW0uR2V0UGh5c2ljc1NldHRpbmdzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUJhdW1nYXJ0ZSA9IGNvbmZpZy5iYXVtZ2FydGU7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUJvZHlQYWlyQ2FjaGVDb3NNYXhEZWx0YVJvdGF0aW9uRGl2MiA9IGNvbmZpZy5ib2R5UGFpckNhY2hlQ29zTWF4RGVsdGFSb3RhdGlvbkRpdjI7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUJvZHlQYWlyQ2FjaGVNYXhEZWx0YVBvc2l0aW9uU3EgPSBjb25maWcuYm9keVBhaXJDYWNoZU1heERlbHRhUG9zaXRpb25TcTtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tQ29udGFjdE5vcm1hbENvc01heERlbHRhUm90YXRpb24gPSBjb25maWcuY29udGFjdE5vcm1hbENvc01heERlbHRhUm90YXRpb247XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUNvbnRhY3RQb2ludFByZXNlcnZlTGFtYmRhTWF4RGlzdFNxID0gY29uZmlnLmNvbnRhY3RQb2ludFByZXNlcnZlTGFtYmRhTWF4RGlzdFNxO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1EZXRlcm1pbmlzdGljU2ltdWxhdGlvbiA9IGNvbmZpZy5kZXRlcm1pbmlzdGljU2ltdWxhdGlvbjtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTGluZWFyQ2FzdE1heFBlbmV0cmF0aW9uID0gY29uZmlnLmxpbmVhckNhc3RNYXhQZW5ldHJhdGlvbjtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTGluZWFyQ2FzdFRocmVzaG9sZCA9IGNvbmZpZy5saW5lYXJDYXN0VGhyZXNob2xkO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1NYW5pZm9sZFRvbGVyYW5jZVNxID0gY29uZmlnLm1hbmlmb2xkVG9sZXJhbmNlU3E7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubU1heEluRmxpZ2h0Qm9keVBhaXJzID0gY29uZmlnLm1heEluRmxpZ2h0Qm9keVBhaXJzO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1NYXhQZW5ldHJhdGlvbkRpc3RhbmNlID0gY29uZmlnLm1heFBlbmV0cmF0aW9uRGlzdGFuY2U7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubU1pblZlbG9jaXR5Rm9yUmVzdGl0dXRpb24gPSBjb25maWcubWluVmVsb2NpdHlGb3JSZXN0aXR1dGlvbjtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tTnVtUG9zaXRpb25TdGVwcyA9IGNvbmZpZy5udW1Qb3NpdGlvblN0ZXBzO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1OdW1WZWxvY2l0eVN0ZXBzID0gY29uZmlnLm51bVZlbG9jaXR5U3RlcHM7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVBlbmV0cmF0aW9uU2xvcCA9IGNvbmZpZy5wZW5ldHJhdGlvblNsb3A7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVBvaW50VmVsb2NpdHlTbGVlcFRocmVzaG9sZCA9IGNvbmZpZy5wb2ludFZlbG9jaXR5U2xlZXBUaHJlc2hvbGQ7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVNwZWN1bGF0aXZlQ29udGFjdERpc3RhbmNlID0gY29uZmlnLnNwZWN1bGF0aXZlQ29udGFjdERpc3RhbmNlO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1TdGVwTGlzdGVuZXJCYXRjaGVzUGVySm9iID0gY29uZmlnLnN0ZXBMaXN0ZW5lckJhdGNoZXNQZXJKb2I7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVN0ZXBMaXN0ZW5lcnNCYXRjaFNpemUgPSBjb25maWcuc3RlcExpc3RlbmVyc0JhdGNoU2l6ZTtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tVGltZUJlZm9yZVNsZWVwID0gY29uZmlnLnRpbWVCZWZvcmVTbGVlcDtcclxuXHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUNvbnN0cmFpbnRXYXJtU3RhcnQgPSBjb25maWcuY29uc3RyYWludFdhcm1TdGFydDtcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tVXNlQm9keVBhaXJDb250YWN0Q2FjaGUgPSBjb25maWcudXNlQm9keVBhaXJDb250YWN0Q2FjaGU7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubVVzZU1hbmlmb2xkUmVkdWN0aW9uID0gY29uZmlnLnVzZU1hbmlmb2xkUmVkdWN0aW9uO1xyXG4gICAgICAgIHN5c3RlbVNldHRpbmdzLm1Vc2VMYXJnZUlzbGFuZFNwbGl0dGVyID0gY29uZmlnLnVzZUxhcmdlSXNsYW5kU3BsaXR0ZXI7XHJcbiAgICAgICAgc3lzdGVtU2V0dGluZ3MubUFsbG93U2xlZXBpbmcgPSBjb25maWcuYWxsb3dTbGVlcGluZztcclxuICAgICAgICBzeXN0ZW1TZXR0aW5ncy5tQ2hlY2tBY3RpdmVFZGdlcyA9IGNvbmZpZy5jaGVja0FjdGl2ZUVkZ2VzO1xyXG5cclxuICAgICAgICBwaHlzaWNzU3lzdGVtLlNldFBoeXNpY3NTZXR0aW5ncyhzeXN0ZW1TZXR0aW5ncyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgYmFja2VuZC5qb2x0SW50ZXJmYWNlID0gam9sdEludGVyZmFjZTtcclxuICAgICAgICBiYWNrZW5kLnBoeXNpY3NTeXN0ZW0gPSBwaHlzaWNzU3lzdGVtO1xyXG5cclxuICAgICAgICBiYWNrZW5kLmJwRmlsdGVyID0gbmV3IEpvbHQuRGVmYXVsdEJyb2FkUGhhc2VMYXllckZpbHRlcihqb2x0SW50ZXJmYWNlLkdldE9iamVjdFZzQnJvYWRQaGFzZUxheWVyRmlsdGVyKCksIDEpO1xyXG4gICAgICAgIGJhY2tlbmQub2JqRmlsdGVyID0gbmV3IEpvbHQuRGVmYXVsdE9iamVjdExheWVyRmlsdGVyKGpvbHRJbnRlcmZhY2UuR2V0T2JqZWN0TGF5ZXJQYWlyRmlsdGVyKCksIDEpO1xyXG4gICAgICAgIGJhY2tlbmQuYm9keUZpbHRlciA9IG5ldyBKb2x0LkJvZHlGaWx0ZXIoKTtcclxuICAgICAgICBiYWNrZW5kLnNoYXBlRmlsdGVyID0gbmV3IEpvbHQuU2hhcGVGaWx0ZXIoKTtcclxuICAgICAgICBiYWNrZW5kLmJvZHlMaXN0ID0gbmV3IEpvbHQuQm9keUlEVmVjdG9yKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlU2hhcGVTZXR0aW5ncyhzaGFwZSwgLi4uYXR0cikge1xyXG4gICAgICAgIHN3aXRjaCAoc2hhcGUpIHtcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9CT1g6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvbHQuQm94U2hhcGVTZXR0aW5ncyhhdHRyWzBdIC8qIGhhbGYgZXh0ZW50ICovLCBhdHRyWzFdIC8qIGNvbnZleCByYWRpdXMgKi8pO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9TUEhFUkU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvbHQuU3BoZXJlU2hhcGVTZXR0aW5ncyhhdHRyWzBdIC8qIHJhZGl1cyAqLyk7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0NBUFNVTEU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvbHQuQ2Fwc3VsZVNoYXBlU2V0dGluZ3MoYXR0clswXSAvKiBoYWxmIGhlaWdodCAqLywgYXR0clsxXSAvKiByYWRpdXMgKi8pO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9DWUxJTkRFUjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9sdC5DeWxpbmRlclNoYXBlU2V0dGluZ3MoYXR0clswXSAvKiBoYWxmIGhlaWdodCAqLywgYXR0clsxXSAvKiByYWRpdXMgKi8sIGF0dHJbMl0gLyogY29udmV4IHJhZGl1cyAqLyk7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLndhcm5PbmNlKGBVbnJlY29nbml6ZWQgc2hhcGU6ICR7IHNoYXBlIH1gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0VmVjMyk7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRRdWF0KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPXHJcbiAgICAvLyBjb252ZXJ0IGNyZWF0aW9uIG1ldGhvZHMgdG8gc3RhdGljXHJcblxyXG4gICAgX2NyZWF0ZVNoYXBlKGNiLCBtZXNoQnVmZmVycykge1xyXG4gICAgICAgIC8vIHNoYXBlIG51bWJlclxyXG4gICAgICAgIGNvbnN0IG51bSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGVTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZVNoYXBlU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICBpZiAoIXNoYXBlU2V0dGluZ3MpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZVNldHRpbmdzLkNyZWF0ZSgpLkdldCgpO1xyXG5cclxuICAgICAgICB0aGlzLl9iYWNrZW5kLnRyYWNrZXIuc2hhcGVNYXAuc2V0KG51bSwgc2hhcGUpO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlQm9keShjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG4gICAgICAgIGNvbnN0IGpxID0gdGhpcy5fam9sdFF1YXQ7XHJcblxyXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLSBTSEFQRSBQUk9QUyAtLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgaWYgKCFzaGFwZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZVNldHRpbmdzLkNyZWF0ZSgpLkdldCgpO1xyXG5cclxuICAgICAgICAvLyAtLS0tLS0tLS0tLS0gQk9EWSBQUk9QUyAtLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIC8vIFBDSURcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgLy8gcG9zaXRpb25cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuXHJcbiAgICAgICAgLy8gcm90YXRpb25cclxuICAgICAgICBqcS5Gcm9tQnVmZmVyKGNiKTtcclxuXHJcbiAgICAgICAgLy8gbW90aW9uIHR5cGVcclxuICAgICAgICBjb25zdCBtb3Rpb25UeXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcblxyXG4gICAgICAgIC8vIHVzZSBtb3Rpb24gc3RhdGVcclxuICAgICAgICBjb25zdCB1c2VNb3Rpb25TdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgIC8vIG9iamVjdCBsYXllclxyXG4gICAgICAgIGNvbnN0IGxheWVyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIGNvbnN0IG9iamVjdExheWVyID0gYmFja2VuZC5nZXRCaXRWYWx1ZShsYXllcik7XHJcbiAgICAgICAgY29uc3QgYm9keUNyZWF0aW9uU2V0dGluZ3MgPSBuZXcgSm9sdC5Cb2R5Q3JlYXRpb25TZXR0aW5ncyhzaGFwZSwganYsIGpxLCBtb3Rpb25UeXBlLCBvYmplY3RMYXllcik7XHJcblxyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1MaW5lYXJWZWxvY2l0eSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1Bbmd1bGFyVmVsb2NpdHkgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWF4TGluZWFyVmVsb2NpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYXhBbmd1bGFyVmVsb2NpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1GcmljdGlvbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubVJlc3RpdHV0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTGluZWFyRGFtcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUFuZ3VsYXJEYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tR3Jhdml0eUZhY3RvciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUluZXJ0aWFNdWx0aXBsaWVyID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dlZERPRnMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dEeW5hbWljT3JLaW5lbWF0aWMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1Jc1NlbnNvciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU1vdGlvblF1YWxpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQWxsb3dTbGVlcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gY29sbGlzaW9uIGdyb3VwXHJcbiAgICAgICAgY29uc3QgZ3JvdXAgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpIDogbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY29sbGlzaW9uIHN1YiBncm91cFxyXG4gICAgICAgIGNvbnN0IHN1Ykdyb3VwID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKSA6IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGRlYnVnIGRyYXdcclxuICAgICAgICBjb25zdCBkZWJ1Z0RyYXcgPSBEZWJ1Zy5kZXYgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChncm91cCAhPT0gbnVsbCAmJiBzdWJHcm91cCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCB0YWJsZSA9IGJhY2tlbmQuZ3JvdXBGaWx0ZXJUYWJsZXNbZ3JvdXBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tVaW50KGdyb3VwLCBgSW52YWxpZCBmaWx0ZXIgZ3JvdXA6ICR7IGdyb3VwIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KHN1Ykdyb3VwLCBgSW52YWxpZCBmaWx0ZXIgZ3JvdXA6ICR7IHN1Ykdyb3VwIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhdGFibGUsIGBUcnlpbmcgdG8gc2V0IGEgZmlsdGVyIGdyb3VwIHRoYXQgZG9lcyBub3QgZXhpc3Q6ICR7IGdyb3VwIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KChzdWJHcm91cCA8PSB0YWJsZT8ubWF4SW5kZXgpLCBgVHJ5aW5nIHRvIHNldCBzdWIgZ3JvdXAgdGhhdCBpcyBvdmVyIHRoZSBmaWx0ZXIgZ3JvdXAgdGFibGUgc2l6ZTogJHsgc3ViR3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgbUNvbGxpc2lvbkdyb3VwID0gYm9keUNyZWF0aW9uU2V0dGluZ3MubUNvbGxpc2lvbkdyb3VwO1xyXG4gICAgICAgICAgICBtQ29sbGlzaW9uR3JvdXAuU2V0R3JvdXBGaWx0ZXIodGFibGUpO1xyXG4gICAgICAgICAgICBtQ29sbGlzaW9uR3JvdXAuU2V0R3JvdXBJRChncm91cCk7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRTdWJHcm91cElEKHN1Ykdyb3VwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tVaW50KGluZGV4LCBgaW52YWxpZCBib2R5IGluZGV4OiAkeyBpbmRleCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KGxheWVyLCBgaW52YWxpZCBvYmplY3QgbGF5ZXI6ICR7IGxheWVyIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1VpbnQobW90aW9uVHlwZSwgYGludmFsaWQgbW90aW9uIHR5cGU6ICR7IG1vdGlvblR5cGUgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG92ZXJyaWRlIG1hc3MgcHJvcGVydGllc1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTWV0aG9kID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrVWludChzZWxlY3RlZE1ldGhvZCwgYGludmFsaWQgbWFzcyBvdmVycmlkZSBtZXRob2Q6ICR7IHNlbGVjdGVkTWV0aG9kIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAoc2VsZWN0ZWRNZXRob2QgIT09IEpvbHQuRU92ZXJyaWRlTWFzc1Byb3BlcnRpZXNfQ2FsY3VsYXRlTWFzc0FuZEluZXJ0aWEpIHtcclxuICAgICAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU92ZXJyaWRlTWFzc1Byb3BlcnRpZXMgPSBzZWxlY3RlZE1ldGhvZDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1hc3MgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShtYXNzLCBgaW52YWxpZCBtYXNzOiAkeyBtYXNzIH1gKTtcclxuICAgICAgICAgICAgICAgIGlmICghb2spIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWFzc1Byb3BlcnRpZXNPdmVycmlkZS5tTWFzcyA9IG1hc3M7XHJcblxyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRNZXRob2QgPT09IEpvbHQuRU92ZXJyaWRlTWFzc1Byb3BlcnRpZXNfTWFzc0FuZEluZXJ0aWFQcm92aWRlZCkge1xyXG4gICAgICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBqcS5Gcm9tQnVmZmVyKGNiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBtNCA9IEpvbHQuTWF0NDQuc1JvdGF0aW9uVHJhbnNsYXRpb24oanEsIGp2KTtcclxuICAgICAgICAgICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYXNzUHJvcGVydGllc092ZXJyaWRlLm1JbmVydGlhID0gbTQ7XHJcbiAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kobTQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBib2R5SW50ZXJmYWNlID0gYmFja2VuZC5ib2R5SW50ZXJmYWNlO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBib2R5SW50ZXJmYWNlLkNyZWF0ZUJvZHkoYm9keUNyZWF0aW9uU2V0dGluZ3MpO1xyXG4gICAgICAgIGJvZHlJbnRlcmZhY2UuQWRkQm9keShib2R5LkdldElEKCksIEpvbHQuQWN0aXZhdGUpO1xyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGJvZHkuZGVidWdEcmF3ID0gZGVidWdEcmF3O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRGVzdHJveSBzaGFwZSBzZXR0aW5ncyBhZnRlciBib2R5IGlzIGNyZWF0ZWQ6XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHNoYXBlU2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveShib2R5Q3JlYXRpb25TZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIGlmIChiYWNrZW5kLmNvbmZpZy51c2VNb3Rpb25TdGF0ZXMpIHtcclxuICAgICAgICAgICAgaWYgKHVzZU1vdGlvblN0YXRlICYmIChtb3Rpb25UeXBlID09PSBKb2x0LkVNb3Rpb25UeXBlX0R5bmFtaWMgfHwgbW90aW9uVHlwZSA9PT0gSm9sdC5FTW90aW9uVHlwZV9LaW5lbWF0aWMpKSB7XHJcbiAgICAgICAgICAgICAgICBib2R5Lm1vdGlvblN0YXRlID0gbmV3IE1vdGlvblN0YXRlKGJvZHkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBiYWNrZW5kLnRyYWNrZXIuYWRkKGJvZHksIGluZGV4KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZVNvZnRCb2R5KGNiLCBtZXNoQnVmZmVycykge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzM7XHJcbiAgICAgICAgY29uc3QganEgPSB0aGlzLl9qb2x0UXVhdDtcclxuXHJcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tIFNIQVBFIFBST1BTIC0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGVTZXR0aW5ncyA9IENyZWF0b3IuY3JlYXRlU29mdEJvZHlTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgaWYgKCFzaGFwZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tIEJPRFkgUFJPUFMgLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAvLyBQQ0lEXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoaW5kZXgsIGBpbnZhbGlkIGJvZHkgaW5kZXg6ICR7IGluZGV4IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBwb3NpdGlvblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAvLyByb3RhdGlvblxyXG4gICAgICAgIGpxLkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBvYmplY3RMYXllciA9IGJhY2tlbmQuZ2V0Qml0VmFsdWUobGF5ZXIpO1xyXG4gICAgICAgIGNvbnN0IGJvZHlDcmVhdGlvblNldHRpbmdzID0gbmV3IEpvbHQuU29mdEJvZHlDcmVhdGlvblNldHRpbmdzKHNoYXBlU2V0dGluZ3MsIGp2LCBqcSk7XHJcblxyXG4gICAgICAgIC8vIGNvbGxpc2lvbiBncm91cFxyXG4gICAgICAgIGNvbnN0IGdyb3VwID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKSA6IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGNvbGxpc2lvbiBzdWIgZ3JvdXBcclxuICAgICAgICBjb25zdCBzdWJHcm91cCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMikgOiBudWxsO1xyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1PYmplY3RMYXllciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDE2KTtcclxuICAgICAgICAgICAgY29uc3QgbU51bUl0ZXJhdGlvbnMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IG1MaW5lYXJEYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbU1heExpbmVhclZlbG9jaXR5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbVJlc3RpdHV0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbUZyaWN0aW9uID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbVByZXNzdXJlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbUdyYXZpdHlGYWN0b3IgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjb25zdCBtVXBkYXRlUG9zaXRpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICBjb25zdCBtTWFrZVJvdGF0aW9uSWRlbnRpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICBjb25zdCBtQWxsb3dTbGVlcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tT2JqZWN0TGF5ZXIgPSBtT2JqZWN0TGF5ZXI7XHJcbiAgICAgICAgICAgIC8vIGJvZHlDcmVhdGlvblNldHRpbmdzLm1OdW1JdGVyYXRpb25zID0gbU51bUl0ZXJhdGlvbnM7XHJcbiAgICAgICAgICAgIC8vIGJvZHlDcmVhdGlvblNldHRpbmdzLm1MaW5lYXJEYW1waW5nID0gbUxpbmVhckRhbXBpbmc7XHJcbiAgICAgICAgICAgIC8vIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYXhMaW5lYXJWZWxvY2l0eSA9IG1NYXhMaW5lYXJWZWxvY2l0eTtcclxuICAgICAgICAgICAgLy8gYm9keUNyZWF0aW9uU2V0dGluZ3MubVJlc3RpdHV0aW9uID0gbVJlc3RpdHV0aW9uO1xyXG4gICAgICAgICAgICAvLyBib2R5Q3JlYXRpb25TZXR0aW5ncy5tRnJpY3Rpb24gPSBtRnJpY3Rpb247XHJcbiAgICAgICAgICAgIC8vIGJvZHlDcmVhdGlvblNldHRpbmdzLm1QcmVzc3VyZSA9IG1QcmVzc3VyZTtcclxuICAgICAgICAgICAgLy8gYm9keUNyZWF0aW9uU2V0dGluZ3MubUdyYXZpdHlGYWN0b3IgPSBtR3Jhdml0eUZhY3RvcjtcclxuICAgICAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubVVwZGF0ZVBvc2l0aW9uID0gbVVwZGF0ZVBvc2l0aW9uO1xyXG4gICAgICAgICAgICAvLyBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWFrZVJvdGF0aW9uSWRlbnRpdHkgPSBtTWFrZVJvdGF0aW9uSWRlbnRpdHk7XHJcbiAgICAgICAgICAgIC8vIGJvZHlDcmVhdGlvblNldHRpbmdzLm1BbGxvd1NsZWVwaW5nID0gbUFsbG93U2xlZXBpbmc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubU9iamVjdExheWVyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTnVtSXRlcmF0aW9ucyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgYm9keUNyZWF0aW9uU2V0dGluZ3MubUxpbmVhckRhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tTWF4TGluZWFyVmVsb2NpdHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tUmVzdGl0dXRpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tRnJpY3Rpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tUHJlc3N1cmUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBib2R5Q3JlYXRpb25TZXR0aW5ncy5tR3Jhdml0eUZhY3RvciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1VcGRhdGVQb3NpdGlvbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1NYWtlUm90YXRpb25JZGVudGl0eSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgIGJvZHlDcmVhdGlvblNldHRpbmdzLm1BbGxvd1NsZWVwaW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gZGVidWcgZHJhd1xyXG4gICAgICAgIGNvbnN0IGRlYnVnRHJhdyA9IERlYnVnLmRldiA/IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKGdyb3VwICE9PSBudWxsICYmIHN1Ykdyb3VwICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gYmFja2VuZC5ncm91cEZpbHRlclRhYmxlc1tncm91cF07XHJcblxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoZ3JvdXAsIGBJbnZhbGlkIGZpbHRlciBncm91cDogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1VpbnQoc3ViR3JvdXAsIGBJbnZhbGlkIGZpbHRlciBncm91cDogJHsgc3ViR3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoISF0YWJsZSwgYFRyeWluZyB0byBzZXQgYSBmaWx0ZXIgZ3JvdXAgdGhhdCBkb2VzIG5vdCBleGlzdDogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoKHN1Ykdyb3VwIDw9IHRhYmxlPy5tYXhJbmRleCksIGBUcnlpbmcgdG8gc2V0IHN1YiBncm91cCB0aGF0IGlzIG92ZXIgdGhlIGZpbHRlciBncm91cCB0YWJsZSBzaXplOiAkeyBzdWJHcm91cCB9YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtQ29sbGlzaW9uR3JvdXAgPSBib2R5Q3JlYXRpb25TZXR0aW5ncy5tQ29sbGlzaW9uR3JvdXA7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRHcm91cEZpbHRlcih0YWJsZSk7XHJcbiAgICAgICAgICAgIG1Db2xsaXNpb25Hcm91cC5TZXRHcm91cElEKGdyb3VwKTtcclxuICAgICAgICAgICAgbUNvbGxpc2lvbkdyb3VwLlNldFN1Ykdyb3VwSUQoc3ViR3JvdXApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYm9keUludGVyZmFjZSA9IGJhY2tlbmQuYm9keUludGVyZmFjZTtcclxuICAgICAgICBjb25zdCBib2R5ID0gYm9keUludGVyZmFjZS5DcmVhdGVTb2Z0Qm9keShib2R5Q3JlYXRpb25TZXR0aW5ncyk7XHJcbiAgICAgICAgYm9keUludGVyZmFjZS5BZGRCb2R5KGJvZHkuR2V0SUQoKSwgSm9sdC5BY3RpdmF0ZSk7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgYm9keS5kZWJ1Z0RyYXcgPSBkZWJ1Z0RyYXc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBEZXN0cm95IHNoYXBlIHNldHRpbmdzIGFmdGVyIGJvZHkgaXMgY3JlYXRlZDpcclxuICAgICAgICBKb2x0LmRlc3Ryb3koYm9keUNyZWF0aW9uU2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBiYWNrZW5kLnRyYWNrZXIuYWRkKGJvZHksIGluZGV4KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZVZlaGljbGUoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHBoeXNpY3NTeXN0ZW0gPSBiYWNrZW5kLnBoeXNpY3NTeXN0ZW07XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCB0eXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgY29uc3QgaXNXaGVlbGVkID0gdHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMIHx8IHR5cGUgPT09IFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkZXN0cm95U2V0dGluZ3MgPSAobGlzdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KGxpc3RbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlQ3VydmUgPSAoY3VydmUpID0+IHtcclxuICAgICAgICAgICAgICAgIGN1cnZlLkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnZlLkFkZFBvaW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUdlYXJzID0gKGdlYXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGdlYXJzLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBnZWFycy5wdXNoX2JhY2soY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVdoZWVsID0gKHdoZWVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tUG9zaXRpb24gPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1TdXNwZW5zaW9uRm9yY2VQb2ludCA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubVN1c3BlbnNpb25EaXJlY3Rpb24gPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1TdGVlcmluZ0F4aXMgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIHdoZWVsLm1XaGVlbFVwID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tV2hlZWxGb3J3YXJkID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tU3VzcGVuc2lvbk1pbkxlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tU3VzcGVuc2lvbk1heExlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tU3VzcGVuc2lvblByZWxvYWRMZW5ndGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubVJhZGl1cyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICB3aGVlbC5tV2lkdGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgd2hlZWwubUVuYWJsZVN1c3BlbnNpb25Gb3JjZVBvaW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzcHJpbmcgPSB3aGVlbC5tU3VzcGVuc2lvblNwcmluZztcclxuICAgICAgICAgICAgICAgIHNwcmluZy5tTW9kZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICAgICAgc3ByaW5nLm1GcmVxdWVuY3kgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgc3ByaW5nLm1TdGlmZm5lc3MgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgc3ByaW5nLm1EYW1waW5nID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBsb25naXR1ZGluYWwgZnJpY3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ3VydmUod2hlZWwubUxvbmdpdHVkaW5hbEZyaWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBsYXRlcmFsIGZyaWN0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUN1cnZlKHdoZWVsLm1MYXRlcmFsRnJpY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLm1JbmVydGlhID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICB3aGVlbC5tQW5ndWxhckRhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLm1NYXhTdGVlckFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICB3aGVlbC5tTWF4QnJha2VUb3JxdWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLm1NYXhIYW5kQnJha2VUb3JxdWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBnZW5lcmFsXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnRTZXR0aW5ncyA9IG5ldyBKb2x0LlZlaGljbGVDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgY29uc3RyYWludFNldHRpbmdzLm1OdW1WZWxvY2l0eVN0ZXBzT3ZlcnJpZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncy5tTnVtUG9zaXRpb25TdGVwc092ZXJyaWRlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgICAgICBjb25zdHJhaW50U2V0dGluZ3MubVVwID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncy5tRm9yd2FyZCA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICBjb25zdHJhaW50U2V0dGluZ3MubU1heFBpdGNoUm9sbEFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXJcclxuICAgICAgICAgICAgbGV0IGNvbnRyb2xsZXJTZXR0aW5ncztcclxuICAgICAgICAgICAgaWYgKGlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzID0gdHlwZSA9PT0gVkVISUNMRV9UWVBFX1dIRUVMID9cclxuICAgICAgICAgICAgICAgICAgICBuZXcgSm9sdC5XaGVlbGVkVmVoaWNsZUNvbnRyb2xsZXJTZXR0aW5ncygpIDpcclxuICAgICAgICAgICAgICAgICAgICBuZXcgSm9sdC5Nb3RvcmN5Y2xlQ29udHJvbGxlclNldHRpbmdzKClcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRTZXR0aW5ncyA9IG5ldyBKb2x0LlRyYWNrZWRWZWhpY2xlQ29udHJvbGxlclNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGVuZ2luZVxyXG4gICAgICAgICAgICBjb25zdCBlbmdpbmUgPSBjb250cm9sbGVyU2V0dGluZ3MubUVuZ2luZTtcclxuICAgICAgICAgICAgZW5naW5lLm1NYXhUb3JxdWUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBlbmdpbmUubU1pblJQTSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGVuZ2luZS5tTWF4UlBNID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgZW5naW5lLm1JbmVydGlhID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgZW5naW5lLm1Bbmd1bGFyRGFtcGluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlQ3VydmUoZW5naW5lLm1Ob3JtYWxpemVkVG9ycXVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdHJhbnNtaXNzaW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbWlzc2lvbiA9IGNvbnRyb2xsZXJTZXR0aW5ncy5tVHJhbnNtaXNzaW9uO1xyXG4gICAgICAgICAgICB0cmFuc21pc3Npb24ubU1vZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1Td2l0Y2hUaW1lID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1DbHV0Y2hSZWxlYXNlVGltZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIHRyYW5zbWlzc2lvbi5tU3dpdGNoTGF0ZW5jeSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIHRyYW5zbWlzc2lvbi5tU2hpZnRVcFJQTSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIHRyYW5zbWlzc2lvbi5tU2hpZnREb3duUlBNID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgdHJhbnNtaXNzaW9uLm1DbHV0Y2hTdHJlbmd0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIHVwZGF0ZUdlYXJzKHRyYW5zbWlzc2lvbi5tR2VhclJhdGlvcyk7XHJcbiAgICAgICAgICAgIHVwZGF0ZUdlYXJzKHRyYW5zbWlzc2lvbi5tUmV2ZXJzZUdlYXJSYXRpb3MpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIHdoZWVsc1xyXG4gICAgICAgICAgICBjb25zdCB3aGVlbHNDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbVdoZWVscyA9IGNvbnN0cmFpbnRTZXR0aW5ncy5tV2hlZWxzO1xyXG4gICAgICAgICAgICBjb25zdCBXaGVlbCA9IGlzV2hlZWxlZCA/IEpvbHQuV2hlZWxTZXR0aW5nc1dWIDogSm9sdC5XaGVlbFNldHRpbmdzVFY7XHJcbiAgICAgICAgICAgIG1XaGVlbHMuY2xlYXIoKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbHNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB3aGVlbCA9IG5ldyBXaGVlbCgpO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlV2hlZWwod2hlZWwpO1xyXG4gICAgICAgICAgICAgICAgbVdoZWVscy5wdXNoX2JhY2sod2hlZWwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZ2V0IHRyYWNrcyBhbmQgbWFwIHdoZWVsc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJhY2tzQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHRyYWNrc0NvdW50OyB0KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IGNvbnRyb2xsZXJTZXR0aW5ncy5nZXRfbVRyYWNrcyh0KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0d2MgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7IC8vIHRyYWNrIHdoZWVscyBjb3VudFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHRoZSBsYXN0IHdoZWVsIGluIHRoZSB0cmFjayB0byBiZSBhIGRyaXZlbiB3aGVlbCAoY29ubmVjdGVkIHRvIGVuZ2luZSlcclxuICAgICAgICAgICAgICAgICAgICB0cmFjay5tRHJpdmVuV2hlZWwgPSB0d2MgLSAxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHR3YzsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrLm1XaGVlbHMucHVzaF9iYWNrKGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkaWZmcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkaWZmZXJlbnRpYWxzXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaWZmZXJlbnRpYWxzID0gY29udHJvbGxlclNldHRpbmdzLm1EaWZmZXJlbnRpYWxzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgSm9sdC5WZWhpY2xlRGlmZmVyZW50aWFsU2V0dGluZ3MoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1MZWZ0V2hlZWwgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0lOVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubVJpZ2h0V2hlZWwgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0lOVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubURpZmZlcmVudGlhbFJhdGlvID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubUxlZnRSaWdodFNwbGl0ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubUxpbWl0ZWRTbGlwUmF0aW8gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tRW5naW5lVG9ycXVlUmF0aW8gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZnMucHVzaChzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZlcmVudGlhbHMucHVzaF9iYWNrKHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1EaWZmZXJlbnRpYWxMaW1pdGVkU2xpcFJhdGlvID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyU2V0dGluZ3MubU1heExlYW5BbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1MZWFuU3ByaW5nQ29uc3RhbnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJTZXR0aW5ncy5tTGVhblNwcmluZ0RhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJTZXR0aW5ncy5tTGVhblNwcmluZ0ludGVncmF0aW9uQ29lZmZpY2llbnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJTZXR0aW5ncy5tTGVhblNwcmluZ0ludGVncmF0aW9uQ29lZmZpY2llbnREZWNheSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlclNldHRpbmdzLm1MZWFuU21vb3RoaW5nRmFjdG9yID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gYW50aSByb2xsIGJhcnNcclxuICAgICAgICAgICAgY29uc3QgYmFyc0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgICAgICBjb25zdCBtQW50aVJvbGxCYXJzID0gY29uc3RyYWludFNldHRpbmdzLm1BbnRpUm9sbEJhcnM7XHJcbiAgICAgICAgICAgIGNvbnN0IGJhcnMgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiYXJzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYmFyID0gbmV3IEpvbHQuVmVoaWNsZUFudGlSb2xsQmFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgYmFyLm1MZWZ0V2hlZWwgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgICAgICBiYXIubVJpZ2h0V2hlZWwgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgICAgICBiYXIubVN0aWZmbmVzcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICAgICAgYmFycy5wdXNoKGJhcik7XHJcbiAgICAgICAgICAgICAgICBtQW50aVJvbGxCYXJzLnB1c2hfYmFjayhiYXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdHJhaW50U2V0dGluZ3MubUNvbnRyb2xsZXIgPSBjb250cm9sbGVyU2V0dGluZ3M7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25zdHJhaW50XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCBjb25zdHJhaW50ID0gbmV3IEpvbHQuVmVoaWNsZUNvbnN0cmFpbnQoYm9keSwgY29uc3RyYWludFNldHRpbmdzKTtcclxuICAgICAgICAgICAgY29uc3QgY2FzdFR5cGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgICAgICAvLyBGb3IgYmFja2VuZCB0byB3cml0ZSB3aGVlbHMgaXNvbWV0cnlcclxuICAgICAgICAgICAgYm9keS5pc1ZlaGljbGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy8gd2hlZWxzIGNvbnRhY3QgdGVzdGVyXHJcbiAgICAgICAgICAgIGxldCB0ZXN0ZXI7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoY2FzdFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfUkFZOiB7XHJcbiAgICAgICAgICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4QW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RlciA9IG5ldyBKb2x0LlZlaGljbGVDb2xsaXNpb25UZXN0ZXJSYXkobGF5ZXIsIGp2LCBtYXhBbmdsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIFZFSElDTEVfQ0FTVF9UWVBFX1NQSEVSRToge1xyXG4gICAgICAgICAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heEFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpdXMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RlciA9IG5ldyBKb2x0LlZlaGljbGVDb2xsaXNpb25UZXN0ZXJDYXN0U3BoZXJlKGxheWVyLCByYWRpdXMsIGp2LCBtYXhBbmdsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJhY3Rpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RlciA9IG5ldyBKb2x0LlZlaGljbGVDb2xsaXNpb25UZXN0ZXJDYXN0Q3lsaW5kZXIobGF5ZXIsIGZyYWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGBVbnJlY29nbml6ZWQgY2FzdCB0eXBlOiAkeyBjYXN0VHlwZSB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0cmFpbnQuU2V0VmVoaWNsZUNvbGxpc2lvblRlc3Rlcih0ZXN0ZXIpO1xyXG5cclxuICAgICAgICAgICAgLy8gZXZlbnRzXHJcbiAgICAgICAgICAgIGlmIChiYWNrZW5kLmNvbmZpZy52ZWhpY2xlQ29udGFjdEV2ZW50c0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGJhY2tlbmQubGlzdGVuZXIuaW5pdFZlaGljbGVFdmVudHMoY29uc3RyYWludCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHBoeXNpY3NTeXN0ZW0uQWRkQ29uc3RyYWludChjb25zdHJhaW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVyID0gbmV3IEpvbHQuVmVoaWNsZUNvbnN0cmFpbnRTdGVwTGlzdGVuZXIoY29uc3RyYWludCk7XHJcbiAgICAgICAgICAgIHBoeXNpY3NTeXN0ZW0uQWRkU3RlcExpc3RlbmVyKGxpc3RlbmVyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGFkZCByZWZlcmVuY2VzIGZvciBDbGVhbmVyIG9wZXJhdG9yXHJcbiAgICAgICAgICAgIGJvZHkuY29uc3RyYWludHMgPSBbaW5kZXhdO1xyXG4gICAgICAgICAgICBjb25zdHJhaW50Lmxpc3RlbmVyID0gbGlzdGVuZXI7XHJcblxyXG4gICAgICAgICAgICBsZXQgQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgaWYgKGlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICAgICAgQ29udHJvbGxlciA9IHR5cGUgPT09IFZFSElDTEVfVFlQRV9XSEVFTCA/IFxyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuV2hlZWxlZFZlaGljbGVDb250cm9sbGVyIDogXHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5Nb3RvcmN5Y2xlQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXIgPSBKb2x0LlRyYWNrZWRWZWhpY2xlQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdHJhaW50LmNvbnRyb2xsZXIgPSBKb2x0LmNhc3RPYmplY3QoY29uc3RyYWludC5HZXRDb250cm9sbGVyKCksIENvbnRyb2xsZXIpO1xyXG4gICAgICAgICAgICBjb25zdHJhaW50LndoZWVsc0NvdW50ID0gd2hlZWxzQ291bnQ7XHJcblxyXG4gICAgICAgICAgICB0cmFja2VyLmFkZENvbnN0cmFpbnQoaW5kZXgsIGNvbnN0cmFpbnQsIGJvZHkpO1xyXG5cclxuICAgICAgICAgICAgZGVzdHJveVNldHRpbmdzKGRpZmZzKTtcclxuICAgICAgICAgICAgZGVzdHJveVNldHRpbmdzKGJhcnMpO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZUdyb3VwcyhjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGdyb3Vwc0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tVaW50KGdyb3Vwc0NvdW50LCBgSW52YWxpZCBmaWx0ZXIgZ3JvdXBzIGNvdW50OiAkeyBncm91cHNDb3VudCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KGdyb3Vwc0NvdW50ID4gMCwgYEludmFsaWQgZmlsdGVyIGdyb3VwcyBjb3VudDogJHsgZ3JvdXBzQ291bnQgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBzdWJHcm91cHNDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKVxyXG4gICAgICAgICAgICBjb25zdCB0YWJsZSA9IG5ldyBKb2x0Lkdyb3VwRmlsdGVyVGFibGUoc3ViR3JvdXBzQ291bnQpO1xyXG4gICAgICAgICAgICBiYWNrZW5kLmdyb3VwRmlsdGVyVGFibGVzLnB1c2godGFibGUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoc3ViR3JvdXBzQ291bnQsIGBJbnZhbGlkIHN1YiBncm91cCBjb3VudDogJHsgc3ViR3JvdXBzQ291bnQgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0YWJsZS5tYXhJbmRleCA9IHN1Ykdyb3Vwc0NvdW50IC0gMTsgLy8gZm9yIGRlYnVnIHRlc3QgaW4gZGVidWcgbW9kZSB3aGVuIGNyZWF0aW5nIGEgYm9keVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX2pvbHRWZWMzO1xyXG4gICAgICAgIGNvbnN0IGpxID0gdGhpcy5fam9sdFF1YXQ7XHJcbiAgICAgICAgY29uc3Qgc2hhcGVUeXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcblxyXG4gICAgICAgIC8vIHNjYWxlXHJcbiAgICAgICAgY29uc3QgdXNlU2NhbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGxldCBzeCwgc3ksIHN6XHJcbiAgICAgICAgaWYgKHVzZVNjYWxlKSB7XHJcbiAgICAgICAgICAgIHN4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgc3kgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBzeiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHN4LCBgSW52YWxpZCBzY2FsZSBYOiAkeyBzeCB9YCk7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoc3ksIGBJbnZhbGlkIHNjYWxlIFk6ICR7IHN5IH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChzeiwgYEludmFsaWQgc2NhbGUgWjogJHsgc3ogfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc2V0dGluZ3MsIGhoLCByLCBjcjtcclxuICAgICAgICBzd2l0Y2ggKHNoYXBlVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0JPWDpcclxuICAgICAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgY3IgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKGNyLCBgaW52YWxpZCBjb252ZXggcmFkaXVzOiAkeyBjciB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuY3JlYXRlU2hhcGVTZXR0aW5ncyhzaGFwZVR5cGUsIGp2LCBjcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ0FQU1VMRTpcclxuICAgICAgICAgICAgICAgIGhoID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIHIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShoaCwgYGludmFsaWQgaGFsZiBoZWlnaHQ6ICR7IGhoIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShyLCBgaW52YWxpZCByYWRpdXM6ICR7IHIgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTY2FsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydCgoc3ggPT09IHN5KSAmJiAoc3kgPT09IHN6KSwgYENhcHN1bGUgc2hhcGUgc2NhbGUgbXVzdCBiZSB1bmlmb3JtOiAkeyBzeCB9LCAkeyBzeSB9LCAkeyBzeiB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghb2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLmNyZWF0ZVNoYXBlU2V0dGluZ3Moc2hhcGVUeXBlLCBoaCwgcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ1lMSU5ERVI6XHJcbiAgICAgICAgICAgICAgICBoaCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICByID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGNyID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0UG9zaXRpdmUoaGgsIGBpbnZhbGlkIGhhbGYgaGVpZ2h0OiAkeyBoaCB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0UG9zaXRpdmUociwgYGludmFsaWQgcmFkaXVzOiAkeyByIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZShjciwgYGludmFsaWQgY29udmV4IHJhZGl1czogJHsgY3IgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTY2FsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChzeCA9PT0gc3osIGBDeWxpbmRlciBzaGFwZSBzY2FsZSBtdXN0IGJlIHVuaWZvcm0gaW4gWFogcGxhbmU6ICR7IHN4IH0sICR7IHN6IH1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuY3JlYXRlU2hhcGVTZXR0aW5ncyhzaGFwZVR5cGUsIGhoLCByLCBjcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfU1BIRVJFOlxyXG4gICAgICAgICAgICAgICAgciA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHIsIGBpbnZhbGlkIHJhZGl1czogJHsgciB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZVNjYWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KChzeCA9PT0gc3kpICYmIChzeSA9PT0gc3opLCBgU3BoZXJlIHNoYXBlIHNjYWxlIG11c3QgYmUgdW5pZm9ybTogJHsgc3ggfSwgJHsgc3kgfSwgJHsgc3ogfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5jcmVhdGVTaGFwZVNldHRpbmdzKHNoYXBlVHlwZSwgcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIC8vIGludGVudGlvbmFsIGZhbGwtdGhyb3VnaFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX01FU0g6XHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ09OVkVYX0hVTEw6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IENyZWF0b3IuY3JlYXRlTWVzaFNoYXBlU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzLCBzaGFwZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX1NUQVRJQ19DT01QT1VORDpcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5fY3JlYXRlU3RhdGljQ29tcG91bmRTaGFwZVNldHRpbmdzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfSEVJR0hURklFTEQ6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZUhlaWdodEZpZWxkU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy53YXJuKCdJbnZhbGlkIHNoYXBlIHR5cGUnLCBzaGFwZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNoYXBlVHlwZSA9PT0gU0hBUEVfU1RBVElDX0NPTVBPVU5EKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBvdW5kU2V0dGluZ3MgPSBuZXcgSm9sdC5TdGF0aWNDb21wb3VuZFNoYXBlU2V0dGluZ3MoKTtcclxuICAgIFxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gc2V0dGluZ3MubGVuZ3RoOyBpIDwgZW5kOyBpICs9IDMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkU2V0dGluZ3MgPSBzZXR0aW5nc1tpXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHNldHRpbmdzW2kgKyAxXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IHNldHRpbmdzW2kgKyAyXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAganYuU2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICAgICAganEuU2V0KHJvdC54LCByb3QueSwgcm90LnosIHJvdC53KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY29tcG91bmRTZXR0aW5ncy5BZGRTaGFwZShqdiwganEsIGNoaWxkU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IGNvbXBvdW5kU2V0dGluZ3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGlzQ29tcG91bmRDaGlsZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgaWYgKCFpc0NvbXBvdW5kQ2hpbGQpIHtcclxuICAgICAgICAgICAgY29uc3QgZGVuc2l0eSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKGRlbnNpdHksIGBJbnZhbGlkIGRlbnNpdHkgdmFsdWU6ICR7IGRlbnNpdHkgfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXR0aW5ncy5tRGVuc2l0eSA9IGRlbnNpdHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBzaGFwZSBvZmZzZXRcclxuICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAganEuRnJvbUJ1ZmZlcihjYik7XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlJvdGF0ZWRUcmFuc2xhdGVkU2hhcGVTZXR0aW5ncyhqdiwganEsIHNldHRpbmdzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNlbnRlciBvZiBtYXNzIG9mZnNldFxyXG4gICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5PZmZzZXRDZW50ZXJPZk1hc3NTaGFwZVNldHRpbmdzKGp2LCBzZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodXNlU2NhbGUpIHtcclxuICAgICAgICAgICAganYuU2V0KHN4LCBzeSwgc3opO1xyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlNjYWxlZFNoYXBlU2V0dGluZ3Moc2V0dGluZ3MsIGp2KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncztcclxuICAgIH0gXHJcblxyXG4gICAgX2NyZWF0ZVN0YXRpY0NvbXBvdW5kU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBjaGlsZHJlbkNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5fY3JlYXRlU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgICAgICBpZiAoIXNldHRpbmdzKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSB7fTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNiLnJlYWRWZWMocG9zKTtcclxuICAgICAgICAgICAgY2IucmVhZFF1YXQocm90KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKHBvcywgYEludmFsaWQgc3RhdGljIGNvbXBvdW5kIGNoaWxkIHBvc2l0aW9uIHZlY3RvcmApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1F1YXQocm90LCBgSW52YWxpZCBzdGF0aWMgY29tcG91bmQgY2hpbGQgcXVhdGVybmlvbmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goc2V0dGluZ3MsIHBvcywgcm90KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjaGlsZHJlbjtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlSGVpZ2h0RmllbGRTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmFzc2VydCghIW1lc2hCdWZmZXJzLCBgTWlzc2luZyBidWZmZXJzIHRvIGdlbmVyYXRlIGEgSGVpZ2h0RmllbGQgc2hhcGU6ICR7IG1lc2hCdWZmZXJzIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQobWVzaEJ1ZmZlcnMubGVuZ3RoID4gMCwgYEludmFsaWQgYnVmZmVycyB0byBnZW5lcmF0ZSBIZWlnaHRGaWVsZCBzaGFwZTogJHsgbWVzaEJ1ZmZlcnMgfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBidWZmZXIgPSBtZXNoQnVmZmVycy5zaGlmdCgpO1xyXG4gICAgICAgIGNvbnN0IHNhbXBsZXMgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlcik7XHJcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHNhbXBsZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG5ldyBKb2x0LkhlaWdodEZpZWxkU2hhcGVTZXR0aW5ncygpO1xyXG4gICAgICAgIHNldHRpbmdzLm1PZmZzZXQgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBzZXR0aW5ncy5tU2NhbGUgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBzZXR0aW5ncy5tU2FtcGxlQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUJsb2NrU2l6ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgIHNldHRpbmdzLm1CaXRzUGVyU2FtcGxlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgc2V0dGluZ3MubUFjdGl2ZUVkZ2VDb3NUaHJlc2hvbGRBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUhlaWdodFNhbXBsZXMucmVzaXplKHNpemUpO1xyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IHRoZSBoZWlnaHQgc2FtcGxlcyBpbnRvIGEgRmxvYXQzMkFycmF5XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0U2FtcGxlcyA9IG5ldyBGbG9hdDMyQXJyYXkoSm9sdC5IRUFQRjMyLmJ1ZmZlciwgSm9sdC5nZXRQb2ludGVyKHNldHRpbmdzLm1IZWlnaHRTYW1wbGVzLmRhdGEoKSksIHNpemUpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gaGVpZ2h0U2FtcGxlcy5sZW5ndGg7IGkgPCBlbmQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBzYW1wbGVzW2ldO1xyXG4gICAgICAgICAgICBoZWlnaHRTYW1wbGVzW2ldID0gaGVpZ2h0ID49MCA/IGhlaWdodCA6IEpvbHQuSGVpZ2h0RmllbGRTaGFwZUNvbnN0YW50VmFsdWVzLnByb3RvdHlwZS5jTm9Db2xsaXNpb25WYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncztcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlQ29uc3RyYWludChjYikge1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzM7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBwaHlzaWNzU3lzdGVtID0gYmFja2VuZC5waHlzaWNzU3lzdGVtO1xyXG5cclxuICAgICAgICBjb25zdCB0eXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgaWR4MSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBpZHgyID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBjb25zdCBib2R5MSA9IHRyYWNrZXIuZ2V0Qm9keUJ5UENJRChpZHgxKTtcclxuICAgICAgICBjb25zdCBib2R5MiA9IHRyYWNrZXIuZ2V0Qm9keUJ5UENJRChpZHgyKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydCghIWJvZHkxLCBgVW5hYmxlIHRvIGxvY2F0ZSBib2R5IHRvIGFkZCBjb25zdHJhaW50IHRvOiAkeyBpZHgxIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoISFib2R5MiwgYFVuYWJsZSB0byBsb2NhdGUgYm9keSB0byBhZGQgY29uc3RyYWludCB0bzogJHsgaWR4MiB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyByZWZhY3RvciB0byBvd24gbWV0aG9kc1xyXG5cclxuICAgICAgICBsZXQgc2V0dGluZ3M7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0ZJWEVEOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5GaXhlZENvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BdXRvRGV0ZWN0UG9pbnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzZXR0aW5ncy5tQXV0b0RldGVjdFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tQXhpc1kxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUF4aXNYMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWTIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfUE9JTlQ6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlBvaW50Q29uc3RyYWludFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfRElTVEFOQ0U6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LkRpc3RhbmNlQ29uc3RyYWludFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWluRGlzdGFuY2UgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1NYXhEaXN0YW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZ1NldHRpbmdzID0gdGhpcy5fY3JlYXRlU3ByaW5nU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1MaW1pdHNTcHJpbmdTZXR0aW5ncyA9IHNwcmluZ1NldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShzcHJpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0hJTkdFOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5IaW5nZUNvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tSGluZ2VBeGlzMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ob3JtYWxBeGlzMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tSGluZ2VBeGlzMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ob3JtYWxBeGlzMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdHNNaW4gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdHNNYXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1NYXhGcmljdGlvblRvcnF1ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZ1NldHRpbmdzID0gdGhpcy5fY3JlYXRlU3ByaW5nU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1MaW1pdHNTcHJpbmdTZXR0aW5ncyA9IHNwcmluZ1NldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShzcHJpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vdG9yU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVNb3RvclNldHRpbmdzKGNiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5tTW90b3JTZXR0aW5ncyA9IG1vdG9yU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KG1vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TTElERVI6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlNsaWRlckNvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BdXRvRGV0ZWN0UG9pbnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzZXR0aW5ncy5tQXV0b0RldGVjdFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Qb2ludDEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvaW50MiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1TbGlkZXJBeGlzMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ob3JtYWxBeGlzMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1TbGlkZXJBeGlzMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ob3JtYWxBeGlzMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdHNNaW4gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdHNNYXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1NYXhGcmljdGlvbkZvcmNlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ByaW5nU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTcHJpbmdTZXR0aW5ncyhjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubUxpbWl0c1NwcmluZ1NldHRpbmdzID0gc3ByaW5nU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KHNwcmluZ1NldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW90b3JTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZU1vdG9yU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1Nb3RvclNldHRpbmdzID0gbW90b3JTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kobW90b3JTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0NPTkU6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LkNvbmVDb25zdHJhaW50U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVR3aXN0QXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9pbnQyID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVR3aXN0QXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tSGFsZkNvbmVBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX1NXSU5HX1RXSVNUOlxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBuZXcgSm9sdC5Td2luZ1R3aXN0Q29uc3RyYWludFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBvc2l0aW9uMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ud2lzdEF4aXMxID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVBsYW5lQXhpczEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9zaXRpb24yID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVR3aXN0QXhpczIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUGxhbmVBeGlzMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1Ob3JtYWxIYWxmQ29uZUFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUGxhbmVIYWxmQ29uZUFuZ2xlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tVHdpc3RNaW5BbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubVR3aXN0TWF4QW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1NYXhGcmljdGlvblRvcnF1ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3aW5nTW90b3JTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZU1vdG9yU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1Td2luZ01vdG9yU2V0dGluZ3MgPSBzd2luZ01vdG9yU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KHN3aW5nTW90b3JTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHR3aXN0TW90b3JTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZU1vdG9yU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1Ud2lzdE1vdG9yU2V0dGluZ3MgPSB0d2lzdE1vdG9yU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KHR3aXN0TW90b3JTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX1NJWF9ET0Y6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IG5ldyBKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXhpcyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChheGlzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9YOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGcmVlQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1k6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZyZWVBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1RyYW5zbGF0aW9uWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1o6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZyZWVBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1RyYW5zbGF0aW9uWik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRnJlZUF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25YKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfUk9UQVRJT05fWTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRnJlZUF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25ZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGcmVlQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19Sb3RhdGlvblopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgVW5yZWNvZ25pemVkIHNpeCBkb2YgY29uc3RyYWludCBheGlzIHNldHRpbmc6ICR7IGF4aXMgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF4aXMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYXhpcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRml4ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1RyYW5zbGF0aW9uWCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5NYWtlRml4ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1RyYW5zbGF0aW9uWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1o6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZpeGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuTWFrZUZpeGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19Sb3RhdGlvblgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9ZOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGaXhlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25ZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLk1ha2VGaXhlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25aKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYFVucmVjb2duaXplZCBzaXggZG9mIGNvbnN0cmFpbnQgYXhpcyBzZXR0aW5nOiAkeyBheGlzIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBheGlzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGF4aXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1RSQU5TTEFUSU9OX1g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuU2V0TGltaXRlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfVHJhbnNsYXRpb25YLCBtaW4sIG1heCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5TZXRMaW1pdGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblksIG1pbiwgbWF4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1NJWF9ET0ZfVFJBTlNMQVRJT05fWjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5TZXRMaW1pdGVkQXhpcyhKb2x0LlNpeERPRkNvbnN0cmFpbnRTZXR0aW5nc19FQXhpc19UcmFuc2xhdGlvblosIG1pbiwgbWF4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9YOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLlNldExpbWl0ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWCwgbWluLCBtYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9ZOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLlNldExpbWl0ZWRBeGlzKEpvbHQuU2l4RE9GQ29uc3RyYWludFNldHRpbmdzX0VBeGlzX1JvdGF0aW9uWSwgbWluLCBtYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9TSVhfRE9GX1JPVEFUSU9OX1o6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuU2V0TGltaXRlZEF4aXMoSm9sdC5TaXhET0ZDb25zdHJhaW50U2V0dGluZ3NfRUF4aXNfUm90YXRpb25aLCBtaW4sIG1heCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGBVbnJlY29nbml6ZWQgc2l4IGRvZiBjb25zdHJhaW50IGF4aXMgc2V0dGluZzogJHsgYXhpcyB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9zaXRpb24xID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUF4aXNYMSA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWTEgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tUG9zaXRpb24yID0ganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUF4aXNYMiA9IGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1BeGlzWTIgPSBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSBzZXR0aW5ncy5tTWF4RnJpY3Rpb24gPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1MaW1pdE1pbiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubUxpbWl0TWF4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ByaW5nU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTcHJpbmdTZXR0aW5ncyhjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubUxpbWl0c1NwcmluZ1NldHRpbmdzID0gc3ByaW5nU2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgSm9sdC5kZXN0cm95KHNwcmluZ1NldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW90b3JTZXR0aW5ncyA9IHRoaXMuX2NyZWF0ZU1vdG9yU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm1Nb3RvclNldHRpbmdzID0gbW90b3JTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBKb2x0LmRlc3Ryb3kobW90b3JTZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYFVucmVjb2duaXplZCBjb25zdHJhaW50IHR5cGU6ICR7IHR5cGUgfWApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIHNldHRpbmdzLm1OdW1WZWxvY2l0eVN0ZXBzT3ZlcnJpZGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuICAgICAgICBpZiAoY2IuZmxhZykgc2V0dGluZ3MubU51bVBvc2l0aW9uU3RlcHNPdmVycmlkZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgIGlmIChjYi5mbGFnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwYWNlID0gKGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpID09PSBDT05TVFJBSU5UX1NQQUNFX1dPUkxEKSA/IEpvbHQuRUNvbnN0cmFpbnRTcGFjZV9Xb3JsZFNwYWNlIDogSm9sdC5FQ29uc3RyYWludFNwYWNlX0xvY2FsVG9Cb2R5Q09NO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5tU3BhY2UgPSBzcGFjZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBzZXR0aW5ncy5DcmVhdGUoYm9keTEsIGJvZHkyKTtcclxuXHJcbiAgICAgICAgaWYgKCFib2R5MS5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICBib2R5MS5jb25zdHJhaW50cyA9IFtdO1xyXG4gICAgICAgICAgICBib2R5MS5saW5rZWQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWJvZHkyLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICAgIGJvZHkyLmNvbnN0cmFpbnRzID0gW107XHJcbiAgICAgICAgICAgIGJvZHkyLmxpbmtlZCA9IG5ldyBTZXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGJvZHkxLmNvbnN0cmFpbnRzLnB1c2goaW5kZXgpO1xyXG4gICAgICAgIGJvZHkyLmNvbnN0cmFpbnRzLnB1c2goaW5kZXgpO1xyXG5cclxuICAgICAgICBib2R5MS5saW5rZWQuYWRkKGJvZHkyKTtcclxuICAgICAgICBib2R5Mi5saW5rZWQuYWRkKGJvZHkxKTtcclxuXHJcbiAgICAgICAgdHJhY2tlci5hZGRDb25zdHJhaW50KGluZGV4LCBjb25zdHJhaW50LCBib2R5MSwgYm9keTIpO1xyXG5cclxuICAgICAgICBwaHlzaWNzU3lzdGVtLkFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZVNwcmluZ1NldHRpbmdzKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgc3ByaW5nU2V0dGluZ3MgPSBuZXcgSm9sdC5TcHJpbmdTZXR0aW5ncygpO1xyXG4gICAgICAgIGNvbnN0IG1vZGUgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCkgOiBTUFJJTkdfTU9ERV9GUkVRVUVOQ1k7XHJcbiAgICAgICAgc3ByaW5nU2V0dGluZ3MubU1vZGUgPSAobW9kZSA9PT0gU1BSSU5HX01PREVfRlJFUVVFTkNZKSA/IFxyXG4gICAgICAgICAgICBKb2x0LkVTcHJpbmdNb2RlX0ZyZXF1ZW5jeUFuZERhbXBpbmcgOiBKb2x0LkVTcHJpbmdNb2RlX1N0aWZmbmVzc0FuZERhbXBpbmc7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIHNwcmluZ1NldHRpbmdzLm1GcmVxdWVuY3kgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIGlmIChjYi5mbGFnKSBzcHJpbmdTZXR0aW5ncy5tU3RpZmZuZXNzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBpZiAoY2IuZmxhZykgc3ByaW5nU2V0dGluZ3MubURhbXBpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHJldHVybiBzcHJpbmdTZXR0aW5ncztcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlTW90b3JTZXR0aW5ncyhjYikge1xyXG4gICAgICAgIGNvbnN0IG1vdG9yU2V0dGluZ3MgPSBuZXcgSm9sdC5Nb3RvclNldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3ByaW5nc1NldHRpbmdzID0gdGhpcy5fY3JlYXRlU3ByaW5nU2V0dGluZ3MoY2IpO1xyXG4gICAgICAgICAgICBtb3RvclNldHRpbmdzLm1TcHJpbmdTZXR0aW5ncyA9IHNwcmluZ3NTZXR0aW5ncztcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KHNwcmluZ3NTZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYi5mbGFnKSBtb3RvclNldHRpbmdzLm1NaW5Gb3JjZUxpbWl0ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBpZiAoY2IuZmxhZykgbW90b3JTZXR0aW5ncy5tTWF4Rm9yY2VMaW1pdCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgaWYgKGNiLmZsYWcpIG1vdG9yU2V0dGluZ3MubU1pblRvcnF1ZUxpbWl0ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBpZiAoY2IuZmxhZykgbW90b3JTZXR0aW5ncy5tTWF4VG9ycXVlTGltaXQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICByZXR1cm4gbW90b3JTZXR0aW5ncztcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlQ2hhcmFjdGVyKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBiYWNrZW5kLmxpc3RlbmVyO1xyXG4gICAgICAgIGNvbnN0IGNoYXJFdmVudHMgPSBiYWNrZW5kLmNvbmZpZy5jaGFyQ29udGFjdEV2ZW50c0VuYWJsZWQ7XHJcbiAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuICAgICAgICBjb25zdCBqcSA9IHRoaXMuX2pvbHRRdWF0O1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbmV3IEpvbHQuQ2hhcmFjdGVyVmlydHVhbFNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNoYXBlU2V0dGluZ3MgPSB0aGlzLl9jcmVhdGVTaGFwZVNldHRpbmdzKGNiLCBudWxsKTtcclxuICAgICAgICBpZiAoIXNoYXBlU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZVNldHRpbmdzLkNyZWF0ZSgpLkdldCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNldHRpbmdzLm1TaGFwZSA9IHNoYXBlO1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCB1c2VNb3Rpb25TdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIHNldHRpbmdzLm1VcCA9IGp2O1xyXG5cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgY29uc3QgcGxhbmUgPSBuZXcgSm9sdC5QbGFuZShqdiwgZGlzdGFuY2UpO1xyXG4gICAgICAgIHNldHRpbmdzLm1TdXBwb3J0aW5nVm9sdW1lID0gcGxhbmU7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHBsYW5lKTtcclxuXHJcbiAgICAgICAgc2V0dGluZ3MubU1heFNsb3BlQW5nbGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXNzID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tTWF4U3RyZW5ndGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICBzZXR0aW5ncy5tU2hhcGVPZmZzZXQgPSBqdjtcclxuICAgICAgICBzZXR0aW5ncy5tQmFja0ZhY2VNb2RlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgc2V0dGluZ3MubVByZWRpY3RpdmVDb250YWN0RGlzdGFuY2UgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhDb2xsaXNpb25JdGVyYXRpb25zID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhDb25zdHJhaW50SXRlcmF0aW9ucyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBzZXR0aW5ncy5tTWluVGltZVJlbWFpbmluZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUNvbGxpc2lvblRvbGVyYW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubUNoYXJhY3RlclBhZGRpbmcgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1NYXhOdW1IaXRzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIHNldHRpbmdzLm1IaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgc2V0dGluZ3MubVBlbmV0cmF0aW9uUmVjb3ZlcnlTcGVlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgIGpxLkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICBpZiAoY2hhckV2ZW50cyAmJiAhbGlzdGVuZXIuY2hhckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLmluaXRDaGFyYWN0ZXJFdmVudHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNoYXJhY3RlciA9IG5ldyBKb2x0LkNoYXJhY3RlclZpcnR1YWwoc2V0dGluZ3MsIGp2LCBqcSwgYmFja2VuZC5waHlzaWNzU3lzdGVtKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXIuZGVidWdEcmF3ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKGJhY2tlbmQuY29uZmlnLnVzZU1vdGlvblN0YXRlcyAmJiB1c2VNb3Rpb25TdGF0ZSkge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXIubW90aW9uU3RhdGUgPSBuZXcgTW90aW9uU3RhdGUoY2hhcmFjdGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFyRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIGNoYXJhY3Rlci5TZXRMaXN0ZW5lcihsaXN0ZW5lci5jaGFyTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZm9yIG1vdGlvbiBzdGF0ZVxyXG4gICAgICAgIGNoYXJhY3Rlci5pc0NoYXJhY3RlciA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGZvciBzaGFwZSByZXNldFxyXG4gICAgICAgIGNoYXJhY3Rlci5vcmlnaW5hbFNoYXBlID0gc2hhcGU7XHJcblxyXG4gICAgICAgIGJhY2tlbmQudHJhY2tlci5hZGRDaGFyYWN0ZXIoY2hhcmFjdGVyLCBpbmRleCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjcmVhdGVNZXNoU2hhcGVTZXR0aW5ncyhjYiwgbWVzaEJ1ZmZlcnMsIHNoYXBlVHlwZSkge1xyXG4gICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgYmFzZSwgc3RyaWRlLCBudW1JbmRpY2VzLCB0cmlDb3VudCwgcG9zaXRpb25zLCBpbmRpY2VzXHJcbiAgICAgICAgfSA9IENyZWF0b3IucmVhZE1lc2hCdWZmZXJzKGNiLCBtZXNoQnVmZmVycyk7XHJcblxyXG4gICAgICAgIC8vIFRPRE86XHJcbiAgICAgICAgLy8gYWRkIHN1cHBvcnQgZm9yIGR1cGxpY2F0ZSB2ZXJ0aWNlcyB0ZXN0XHJcblxyXG4gICAgICAgIGNvbnN0IHAgPSBwb3NpdGlvbnM7XHJcbiAgICAgICAgbGV0IGkxLCBpMiwgaTM7XHJcbiAgICAgICAgbGV0IHNldHRpbmdzO1xyXG5cclxuICAgICAgICBpZiAoc2hhcGVUeXBlID09PSBTSEFQRV9DT05WRVhfSFVMTCkge1xyXG4gICAgICAgICAgICBjb25zdCBjYWNoZSA9IG5ldyBTZXQoKTtcclxuICAgICAgICAgICAgY29uc3QganYgPSB0aGlzLl9qb2x0VmVjMztcclxuXHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IEpvbHQuQ29udmV4SHVsbFNoYXBlU2V0dGluZ3MoKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtSW5kaWNlczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGluZGljZXNbaV0gKiBzdHJpZGU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gcFtpbmRleF07XHJcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gcFtpbmRleCArIDFdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeiA9IHBbaW5kZXggKyAyXTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBkZWR1cGxpY2F0ZSB2ZXJ0c1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyID0gYCR7eH06JHt5fToke3p9YDtcclxuICAgICAgICAgICAgICAgIGlmICghY2FjaGUuaGFzKHN0cikpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWNoZS5hZGQoc3RyKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBqdi5TZXQoeCwgeSwgeik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MubVBvaW50cy5wdXNoX2JhY2soanYpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChzaGFwZVR5cGUgPT09IFNIQVBFX01FU0gpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJpYW5nbGVzID0gbmV3IEpvbHQuVHJpYW5nbGVMaXN0KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgdHJpYW5nbGVzLnJlc2l6ZSh0cmlDb3VudCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsZXQgdjEsIHYyLCB2MztcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpMSA9IGluZGljZXNbYmFzZSArIGkgKiAzXSAqIHN0cmlkZTtcclxuICAgICAgICAgICAgICAgIGkyID0gaW5kaWNlc1tiYXNlICsgaSAqIDMgKyAxXSAqIHN0cmlkZTtcclxuICAgICAgICAgICAgICAgIGkzID0gaW5kaWNlc1tiYXNlICsgaSAqIDMgKyAyXSAqIHN0cmlkZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRyaWFuZ2xlcy5hdChpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdjEgPSB0LmdldF9tVigwKTtcclxuICAgICAgICAgICAgICAgIHYyID0gdC5nZXRfbVYoMSk7XHJcbiAgICAgICAgICAgICAgICB2MyA9IHQuZ2V0X21WKDIpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB2MS54ID0gcFtpMV07IHYxLnkgPSBwW2kxICsgMV07IHYxLnogPSBwW2kxICsgMl07XHJcbiAgICAgICAgICAgICAgICB2Mi54ID0gcFtpMl07IHYyLnkgPSBwW2kyICsgMV07IHYyLnogPSBwW2kyICsgMl07XHJcbiAgICAgICAgICAgICAgICB2My54ID0gcFtpM107IHYzLnkgPSBwW2kzICsgMV07IHYzLnogPSBwW2kzICsgMl07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gbmV3IEpvbHQuTWVzaFNoYXBlU2V0dGluZ3ModHJpYW5nbGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjcmVhdGVTb2Z0Qm9keVNoYXBlU2V0dGluZ3MoY2IsIG1lc2hCdWZmZXJzKSB7XHJcbiAgICAgICAgLy8gc2NhbGVcclxuICAgICAgICBjb25zdCB1c2VTY2FsZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgbGV0IHN4ID0gMTtcclxuICAgICAgICBsZXQgc3kgPSAxO1xyXG4gICAgICAgIGxldCBzeiA9IDE7XHJcbiAgICAgICAgaWYgKHVzZVNjYWxlKSB7XHJcbiAgICAgICAgICAgIHN4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgc3kgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBzeiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHN4LCBgSW52YWxpZCBzY2FsZSBYOiAkeyBzeCB9YCk7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoc3ksIGBJbnZhbGlkIHNjYWxlIFk6ICR7IHN5IH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChzeiwgYEludmFsaWQgc2NhbGUgWjogJHsgc3ogfWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgIGJhc2UsIHZlcnRleENvdW50LCB0cmlDb3VudCwgcG9zaXRpb25zLCBpbmRpY2VzXHJcbiAgICAgICAgfSA9IENyZWF0b3IucmVhZE1lc2hCdWZmZXJzKGNiLCBtZXNoQnVmZmVycyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgSm9sdC5Tb2Z0Qm9keVNoYXJlZFNldHRpbmdzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIHZlcnRpY2VzXHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgY29uc3QgamYgPSBuZXcgSm9sdC5GbG9hdDMoKTtcclxuICAgICAgICBjb25zdCB2ID0gbmV3IEpvbHQuU29mdEJvZHlTaGFyZWRTZXR0aW5nc1ZlcnRleCgpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydGV4Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBpMyA9IGkgKiAzO1xyXG4gICAgICAgICAgICBjb25zdCB4ID0gcG9zaXRpb25zW2kzXTtcclxuICAgICAgICAgICAgY29uc3QgeSA9IHBvc2l0aW9uc1tpMyArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCB6ID0gcG9zaXRpb25zW2kzICsgMl07XHJcblxyXG4gICAgICAgICAgICAvLyBkZWR1cGxpY2F0ZSB2ZXJ0c1xyXG4gICAgICAgICAgICBjb25zdCBzdHIgPSBgJHt4fToke3l9OiR7en1gO1xyXG4gICAgICAgICAgICBpZiAoIWNhY2hlLmhhcyhzdHIpKSB7XHJcbiAgICAgICAgICAgICAgICBjYWNoZS5hZGQoc3RyKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgamYueCA9IHggKiBzeDtcclxuICAgICAgICAgICAgICAgIGpmLnkgPSB5ICogc3k7XHJcbiAgICAgICAgICAgICAgICBqZi56ID0geiAqIHN6O1xyXG4gICAgICAgICAgICAgICAgdi5tUG9zaXRpb24gPSBqZjtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5tVmVydGljZXMucHVzaF9iYWNrKHYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB3aWR0aCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBsZW5ndGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgY29tcGxpYW5jZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgY29uc3QgZml4ZWRDb3VudCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCByb3dWZXJ0cyA9IHdpZHRoICsgMTtcclxuICAgICAgICBjb25zdCBjb2xWZXJ0cyA9IGxlbmd0aCArIDE7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIGVkZ2VzXHJcbiAgICAgICAgY29uc3QgZWRnZSA9IG5ldyBKb2x0LlNvZnRCb2R5U2hhcmVkU2V0dGluZ3NFZGdlKDAsIDEsIGNvbXBsaWFuY2UpO1xyXG4gICAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gc2V0dGluZ3MubUVkZ2VDb25zdHJhaW50cztcclxuICAgICAgICBsZXQgdjAsIHYxO1xyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgcm93VmVydHM7IHgrKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGNvbFZlcnRzOyB5KyspIHtcclxuICAgICAgICAgICAgICAgIHYwID0geSArIHggKiBjb2xWZXJ0cztcclxuICAgICAgICAgICAgICAgIGVkZ2Uuc2V0X21WZXJ0ZXgoMCwgdjApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh5IDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRnZS5zZXRfbVZlcnRleCgxLCB2MCArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzLnB1c2hfYmFjayhlZGdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh4IDwgd2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGdlLnNldF9tVmVydGV4KDEsIHYwICsgY29sVmVydHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzLnB1c2hfYmFjayhlZGdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh5IDwgbGVuZ3RoICYmIHggPCB3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHYxID0gdjAgKyBjb2xWZXJ0cyArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRnZS5zZXRfbVZlcnRleCgxLCB2MSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHMucHVzaF9iYWNrKGVkZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2V0X21WZXJ0ZXgoMCwgdjAgKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBlZGdlLnNldF9tVmVydGV4KDEsIHYxIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHMucHVzaF9iYWNrKGVkZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldHRpbmdzLkNhbGN1bGF0ZUVkZ2VMZW5ndGhzKCk7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KGVkZ2UpO1xyXG5cclxuICAgICAgICAvLyBGaXhlZCB2ZXJ0c1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZml4ZWRDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpeGVkSW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLm1WZXJ0aWNlcy5hdChmaXhlZEluZGV4KS5tSW52TWFzcyA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDcmVhdGUgZmFjZXNcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgaTEgPSBpbmRpY2VzW2Jhc2UgKyBpICogM107XHJcbiAgICAgICAgICAgIGNvbnN0IGkyID0gaW5kaWNlc1tiYXNlICsgaSAqIDMgKyAxXTtcclxuICAgICAgICAgICAgY29uc3QgaTMgPSBpbmRpY2VzW2Jhc2UgKyBpICogMyArIDJdO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MuQWRkRmFjZShuZXcgSm9sdC5Tb2Z0Qm9keVNoYXJlZFNldHRpbmdzRmFjZShpMSwgaTIsIGkzLCAwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldHRpbmdzLk9wdGltaXplKCk7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveShqZik7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHYpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHJlYWRNZXNoQnVmZmVycyhjYiwgbWVzaEJ1ZmZlcnMpIHtcclxuICAgICAgICBjb25zdCBiYXNlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IHN0cmlkZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgIGNvbnN0IHZlcnRleENvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IG51bUluZGljZXMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgaWR4TGVuZ3RoID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGlkeE9mZnNldCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja1VpbnQoYmFzZSwgYEludmFsaWQgYnVmZmVyIGJhc2UgdG8gZ2VuZXJhdGUgbWVzaC9odWxsOiAkeyBiYXNlIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1VpbnQob2Zmc2V0LCBgSW52YWxpZCBwb3NpdGlvbnMgYnVmZmVyIG9mZnNldCB0byBnZW5lcmF0ZSBtZXNoL2h1bGw6ICR7IG9mZnNldCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KHN0cmlkZSwgYEludmFsaWQgcG9zaXRpb25zIGJ1ZmZlciBzdHJpZGUgdG8gZ2VuZXJhdGUgbWVzaC9odWxsOiAkeyBzdHJpZGUgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVWludChudW1JbmRpY2VzLCBgSW52YWxpZCBpbmRpY2VzIGNvdW50IHRvIGdlbmVyYXRlIG1lc2gvaHVsbDogJHsgbnVtSW5kaWNlcyB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhbWVzaEJ1ZmZlcnMsIGBObyBtZXNoIGJ1ZmZlcnMgdG8gZ2VuZXJhdGUgYSBtZXNoL2h1bGw6ICR7IG1lc2hCdWZmZXJzIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQobWVzaEJ1ZmZlcnMubGVuZ3RoID4gMSwgYEludmFsaWQgYnVmZmVycyB0byBnZW5lcmF0ZSBtZXNoL2h1bGw6ICR7IG1lc2hCdWZmZXJzIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBvc0J1ZmZlciA9IG1lc2hCdWZmZXJzLnNoaWZ0KCk7XHJcbiAgICAgICAgY29uc3QgaWR4QnVmZmVyID0gbWVzaEJ1ZmZlcnMuc2hpZnQoKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KHBvc0J1ZmZlciwgb2Zmc2V0KTsgLy8gdmVydGV4IHBvc2l0aW9uc1xyXG4gICAgICAgIGNvbnN0IGFycmF5Q29uc3RydWN0b3IgPSBudW1JbmRpY2VzID4gNjU1MzUgPyBVaW50MzJBcnJheSA6IFVpbnQxNkFycmF5O1xyXG4gICAgICAgIGNvbnN0IGluZGljZXMgPSBuZXcgYXJyYXlDb25zdHJ1Y3RvcihpZHhCdWZmZXIsIGlkeE9mZnNldCwgaWR4TGVuZ3RoKTtcclxuICAgICAgICBjb25zdCB0cmlDb3VudCA9IE1hdGguZmxvb3IobnVtSW5kaWNlcyAvIDMpO1xyXG5cclxuICAgICAgICByZXR1cm4geyBiYXNlLCBzdHJpZGUsIHZlcnRleENvdW50LCBudW1JbmRpY2VzLCB0cmlDb3VudCwgcG9zaXRpb25zLCBpbmRpY2VzIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IENyZWF0b3IgfTtcclxuXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/creator.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/drawer.mjs":
/*!************************************************!*\
  !*** ./src/backends/jolt/operators/drawer.mjs ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Drawer: () => (/* binding */ Drawer)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Drawer {\r\n    constructor() {\r\n        this._joltAabb = Jolt.AABox.prototype.sBiggest();\r\n        this._joltQuat = Jolt.Quat.prototype.sIdentity();\r\n        this._scale = new Jolt.Vec3(1, 1, 1);\r\n        this._data = [];\r\n        this._buffers = [];\r\n        this._contexts = [];\r\n    }\r\n\r\n    get data() {\r\n        return this._data;\r\n    }\r\n\r\n    get buffers() {\r\n        return this._buffers;\r\n    }\r\n\r\n    get dirty() {\r\n        return this._data.length > 0;\r\n    }\r\n\r\n    write(tracker) {\r\n        const debugBodies = tracker.debug;\r\n\r\n        if (debugBodies.size === 0) {\r\n            return true;\r\n        }\r\n\r\n        let ok = true;\r\n        debugBodies.forEach(body => {\r\n            ok = ok && this._writeShape(body, tracker);\r\n        });\r\n\r\n        return ok;\r\n    }\r\n\r\n    reset() {\r\n        this._data.length = 0;\r\n        this._buffers.length = 0;\r\n    }\r\n\r\n    destroy() {\r\n        this.reset();\r\n\r\n        Jolt.destroy(this._joltAabb);\r\n        this._joltAabb = null;\r\n\r\n        Jolt.destroy(this._joltQuat);\r\n        this._joltQuat = null;\r\n\r\n        Jolt.destroy(this._scale);\r\n        this._scale = null;\r\n    }\r\n\r\n    _writeShape(body, tracker) {\r\n        try {\r\n            const motionType = body.isCharacter ? Jolt.EMotionType_Kinematic : body.GetMotionType();\r\n            const isRigidBody = body.GetBodyType() === Jolt.EBodyType_RigidBody;\r\n\r\n            const data = body.debugDrawData;\r\n            if (data) {\r\n                if (isRigidBody) {\r\n                    const buffer = Jolt.HEAPF32.buffer;\r\n\r\n                    this._data.push(...data, motionType, buffer);\r\n                    this._buffers.push(buffer);\r\n\r\n                    return true;\r\n                } else {\r\n                    // Soft body will have new vertex positions, so we need to create a new triContext\r\n                    Jolt.destroy(body.triContext);\r\n                    body.triContext = null;\r\n                    body.debugDrawData = null;\r\n                }\r\n            }\r\n\r\n            const shape = body.GetShape();\r\n            const index = tracker.getPCID(Jolt.getPointer(body));\r\n            const triContext = new Jolt.ShapeGetTriangles(shape, Jolt.AABox.prototype.sBiggest(), shape.GetCenterOfMass(), Jolt.Quat.prototype.sIdentity(), this._scale);\r\n            const byteOffset = triContext.GetVerticesData();\r\n            const length = triContext.GetVerticesSize() / _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.FLOAT32_SIZE;\r\n            const buffer = Jolt.HEAPF32.buffer;\r\n\r\n            body.debugDrawData = [index, length, byteOffset];\r\n            body.triContext = triContext;\r\n\r\n            this._data.push(index, length, byteOffset, motionType, buffer);\r\n            this._buffers.push(buffer);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    get views() {\r\n        return this._views;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvZHJhd2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvb3BlcmF0b3JzL2RyYXdlci5tanM/ZGVlMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGTE9BVDMyX1NJWkUgfSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY2xhc3MgRHJhd2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuX2pvbHRBYWJiID0gSm9sdC5BQUJveC5wcm90b3R5cGUuc0JpZ2dlc3QoKTtcclxuICAgICAgICB0aGlzLl9qb2x0UXVhdCA9IEpvbHQuUXVhdC5wcm90b3R5cGUuc0lkZW50aXR5KCk7XHJcbiAgICAgICAgdGhpcy5fc2NhbGUgPSBuZXcgSm9sdC5WZWMzKDEsIDEsIDEpO1xyXG4gICAgICAgIHRoaXMuX2RhdGEgPSBbXTtcclxuICAgICAgICB0aGlzLl9idWZmZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5fY29udGV4dHMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYnVmZmVycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnVmZmVycztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGEubGVuZ3RoID4gMDtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZSh0cmFja2VyKSB7XHJcbiAgICAgICAgY29uc3QgZGVidWdCb2RpZXMgPSB0cmFja2VyLmRlYnVnO1xyXG5cclxuICAgICAgICBpZiAoZGVidWdCb2RpZXMuc2l6ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgZGVidWdCb2RpZXMuZm9yRWFjaChib2R5ID0+IHtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiB0aGlzLl93cml0ZVNoYXBlKGJvZHksIHRyYWNrZXIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5fZGF0YS5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX2J1ZmZlcnMubGVuZ3RoID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRBYWJiKTtcclxuICAgICAgICB0aGlzLl9qb2x0QWFiYiA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0UXVhdCk7XHJcbiAgICAgICAgdGhpcy5fam9sdFF1YXQgPSBudWxsO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fc2NhbGUpO1xyXG4gICAgICAgIHRoaXMuX3NjYWxlID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVTaGFwZShib2R5LCB0cmFja2VyKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgbW90aW9uVHlwZSA9IGJvZHkuaXNDaGFyYWN0ZXIgPyBKb2x0LkVNb3Rpb25UeXBlX0tpbmVtYXRpYyA6IGJvZHkuR2V0TW90aW9uVHlwZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBpc1JpZ2lkQm9keSA9IGJvZHkuR2V0Qm9keVR5cGUoKSA9PT0gSm9sdC5FQm9keVR5cGVfUmlnaWRCb2R5O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGJvZHkuZGVidWdEcmF3RGF0YTtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1JpZ2lkQm9keSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IEpvbHQuSEVBUEYzMi5idWZmZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEucHVzaCguLi5kYXRhLCBtb3Rpb25UeXBlLCBidWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1ZmZlcnMucHVzaChidWZmZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU29mdCBib2R5IHdpbGwgaGF2ZSBuZXcgdmVydGV4IHBvc2l0aW9ucywgc28gd2UgbmVlZCB0byBjcmVhdGUgYSBuZXcgdHJpQ29udGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIEpvbHQuZGVzdHJveShib2R5LnRyaUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHkudHJpQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keS5kZWJ1Z0RyYXdEYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2hhcGUgPSBib2R5LkdldFNoYXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihib2R5KSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaUNvbnRleHQgPSBuZXcgSm9sdC5TaGFwZUdldFRyaWFuZ2xlcyhzaGFwZSwgSm9sdC5BQUJveC5wcm90b3R5cGUuc0JpZ2dlc3QoKSwgc2hhcGUuR2V0Q2VudGVyT2ZNYXNzKCksIEpvbHQuUXVhdC5wcm90b3R5cGUuc0lkZW50aXR5KCksIHRoaXMuX3NjYWxlKTtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZU9mZnNldCA9IHRyaUNvbnRleHQuR2V0VmVydGljZXNEYXRhKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHRyaUNvbnRleHQuR2V0VmVydGljZXNTaXplKCkgLyBGTE9BVDMyX1NJWkU7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IEpvbHQuSEVBUEYzMi5idWZmZXI7XHJcblxyXG4gICAgICAgICAgICBib2R5LmRlYnVnRHJhd0RhdGEgPSBbaW5kZXgsIGxlbmd0aCwgYnl0ZU9mZnNldF07XHJcbiAgICAgICAgICAgIGJvZHkudHJpQ29udGV4dCA9IHRyaUNvbnRleHQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9kYXRhLnB1c2goaW5kZXgsIGxlbmd0aCwgYnl0ZU9mZnNldCwgbW90aW9uVHlwZSwgYnVmZmVyKTtcclxuICAgICAgICAgICAgdGhpcy5fYnVmZmVycy5wdXNoKGJ1ZmZlcik7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdmlld3MoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdzO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBEcmF3ZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/drawer.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/listener.mjs":
/*!**************************************************!*\
  !*** ./src/backends/jolt/operators/listener.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Listener: () => (/* binding */ Listener)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nclass Listener {\r\n    constructor(backend) {\r\n        this._listener = null;\r\n        this._charListener = null;\r\n\r\n        this._backend = backend;\r\n\r\n        this._contactsData = [0];\r\n        this._contactsCache = new Set();\r\n\r\n        this._charContactsData = new Map();\r\n    }\r\n\r\n    get dirty() {\r\n        return (this._contactsData[0] > 0 || this._charContactsData[0] > 0);\r\n    }\r\n\r\n    get charListener() {\r\n        return this._charListener;\r\n    }\r\n\r\n    // Contact Events\r\n\r\n    onContactValidate(body1, body2, baseOffset, collideShapeResult) {\r\n        return Jolt.ValidateResult_AcceptAllContactsForThisBodyPair;\r\n    }\r\n\r\n    initEvents(config) {\r\n        const listener = new Jolt.ContactListenerJS();\r\n        listener.OnContactValidate = this.onContactValidate.bind(this);\r\n        \r\n        if (config.contactAddedEventsEnabled) {\r\n            listener.OnContactAdded = this.onContactAdded.bind(this);\r\n        } else {\r\n            listener.OnContactAdded = () => {};\r\n        }\r\n\r\n        if (config.contactPersistedEventsEnabled) {\r\n            listener.OnContactPersisted = this.onContactPersisted.bind(this);\r\n        } else {\r\n            listener.OnContactPersisted = () => {};\r\n        }\r\n\r\n        if (config.contactRemovedEventsEnabled) {\r\n            listener.OnContactRemoved = this.onContactRemoved.bind(this);\r\n        } else {\r\n            listener.OnContactRemoved = () => {};\r\n        }\r\n\r\n        this._backend.physicsSystem.SetContactListener(listener);\r\n\r\n        this._listener = listener;\r\n    }\r\n\r\n    overrideContacts(listenerType, overrides) {\r\n        if (listenerType === 'char' && !this._charListener) {\r\n            this.initCharacterEvents();\r\n        }\r\n\r\n        const listener = listenerType === 'contacts' ? this._listener : this._charListener;\r\n\r\n        for (const [method, funcStr] of Object.entries(overrides)) {\r\n            listener[method] = eval('(' + funcStr + ')');\r\n        }\r\n    }\r\n\r\n    onContactPersisted(b1Pointer, b2Pointer, manifoldPointer, settingsPointer) {\r\n        this._wrapAndWrite(b1Pointer, b2Pointer, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_PERSISTED, false);\r\n    }\r\n\r\n    onContactRemoved(subShapePairPointer) {\r\n        const subShapePair = Jolt.wrapPointer(subShapePairPointer, Jolt.SubShapeIDPair);\r\n        const bodyLockInterface = this._backend.physicsSystem.GetBodyLockInterface();\r\n\r\n        let body1 = bodyLockInterface.TryGetBody(subShapePair.GetBody1ID());\r\n        let body2 = bodyLockInterface.TryGetBody(subShapePair.GetBody2ID());\r\n\r\n        // A body could have been destroyed by the time this closure is called.\r\n        // Check if the body is still valid:\r\n        if (Jolt.getPointer(body1) === 0) {\r\n            body1 = null;\r\n        }\r\n        if (Jolt.getPointer(body2) === 0) {\r\n            body2 = null;\r\n        }\r\n\r\n        this._writeContactPair(body1, body2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_REMOVED, true);\r\n    }\r\n\r\n    onContactAdded(b1Pointer, b2Pointer, manifoldPointer, settingsPointer) {\r\n        const data = this._contactsData;\r\n        const { contactPoints, contactPointsAveraged } = this._backend.config;\r\n        const manifold = Jolt.wrapPointer(manifoldPointer, Jolt.ContactManifold);\r\n\r\n        this._wrapAndWrite(b1Pointer, b2Pointer, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_ADDED, true);\r\n\r\n        const n = manifold.mWorldSpaceNormal;\r\n        const d = manifold.mPenetrationDepth;\r\n\r\n        data.push(n.GetX(), n.GetY(), n.GetZ(), d);\r\n\r\n        if (contactPoints) {\r\n            const jv = Jolt.Vec3.prototype.sZero();\r\n            const offset = manifold.mBaseOffset;\r\n            const points1 = manifold.mRelativeContactPointsOn1;\r\n            const points2 = manifold.mRelativeContactPointsOn2;\r\n            const count1 = points1.size();\r\n\r\n            if (contactPointsAveraged) {\r\n                for (let i = 0; i < count1; i++) {\r\n                    jv.Add(points1.at(i));\r\n                }\r\n                jv.Mul(1 / count1);\r\n                jv.Add(offset);\r\n                data.push(jv.GetX(), jv.GetY(), jv.GetZ());\r\n            } else {\r\n                const count2 = points1.size();\r\n                data.push(offset.GetX(), offset.GetY(), offset.GetZ(), count1, count2);\r\n                for (let i = 0; i < count1; i++) {\r\n                    const p = points1.at(i);\r\n                    data.push(p.GetX(), p.GetY(), p.GetZ());\r\n                }\r\n                for (let i = 0; i < count2; i++) {\r\n                    const p = points2.at(i);\r\n                    data.push(p.GetX(), p.GetY(), p.GetZ());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Character contact events\r\n\r\n    initCharacterEvents() {\r\n        const listener = new Jolt.CharacterContactListenerJS();\r\n\r\n        listener.OnAdjustBodyVelocity = () => {};\r\n\r\n        listener.OnContactValidate = (character, bodyID2, subShapeID2) => {\r\n            // allow all\r\n            return true;\r\n        };\r\n\r\n        listener.OnContactAdded = () => {};\r\n\r\n        listener.OnContactSolve = this.onCharContactSolve.bind(this);\r\n\r\n        this._charListener = listener;\r\n    }\r\n\r\n    onCharContactSolve(character, bodyID2, subShapeID2, cp, cn, cv, contactMaterial, characterVelocity, nv) {\r\n        character = Jolt.wrapPointer(character, Jolt.CharacterVirtual);\r\n        cp = Jolt.wrapPointer(cp, Jolt.Vec3);\r\n        cn = Jolt.wrapPointer(cn, Jolt.Vec3);\r\n        cv = Jolt.wrapPointer(cv, Jolt.Vec3);\r\n        nv = Jolt.wrapPointer(nv, Jolt.Vec3);\r\n\r\n        const tracker = this._backend.tracker;\r\n        const data = this._charContactsData;\r\n        const index = tracker.getPCID(Jolt.getPointer(character));\r\n        \r\n        const bodyLockInterface = this._backend.physicsSystem.GetBodyLockInterface();\r\n\r\n        let body2 = bodyLockInterface.TryGetBody(bodyID2);\r\n        if (Jolt.getPointer(body2) === 0) {\r\n            body2 = null;\r\n        }\r\n\r\n        let contacts = data.get(index);\r\n        if (!contacts) {\r\n            contacts = [0];\r\n            data.set(index, contacts);\r\n        }\r\n\r\n        contacts[0] = ++contacts[0];\r\n\r\n        contacts.push(!!body2);\r\n        if (body2) {\r\n            const index2 = tracker.getPCID(Jolt.getPointer(body2));\r\n            contacts.push(index2);\r\n        } else {\r\n            contacts.push(null);\r\n        }\r\n\r\n        // contact position\r\n        contacts.push(cp.GetX());\r\n        contacts.push(cp.GetY());\r\n        contacts.push(cp.GetZ());\r\n\r\n        // contact normal\r\n        contacts.push(cn.GetX());\r\n        contacts.push(cn.GetY());\r\n        contacts.push(cn.GetZ());\r\n\r\n        // contact velocity\r\n        contacts.push(cv.GetX());\r\n        contacts.push(cv.GetY());\r\n        contacts.push(cv.GetZ());\r\n\r\n        // new character velocity\r\n        contacts.push(nv.GetX());\r\n        contacts.push(nv.GetY());\r\n        contacts.push(nv.GetZ());\r\n    }\r\n\r\n    initVehicleEvents(constraint) {\r\n        const listener = Jolt.VehicleConstraintCallbacksJS();\r\n\r\n        listener.GetCombinedFriction = (wheelIndex, tireFrictionDirection, tireFriction, body2, subShapeID2) => {\r\n            body2 = Jolt.wrapPointer(body2, Jolt.Body);\r\n            return Math.sqrt(tireFriction * body2.GetFriction()); // This is the default calculation\r\n        };\r\n        listener.OnPreStepCallback = () => {};\r\n        listener.OnPostCollideCallback = () => {};\r\n        listener.OnPostStepCallback = () => {};\r\n\r\n        listener.SetVehicleConstraint(constraint);\r\n\r\n        this._vehicleListener = listener;\r\n    }\r\n\r\n    write(cb) {\r\n        this._writeContactEvents(cb);\r\n        this._writeCharacterEvents(cb);\r\n    }\r\n\r\n    reset(cb) {\r\n        this._contactsData.length = 0;\r\n        this._contactsData[0] = 0;\r\n        this._contactsCache.clear();\r\n        this._charContactsData.clear();\r\n    }\r\n\r\n    destroy() {\r\n        if (this._listener) {\r\n            Jolt.destroy(this._listener);\r\n            this._listener = null;\r\n        }\r\n\r\n        if (this._charListener) {\r\n            Jolt.destroy(this._charListener);\r\n            this._charListener = null;\r\n        }\r\n    }\r\n\r\n    _writeContactEvents(cb) {\r\n        const data = this._contactsData;\r\n        const contactsCount = data[0];\r\n        \r\n        if (contactsCount === 0) {\r\n            return;\r\n        }\r\n        \r\n        const { contactPoints, contactPointsAveraged } = this._backend.config;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_BODY);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_CONTACTS);\r\n        \r\n        cb.write(contactsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // TODO\r\n        // average points per contact pair, instead of all contacts\r\n\r\n        for (let i = 0, k = 1; i < contactsCount; i++) {\r\n            // type\r\n            const type = data[k++];\r\n            cb.write(type, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT8, false);\r\n\r\n            // idx1, idx2, can be -1\r\n            const isValidBody1 = data[k++];\r\n            const isValidBody2 = data[k++];\r\n            cb.write(isValidBody1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n            cb.write(isValidBody2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n            if (isValidBody1) {\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n            if (isValidBody2) {\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n\r\n            if (type === _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CONTACT_TYPE_ADDED) {\r\n                // normal xyz\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                \r\n                // depth\r\n                cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n    \r\n                cb.write(contactPoints, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                if (contactPoints) {\r\n    \r\n                    cb.write(contactPointsAveraged, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                    if (contactPointsAveraged) {\r\n                        // world point\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                    } else {\r\n                        // offset\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        \r\n                        // count1, count2\r\n                        const count1 = data[k++];\r\n                        const count2 = data[k++];\r\n                        cb.write(count1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n                        cb.write(count2, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n    \r\n                        // local points\r\n                        for (let i = 0; i < count1; i++) {\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        }\r\n                        for (let i = 0; i < count2; i++) {\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                            cb.write(data[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                        }                    \r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeCharacterEvents(cb) {\r\n        const data = this._charContactsData;\r\n        const charsCount = data.size;\r\n\r\n        // Skip writing contact events, if there are none\r\n        let skip = true;\r\n        data.forEach(contacts => {\r\n            if (contacts[0] > 0)\r\n                skip = false;\r\n        });\r\n        if (skip)\r\n            return;\r\n\r\n        cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n        cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_CONTACTS);\r\n        cb.write(charsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n        data.forEach((contacts, index) => {\r\n            const contactsCount = contacts[0];\r\n\r\n            cb.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(contactsCount, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0, k = 1; i < contactsCount; i++) {\r\n                // is body 2 valid\r\n                cb.write(contacts[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_BOOL, false);\r\n                cb.write(contacts[k++] || 0, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n                \r\n                // contact position\r\n                // contact normal\r\n                // contact velocity\r\n                // new char velocity\r\n                for (let n = 0; n < 12; n++) {\r\n                    cb.write(contacts[k++], _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_FLOAT32, false);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    _wrapAndWrite(b1Pointer, b2Pointer, type, ignoreCache) {\r\n        const Body = Jolt.Body;\r\n\r\n        const body1 = Jolt.wrapPointer(b1Pointer, Body);\r\n\t\tconst body2 = Jolt.wrapPointer(b2Pointer, Body);\r\n\r\n        this._writeContactPair(body1, body2, type, ignoreCache);\r\n    }\r\n\r\n    _writeContactPair(body1, body2, type, ignoreCache) {\r\n        const tracker = this._backend.tracker;\r\n        const data = this._contactsData;\r\n\r\n        let idx1 = null;\r\n        if (body1 !== null) {\r\n            idx1 = tracker.getPCID(Jolt.getPointer(body1)) ?? null;\r\n        }\r\n\r\n        let idx2 = null;\r\n        if (body2 !== null) {\r\n            idx2 = tracker.getPCID(Jolt.getPointer(body2)) ?? null;\r\n        }\r\n\r\n        // Persisted contacts will be called once per substep, which may \r\n        // happen multiple times per sim step. For general purposes, the first\r\n        // substep results should be enough, so we can discard the same\r\n        // contact pair after the first substep.\r\n        if (!ignoreCache && body1 && body2) {\r\n            const cache = this._contactsCache;\r\n            const str = `${ idx1 }:${ idx2 }:${ type }`;\r\n            if (cache.has(str)) {\r\n                return;\r\n            }\r\n            cache.add(str);\r\n        }\r\n\r\n        data[0] = ++data[0];\r\n\r\n        data.push(type);\r\n        data.push(!!body1);\r\n        data.push(!!body2);\r\n\r\n        if (body1)\r\n            data.push(idx1);\r\n        \r\n        if (body2)\r\n            data.push(idx2);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbGlzdGVuZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbGlzdGVuZXIubWpzP2U0YzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UOCwgQ01EX1JFUE9SVF9DT05UQUNUUyxcclxuICAgIENPTVBPTkVOVF9TWVNURU1fQk9EWSwgQ09NUE9ORU5UX1NZU1RFTV9DSEFSLCBDT05UQUNUX1RZUEVfQURERUQsIENPTlRBQ1RfVFlQRV9QRVJTSVNURUQsXHJcbiAgICBDT05UQUNUX1RZUEVfUkVNT1ZFRFxyXG59IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcblxyXG5jbGFzcyBMaXN0ZW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2NoYXJMaXN0ZW5lciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2JhY2tlbmQgPSBiYWNrZW5kO1xyXG5cclxuICAgICAgICB0aGlzLl9jb250YWN0c0RhdGEgPSBbMF07XHJcbiAgICAgICAgdGhpcy5fY29udGFjdHNDYWNoZSA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2hhckNvbnRhY3RzRGF0YSA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLl9jb250YWN0c0RhdGFbMF0gPiAwIHx8IHRoaXMuX2NoYXJDb250YWN0c0RhdGFbMF0gPiAwKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2hhckxpc3RlbmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyTGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29udGFjdCBFdmVudHNcclxuXHJcbiAgICBvbkNvbnRhY3RWYWxpZGF0ZShib2R5MSwgYm9keTIsIGJhc2VPZmZzZXQsIGNvbGxpZGVTaGFwZVJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybiBKb2x0LlZhbGlkYXRlUmVzdWx0X0FjY2VwdEFsbENvbnRhY3RzRm9yVGhpc0JvZHlQYWlyO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRFdmVudHMoY29uZmlnKSB7XHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgSm9sdC5Db250YWN0TGlzdGVuZXJKUygpO1xyXG4gICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFZhbGlkYXRlID0gdGhpcy5vbkNvbnRhY3RWYWxpZGF0ZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChjb25maWcuY29udGFjdEFkZGVkRXZlbnRzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICBsaXN0ZW5lci5PbkNvbnRhY3RBZGRlZCA9IHRoaXMub25Db250YWN0QWRkZWQuYmluZCh0aGlzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsaXN0ZW5lci5PbkNvbnRhY3RBZGRlZCA9ICgpID0+IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbmZpZy5jb250YWN0UGVyc2lzdGVkRXZlbnRzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICBsaXN0ZW5lci5PbkNvbnRhY3RQZXJzaXN0ZWQgPSB0aGlzLm9uQ29udGFjdFBlcnNpc3RlZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFBlcnNpc3RlZCA9ICgpID0+IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbmZpZy5jb250YWN0UmVtb3ZlZEV2ZW50c0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgbGlzdGVuZXIuT25Db250YWN0UmVtb3ZlZCA9IHRoaXMub25Db250YWN0UmVtb3ZlZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyLk9uQ29udGFjdFJlbW92ZWQgPSAoKSA9PiB7fTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2JhY2tlbmQucGh5c2ljc1N5c3RlbS5TZXRDb250YWN0TGlzdGVuZXIobGlzdGVuZXIpO1xyXG5cclxuICAgICAgICB0aGlzLl9saXN0ZW5lciA9IGxpc3RlbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlQ29udGFjdHMobGlzdGVuZXJUeXBlLCBvdmVycmlkZXMpIHtcclxuICAgICAgICBpZiAobGlzdGVuZXJUeXBlID09PSAnY2hhcicgJiYgIXRoaXMuX2NoYXJMaXN0ZW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRDaGFyYWN0ZXJFdmVudHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVyID0gbGlzdGVuZXJUeXBlID09PSAnY29udGFjdHMnID8gdGhpcy5fbGlzdGVuZXIgOiB0aGlzLl9jaGFyTGlzdGVuZXI7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgW21ldGhvZCwgZnVuY1N0cl0gb2YgT2JqZWN0LmVudHJpZXMob3ZlcnJpZGVzKSkge1xyXG4gICAgICAgICAgICBsaXN0ZW5lclttZXRob2RdID0gZXZhbCgnKCcgKyBmdW5jU3RyICsgJyknKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25Db250YWN0UGVyc2lzdGVkKGIxUG9pbnRlciwgYjJQb2ludGVyLCBtYW5pZm9sZFBvaW50ZXIsIHNldHRpbmdzUG9pbnRlcikge1xyXG4gICAgICAgIHRoaXMuX3dyYXBBbmRXcml0ZShiMVBvaW50ZXIsIGIyUG9pbnRlciwgQ09OVEFDVF9UWVBFX1BFUlNJU1RFRCwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ29udGFjdFJlbW92ZWQoc3ViU2hhcGVQYWlyUG9pbnRlcikge1xyXG4gICAgICAgIGNvbnN0IHN1YlNoYXBlUGFpciA9IEpvbHQud3JhcFBvaW50ZXIoc3ViU2hhcGVQYWlyUG9pbnRlciwgSm9sdC5TdWJTaGFwZUlEUGFpcik7XHJcbiAgICAgICAgY29uc3QgYm9keUxvY2tJbnRlcmZhY2UgPSB0aGlzLl9iYWNrZW5kLnBoeXNpY3NTeXN0ZW0uR2V0Qm9keUxvY2tJbnRlcmZhY2UoKTtcclxuXHJcbiAgICAgICAgbGV0IGJvZHkxID0gYm9keUxvY2tJbnRlcmZhY2UuVHJ5R2V0Qm9keShzdWJTaGFwZVBhaXIuR2V0Qm9keTFJRCgpKTtcclxuICAgICAgICBsZXQgYm9keTIgPSBib2R5TG9ja0ludGVyZmFjZS5UcnlHZXRCb2R5KHN1YlNoYXBlUGFpci5HZXRCb2R5MklEKCkpO1xyXG5cclxuICAgICAgICAvLyBBIGJvZHkgY291bGQgaGF2ZSBiZWVuIGRlc3Ryb3llZCBieSB0aGUgdGltZSB0aGlzIGNsb3N1cmUgaXMgY2FsbGVkLlxyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBib2R5IGlzIHN0aWxsIHZhbGlkOlxyXG4gICAgICAgIGlmIChKb2x0LmdldFBvaW50ZXIoYm9keTEpID09PSAwKSB7XHJcbiAgICAgICAgICAgIGJvZHkxID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihib2R5MikgPT09IDApIHtcclxuICAgICAgICAgICAgYm9keTIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fd3JpdGVDb250YWN0UGFpcihib2R5MSwgYm9keTIsIENPTlRBQ1RfVFlQRV9SRU1PVkVELCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNvbnRhY3RBZGRlZChiMVBvaW50ZXIsIGIyUG9pbnRlciwgbWFuaWZvbGRQb2ludGVyLCBzZXR0aW5nc1BvaW50ZXIpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fY29udGFjdHNEYXRhO1xyXG4gICAgICAgIGNvbnN0IHsgY29udGFjdFBvaW50cywgY29udGFjdFBvaW50c0F2ZXJhZ2VkIH0gPSB0aGlzLl9iYWNrZW5kLmNvbmZpZztcclxuICAgICAgICBjb25zdCBtYW5pZm9sZCA9IEpvbHQud3JhcFBvaW50ZXIobWFuaWZvbGRQb2ludGVyLCBKb2x0LkNvbnRhY3RNYW5pZm9sZCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3dyYXBBbmRXcml0ZShiMVBvaW50ZXIsIGIyUG9pbnRlciwgQ09OVEFDVF9UWVBFX0FEREVELCB0cnVlKTtcclxuXHJcbiAgICAgICAgY29uc3QgbiA9IG1hbmlmb2xkLm1Xb3JsZFNwYWNlTm9ybWFsO1xyXG4gICAgICAgIGNvbnN0IGQgPSBtYW5pZm9sZC5tUGVuZXRyYXRpb25EZXB0aDtcclxuXHJcbiAgICAgICAgZGF0YS5wdXNoKG4uR2V0WCgpLCBuLkdldFkoKSwgbi5HZXRaKCksIGQpO1xyXG5cclxuICAgICAgICBpZiAoY29udGFjdFBvaW50cykge1xyXG4gICAgICAgICAgICBjb25zdCBqdiA9IEpvbHQuVmVjMy5wcm90b3R5cGUuc1plcm8oKTtcclxuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gbWFuaWZvbGQubUJhc2VPZmZzZXQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvaW50czEgPSBtYW5pZm9sZC5tUmVsYXRpdmVDb250YWN0UG9pbnRzT24xO1xyXG4gICAgICAgICAgICBjb25zdCBwb2ludHMyID0gbWFuaWZvbGQubVJlbGF0aXZlQ29udGFjdFBvaW50c09uMjtcclxuICAgICAgICAgICAgY29uc3QgY291bnQxID0gcG9pbnRzMS5zaXplKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoY29udGFjdFBvaW50c0F2ZXJhZ2VkKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50MTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAganYuQWRkKHBvaW50czEuYXQoaSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAganYuTXVsKDEgLyBjb3VudDEpO1xyXG4gICAgICAgICAgICAgICAganYuQWRkKG9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2goanYuR2V0WCgpLCBqdi5HZXRZKCksIGp2LkdldFooKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudDIgPSBwb2ludHMxLnNpemUoKTtcclxuICAgICAgICAgICAgICAgIGRhdGEucHVzaChvZmZzZXQuR2V0WCgpLCBvZmZzZXQuR2V0WSgpLCBvZmZzZXQuR2V0WigpLCBjb3VudDEsIGNvdW50Mik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50MTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHBvaW50czEuYXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHAuR2V0WCgpLCBwLkdldFkoKSwgcC5HZXRaKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDI7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwb2ludHMyLmF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChwLkdldFgoKSwgcC5HZXRZKCksIHAuR2V0WigpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGFyYWN0ZXIgY29udGFjdCBldmVudHNcclxuXHJcbiAgICBpbml0Q2hhcmFjdGVyRXZlbnRzKCkge1xyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVyID0gbmV3IEpvbHQuQ2hhcmFjdGVyQ29udGFjdExpc3RlbmVySlMoKTtcclxuXHJcbiAgICAgICAgbGlzdGVuZXIuT25BZGp1c3RCb2R5VmVsb2NpdHkgPSAoKSA9PiB7fTtcclxuXHJcbiAgICAgICAgbGlzdGVuZXIuT25Db250YWN0VmFsaWRhdGUgPSAoY2hhcmFjdGVyLCBib2R5SUQyLCBzdWJTaGFwZUlEMikgPT4ge1xyXG4gICAgICAgICAgICAvLyBhbGxvdyBhbGxcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGlzdGVuZXIuT25Db250YWN0QWRkZWQgPSAoKSA9PiB7fTtcclxuXHJcbiAgICAgICAgbGlzdGVuZXIuT25Db250YWN0U29sdmUgPSB0aGlzLm9uQ2hhckNvbnRhY3RTb2x2ZS5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLl9jaGFyTGlzdGVuZXIgPSBsaXN0ZW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBvbkNoYXJDb250YWN0U29sdmUoY2hhcmFjdGVyLCBib2R5SUQyLCBzdWJTaGFwZUlEMiwgY3AsIGNuLCBjdiwgY29udGFjdE1hdGVyaWFsLCBjaGFyYWN0ZXJWZWxvY2l0eSwgbnYpIHtcclxuICAgICAgICBjaGFyYWN0ZXIgPSBKb2x0LndyYXBQb2ludGVyKGNoYXJhY3RlciwgSm9sdC5DaGFyYWN0ZXJWaXJ0dWFsKTtcclxuICAgICAgICBjcCA9IEpvbHQud3JhcFBvaW50ZXIoY3AsIEpvbHQuVmVjMyk7XHJcbiAgICAgICAgY24gPSBKb2x0LndyYXBQb2ludGVyKGNuLCBKb2x0LlZlYzMpO1xyXG4gICAgICAgIGN2ID0gSm9sdC53cmFwUG9pbnRlcihjdiwgSm9sdC5WZWMzKTtcclxuICAgICAgICBudiA9IEpvbHQud3JhcFBvaW50ZXIobnYsIEpvbHQuVmVjMyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSB0aGlzLl9iYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2NoYXJDb250YWN0c0RhdGE7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGNoYXJhY3RlcikpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGJvZHlMb2NrSW50ZXJmYWNlID0gdGhpcy5fYmFja2VuZC5waHlzaWNzU3lzdGVtLkdldEJvZHlMb2NrSW50ZXJmYWNlKCk7XHJcblxyXG4gICAgICAgIGxldCBib2R5MiA9IGJvZHlMb2NrSW50ZXJmYWNlLlRyeUdldEJvZHkoYm9keUlEMik7XHJcbiAgICAgICAgaWYgKEpvbHQuZ2V0UG9pbnRlcihib2R5MikgPT09IDApIHtcclxuICAgICAgICAgICAgYm9keTIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNvbnRhY3RzID0gZGF0YS5nZXQoaW5kZXgpO1xyXG4gICAgICAgIGlmICghY29udGFjdHMpIHtcclxuICAgICAgICAgICAgY29udGFjdHMgPSBbMF07XHJcbiAgICAgICAgICAgIGRhdGEuc2V0KGluZGV4LCBjb250YWN0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb250YWN0c1swXSA9ICsrY29udGFjdHNbMF07XHJcblxyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goISFib2R5Mik7XHJcbiAgICAgICAgaWYgKGJvZHkyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4MiA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoYm9keTIpKTtcclxuICAgICAgICAgICAgY29udGFjdHMucHVzaChpbmRleDIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRhY3RzLnB1c2gobnVsbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb250YWN0IHBvc2l0aW9uXHJcbiAgICAgICAgY29udGFjdHMucHVzaChjcC5HZXRYKCkpO1xyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY3AuR2V0WSgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKGNwLkdldFooKSk7XHJcblxyXG4gICAgICAgIC8vIGNvbnRhY3Qgbm9ybWFsXHJcbiAgICAgICAgY29udGFjdHMucHVzaChjbi5HZXRYKCkpO1xyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY24uR2V0WSgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKGNuLkdldFooKSk7XHJcblxyXG4gICAgICAgIC8vIGNvbnRhY3QgdmVsb2NpdHlcclxuICAgICAgICBjb250YWN0cy5wdXNoKGN2LkdldFgoKSk7XHJcbiAgICAgICAgY29udGFjdHMucHVzaChjdi5HZXRZKCkpO1xyXG4gICAgICAgIGNvbnRhY3RzLnB1c2goY3YuR2V0WigpKTtcclxuXHJcbiAgICAgICAgLy8gbmV3IGNoYXJhY3RlciB2ZWxvY2l0eVxyXG4gICAgICAgIGNvbnRhY3RzLnB1c2gobnYuR2V0WCgpKTtcclxuICAgICAgICBjb250YWN0cy5wdXNoKG52LkdldFkoKSk7XHJcbiAgICAgICAgY29udGFjdHMucHVzaChudi5HZXRaKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRWZWhpY2xlRXZlbnRzKGNvbnN0cmFpbnQpIHtcclxuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IEpvbHQuVmVoaWNsZUNvbnN0cmFpbnRDYWxsYmFja3NKUygpO1xyXG5cclxuICAgICAgICBsaXN0ZW5lci5HZXRDb21iaW5lZEZyaWN0aW9uID0gKHdoZWVsSW5kZXgsIHRpcmVGcmljdGlvbkRpcmVjdGlvbiwgdGlyZUZyaWN0aW9uLCBib2R5Miwgc3ViU2hhcGVJRDIpID0+IHtcclxuICAgICAgICAgICAgYm9keTIgPSBKb2x0LndyYXBQb2ludGVyKGJvZHkyLCBKb2x0LkJvZHkpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRpcmVGcmljdGlvbiAqIGJvZHkyLkdldEZyaWN0aW9uKCkpOyAvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IGNhbGN1bGF0aW9uXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsaXN0ZW5lci5PblByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9O1xyXG4gICAgICAgIGxpc3RlbmVyLk9uUG9zdENvbGxpZGVDYWxsYmFjayA9ICgpID0+IHt9O1xyXG4gICAgICAgIGxpc3RlbmVyLk9uUG9zdFN0ZXBDYWxsYmFjayA9ICgpID0+IHt9O1xyXG5cclxuICAgICAgICBsaXN0ZW5lci5TZXRWZWhpY2xlQ29uc3RyYWludChjb25zdHJhaW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5fdmVoaWNsZUxpc3RlbmVyID0gbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGUoY2IpIHtcclxuICAgICAgICB0aGlzLl93cml0ZUNvbnRhY3RFdmVudHMoY2IpO1xyXG4gICAgICAgIHRoaXMuX3dyaXRlQ2hhcmFjdGVyRXZlbnRzKGNiKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldChjYikge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhY3RzRGF0YS5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhY3RzRGF0YVswXSA9IDA7XHJcbiAgICAgICAgdGhpcy5fY29udGFjdHNDYWNoZS5jbGVhcigpO1xyXG4gICAgICAgIHRoaXMuX2NoYXJDb250YWN0c0RhdGEuY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5lcikge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fbGlzdGVuZXIpO1xyXG4gICAgICAgICAgICB0aGlzLl9saXN0ZW5lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2hhckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9jaGFyTGlzdGVuZXIpO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFyTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDb250YWN0RXZlbnRzKGNiKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2NvbnRhY3RzRGF0YTtcclxuICAgICAgICBjb25zdCBjb250YWN0c0NvdW50ID0gZGF0YVswXTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoY29udGFjdHNDb3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHsgY29udGFjdFBvaW50cywgY29udGFjdFBvaW50c0F2ZXJhZ2VkIH0gPSB0aGlzLl9iYWNrZW5kLmNvbmZpZztcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX0JPRFkpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX0NPTlRBQ1RTKTtcclxuICAgICAgICBcclxuICAgICAgICBjYi53cml0ZShjb250YWN0c0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyBhdmVyYWdlIHBvaW50cyBwZXIgY29udGFjdCBwYWlyLCBpbnN0ZWFkIG9mIGFsbCBjb250YWN0c1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgayA9IDE7IGkgPCBjb250YWN0c0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgLy8gdHlwZVxyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gZGF0YVtrKytdO1xyXG4gICAgICAgICAgICBjYi53cml0ZSh0eXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlkeDEsIGlkeDIsIGNhbiBiZSAtMVxyXG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkQm9keTEgPSBkYXRhW2srK107XHJcbiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRCb2R5MiA9IGRhdGFbaysrXTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoaXNWYWxpZEJvZHkxLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShpc1ZhbGlkQm9keTIsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTEpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTIpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gQ09OVEFDVF9UWVBFX0FEREVEKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBub3JtYWwgeHl6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIGRlcHRoXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGNvbnRhY3RQb2ludHMsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFjdFBvaW50cykge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdFBvaW50c0F2ZXJhZ2VkLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0UG9pbnRzQXZlcmFnZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd29ybGQgcG9pbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZGF0YVtrKytdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoZGF0YVtrKytdLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdW50MSwgY291bnQyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50MSA9IGRhdGFbaysrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQyID0gZGF0YVtrKytdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShjb3VudDEsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY291bnQyLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9jYWwgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGRhdGFbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50MjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShkYXRhW2srK10sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDaGFyYWN0ZXJFdmVudHMoY2IpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fY2hhckNvbnRhY3RzRGF0YTtcclxuICAgICAgICBjb25zdCBjaGFyc0NvdW50ID0gZGF0YS5zaXplO1xyXG5cclxuICAgICAgICAvLyBTa2lwIHdyaXRpbmcgY29udGFjdCBldmVudHMsIGlmIHRoZXJlIGFyZSBub25lXHJcbiAgICAgICAgbGV0IHNraXAgPSB0cnVlO1xyXG4gICAgICAgIGRhdGEuZm9yRWFjaChjb250YWN0cyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb250YWN0c1swXSA+IDApXHJcbiAgICAgICAgICAgICAgICBza2lwID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHNraXApXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihDT01QT05FTlRfU1lTVEVNX0NIQVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX0NPTlRBQ1RTKTtcclxuICAgICAgICBjYi53cml0ZShjaGFyc0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGRhdGEuZm9yRWFjaCgoY29udGFjdHMsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhY3RzQ291bnQgPSBjb250YWN0c1swXTtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGNvbnRhY3RzQ291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBrID0gMTsgaSA8IGNvbnRhY3RzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gaXMgYm9keSAyIHZhbGlkXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShjb250YWN0c1trKytdLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdHNbaysrXSB8fCAwLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIGNvbnRhY3QgcG9zaXRpb25cclxuICAgICAgICAgICAgICAgIC8vIGNvbnRhY3Qgbm9ybWFsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250YWN0IHZlbG9jaXR5XHJcbiAgICAgICAgICAgICAgICAvLyBuZXcgY2hhciB2ZWxvY2l0eVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCAxMjsgbisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iud3JpdGUoY29udGFjdHNbaysrXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIF93cmFwQW5kV3JpdGUoYjFQb2ludGVyLCBiMlBvaW50ZXIsIHR5cGUsIGlnbm9yZUNhY2hlKSB7XHJcbiAgICAgICAgY29uc3QgQm9keSA9IEpvbHQuQm9keTtcclxuXHJcbiAgICAgICAgY29uc3QgYm9keTEgPSBKb2x0LndyYXBQb2ludGVyKGIxUG9pbnRlciwgQm9keSk7XHJcblx0XHRjb25zdCBib2R5MiA9IEpvbHQud3JhcFBvaW50ZXIoYjJQb2ludGVyLCBCb2R5KTtcclxuXHJcbiAgICAgICAgdGhpcy5fd3JpdGVDb250YWN0UGFpcihib2R5MSwgYm9keTIsIHR5cGUsIGlnbm9yZUNhY2hlKTtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVDb250YWN0UGFpcihib2R5MSwgYm9keTIsIHR5cGUsIGlnbm9yZUNhY2hlKSB7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IHRoaXMuX2JhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fY29udGFjdHNEYXRhO1xyXG5cclxuICAgICAgICBsZXQgaWR4MSA9IG51bGw7XHJcbiAgICAgICAgaWYgKGJvZHkxICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlkeDEgPSB0cmFja2VyLmdldFBDSUQoSm9sdC5nZXRQb2ludGVyKGJvZHkxKSkgPz8gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpZHgyID0gbnVsbDtcclxuICAgICAgICBpZiAoYm9keTIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWR4MiA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoYm9keTIpKSA/PyBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUGVyc2lzdGVkIGNvbnRhY3RzIHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyIHN1YnN0ZXAsIHdoaWNoIG1heSBcclxuICAgICAgICAvLyBoYXBwZW4gbXVsdGlwbGUgdGltZXMgcGVyIHNpbSBzdGVwLiBGb3IgZ2VuZXJhbCBwdXJwb3NlcywgdGhlIGZpcnN0XHJcbiAgICAgICAgLy8gc3Vic3RlcCByZXN1bHRzIHNob3VsZCBiZSBlbm91Z2gsIHNvIHdlIGNhbiBkaXNjYXJkIHRoZSBzYW1lXHJcbiAgICAgICAgLy8gY29udGFjdCBwYWlyIGFmdGVyIHRoZSBmaXJzdCBzdWJzdGVwLlxyXG4gICAgICAgIGlmICghaWdub3JlQ2FjaGUgJiYgYm9keTEgJiYgYm9keTIpIHtcclxuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLl9jb250YWN0c0NhY2hlO1xyXG4gICAgICAgICAgICBjb25zdCBzdHIgPSBgJHsgaWR4MSB9OiR7IGlkeDIgfTokeyB0eXBlIH1gO1xyXG4gICAgICAgICAgICBpZiAoY2FjaGUuaGFzKHN0cikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYWNoZS5hZGQoc3RyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRhdGFbMF0gPSArK2RhdGFbMF07XHJcblxyXG4gICAgICAgIGRhdGEucHVzaCh0eXBlKTtcclxuICAgICAgICBkYXRhLnB1c2goISFib2R5MSk7XHJcbiAgICAgICAgZGF0YS5wdXNoKCEhYm9keTIpO1xyXG5cclxuICAgICAgICBpZiAoYm9keTEpXHJcbiAgICAgICAgICAgIGRhdGEucHVzaChpZHgxKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoYm9keTIpXHJcbiAgICAgICAgICAgIGRhdGEucHVzaChpZHgyKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgTGlzdGVuZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/listener.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/modifier.mjs":
/*!**************************************************!*\
  !*** ./src/backends/jolt/operators/modifier.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Modifier: () => (/* binding */ Modifier)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../motion-state.mjs */ \"./src/backends/jolt/motion-state.mjs\");\n\r\n\r\n\r\n\r\nclass Modifier {\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n\r\n        this._joltVec3_1 = new Jolt.Vec3();\r\n        this._joltVec3_2 = new Jolt.Vec3();\r\n        this._joltVec3_3 = new Jolt.Vec3();\r\n        this._joltQuat_1 = new Jolt.Quat();\r\n    }\r\n\r\n    get joltVec3_1() {\r\n        return this._joltVec3_1;\r\n    }\r\n\r\n    get joltVec3_2() {\r\n        return this._joltVec3_2;\r\n    }\r\n\r\n    modify() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHANGE_GRAVITY:\r\n                ok = this._changeGravity(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_FORCE:\r\n                ok = this._applyForces(cb, 'AddForce');\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_IMPULSE:\r\n                ok = this._applyForces(cb, 'AddImpulse');\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_ANGULAR_IMPULSE:\r\n                ok = this._applyForces(cb, 'AddAngularImpulse', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_APPLY_BUOYANCY_IMPULSE:\r\n                ok = this._applyBuoyancyImpulse(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_ADD_TORQUE:\r\n                ok = this._applyForces(cb, 'AddTorque', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_MOVE_BODY:\r\n                ok = this._moveBody(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_LIN_VEL:\r\n                ok = this._applyForces(cb, 'SetLinearVelocity', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHAR_SET_LIN_VEL:\r\n                this._setCharacterLinVel(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_ANG_VEL:\r\n                ok = this._applyForces(cb, 'SetAngularVelocity', true);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_RESET_VELOCITIES:\r\n                ok = this._resetVelocities(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_MOTION_TYPE:\r\n                ok = this._setMotionType(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_TOGGLE_GROUP_PAIR:\r\n                ok = this._toggleGroupPair(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_USER_DATA:\r\n                ok = this._setUserData(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CHAR_SET_SHAPE:\r\n                ok = this._setCharShape(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_USE_MOTION_STATE:\r\n                ok = this._useMotionState(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_CONSTRAINT_ENABLED:\r\n                ok = this._setConstraintEnabled(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_SET_DRIVER_INPUT:\r\n                ok = this._setDriverInput(cb);\r\n                break;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        Jolt.destroy(this._joltVec3_1);\r\n        Jolt.destroy(this._joltVec3_2);\r\n        Jolt.destroy(this._joltVec3_3);\r\n        Jolt.destroy(this._joltQuat_1);\r\n    }\r\n\r\n    _changeGravity(cb) {\r\n        const jv = this._joltVec3;\r\n\r\n        jv.FromBuffer(cb);\r\n\r\n        try {\r\n            this._backend.system.SetGravity(jv);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _applyForces(cb, method, oneAttr = false) {\r\n        const jv1 = this._joltVec3_1;\r\n        const jv2 = this._joltVec3_2;\r\n\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv1.FromBuffer(cb);\r\n            if (oneAttr) {\r\n                body[method](jv1);\r\n            } else {\r\n                if (cb.flag) {\r\n                    jv2.FromBuffer(cb);\r\n                    body[method](jv1, jv2);\r\n                } else {\r\n                    body[method](jv1);\r\n                }\r\n            }\r\n            this._backend.bodyInterface.ActivateBody(body.GetID());\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setCharShape(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const pcid = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useCallback = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const shapeIndex = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32) : null;\r\n\r\n        const char = tracker.getBodyByPCID(pcid);\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !char) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Unable to locate character under id: ${ pcid }`);\r\n            return false;\r\n        }\r\n\r\n        let shape;\r\n        if (shapeIndex != null) {\r\n            shape = tracker.shapeMap.get(shapeIndex);\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && !shape) {\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Unable to locate shape: ${ shapeIndex }`);\r\n                return false;\r\n            }\r\n        } else {\r\n            shape = char.originalShape;\r\n        }\r\n\r\n        let cbIndex;\r\n        if (useCallback) {\r\n            cbIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        }\r\n\r\n        const ok = char.SetShape(shape, \r\n            backend.config.penetrationSlop * 1.5,\r\n            backend.bpFilter,\r\n            backend.objFilter,\r\n            backend.bodyFilter,\r\n            backend.shapeFilter,\r\n            backend.joltInterface.GetTempAllocator());\r\n        \r\n        if (ok && useCallback) {\r\n            const cb = backend.outBuffer;\r\n\r\n            cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n            cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_SET_SHAPE);\r\n            cb.write(cbIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _resetCharShape(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const pcid = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const useCallback = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        let cbIndex;\r\n        if (useCallback) {\r\n            cbIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        }\r\n\r\n        const char = tracker.getBodyByPCID(pcid);\r\n\r\n        const ok = char.SetShape(shape, \r\n            backend.config.penetrationSlop * 1.5,\r\n            backend.bpFilter,\r\n            backend.objFilter,\r\n            backend.bodyFilter,\r\n            backend.shapeFilter,\r\n            backend.joltInterface.GetTempAllocator());\r\n        \r\n        if (ok && useCallback) {\r\n            const cb = backend.outBuffer;\r\n\r\n            cb.writeOperator(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.COMPONENT_SYSTEM_CHAR);\r\n            cb.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_REPORT_SET_SHAPE);\r\n            cb.write(cbIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _setUserData(cb) {\r\n        const obj = this._getBody(cb);\r\n\r\n        try {\r\n            const shape = obj.GetShape();\r\n            const value = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            shape.SetUserData(value);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _useMotionState(cb) {\r\n        const body = this._getBody(cb);\r\n        const useMotionState = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        if (!body.motionState && useMotionState) {\r\n            body.motionState = new _motion_state_mjs__WEBPACK_IMPORTED_MODULE_2__.MotionState(body);\r\n        } else if (body.motionState && !useMotionState) {\r\n            body.motionState = null;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setCharacterLinVel(cb) {\r\n        const jv = this._joltVec3_1;\r\n        const char = this._getBody(cb);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            char.SetLinearVelocity(jv);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }        \r\n    }\r\n\r\n    _applyBuoyancyImpulse(cb) {\r\n        const backend = this._backend;\r\n        const body = this._getBody(cb);\r\n        const jv1 = this._joltVec3_1;\r\n        const jv2 = this._joltVec3_2;\r\n        const jv3 = this._joltVec3_3;\r\n\r\n        try {\r\n            const waterSurfacePosition = jv1.FromBuffer(cb);\r\n            const surfaceNormal = jv2.FromBuffer(cb);\r\n            const buoyancy = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const linearDrag = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const angularDrag = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n            const fluidVelocity = jv3.FromBuffer(cb);\r\n            const deltaTime = backend.config.fixedStep;\r\n            const gravity = backend.physicsSystem.GetGravity();\r\n\r\n            body.ApplyBuoyancyImpulse(waterSurfacePosition, surfaceNormal, buoyancy, linearDrag, angularDrag, fluidVelocity, gravity, deltaTime);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setConstraintEnabled(cb) {\r\n        const backend = this._backend;\r\n\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const enabled = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const activate = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n\r\n        const data = backend.tracker.constraintMap.get(index);\r\n        \r\n        // An index could be old and constraint might have been already destroyed.\r\n        if (!data) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Trying to enable/disable a constraint that has already been destroyed: ${ index }`);\r\n            return true;\r\n        }\r\n\r\n        try {\r\n            data.constraint.SetEnabled(enabled);\r\n    \r\n            if (activate) {\r\n                const bodyInterface = backend.bodyInterface;\r\n                const { body1, body2 } = data;\r\n    \r\n                if (Jolt.getPointer(data.body1) !== 0) {\r\n                    bodyInterface.ActivateBody(body1.GetID());\r\n                }\r\n                if (Jolt.getPointer(data.body2) !== 0) {\r\n                    bodyInterface.ActivateBody(body2.GetID());\r\n                }\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    _resetVelocities(cb) {\r\n        const jv1 = this._joltVec3_1;\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv1.Set(0, 0, 0);\r\n\r\n            body.SetLinearVelocity(jv1);\r\n            body.SetAngularVelocity(jv1);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _moveBody(cb) {\r\n        const backend = this._backend;\r\n        const jv = this._joltVec3_1;\r\n        const jq = this._joltQuat_1;\r\n        const body = this._getBody(cb);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            jq.FromBuffer(cb);\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                const type = body.GetMotionType();\r\n                if (type === Jolt.EMotionType_Dynamic || type === Jolt.EMotionType_Kinematic) {\r\n                    backend.bodyInterface.SetPositionAndRotation(body.GetID(), jv, jq, Jolt.Activate);\r\n                } else {\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warnOnce('Trying to move a static body.');\r\n                }\r\n            } else {\r\n                backend.bodyInterface.SetPositionAndRotation(body.GetID(), jv, jq, Jolt.Activate);\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setDriverInput(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n\r\n        const body = tracker.getBodyByPCID(index);\r\n        const data = tracker.constraintMap.get(index);\r\n        if (!data || !body) {\r\n            return true;\r\n        }\r\n\r\n        data.constraint.controller.SetDriverInput(\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32),\r\n            cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        backend.bodyInterface.ActivateBody(body.GetID());\r\n\r\n        return true;\r\n    }\r\n\r\n    _toggleGroupPair(cb) {\r\n        const backend = this._backend;\r\n        const enable = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n        const group = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const subGroup1 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const subGroup2 = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n\r\n        try {\r\n            const filter = backend.groupFilterTables[group];\r\n\r\n            if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n                let ok = true;\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(!!filter, `Unable to locate filter group: ${ group }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(subGroup1 <= filter.maxIndex, `Sub group number is over the filter table size: ${ subGroup1 }`);\r\n                ok = ok && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(subGroup2 <= filter.maxIndex, `Sub group number is over the filter table size: ${ subGroup2 }`);\r\n                if (!ok) return false;\r\n            }\r\n\r\n            if (enable) {\r\n                filter.EnableCollision(subGroup1, subGroup2);\r\n            } else {\r\n                filter.DisableCollision(subGroup1, subGroup2);\r\n            }\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _setMotionType(cb) {\r\n        const backend = this._backend;\r\n        const tracker = backend.tracker;\r\n        const bodyInterface = backend.bodyInterface;\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT16);\r\n        const body = tracker.getBodyByPCID(index);\r\n        const type = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.checkUint(type);\r\n\r\n        try {\r\n            bodyInterface.SetMotionType(body.GetID(), type, Jolt.Activate);\r\n            tracker.update(body, index);\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _getBody(cb) {\r\n        const index = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        return this._backend.tracker.getBodyByPCID(index);\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbW9kaWZpZXIubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvbW9kaWZpZXIubWpzPzBiYmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9SRUFEX0JPT0wsXHJcbiAgICBCVUZGRVJfUkVBRF9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDE2LCBCVUZGRVJfUkVBRF9VSU5UMzIsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UOCxcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsXHJcbiAgICBDTURfQUREX0FOR1VMQVJfSU1QVUxTRSwgQ01EX0FERF9GT1JDRSwgQ01EX0FERF9JTVBVTFNFLFxyXG4gICAgQ01EX0FERF9UT1JRVUUsIENNRF9BUFBMWV9CVU9ZQU5DWV9JTVBVTFNFLCBDTURfQ0hBTkdFX0dSQVZJVFksXHJcbiAgICBDTURfQ0hBUl9TRVRfTElOX1ZFTCxcclxuICAgIENNRF9DSEFSX1NFVF9TSEFQRSxcclxuICAgIENNRF9NT1ZFX0JPRFksXHJcbiAgICBDTURfUkVQT1JUX1NFVF9TSEFQRSxcclxuICAgIENNRF9SRVNFVF9WRUxPQ0lUSUVTLFxyXG4gICAgQ01EX1NFVF9BTkdfVkVMLFxyXG4gICAgQ01EX1NFVF9DT05TVFJBSU5UX0VOQUJMRUQsXHJcbiAgICBDTURfU0VUX0RSSVZFUl9JTlBVVCxcclxuICAgIENNRF9TRVRfTElOX1ZFTCwgQ01EX1NFVF9NT1RJT05fVFlQRSxcclxuICAgIENNRF9TRVRfVVNFUl9EQVRBLFxyXG4gICAgQ01EX1RPR0dMRV9HUk9VUF9QQUlSLFxyXG4gICAgQ01EX1VTRV9NT1RJT05fU1RBVEUsXHJcbiAgICBDT01QT05FTlRfU1lTVEVNX0NIQVJcclxufSBmcm9tIFwiLi4vLi4vLi4vcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBNb3Rpb25TdGF0ZSB9IGZyb20gXCIuLi9tb3Rpb24tc3RhdGUubWpzXCI7XHJcblxyXG5jbGFzcyBNb2RpZmllciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IGJhY2tlbmQ7XHJcblxyXG4gICAgICAgIHRoaXMuX2pvbHRWZWMzXzEgPSBuZXcgSm9sdC5WZWMzKCk7XHJcbiAgICAgICAgdGhpcy5fam9sdFZlYzNfMiA9IG5ldyBKb2x0LlZlYzMoKTtcclxuICAgICAgICB0aGlzLl9qb2x0VmVjM18zID0gbmV3IEpvbHQuVmVjMygpO1xyXG4gICAgICAgIHRoaXMuX2pvbHRRdWF0XzEgPSBuZXcgSm9sdC5RdWF0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGpvbHRWZWMzXzEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvbHRWZWMzXzE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGpvbHRWZWMzXzIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvbHRWZWMzXzI7XHJcbiAgICB9XHJcblxyXG4gICAgbW9kaWZ5KCkge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fYmFja2VuZC5pbkJ1ZmZlcjtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBDTURfQ0hBTkdFX0dSQVZJVFk6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2NoYW5nZUdyYXZpdHkoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9BRERfRk9SQ0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5Rm9yY2VzKGNiLCAnQWRkRm9yY2UnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQUREX0lNUFVMU0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5Rm9yY2VzKGNiLCAnQWRkSW1wdWxzZScpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9BRERfQU5HVUxBUl9JTVBVTFNFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9hcHBseUZvcmNlcyhjYiwgJ0FkZEFuZ3VsYXJJbXB1bHNlJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0FQUExZX0JVT1lBTkNZX0lNUFVMU0U6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX2FwcGx5QnVveWFuY3lJbXB1bHNlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQUREX1RPUlFVRTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fYXBwbHlGb3JjZXMoY2IsICdBZGRUb3JxdWUnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfTU9WRV9CT0RZOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9tb3ZlQm9keShjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1NFVF9MSU5fVkVMOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9hcHBseUZvcmNlcyhjYiwgJ1NldExpbmVhclZlbG9jaXR5JywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NIQVJfU0VUX0xJTl9WRUw6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDaGFyYWN0ZXJMaW5WZWwoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9TRVRfQU5HX1ZFTDpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fYXBwbHlGb3JjZXMoY2IsICdTZXRBbmd1bGFyVmVsb2NpdHknLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfUkVTRVRfVkVMT0NJVElFUzpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fcmVzZXRWZWxvY2l0aWVzKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfU0VUX01PVElPTl9UWVBFOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9zZXRNb3Rpb25UeXBlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfVE9HR0xFX0dST1VQX1BBSVI6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3RvZ2dsZUdyb3VwUGFpcihjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1NFVF9VU0VSX0RBVEE6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3NldFVzZXJEYXRhKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ0hBUl9TRVRfU0hBUEU6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3NldENoYXJTaGFwZShjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1VTRV9NT1RJT05fU1RBVEU6XHJcbiAgICAgICAgICAgICAgICBvayA9IHRoaXMuX3VzZU1vdGlvblN0YXRlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfU0VUX0NPTlNUUkFJTlRfRU5BQkxFRDpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fc2V0Q29uc3RyYWludEVuYWJsZWQoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9TRVRfRFJJVkVSX0lOUFVUOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9zZXREcml2ZXJJbnB1dChjYik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0VmVjM18xKTtcclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fam9sdFZlYzNfMik7XHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2pvbHRWZWMzXzMpO1xyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9qb2x0UXVhdF8xKTtcclxuICAgIH1cclxuXHJcbiAgICBfY2hhbmdlR3Jhdml0eShjYikge1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzM7XHJcblxyXG4gICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLl9iYWNrZW5kLnN5c3RlbS5TZXRHcmF2aXR5KGp2KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2FwcGx5Rm9yY2VzKGNiLCBtZXRob2QsIG9uZUF0dHIgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IGp2MSA9IHRoaXMuX2pvbHRWZWMzXzE7XHJcbiAgICAgICAgY29uc3QganYyID0gdGhpcy5fam9sdFZlYzNfMjtcclxuXHJcbiAgICAgICAgY29uc3QgYm9keSA9IHRoaXMuX2dldEJvZHkoY2IpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqdjEuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGlmIChvbmVBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICBib2R5W21ldGhvZF0oanYxKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYi5mbGFnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAganYyLkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHlbbWV0aG9kXShqdjEsIGp2Mik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHlbbWV0aG9kXShqdjEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2JhY2tlbmQuYm9keUludGVyZmFjZS5BY3RpdmF0ZUJvZHkoYm9keS5HZXRJRCgpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENoYXJTaGFwZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBiYWNrZW5kLnRyYWNrZXI7XHJcbiAgICAgICAgY29uc3QgcGNpZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCB1c2VDYWxsYmFjayA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgY29uc3Qgc2hhcGVJbmRleCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMikgOiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBjaGFyID0gdHJhY2tlci5nZXRCb2R5QnlQQ0lEKHBjaWQpO1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgIWNoYXIpIHtcclxuICAgICAgICAgICAgRGVidWcud2FybihgVW5hYmxlIHRvIGxvY2F0ZSBjaGFyYWN0ZXIgdW5kZXIgaWQ6ICR7IHBjaWQgfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc2hhcGU7XHJcbiAgICAgICAgaWYgKHNoYXBlSW5kZXggIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzaGFwZSA9IHRyYWNrZXIuc2hhcGVNYXAuZ2V0KHNoYXBlSW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2ICYmICFzaGFwZSkge1xyXG4gICAgICAgICAgICAgICAgRGVidWcud2FybihgVW5hYmxlIHRvIGxvY2F0ZSBzaGFwZTogJHsgc2hhcGVJbmRleCB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaGFwZSA9IGNoYXIub3JpZ2luYWxTaGFwZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjYkluZGV4O1xyXG4gICAgICAgIGlmICh1c2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgICBjYkluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb2sgPSBjaGFyLlNldFNoYXBlKHNoYXBlLCBcclxuICAgICAgICAgICAgYmFja2VuZC5jb25maWcucGVuZXRyYXRpb25TbG9wICogMS41LFxyXG4gICAgICAgICAgICBiYWNrZW5kLmJwRmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLm9iakZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5ib2R5RmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLnNoYXBlRmlsdGVyLFxyXG4gICAgICAgICAgICBiYWNrZW5kLmpvbHRJbnRlcmZhY2UuR2V0VGVtcEFsbG9jYXRvcigpKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAob2sgJiYgdXNlQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY29uc3QgY2IgPSBiYWNrZW5kLm91dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlT3BlcmF0b3IoQ09NUE9ORU5UX1NZU1RFTV9DSEFSKTtcclxuICAgICAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9SRVBPUlRfU0VUX1NIQVBFKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoY2JJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfcmVzZXRDaGFyU2hhcGUoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IHBjaWQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgdXNlQ2FsbGJhY2sgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICBsZXQgY2JJbmRleDtcclxuICAgICAgICBpZiAodXNlQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY2JJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNoYXIgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQocGNpZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9rID0gY2hhci5TZXRTaGFwZShzaGFwZSwgXHJcbiAgICAgICAgICAgIGJhY2tlbmQuY29uZmlnLnBlbmV0cmF0aW9uU2xvcCAqIDEuNSxcclxuICAgICAgICAgICAgYmFja2VuZC5icEZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5vYmpGaWx0ZXIsXHJcbiAgICAgICAgICAgIGJhY2tlbmQuYm9keUZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5zaGFwZUZpbHRlcixcclxuICAgICAgICAgICAgYmFja2VuZC5qb2x0SW50ZXJmYWNlLkdldFRlbXBBbGxvY2F0b3IoKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKG9rICYmIHVzZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNiID0gYmFja2VuZC5vdXRCdWZmZXI7XHJcblxyXG4gICAgICAgICAgICBjYi53cml0ZU9wZXJhdG9yKENPTVBPTkVOVF9TWVNURU1fQ0hBUik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfUkVQT1JUX1NFVF9TSEFQRSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGNiSW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldFVzZXJEYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNoYXBlID0gb2JqLkdldFNoYXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgc2hhcGUuU2V0VXNlckRhdGEodmFsdWUpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfdXNlTW90aW9uU3RhdGUoY2IpIHtcclxuICAgICAgICBjb25zdCBib2R5ID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcbiAgICAgICAgY29uc3QgdXNlTW90aW9uU3RhdGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG5cclxuICAgICAgICBpZiAoIWJvZHkubW90aW9uU3RhdGUgJiYgdXNlTW90aW9uU3RhdGUpIHtcclxuICAgICAgICAgICAgYm9keS5tb3Rpb25TdGF0ZSA9IG5ldyBNb3Rpb25TdGF0ZShib2R5KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGJvZHkubW90aW9uU3RhdGUgJiYgIXVzZU1vdGlvblN0YXRlKSB7XHJcbiAgICAgICAgICAgIGJvZHkubW90aW9uU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENoYXJhY3RlckxpblZlbChjYikge1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzNfMTtcclxuICAgICAgICBjb25zdCBjaGFyID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICBjaGFyLlNldExpbmVhclZlbG9jaXR5KGp2KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIF9hcHBseUJ1b3lhbmN5SW1wdWxzZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9nZXRCb2R5KGNiKTtcclxuICAgICAgICBjb25zdCBqdjEgPSB0aGlzLl9qb2x0VmVjM18xO1xyXG4gICAgICAgIGNvbnN0IGp2MiA9IHRoaXMuX2pvbHRWZWMzXzI7XHJcbiAgICAgICAgY29uc3QganYzID0gdGhpcy5fam9sdFZlYzNfMztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgd2F0ZXJTdXJmYWNlUG9zaXRpb24gPSBqdjEuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0IHN1cmZhY2VOb3JtYWwgPSBqdjIuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1b3lhbmN5ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgbGluZWFyRHJhZyA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IGFuZ3VsYXJEcmFnID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgZmx1aWRWZWxvY2l0eSA9IGp2My5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgY29uc3QgZGVsdGFUaW1lID0gYmFja2VuZC5jb25maWcuZml4ZWRTdGVwO1xyXG4gICAgICAgICAgICBjb25zdCBncmF2aXR5ID0gYmFja2VuZC5waHlzaWNzU3lzdGVtLkdldEdyYXZpdHkoKTtcclxuXHJcbiAgICAgICAgICAgIGJvZHkuQXBwbHlCdW95YW5jeUltcHVsc2Uod2F0ZXJTdXJmYWNlUG9zaXRpb24sIHN1cmZhY2VOb3JtYWwsIGJ1b3lhbmN5LCBsaW5lYXJEcmFnLCBhbmd1bGFyRHJhZywgZmx1aWRWZWxvY2l0eSwgZ3Jhdml0eSwgZGVsdGFUaW1lKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldENvbnN0cmFpbnRFbmFibGVkKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2YXRlID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGJhY2tlbmQudHJhY2tlci5jb25zdHJhaW50TWFwLmdldChpbmRleCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQW4gaW5kZXggY291bGQgYmUgb2xkIGFuZCBjb25zdHJhaW50IG1pZ2h0IGhhdmUgYmVlbiBhbHJlYWR5IGRlc3Ryb3llZC5cclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLndhcm4oYFRyeWluZyB0byBlbmFibGUvZGlzYWJsZSBhIGNvbnN0cmFpbnQgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIGRlc3Ryb3llZDogJHsgaW5kZXggfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGRhdGEuY29uc3RyYWludC5TZXRFbmFibGVkKGVuYWJsZWQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmIChhY3RpdmF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYm9keUludGVyZmFjZSA9IGJhY2tlbmQuYm9keUludGVyZmFjZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgYm9keTEsIGJvZHkyIH0gPSBkYXRhO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoSm9sdC5nZXRQb2ludGVyKGRhdGEuYm9keTEpICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keUludGVyZmFjZS5BY3RpdmF0ZUJvZHkoYm9keTEuR2V0SUQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoSm9sdC5nZXRQb2ludGVyKGRhdGEuYm9keTIpICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keUludGVyZmFjZS5BY3RpdmF0ZUJvZHkoYm9keTIuR2V0SUQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfcmVzZXRWZWxvY2l0aWVzKGNiKSB7XHJcbiAgICAgICAgY29uc3QganYxID0gdGhpcy5fam9sdFZlYzNfMTtcclxuICAgICAgICBjb25zdCBib2R5ID0gdGhpcy5fZ2V0Qm9keShjYik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGp2MS5TZXQoMCwgMCwgMCk7XHJcblxyXG4gICAgICAgICAgICBib2R5LlNldExpbmVhclZlbG9jaXR5KGp2MSk7XHJcbiAgICAgICAgICAgIGJvZHkuU2V0QW5ndWxhclZlbG9jaXR5KGp2MSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9tb3ZlQm9keShjYikge1xyXG4gICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgICAgIGNvbnN0IGp2ID0gdGhpcy5fam9sdFZlYzNfMTtcclxuICAgICAgICBjb25zdCBqcSA9IHRoaXMuX2pvbHRRdWF0XzE7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHRoaXMuX2dldEJvZHkoY2IpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqdi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAganEuRnJvbUJ1ZmZlcihjYik7XHJcblxyXG4gICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYm9keS5HZXRNb3Rpb25UeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gSm9sdC5FTW90aW9uVHlwZV9EeW5hbWljIHx8IHR5cGUgPT09IEpvbHQuRU1vdGlvblR5cGVfS2luZW1hdGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2VuZC5ib2R5SW50ZXJmYWNlLlNldFBvc2l0aW9uQW5kUm90YXRpb24oYm9keS5HZXRJRCgpLCBqdiwganEsIEpvbHQuQWN0aXZhdGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy53YXJuT25jZSgnVHJ5aW5nIHRvIG1vdmUgYSBzdGF0aWMgYm9keS4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJhY2tlbmQuYm9keUludGVyZmFjZS5TZXRQb3NpdGlvbkFuZFJvdGF0aW9uKGJvZHkuR2V0SUQoKSwganYsIGpxLCBKb2x0LkFjdGl2YXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBfc2V0RHJpdmVySW5wdXQoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBjb25zdCBib2R5ID0gdHJhY2tlci5nZXRCb2R5QnlQQ0lEKGluZGV4KTtcclxuICAgICAgICBjb25zdCBkYXRhID0gdHJhY2tlci5jb25zdHJhaW50TWFwLmdldChpbmRleCk7XHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICFib2R5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGF0YS5jb25zdHJhaW50LmNvbnRyb2xsZXIuU2V0RHJpdmVySW5wdXQoXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBiYWNrZW5kLmJvZHlJbnRlcmZhY2UuQWN0aXZhdGVCb2R5KGJvZHkuR2V0SUQoKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF90b2dnbGVHcm91cFBhaXIoY2IpIHtcclxuICAgICAgICBjb25zdCBiYWNrZW5kID0gdGhpcy5fYmFja2VuZDtcclxuICAgICAgICBjb25zdCBlbmFibGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgIGNvbnN0IGdyb3VwID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIGNvbnN0IHN1Ykdyb3VwMSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDE2KTtcclxuICAgICAgICBjb25zdCBzdWJHcm91cDIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQxNik7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGJhY2tlbmQuZ3JvdXBGaWx0ZXJUYWJsZXNbZ3JvdXBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhZmlsdGVyLCBgVW5hYmxlIHRvIGxvY2F0ZSBmaWx0ZXIgZ3JvdXA6ICR7IGdyb3VwIH1gKTtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KHN1Ykdyb3VwMSA8PSBmaWx0ZXIubWF4SW5kZXgsIGBTdWIgZ3JvdXAgbnVtYmVyIGlzIG92ZXIgdGhlIGZpbHRlciB0YWJsZSBzaXplOiAkeyBzdWJHcm91cDEgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoc3ViR3JvdXAyIDw9IGZpbHRlci5tYXhJbmRleCwgYFN1YiBncm91cCBudW1iZXIgaXMgb3ZlciB0aGUgZmlsdGVyIHRhYmxlIHNpemU6ICR7IHN1Ykdyb3VwMiB9YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChlbmFibGUpIHtcclxuICAgICAgICAgICAgICAgIGZpbHRlci5FbmFibGVDb2xsaXNpb24oc3ViR3JvdXAxLCBzdWJHcm91cDIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLkRpc2FibGVDb2xsaXNpb24oc3ViR3JvdXAxLCBzdWJHcm91cDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIF9zZXRNb3Rpb25UeXBlKGNiKSB7XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBib2R5SW50ZXJmYWNlID0gYmFja2VuZC5ib2R5SW50ZXJmYWNlO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuXHJcbiAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLmNoZWNrVWludCh0eXBlKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYm9keUludGVyZmFjZS5TZXRNb3Rpb25UeXBlKGJvZHkuR2V0SUQoKSwgdHlwZSwgSm9sdC5BY3RpdmF0ZSk7XHJcbiAgICAgICAgICAgIHRyYWNrZXIudXBkYXRlKGJvZHksIGluZGV4KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2dldEJvZHkoY2IpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYmFja2VuZC50cmFja2VyLmdldEJvZHlCeVBDSUQoaW5kZXgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBNb2RpZmllciB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/modifier.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/querier.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/querier.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Querier: () => (/* binding */ Querier)\n/* harmony export */ });\n/* harmony import */ var _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nconst params = [];\r\n\r\nclass Querier {\r\n    static writeRayHit(buffer, system, tracker, cast, calculateNormal, hit) {\r\n        const body = system.GetBodyLockInterfaceNoLock().TryGetBody(hit.mBodyID);\r\n        const point = cast.GetPointOnRay(hit.mFraction);\r\n        const normal = calculateNormal ? body.GetWorldSpaceSurfaceNormal(hit.mSubShapeID2, point) : null;\r\n\r\n        const index = tracker.getPCID(Jolt.getPointer(body));\r\n        buffer.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        buffer.write(point, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32, false);\r\n        buffer.write(normal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32);\r\n\r\n        Jolt.destroy(point);\r\n    }\r\n\r\n    static writeShapeHit(buffer, system, tracker, cast, calculateNormal, hit) {\r\n        const body = system.GetBodyLockInterfaceNoLock().TryGetBody(hit.mBodyID2);\r\n        const transform = cast.mCenterOfMassStart;\r\n        const point = transform.GetTranslation();\r\n        const dir = cast.mDirection;\r\n\r\n        dir.Mul(hit.mFraction);\r\n        point.Add(dir);\r\n\r\n        const normal = calculateNormal ? body.GetWorldSpaceSurfaceNormal(hit.mSubShapeID2, point) : null;\r\n\r\n        const index = tracker.getPCID(Jolt.getPointer(body));\r\n        buffer.write(index, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT32, false);\r\n        buffer.write(point, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32, false);\r\n        buffer.write(normal, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_JOLTVEC32);\r\n\r\n        Jolt.destroy(point);\r\n        if (normal) Jolt.destroy(normal);\r\n    }    \r\n\r\n    constructor(backend) {\r\n        this._backend = backend;\r\n\r\n        // TODO\r\n        // refactor to lazy allocate\r\n\r\n        this._rayCast = new Jolt.RRayCast();\r\n        this._rayCastSettings = new Jolt.RayCastSettings();\r\n        this._tempVectors = [\r\n            new Jolt.Quat(), new Jolt.Vec3(), new Jolt.Vec3(), \r\n            new Jolt.Vec3(), new Jolt.Vec3(), new Jolt.Vec3(),\r\n        ];\r\n\r\n        this._shapeCastSettings = new Jolt.ShapeCastSettings();\r\n\r\n\r\n        this._collectorRayFirst = new Jolt.CastRayClosestHitCollisionCollector();\r\n        this._collectorRayAll = new Jolt.CastRayAllHitCollisionCollector();\r\n\r\n        this._collectorShapeFirst = new Jolt.CastShapeClosestHitCollisionCollector();\r\n        this._collectorShapeAll = new Jolt.CastShapeAllHitCollisionCollector();\r\n\r\n        this._dirty = false;\r\n        this._bodies = [];\r\n        this._shapeCache = new Map();\r\n    }\r\n\r\n    get dirty() {\r\n        return this._dirty;\r\n    }\r\n\r\n    get bpFilter() {\r\n        return this._bpFilter;\r\n    }\r\n\r\n    get objFilter() {\r\n        return this._objFilter;\r\n    }\r\n\r\n    get bodyFilter() {\r\n        return this._bodyFilter;\r\n    }\r\n\r\n    get shapeFilter() {\r\n        return this._shapeFilter;\r\n    }\r\n\r\n    reset() {\r\n        this._dirty = false;\r\n    }\r\n\r\n    query() {\r\n        const cb = this._backend.inBuffer;\r\n        const command = cb.readCommand();\r\n        let ok = true;\r\n\r\n        switch (command) {\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_RAY:\r\n                ok = this._castRay(cb);\r\n                break;\r\n\r\n            case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_SHAPE:\r\n                ok = this._castShape(cb);\r\n                break;\r\n\r\n            default:\r\n                _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Invalid querier command: ${ command }`);\r\n                return false;\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    destroy() {\r\n        this._tempVectors.forEach(vector => {\r\n            Jolt.destroy(vector);\r\n        });\r\n        this._tempVectors.length = 0;\r\n\r\n        Jolt.destroy(this._rayCast);\r\n        this._rayCast = null;\r\n\r\n        Jolt.destroy(this._rayCastSettings);\r\n        this._rayCastSettings = null;\r\n\r\n        Jolt.destroy(this._shapeCastSettings);\r\n        this._shapeCastSettings = null;\r\n\r\n        Jolt.destroy(this._bpFilter);\r\n        this._bpFilter = null;\r\n\r\n        Jolt.destroy(this._objFilter);\r\n        this._objFilter = null;\r\n\r\n        Jolt.destroy(this._bodyFilter);\r\n        this._bodyFilter = null;\r\n\r\n        Jolt.destroy(this._shapeFilter);\r\n        this._shapeFilter = null;\r\n\r\n        Jolt.destroy(this._collectorRayFirst);\r\n        this._collectorRayFirst = null;\r\n\r\n        Jolt.destroy(this._collectorRayAll);\r\n        this._collectorRayAll = null;\r\n\r\n        this._commandsBuffer.destroy();\r\n        this._commandsBuffer = null;\r\n\r\n        this._shapeCache.forEach(shape => {\r\n            Jolt.destroy(shape);\r\n        });\r\n        this._shapeCache.clear();\r\n\r\n        params.length = 0;\r\n        params = undefined;\r\n    }\r\n\r\n    _castRay(cb) {\r\n        const tracker = this._backend.tracker;\r\n        const buffer = this._commandsBuffer;\r\n        const castSettings = this._rayCastSettings;\r\n        const jv = this._tempVectors[1];\r\n        const cast = this._rayCast;\r\n        const system = this._backend.physicsSystem;\r\n\r\n        const cache = this._bodies;\r\n        cache.length = 0;\r\n\r\n        buffer.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_RAY);\r\n        \r\n        const queryIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        buffer.write(queryIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false);\r\n\r\n        try {\r\n            jv.FromBuffer(cb);\r\n            cast.mOrigin = jv;\r\n    \r\n            jv.FromBuffer(cb);\r\n            cast.mDirection = jv;\r\n    \r\n            const firstOnly = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const calculateNormal = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n            const ignoreBackFaces = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const solidConvex = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const collector = firstOnly ? this._collectorRayFirst : this._collectorRayAll;\r\n            const { bpFilter, objFilter, bodyFilter, shapeFilter } = this._backend;\r\n    \r\n            castSettings.mBackFaceMode = ignoreBackFaces ? Jolt.EBackFaceMode_IgnoreBackFaces : Jolt.EBackFaceMode_CollideWithBackFaces;\r\n            castSettings.mTreatConvexAsSolid = solidConvex;\r\n\r\n            system.GetNarrowPhaseQuery().CastRay(cast, castSettings, collector, bpFilter, objFilter, bodyFilter, shapeFilter);\r\n\r\n            if (firstOnly) {\r\n                if (collector.HadHit()) {\r\n                    buffer.write(1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                    Querier.writeRayHit(buffer, system, tracker, cast, calculateNormal, collector.mHit);\r\n                    this._dirty = true;\r\n                }\r\n            } else {\r\n                const hits = collector.mHits;\r\n                const count = hits.size();\r\n                buffer.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                for (let i = 0; i < count; i++) {\r\n                    Querier.writeRayHit(buffer, system, tracker, cast, calculateNormal, hits.at(i));\r\n                    this._dirty = true;\r\n                }\r\n            }\r\n    \r\n            collector.Reset();\r\n            \r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _castShape(cb) {\r\n        const buffer = this._commandsBuffer;\r\n        const tempVectors = this._tempVectors;\r\n        const scale = tempVectors[1];\r\n        const direction = tempVectors[2];\r\n        const position = tempVectors[3];\r\n        const offset = tempVectors[4];\r\n        const rotation = tempVectors[0];\r\n        const backend = this._backend;\r\n        const castSettings = this._shapeCastSettings;\r\n        const tracker = backend.tracker;\r\n        const creator = backend.creator;\r\n        const system = backend.physicsSystem;\r\n\r\n        const queryIndex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT32);\r\n        const shapeType = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n\r\n        buffer.writeCommand(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.CMD_CAST_SHAPE);\r\n        buffer.write(queryIndex, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false);\r\n        \r\n        try {\r\n            position.FromBuffer(cb);\r\n            rotation.FromBuffer(cb);\r\n            direction.FromBuffer(cb);\r\n            cb.flag ? scale.FromBuffer(cb) : scale.Set(1, 1, 1);\r\n            cb.flag ? offset.FromBuffer(cb) : offset.Set(0, 0, 0);\r\n            if (cb.flag) castSettings.mBackFaceModeTriangles = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            if (cb.flag) castSettings.mBackFaceModeConvex = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_UINT8);\r\n            if (cb.flag) castSettings.mUseShrunkenShapeAndConvexRadius = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            if (cb.flag) castSettings.mReturnDeepestPoint = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL);\r\n            \r\n            const firstOnly = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : true;\r\n            const calculateNormal = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_BOOL) : false;\r\n            const collector = firstOnly ? this._collectorShapeFirst : this._collectorShapeAll;\r\n            \r\n            params.length = 0;\r\n\r\n            let shape, str;\r\n            switch (shapeType) {\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_SPHERE: {\r\n                    const radius = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.5;\r\n                    str = `${ shapeType }:${ radius }`;\r\n                    shape = this._shapeCache.get(str);\r\n                    if (!shape) params.push(radius)\r\n                    break;\r\n                }\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_BOX: {\r\n                    let x, y, z;\r\n                    if (cb.flag) {\r\n                        x = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        y = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                        z = cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32);\r\n                    } else {\r\n                        x = 0.5; y = 0.5; z = 0.5;\r\n                    }\r\n                    const halfExtent = tempVectors[5];\r\n                    halfExtent.Set(x, y, z);\r\n                    const cr = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.05;\r\n                    str = `${ shapeType }:${ x }:${ y }:${ z }:${ cr }`;\r\n                    shape = this._shapeCache.get(str);\r\n                    if (!shape) params.push(halfExtent, cr);\r\n                    break;\r\n                }\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CAPSULE: {\r\n                    const halfHeight = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.5;\r\n                    const radius = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.5;\r\n                    str = `${ shapeType }:${ halfHeight }:${ radius }`;\r\n                    shape = this._shapeCache.get(str);\r\n                    if (!shape) params.push(halfHeight, radius);\r\n                    break;\r\n                }\r\n\r\n                case _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.SHAPE_CYLINDER: {\r\n                    const halfHeight = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.5;\r\n                    const radius = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.5;\r\n                    const convexRadius = cb.flag ? cb.read(_physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_READ_FLOAT32) : 0.05;\r\n                    str = `${ shapeType }:${ halfHeight }:${ radius }:${ convexRadius }`;\r\n                    if (!shape) params.push(halfHeight, radius, convexRadius);\r\n                    break;\r\n                }\r\n                \r\n                default:\r\n                    _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(`Shape type in cast not supported: ${ shapeType }`);\r\n                    return false;\r\n            }\r\n\r\n            if (!shape) {\r\n                const settings = creator.createShapeSettings(shapeType, ...params);\r\n                shape = settings.Create().Get();\r\n                this._shapeCache.set(str, shape);\r\n            }\r\n\r\n            const transform = Jolt.Mat44.prototype.sRotationTranslation(rotation, position);\r\n            const shapeCast = new Jolt.RShapeCast(shape, scale, transform, direction);\r\n            const { bpFilter, objFilter, bodyFilter, shapeFilter } = backend;\r\n            system.GetNarrowPhaseQuery().CastShape(shapeCast, castSettings, offset, collector, bpFilter, objFilter, bodyFilter, shapeFilter);\r\n            \r\n            if (firstOnly) {\r\n                if (collector.HadHit()) {\r\n                    buffer.write(1, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                    Querier.writeShapeHit(buffer, system, tracker, shapeCast, calculateNormal, collector.mHit);\r\n\r\n                    this._dirty = true;\r\n                }        \r\n            } else {\r\n                const hits = collector.mHits;\r\n                const count = hits.size();\r\n                buffer.write(count, _physics_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_0__.BUFFER_WRITE_UINT16, false); // hits count\r\n                for (let i = 0; i < count; i++) {\r\n                    Querier.writeShapeHit(buffer, system, tracker, shapeCast, calculateNormal, hits.at(i));\r\n                    this._dirty = true;\r\n                }\r\n            }\r\n\r\n            collector.Reset();\r\n\r\n            Jolt.destroy(shapeCast);\r\n\r\n        } catch (e) {\r\n            _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev && _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.error(e);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvcXVlcmllci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2JhY2tlbmRzL2pvbHQvb3BlcmF0b3JzL3F1ZXJpZXIubWpzPzk4MTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEJVRkZFUl9SRUFEX0ZMT0FUMzIsIEJVRkZFUl9SRUFEX1VJTlQ4LCBDTURfQ0FTVF9SQVksIENNRF9DQVNUX1NIQVBFLFxyXG4gICAgQlVGRkVSX1JFQURfQk9PTCwgQlVGRkVSX1JFQURfVUlOVDMyLCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQxNiwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgU0hBUEVfQk9YLCBTSEFQRV9DQVBTVUxFLFxyXG4gICAgU0hBUEVfQ1lMSU5ERVIsIFNIQVBFX1NQSEVSRVxyXG59IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL3BoeXNpY3MvZGVidWcubWpzXCI7XHJcblxyXG5jb25zdCBwYXJhbXMgPSBbXTtcclxuXHJcbmNsYXNzIFF1ZXJpZXIge1xyXG4gICAgc3RhdGljIHdyaXRlUmF5SGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBjYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGhpdCkge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBzeXN0ZW0uR2V0Qm9keUxvY2tJbnRlcmZhY2VOb0xvY2soKS5UcnlHZXRCb2R5KGhpdC5tQm9keUlEKTtcclxuICAgICAgICBjb25zdCBwb2ludCA9IGNhc3QuR2V0UG9pbnRPblJheShoaXQubUZyYWN0aW9uKTtcclxuICAgICAgICBjb25zdCBub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwgPyBib2R5LkdldFdvcmxkU3BhY2VTdXJmYWNlTm9ybWFsKGhpdC5tU3ViU2hhcGVJRDIsIHBvaW50KSA6IG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdHJhY2tlci5nZXRQQ0lEKEpvbHQuZ2V0UG9pbnRlcihib2R5KSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKGluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKHBvaW50LCBCVUZGRVJfV1JJVEVfSk9MVFZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKG5vcm1hbCwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMik7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveShwb2ludCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlU2hhcGVIaXQoYnVmZmVyLCBzeXN0ZW0sIHRyYWNrZXIsIGNhc3QsIGNhbGN1bGF0ZU5vcm1hbCwgaGl0KSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHN5c3RlbS5HZXRCb2R5TG9ja0ludGVyZmFjZU5vTG9jaygpLlRyeUdldEJvZHkoaGl0Lm1Cb2R5SUQyKTtcclxuICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBjYXN0Lm1DZW50ZXJPZk1hc3NTdGFydDtcclxuICAgICAgICBjb25zdCBwb2ludCA9IHRyYW5zZm9ybS5HZXRUcmFuc2xhdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IGRpciA9IGNhc3QubURpcmVjdGlvbjtcclxuXHJcbiAgICAgICAgZGlyLk11bChoaXQubUZyYWN0aW9uKTtcclxuICAgICAgICBwb2ludC5BZGQoZGlyKTtcclxuXHJcbiAgICAgICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsID8gYm9keS5HZXRXb3JsZFNwYWNlU3VyZmFjZU5vcm1hbChoaXQubVN1YlNoYXBlSUQyLCBwb2ludCkgOiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IHRyYWNrZXIuZ2V0UENJRChKb2x0LmdldFBvaW50ZXIoYm9keSkpO1xyXG4gICAgICAgIGJ1ZmZlci53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGJ1ZmZlci53cml0ZShwb2ludCwgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGJ1ZmZlci53cml0ZShub3JtYWwsIEJVRkZFUl9XUklURV9KT0xUVkVDMzIpO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kocG9pbnQpO1xyXG4gICAgICAgIGlmIChub3JtYWwpIEpvbHQuZGVzdHJveShub3JtYWwpO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5fYmFja2VuZCA9IGJhY2tlbmQ7XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICAvLyByZWZhY3RvciB0byBsYXp5IGFsbG9jYXRlXHJcblxyXG4gICAgICAgIHRoaXMuX3JheUNhc3QgPSBuZXcgSm9sdC5SUmF5Q2FzdCgpO1xyXG4gICAgICAgIHRoaXMuX3JheUNhc3RTZXR0aW5ncyA9IG5ldyBKb2x0LlJheUNhc3RTZXR0aW5ncygpO1xyXG4gICAgICAgIHRoaXMuX3RlbXBWZWN0b3JzID0gW1xyXG4gICAgICAgICAgICBuZXcgSm9sdC5RdWF0KCksIG5ldyBKb2x0LlZlYzMoKSwgbmV3IEpvbHQuVmVjMygpLCBcclxuICAgICAgICAgICAgbmV3IEpvbHQuVmVjMygpLCBuZXcgSm9sdC5WZWMzKCksIG5ldyBKb2x0LlZlYzMoKSxcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICB0aGlzLl9zaGFwZUNhc3RTZXR0aW5ncyA9IG5ldyBKb2x0LlNoYXBlQ2FzdFNldHRpbmdzKCk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JSYXlGaXJzdCA9IG5ldyBKb2x0LkNhc3RSYXlDbG9zZXN0SGl0Q29sbGlzaW9uQ29sbGVjdG9yKCk7XHJcbiAgICAgICAgdGhpcy5fY29sbGVjdG9yUmF5QWxsID0gbmV3IEpvbHQuQ2FzdFJheUFsbEhpdENvbGxpc2lvbkNvbGxlY3RvcigpO1xyXG5cclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JTaGFwZUZpcnN0ID0gbmV3IEpvbHQuQ2FzdFNoYXBlQ2xvc2VzdEhpdENvbGxpc2lvbkNvbGxlY3RvcigpO1xyXG4gICAgICAgIHRoaXMuX2NvbGxlY3RvclNoYXBlQWxsID0gbmV3IEpvbHQuQ2FzdFNoYXBlQWxsSGl0Q29sbGlzaW9uQ29sbGVjdG9yKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fYm9kaWVzID0gW107XHJcbiAgICAgICAgdGhpcy5fc2hhcGVDYWNoZSA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RpcnR5O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBicEZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnBGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG9iakZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb2JqRmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib2R5RmlsdGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ib2R5RmlsdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaGFwZUZpbHRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2hhcGVGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5fZGlydHkgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBxdWVyeSgpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX2JhY2tlbmQuaW5CdWZmZXI7XHJcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IGNiLnJlYWRDb21tYW5kKCk7XHJcbiAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NBU1RfUkFZOlxyXG4gICAgICAgICAgICAgICAgb2sgPSB0aGlzLl9jYXN0UmF5KGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDTURfQ0FTVF9TSEFQRTpcclxuICAgICAgICAgICAgICAgIG9rID0gdGhpcy5fY2FzdFNoYXBlKGNiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgSW52YWxpZCBxdWVyaWVyIGNvbW1hbmQ6ICR7IGNvbW1hbmQgfWApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5fdGVtcFZlY3RvcnMuZm9yRWFjaCh2ZWN0b3IgPT4ge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3kodmVjdG9yKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLl90ZW1wVmVjdG9ycy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fcmF5Q2FzdCk7XHJcbiAgICAgICAgdGhpcy5fcmF5Q2FzdCA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9yYXlDYXN0U2V0dGluZ3MpO1xyXG4gICAgICAgIHRoaXMuX3JheUNhc3RTZXR0aW5ncyA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9zaGFwZUNhc3RTZXR0aW5ncyk7XHJcbiAgICAgICAgdGhpcy5fc2hhcGVDYXN0U2V0dGluZ3MgPSBudWxsO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fYnBGaWx0ZXIpO1xyXG4gICAgICAgIHRoaXMuX2JwRmlsdGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX29iakZpbHRlcik7XHJcbiAgICAgICAgdGhpcy5fb2JqRmlsdGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2JvZHlGaWx0ZXIpO1xyXG4gICAgICAgIHRoaXMuX2JvZHlGaWx0ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICBKb2x0LmRlc3Ryb3kodGhpcy5fc2hhcGVGaWx0ZXIpO1xyXG4gICAgICAgIHRoaXMuX3NoYXBlRmlsdGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgSm9sdC5kZXN0cm95KHRoaXMuX2NvbGxlY3RvclJheUZpcnN0KTtcclxuICAgICAgICB0aGlzLl9jb2xsZWN0b3JSYXlGaXJzdCA9IG51bGw7XHJcblxyXG4gICAgICAgIEpvbHQuZGVzdHJveSh0aGlzLl9jb2xsZWN0b3JSYXlBbGwpO1xyXG4gICAgICAgIHRoaXMuX2NvbGxlY3RvclJheUFsbCA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbW1hbmRzQnVmZmVyLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLl9jb21tYW5kc0J1ZmZlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuX3NoYXBlQ2FjaGUuZm9yRWFjaChzaGFwZSA9PiB7XHJcbiAgICAgICAgICAgIEpvbHQuZGVzdHJveShzaGFwZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5fc2hhcGVDYWNoZS5jbGVhcigpO1xyXG5cclxuICAgICAgICBwYXJhbXMubGVuZ3RoID0gMDtcclxuICAgICAgICBwYXJhbXMgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgX2Nhc3RSYXkoY2IpIHtcclxuICAgICAgICBjb25zdCB0cmFja2VyID0gdGhpcy5fYmFja2VuZC50cmFja2VyO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuX2NvbW1hbmRzQnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGNhc3RTZXR0aW5ncyA9IHRoaXMuX3JheUNhc3RTZXR0aW5ncztcclxuICAgICAgICBjb25zdCBqdiA9IHRoaXMuX3RlbXBWZWN0b3JzWzFdO1xyXG4gICAgICAgIGNvbnN0IGNhc3QgPSB0aGlzLl9yYXlDYXN0O1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuX2JhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuXHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLl9ib2RpZXM7XHJcbiAgICAgICAgY2FjaGUubGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgYnVmZmVyLndyaXRlQ29tbWFuZChDTURfQ0FTVF9SQVkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHF1ZXJ5SW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKHF1ZXJ5SW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAganYuRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGNhc3QubU9yaWdpbiA9IGp2O1xyXG4gICAgXHJcbiAgICAgICAgICAgIGp2LkZyb21CdWZmZXIoY2IpO1xyXG4gICAgICAgICAgICBjYXN0Lm1EaXJlY3Rpb24gPSBqdjtcclxuICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaXJzdE9ubHkgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSA6IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGN1bGF0ZU5vcm1hbCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogZmFsc2U7XHJcbiAgICAgICAgICAgIGNvbnN0IGlnbm9yZUJhY2tGYWNlcyA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3Qgc29saWRDb252ZXggPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSA6IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbGxlY3RvciA9IGZpcnN0T25seSA/IHRoaXMuX2NvbGxlY3RvclJheUZpcnN0IDogdGhpcy5fY29sbGVjdG9yUmF5QWxsO1xyXG4gICAgICAgICAgICBjb25zdCB7IGJwRmlsdGVyLCBvYmpGaWx0ZXIsIGJvZHlGaWx0ZXIsIHNoYXBlRmlsdGVyIH0gPSB0aGlzLl9iYWNrZW5kO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNhc3RTZXR0aW5ncy5tQmFja0ZhY2VNb2RlID0gaWdub3JlQmFja0ZhY2VzID8gSm9sdC5FQmFja0ZhY2VNb2RlX0lnbm9yZUJhY2tGYWNlcyA6IEpvbHQuRUJhY2tGYWNlTW9kZV9Db2xsaWRlV2l0aEJhY2tGYWNlcztcclxuICAgICAgICAgICAgY2FzdFNldHRpbmdzLm1UcmVhdENvbnZleEFzU29saWQgPSBzb2xpZENvbnZleDtcclxuXHJcbiAgICAgICAgICAgIHN5c3RlbS5HZXROYXJyb3dQaGFzZVF1ZXJ5KCkuQ2FzdFJheShjYXN0LCBjYXN0U2V0dGluZ3MsIGNvbGxlY3RvciwgYnBGaWx0ZXIsIG9iakZpbHRlciwgYm9keUZpbHRlciwgc2hhcGVGaWx0ZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpcnN0T25seSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rvci5IYWRIaXQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci53cml0ZSgxLCBCVUZGRVJfV1JJVEVfVUlOVDE2LCBmYWxzZSk7IC8vIGhpdHMgY291bnRcclxuICAgICAgICAgICAgICAgICAgICBRdWVyaWVyLndyaXRlUmF5SGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBjYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGNvbGxlY3Rvci5tSGl0KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaXRzID0gY29sbGVjdG9yLm1IaXRzO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBoaXRzLnNpemUoKTtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpOyAvLyBoaXRzIGNvdW50XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBRdWVyaWVyLndyaXRlUmF5SGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBjYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGhpdHMuYXQoaSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbGxlY3Rvci5SZXNldCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX2Nhc3RTaGFwZShjYikge1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuX2NvbW1hbmRzQnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IHRlbXBWZWN0b3JzID0gdGhpcy5fdGVtcFZlY3RvcnM7XHJcbiAgICAgICAgY29uc3Qgc2NhbGUgPSB0ZW1wVmVjdG9yc1sxXTtcclxuICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB0ZW1wVmVjdG9yc1syXTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRlbXBWZWN0b3JzWzNdO1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRlbXBWZWN0b3JzWzRdO1xyXG4gICAgICAgIGNvbnN0IHJvdGF0aW9uID0gdGVtcFZlY3RvcnNbMF07XHJcbiAgICAgICAgY29uc3QgYmFja2VuZCA9IHRoaXMuX2JhY2tlbmQ7XHJcbiAgICAgICAgY29uc3QgY2FzdFNldHRpbmdzID0gdGhpcy5fc2hhcGVDYXN0U2V0dGluZ3M7XHJcbiAgICAgICAgY29uc3QgdHJhY2tlciA9IGJhY2tlbmQudHJhY2tlcjtcclxuICAgICAgICBjb25zdCBjcmVhdG9yID0gYmFja2VuZC5jcmVhdG9yO1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IGJhY2tlbmQucGh5c2ljc1N5c3RlbTtcclxuXHJcbiAgICAgICAgY29uc3QgcXVlcnlJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBzaGFwZVR5cGUgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQ4KTtcclxuXHJcbiAgICAgICAgYnVmZmVyLndyaXRlQ29tbWFuZChDTURfQ0FTVF9TSEFQRSk7XHJcbiAgICAgICAgYnVmZmVyLndyaXRlKHF1ZXJ5SW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBwb3NpdGlvbi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgcm90YXRpb24uRnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbi5Gcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgY2IuZmxhZyA/IHNjYWxlLkZyb21CdWZmZXIoY2IpIDogc2NhbGUuU2V0KDEsIDEsIDEpO1xyXG4gICAgICAgICAgICBjYi5mbGFnID8gb2Zmc2V0LkZyb21CdWZmZXIoY2IpIDogb2Zmc2V0LlNldCgwLCAwLCAwKTtcclxuICAgICAgICAgICAgaWYgKGNiLmZsYWcpIGNhc3RTZXR0aW5ncy5tQmFja0ZhY2VNb2RlVHJpYW5nbGVzID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgIGlmIChjYi5mbGFnKSBjYXN0U2V0dGluZ3MubUJhY2tGYWNlTW9kZUNvbnZleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG4gICAgICAgICAgICBpZiAoY2IuZmxhZykgY2FzdFNldHRpbmdzLm1Vc2VTaHJ1bmtlblNoYXBlQW5kQ29udmV4UmFkaXVzID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgaWYgKGNiLmZsYWcpIGNhc3RTZXR0aW5ncy5tUmV0dXJuRGVlcGVzdFBvaW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0T25seSA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpIDogdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgY2FsY3VsYXRlTm9ybWFsID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCkgOiBmYWxzZTtcclxuICAgICAgICAgICAgY29uc3QgY29sbGVjdG9yID0gZmlyc3RPbmx5ID8gdGhpcy5fY29sbGVjdG9yU2hhcGVGaXJzdCA6IHRoaXMuX2NvbGxlY3RvclNoYXBlQWxsO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcGFyYW1zLmxlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgICAgICBsZXQgc2hhcGUsIHN0cjtcclxuICAgICAgICAgICAgc3dpdGNoIChzaGFwZVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgU0hBUEVfU1BIRVJFOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaXVzID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMikgOiAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gYCR7IHNoYXBlVHlwZSB9OiR7IHJhZGl1cyB9YDtcclxuICAgICAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMuX3NoYXBlQ2FjaGUuZ2V0KHN0cik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzaGFwZSkgcGFyYW1zLnB1c2gocmFkaXVzKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgU0hBUEVfQk9YOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHgsIHksIHo7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmZsYWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB6ID0gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4ID0gMC41OyB5ID0gMC41OyB6ID0gMC41O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYWxmRXh0ZW50ID0gdGVtcFZlY3RvcnNbNV07XHJcbiAgICAgICAgICAgICAgICAgICAgaGFsZkV4dGVudC5TZXQoeCwgeSwgeik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3IgPSBjYi5mbGFnID8gY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSA6IDAuMDU7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gYCR7IHNoYXBlVHlwZSB9OiR7IHggfTokeyB5IH06JHsgeiB9OiR7IGNyIH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5fc2hhcGVDYWNoZS5nZXQoc3RyKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXNoYXBlKSBwYXJhbXMucHVzaChoYWxmRXh0ZW50LCBjcik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBTSEFQRV9DQVBTVUxFOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpIDogMC41O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IGNiLmZsYWcgPyBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpIDogMC41O1xyXG4gICAgICAgICAgICAgICAgICAgIHN0ciA9IGAkeyBzaGFwZVR5cGUgfTokeyBoYWxmSGVpZ2h0IH06JHsgcmFkaXVzIH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5fc2hhcGVDYWNoZS5nZXQoc3RyKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXNoYXBlKSBwYXJhbXMucHVzaChoYWxmSGVpZ2h0LCByYWRpdXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgU0hBUEVfQ1lMSU5ERVI6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYWxmSGVpZ2h0ID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMikgOiAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaXVzID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMikgOiAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udmV4UmFkaXVzID0gY2IuZmxhZyA/IGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMikgOiAwLjA1O1xyXG4gICAgICAgICAgICAgICAgICAgIHN0ciA9IGAkeyBzaGFwZVR5cGUgfTokeyBoYWxmSGVpZ2h0IH06JHsgcmFkaXVzIH06JHsgY29udmV4UmFkaXVzIH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2hhcGUpIHBhcmFtcy5wdXNoKGhhbGZIZWlnaHQsIHJhZGl1cywgY29udmV4UmFkaXVzKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoYFNoYXBlIHR5cGUgaW4gY2FzdCBub3Qgc3VwcG9ydGVkOiAkeyBzaGFwZVR5cGUgfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzaGFwZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBjcmVhdG9yLmNyZWF0ZVNoYXBlU2V0dGluZ3Moc2hhcGVUeXBlLCAuLi5wYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgc2hhcGUgPSBzZXR0aW5ncy5DcmVhdGUoKS5HZXQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NoYXBlQ2FjaGUuc2V0KHN0ciwgc2hhcGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBKb2x0Lk1hdDQ0LnByb3RvdHlwZS5zUm90YXRpb25UcmFuc2xhdGlvbihyb3RhdGlvbiwgcG9zaXRpb24pO1xyXG4gICAgICAgICAgICBjb25zdCBzaGFwZUNhc3QgPSBuZXcgSm9sdC5SU2hhcGVDYXN0KHNoYXBlLCBzY2FsZSwgdHJhbnNmb3JtLCBkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICBjb25zdCB7IGJwRmlsdGVyLCBvYmpGaWx0ZXIsIGJvZHlGaWx0ZXIsIHNoYXBlRmlsdGVyIH0gPSBiYWNrZW5kO1xyXG4gICAgICAgICAgICBzeXN0ZW0uR2V0TmFycm93UGhhc2VRdWVyeSgpLkNhc3RTaGFwZShzaGFwZUNhc3QsIGNhc3RTZXR0aW5ncywgb2Zmc2V0LCBjb2xsZWN0b3IsIGJwRmlsdGVyLCBvYmpGaWx0ZXIsIGJvZHlGaWx0ZXIsIHNoYXBlRmlsdGVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChmaXJzdE9ubHkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0b3IuSGFkSGl0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBidWZmZXIud3JpdGUoMSwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgZmFsc2UpOyAvLyBoaXRzIGNvdW50XHJcbiAgICAgICAgICAgICAgICAgICAgUXVlcmllci53cml0ZVNoYXBlSGl0KGJ1ZmZlciwgc3lzdGVtLCB0cmFja2VyLCBzaGFwZUNhc3QsIGNhbGN1bGF0ZU5vcm1hbCwgY29sbGVjdG9yLm1IaXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhpdHMgPSBjb2xsZWN0b3IubUhpdHM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGhpdHMuc2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgYnVmZmVyLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDE2LCBmYWxzZSk7IC8vIGhpdHMgY291bnRcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIFF1ZXJpZXIud3JpdGVTaGFwZUhpdChidWZmZXIsIHN5c3RlbSwgdHJhY2tlciwgc2hhcGVDYXN0LCBjYWxjdWxhdGVOb3JtYWwsIGhpdHMuYXQoaSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29sbGVjdG9yLlJlc2V0KCk7XHJcblxyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3koc2hhcGVDYXN0KTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBRdWVyaWVyIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/querier.mjs\n");

/***/ }),

/***/ "./src/backends/jolt/operators/tracker.mjs":
/*!*************************************************!*\
  !*** ./src/backends/jolt/operators/tracker.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Tracker: () => (/* binding */ Tracker)\n/* harmony export */ });\n/* harmony import */ var _physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../physics/debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\nclass Tracker {\r\n    constructor(backend) {\r\n        this.backend = backend;\r\n\r\n        // TODO\r\n        // eval: get rid of _dynamic and _kinematic\r\n        this._dynamic = new Set();\r\n        this._kinematic = new Set();\r\n\r\n        this._character = new Set();\r\n        this._bodyMap = new Map();\r\n        this._idxMap = new Map();\r\n        this._shapeMap = new Map();\r\n        this._constraintMap = new Map();\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug = new Set();\r\n\r\n            Object.defineProperty(this, 'debug', {\r\n                get: () => { return this._debug; }\r\n            });\r\n        }\r\n    }\r\n\r\n    get dynamic() {\r\n        return this._dynamic;\r\n    }\r\n\r\n    get kinematic() {\r\n        return this._kinematic;\r\n    }\r\n\r\n    get character() {\r\n        return this._character;\r\n    }\r\n\r\n    get shapeMap() {\r\n        return this._shapeMap;\r\n    }\r\n\r\n    get constraintMap() {\r\n        return this._constraintMap;\r\n    }\r\n\r\n    add(body, index) {\r\n        const motionType = body.GetMotionType();\r\n        const bodyType = body.GetBodyType();\r\n\r\n        if (bodyType === Jolt.EBodyType_RigidBody) {\r\n            switch (motionType) {\r\n                case Jolt.EMotionType_Dynamic:\r\n                    this._dynamic.add(body);\r\n                    break;\r\n                case Jolt.EMotionType_Kinematic:\r\n                    this._kinematic.add(body);\r\n                    break;\r\n                case Jolt.EMotionType_Static:\r\n                    // no need to track statics\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && body.debugDraw) {\r\n            this._debug.add(body);\r\n        }\r\n\r\n        this._idxMap.set(Jolt.getPointer(body), index);\r\n        this._bodyMap.set(index, body);\r\n    }\r\n\r\n    // addSoftBody(body, index) {\r\n    //     if (Debug.dev && body.debugDraw) {\r\n    //         this._debug.add(body);\r\n    //     }\r\n\r\n    //     this._idxMap.set(Jolt.getPointer(body), index);\r\n    //     this._bodyMap.set(index, body);\r\n    // }    \r\n\r\n    addCharacter(char, index) {\r\n        this._character.add(char);\r\n        this._idxMap.set(Jolt.getPointer(char), index);\r\n        this._bodyMap.set(index, char);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && char.debugDraw) {\r\n            this._debug.add(char);\r\n        }\r\n    }\r\n\r\n    addConstraint(index, constraint, body1, body2) {\r\n        this._constraintMap.set(index, { constraint, body1, body2 });\r\n    }\r\n\r\n    getBodyByPCID(index) {\r\n        return this._bodyMap.get(index);\r\n    }\r\n\r\n    getPCID(index) {\r\n        return this._idxMap.get(index);\r\n    }\r\n\r\n    update(body, index) {\r\n        this.remove(body);\r\n        this.add(body, index);\r\n    }\r\n\r\n    stopTrackingBody(body) {\r\n        this._dynamic.delete(body);\r\n        this._kinematic.delete(body);\r\n        this._character.delete(body);\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug.delete(body);\r\n        }\r\n\r\n        const jid = Jolt.getPointer(body);\r\n        const idx = this._idxMap.get(jid);\r\n\r\n        this._bodyMap.delete(idx);\r\n        this._idxMap.delete(jid);\r\n    }\r\n\r\n    destroy() {\r\n        this._dynamic.clear();\r\n        this._kinematic.clear();\r\n\r\n        this._character.forEach(char => {\r\n            Jolt.destroy(char);\r\n        });\r\n        this._character.clear();\r\n\r\n        this._bodyMap.forEach(body => {\r\n            Jolt.destroy(body);\r\n        });\r\n        this._bodyMap.clear();\r\n\r\n        if (_physics_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            this._debug.clear();\r\n        }\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvdHJhY2tlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvYmFja2VuZHMvam9sdC9vcGVyYXRvcnMvdHJhY2tlci5tanM/MjNhNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9waHlzaWNzL2RlYnVnLm1qc1wiO1xyXG5cclxuY2xhc3MgVHJhY2tlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihiYWNrZW5kKSB7XHJcbiAgICAgICAgdGhpcy5iYWNrZW5kID0gYmFja2VuZDtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGV2YWw6IGdldCByaWQgb2YgX2R5bmFtaWMgYW5kIF9raW5lbWF0aWNcclxuICAgICAgICB0aGlzLl9keW5hbWljID0gbmV3IFNldCgpO1xyXG4gICAgICAgIHRoaXMuX2tpbmVtYXRpYyA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVyID0gbmV3IFNldCgpO1xyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5faWR4TWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuX3NoYXBlTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuX2NvbnN0cmFpbnRNYXAgPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGVidWcgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2RlYnVnJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB7IHJldHVybiB0aGlzLl9kZWJ1ZzsgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGR5bmFtaWMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2R5bmFtaWM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGtpbmVtYXRpYygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fa2luZW1hdGljO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjaGFyYWN0ZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2hhcGVNYXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NoYXBlTWFwO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb25zdHJhaW50TWFwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50TWFwO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZChib2R5LCBpbmRleCkge1xyXG4gICAgICAgIGNvbnN0IG1vdGlvblR5cGUgPSBib2R5LkdldE1vdGlvblR5cGUoKTtcclxuICAgICAgICBjb25zdCBib2R5VHlwZSA9IGJvZHkuR2V0Qm9keVR5cGUoKTtcclxuXHJcbiAgICAgICAgaWYgKGJvZHlUeXBlID09PSBKb2x0LkVCb2R5VHlwZV9SaWdpZEJvZHkpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChtb3Rpb25UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEpvbHQuRU1vdGlvblR5cGVfRHluYW1pYzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9keW5hbWljLmFkZChib2R5KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgSm9sdC5FTW90aW9uVHlwZV9LaW5lbWF0aWM6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2luZW1hdGljLmFkZChib2R5KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgSm9sdC5FTW90aW9uVHlwZV9TdGF0aWM6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gbmVlZCB0byB0cmFjayBzdGF0aWNzXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmIGJvZHkuZGVidWdEcmF3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlYnVnLmFkZChib2R5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2lkeE1hcC5zZXQoSm9sdC5nZXRQb2ludGVyKGJvZHkpLCBpbmRleCk7XHJcbiAgICAgICAgdGhpcy5fYm9keU1hcC5zZXQoaW5kZXgsIGJvZHkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFkZFNvZnRCb2R5KGJvZHksIGluZGV4KSB7XHJcbiAgICAvLyAgICAgaWYgKERlYnVnLmRldiAmJiBib2R5LmRlYnVnRHJhdykge1xyXG4gICAgLy8gICAgICAgICB0aGlzLl9kZWJ1Zy5hZGQoYm9keSk7XHJcbiAgICAvLyAgICAgfVxyXG5cclxuICAgIC8vICAgICB0aGlzLl9pZHhNYXAuc2V0KEpvbHQuZ2V0UG9pbnRlcihib2R5KSwgaW5kZXgpO1xyXG4gICAgLy8gICAgIHRoaXMuX2JvZHlNYXAuc2V0KGluZGV4LCBib2R5KTtcclxuICAgIC8vIH0gICAgXHJcblxyXG4gICAgYWRkQ2hhcmFjdGVyKGNoYXIsIGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVyLmFkZChjaGFyKTtcclxuICAgICAgICB0aGlzLl9pZHhNYXAuc2V0KEpvbHQuZ2V0UG9pbnRlcihjaGFyKSwgaW5kZXgpO1xyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuc2V0KGluZGV4LCBjaGFyKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiBjaGFyLmRlYnVnRHJhdykge1xyXG4gICAgICAgICAgICB0aGlzLl9kZWJ1Zy5hZGQoY2hhcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZENvbnN0cmFpbnQoaW5kZXgsIGNvbnN0cmFpbnQsIGJvZHkxLCBib2R5Mikge1xyXG4gICAgICAgIHRoaXMuX2NvbnN0cmFpbnRNYXAuc2V0KGluZGV4LCB7IGNvbnN0cmFpbnQsIGJvZHkxLCBib2R5MiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRCb2R5QnlQQ0lEKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JvZHlNYXAuZ2V0KGluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQQ0lEKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lkeE1hcC5nZXQoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZShib2R5LCBpbmRleCkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlKGJvZHkpO1xyXG4gICAgICAgIHRoaXMuYWRkKGJvZHksIGluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBzdG9wVHJhY2tpbmdCb2R5KGJvZHkpIHtcclxuICAgICAgICB0aGlzLl9keW5hbWljLmRlbGV0ZShib2R5KTtcclxuICAgICAgICB0aGlzLl9raW5lbWF0aWMuZGVsZXRlKGJvZHkpO1xyXG4gICAgICAgIHRoaXMuX2NoYXJhY3Rlci5kZWxldGUoYm9keSk7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGVidWcuZGVsZXRlKGJvZHkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgamlkID0gSm9sdC5nZXRQb2ludGVyKGJvZHkpO1xyXG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2lkeE1hcC5nZXQoamlkKTtcclxuXHJcbiAgICAgICAgdGhpcy5fYm9keU1hcC5kZWxldGUoaWR4KTtcclxuICAgICAgICB0aGlzLl9pZHhNYXAuZGVsZXRlKGppZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLl9keW5hbWljLmNsZWFyKCk7XHJcbiAgICAgICAgdGhpcy5fa2luZW1hdGljLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NoYXJhY3Rlci5mb3JFYWNoKGNoYXIgPT4ge1xyXG4gICAgICAgICAgICBKb2x0LmRlc3Ryb3koY2hhcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVyLmNsZWFyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuZm9yRWFjaChib2R5ID0+IHtcclxuICAgICAgICAgICAgSm9sdC5kZXN0cm95KGJvZHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX2JvZHlNYXAuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICB0aGlzLl9kZWJ1Zy5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgVHJhY2tlciB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backends/jolt/operators/tracker.mjs\n");

/***/ }),

/***/ "./src/index.mjs":
/*!***********************!*\
  !*** ./src/index.mjs ***!
  \***********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   init: () => (/* reexport safe */ _physics_init_mjs__WEBPACK_IMPORTED_MODULE_0__.init)\n/* harmony export */ });\n/* harmony import */ var _physics_init_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./physics/init.mjs */ \"./src/physics/init.mjs\");\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL2luZGV4Lm1qcz9iM2RjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluaXQgfSBmcm9tIFwiLi9waHlzaWNzL2luaXQubWpzXCI7XHJcblxyXG5leHBvcnQgeyBpbml0IH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/index.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/body/component.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/body/component.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BodyComponent: () => (/* binding */ BodyComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nconst vec3 = new pc.Vec3();\r\n\r\nclass BodyComponent extends _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent {\r\n\r\n    // ---- BODY PROPS ----\r\n\r\n    // Position of the body (not of the center of mass)\r\n    _position = new pc.Vec3();\r\n\r\n    // Rotation of the body.\r\n    _rotation = new pc.Quat();\r\n\r\n    // World space linear velocity of the center of mass (m/s)\r\n    _linearVelocity = new pc.Vec3();\r\n\r\n    // World space angular velocity (rad/s)\r\n    _angularVelocity = new pc.Vec3();\r\n\r\n    // Motion type, determines if the object is static, dynamic or kinematic.\r\n    _motionType = pc.JOLT_MOTION_TYPE_STATIC;\r\n\r\n    // Enables/disables the use of motion state for this entity. Not used by static bodies.\r\n    _useMotionState = true;\r\n\r\n    // The collision layer this body belongs to (determines if two objects can collide).\r\n    // Allows cheap filtering.\r\n    _objectLayer = 0;\r\n\r\n    // The collision group this body belongs to (determines if two objects can collide).\r\n    // Expensive, so disabled by default.\r\n    _collisionGroup = null;\r\n\r\n    // Sub-group (within the collision group). Expensive, so disabled by default.\r\n    _subGroup = null;\r\n\r\n    // Which degrees of freedom this body has (can be used to limit simulation to 2D)\r\n    _allowedDOFs = pc.JOLT_ALLOWED_DOFS_ALL;\r\n\r\n    // When this body is created as static, this setting tells the system to create a\r\n    // MotionProperties object so that the object can be switched to kinematic or dynamic.\r\n    _allowDynamicOrKinematic = false;\r\n\r\n    // If this body is a sensor. A sensor will receive collision callbacks, but will not\r\n    // cause any collision responses and can be used as a trigger volume.\r\n    _isSensor = false;\r\n\r\n    // Motion quality, or how well it detects collisions when it has a high velocity.\r\n    _motionQuality = pc.JOLT_MOTION_QUALITY_DISCRETE;\r\n\r\n    // If this body can go to sleep or not.\r\n    _allowSleeping = true;\r\n\r\n    // Friction of the body (dimensionless number, usually between 0 and 1, 0 = no friction,\r\n    // 1 = friction force equals force that presses the two bodies together). Note that bodies\r\n    // can have negative friction but the combined friction should never go below zero.\r\n    _friction = 0.2;\r\n\r\n    // Restitution of body (dimensionless number, usually between 0 and 1, 0 = completely\r\n    // inelastic collision response, 1 = completely elastic collision response). Note that\r\n    // bodies can have negative restitution but the combined restitution should never go below zero.\r\n    _restitution = 0;\r\n\r\n    // Linear damping: dv/dt = -c * v. c must be between 0 and 1 but is usually close to 0.\r\n    _linearDamping = 0;\r\n\r\n    // Angular damping: dw/dt = -c * w. c must be between 0 and 1 but is usually close to 0.\r\n    _angularDamping = 0;\r\n\r\n    // Maximum linear velocity that this body can reach (m/s)\r\n    _maxLinearVelocity = 500;\r\n\r\n    // Maximum angular velocity that this body can reach (rad/s)\r\n    _maxAngularVelocity = 0.25 * Math.PI * 60;\r\n\r\n    // Value to multiply gravity with for this body.\r\n    _gravityFactor = 1;\r\n\r\n    // When calculating the inertia (not when it is provided) the calculated inertia will be multiplied by this value.\r\n    _inertiaMultiplier = 1;\r\n\r\n    // Determines how mMassPropertiesOverride will be used. By default tells Jolt to\r\n    // auto-calculate by the shape.\r\n    _overrideMassProperties = pc.JOLT_OMP_CALCULATE_MASS_AND_INERTIA;\r\n\r\n    // Used only if Jolt.CalculateInertia or Jolt.MassAndInertiaProvided is selected for\r\n    // mass calculation method\r\n    _overrideMass = 1;\r\n\r\n    // Used if Jolt.MassAndInertiaProvided is selected for mass calculation method.\r\n    // Backend will create inertia matrix from the given position/rotation.\r\n    _overrideInertiaPosition = new pc.Vec3();\r\n    _overrideInertiaRotation = new pc.Quat();\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    set linearVelocity(vec) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vec, `Invalid linear velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        if (!vec.equals(this._linearVelocity)) {\r\n            this._linearVelocity.copy(vec);\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_LIN_VEL, this._index,\r\n                vec, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n        }\r\n    }\r\n\r\n    get linearVelocity() {\r\n        return this._linearVelocity;\r\n    }\r\n\r\n    set angularVelocity(vec) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vec, `Invalid angular velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        if (!vec.equals(this._angularVelocity)) {\r\n            this._angularVelocity.copy(vec);\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_ANG_VEL, this._index,\r\n                vec, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n        }\r\n    }\r\n\r\n    get angularVelocity() {\r\n        return this._angularVelocity;\r\n    }\r\n\r\n    set motionType(type) {\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(type, `Invalid motion type: ${ type }`);\r\n        this._motionType = type;\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_MOTION_TYPE, this._index,\r\n            type, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false\r\n        );\r\n    }\r\n\r\n    get motionType() {\r\n        return this._motionType;\r\n    }\r\n\r\n    get collisionGroup() {\r\n        return this._group;\r\n    }\r\n\r\n    get subGroup() {\r\n        return this._subGroup;\r\n    }\r\n\r\n    get index() {\r\n        return this._index;\r\n    }\r\n\r\n    get userData() {\r\n        return this._userData;\r\n    }\r\n\r\n    set userData(num) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(num, `Invalid user data value. Should be a number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this._userData = num;\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_USER_DATA, this._index,\r\n            num, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );      \r\n    }\r\n\r\n    get useMotionState() {\r\n        return this._useMotionState;\r\n    }\r\n\r\n    set useMotionState(bool) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(bool, `Invalid bool value for useMotionState property: ${ bool }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_USE_MOTION_STATE, this._index,\r\n            bool, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false\r\n        );\r\n    }\r\n\r\n    addForce(force, offset, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(force, `Invalid add force vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(offset, `Invalid add force offset`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let _offset = null;\r\n        if (offset) {\r\n            _offset = vec3.copy(offset);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(_offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            force, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            _offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addForceScalars(forceX, forceY, forceZ, offsetX = 0, offsetY = 0, offsetZ = 0, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceX, `Invalid add impulse X component: ${ forceX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceY, `Invalid add impulse Y component: ${ forceY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(forceZ, `Invalid add impulse Z component: ${ forceZ }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetX, `Invalid add impulse offset X component: ${ offsetX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetY, `Invalid add impulse offset Y component: ${ offsetY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetZ, `Invalid add impulse offset Z component: ${ offsetZ }`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let offset = null;\r\n        if (offsetX !== 0 || offsetY !== 0 || offsetZ !== 0) {\r\n            offset = vec3.set(offsetX, offsetY, offsetZ);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            forceX, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            forceY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            forceZ, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addImpulse(impulse, offset, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(impulse, `Invalid add impulse vector:`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(offset, `Invalid add impulse offset:`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let _offset = null;\r\n        if (offset) {\r\n            _offset = vec3.copy(offset);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(_offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_IMPULSE, this._index,\r\n            impulse, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            _offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    addImpulseScalars(impulseX, impulseY, impulseZ, offsetX = 0, offsetY = 0, offsetZ = 0, isOffsetLocal = false) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseX, `Invalid add impulse X component: ${ impulseX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseY, `Invalid add impulse Y component: ${ impulseY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(impulseZ, `Invalid add impulse Z component: ${ impulseZ }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetX, `Invalid add impulse offset X component: ${ offsetX }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetY, `Invalid add impulse offset Y component: ${ offsetY }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(offsetZ, `Invalid add impulse offset Z component: ${ offsetZ }`);\r\n            if (!ok) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let offset = null;\r\n        if (offsetX !== 0 || offsetY !== 0 || offsetZ !== 0) {\r\n            offset = vec3.set(offsetX, offsetY, offsetZ);\r\n\r\n            if (isOffsetLocal) {\r\n                this._localToWorld(offset);\r\n            }\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            impulseX, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            impulseY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            impulseZ, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, true\r\n        );\r\n    }\r\n\r\n    applyBuoyancyImpulse(waterSurfacePosition, surfaceNormal, buoyancy, linearDrag, angularDrag, fluidVelocity) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = true;\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(waterSurfacePosition, `Invalid water surface position vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(surfaceNormal, `Invalid surface normal`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(buoyancy, `Invalid buoyancy scalar: ${ buoyancy }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(linearDrag, `Invalid linear drag scalar: ${ linearDrag }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(angularDrag, `Invalid angular drag scalar: ${ angularDrag }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(fluidVelocity, `Invalid fluid velocity vector`);\r\n            if (!ok) return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_APPLY_BUOYANCY_IMPULSE, this._index,\r\n            waterSurfacePosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            surfaceNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n            buoyancy, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            linearDrag, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            angularDrag, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            fluidVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    addAngularImpulse(impulse) {\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_IMPULSE, this._index,\r\n            impulse, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    addTorque(torque) {\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_ADD_FORCE, this._index,\r\n            torque, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    writeIsometry() {\r\n        const entity = this.entity;\r\n        if (entity._dirtyWorld) {\r\n            const position = entity.getPosition();\r\n            const rotation = entity.getRotation();\r\n\r\n            this.system.addCommand(\r\n                _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_MOVE_BODY, this._index,\r\n                position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false,\r\n                rotation, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n            );\r\n\r\n            if (this._motionType === pc.JOLT_MOTION_TYPE_DYNAMIC) {\r\n                this.resetVelocities();\r\n            }\r\n        }\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        const ok = _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent.writeShapeData(cb, this);\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !ok) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Error creating a shape data.');\r\n            cb.reset();\r\n            return;\r\n        }\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // We always use world position and rotation from the current entity the component\r\n        // is attached to (instead of default zero vectors)\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // TODO\r\n        // get rid of flags\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n        cb.write(this._motionType, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._useMotionState, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._objectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._linearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._angularVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._maxLinearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxAngularVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._friction, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._restitution, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._linearDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._angularDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._gravityFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._inertiaMultiplier, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._allowedDOFs, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._allowDynamicOrKinematic, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._isSensor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._motionQuality, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._allowSleeping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._collisionGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32);\r\n        cb.write(this._subGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n        const massProps = this._overrideMassProperties;\r\n        cb.write(massProps, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n\r\n        if (massProps !== pc.JOLT_OMP_CALCULATE_MASS_AND_INERTIA) {\r\n            cb.write(this._overrideMass, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            if (this._overrideMassProperties === pc.JOLT_OMP_MASS_AND_INERTIA_PROVIDED) {\r\n                // override inertia\r\n                // Potential precision loss (64 -> 32)\r\n                cb.write(this._overrideInertiaPosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._overrideInertiaRotation, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    resetVelocities() {\r\n        this.system.addCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_RESET_VELOCITIES, this._index);\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n        const shape = this._shape;\r\n        const isCompoundChild = this._isCompoundChild;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        if ((shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH || shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL || shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_HEIGHTFIELD) && \r\n            this._renderAsset && !this._meshes) {\r\n            this._addMeshes();\r\n        } else if (!isCompoundChild) {\r\n            system.createBody(this);\r\n        }\r\n\r\n        if (!isCompoundChild) {\r\n            const motionType = this._motionType;\r\n            if ((motionType === pc.JOLT_MOTION_TYPE_DYNAMIC && this._trackDynamic) || motionType === pc.JOLT_MOTION_TYPE_KINEMATIC) {\r\n                this._isometryEvent = this.system.on('write-isometry', this.writeIsometry, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n\r\n        const system = this.system;\r\n        const componentIndex = this._index;\r\n\r\n        system.setIndexFree(componentIndex);\r\n\r\n        // TODO\r\n        // Jolt currently exposes only static compounds to Wasm. Which means,\r\n        // that a compound parent cannot change children. So, currently\r\n        // a child cannot be added/removed, we can only destroy/create\r\n        // parent.\r\n\r\n        if (this._isCompoundChild) return;\r\n\r\n        system.addCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CLEANER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_DESTROY_BODY, componentIndex);\r\n\r\n        this._isometryEvent?.off();\r\n        this._isometryEvent = null;\r\n    }\r\n\r\n    _localToWorld(vec) {\r\n        const m4 = this.entity.getWorldTransform();\r\n        m4.transformPoint(vec, vec);\r\n    }\r\n\r\n    _addMeshes() {\r\n        const id = this._renderAsset;\r\n        const assets = this.system.app.assets;\r\n\r\n        const onAssetFullyReady = (asset) => {\r\n            this._meshes = asset.resource.meshes;\r\n            this.system.createBody(this);\r\n        };\r\n\r\n        const loadAndHandleAsset = (asset) => {\r\n            asset.ready((asset) => {\r\n                if (asset.data.containerAsset) {\r\n                    const containerAsset = assets.get(asset.data.containerAsset);\r\n                    if (containerAsset.loaded) {\r\n                        onAssetFullyReady(asset);\r\n                    } else {\r\n                        containerAsset.ready(() => {\r\n                            onAssetFullyReady(asset);\r\n                        });\r\n                        assets.load(containerAsset);\r\n                    }\r\n                } else {\r\n                    onAssetFullyReady(asset);\r\n                }\r\n            });\r\n\r\n            assets.load(asset);\r\n        };\r\n\r\n        const asset = assets.get(id);\r\n        if (asset) {\r\n            loadAndHandleAsset(asset);\r\n        } else {\r\n            assets.once('add:' + id, loadAndHandleAsset);\r\n        }        \r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9jb21wb25lbnQubWpzP2RmMmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi4vLi4vLi4vZGVidWcubWpzXCI7XHJcbmltcG9ydCB7IFNoYXBlQ29tcG9uZW50IH0gZnJvbSBcIi4uL2NvbXBvbmVudC5tanNcIjtcclxuaW1wb3J0IHtcclxuICAgIEJVRkZFUl9XUklURV9CT09MLFxyXG4gICAgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDE2LFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UOCwgQlVGRkVSX1dSSVRFX1ZFQzMyLFxyXG4gICAgQ01EX0FERF9GT1JDRSwgQ01EX0FERF9JTVBVTFNFLFxyXG4gICAgQ01EX0FQUExZX0JVT1lBTkNZX0lNUFVMU0UsXHJcbiAgICBDTURfREVTVFJPWV9CT0RZLFxyXG4gICAgQ01EX01PVkVfQk9EWSwgQ01EX1JFU0VUX1ZFTE9DSVRJRVMsIENNRF9TRVRfQU5HX1ZFTCxcclxuICAgIENNRF9TRVRfTElOX1ZFTCwgQ01EX1NFVF9NT1RJT05fVFlQRSxcclxuICAgIENNRF9TRVRfVVNFUl9EQVRBLFxyXG4gICAgQ01EX1VTRV9NT1RJT05fU1RBVEUsXHJcbiAgICBPUEVSQVRPUl9DTEVBTkVSLCBPUEVSQVRPUl9NT0RJRklFUixcclxuICAgIFNIQVBFX0NPTlZFWF9IVUxMLFxyXG4gICAgU0hBUEVfSEVJR0hURklFTEQsXHJcbiAgICBTSEFQRV9NRVNIXHJcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuXHJcbmNvbnN0IHZlYzMgPSBuZXcgcGMuVmVjMygpO1xyXG5cclxuY2xhc3MgQm9keUNvbXBvbmVudCBleHRlbmRzIFNoYXBlQ29tcG9uZW50IHtcclxuXHJcbiAgICAvLyAtLS0tIEJPRFkgUFJPUFMgLS0tLVxyXG5cclxuICAgIC8vIFBvc2l0aW9uIG9mIHRoZSBib2R5IChub3Qgb2YgdGhlIGNlbnRlciBvZiBtYXNzKVxyXG4gICAgX3Bvc2l0aW9uID0gbmV3IHBjLlZlYzMoKTtcclxuXHJcbiAgICAvLyBSb3RhdGlvbiBvZiB0aGUgYm9keS5cclxuICAgIF9yb3RhdGlvbiA9IG5ldyBwYy5RdWF0KCk7XHJcblxyXG4gICAgLy8gV29ybGQgc3BhY2UgbGluZWFyIHZlbG9jaXR5IG9mIHRoZSBjZW50ZXIgb2YgbWFzcyAobS9zKVxyXG4gICAgX2xpbmVhclZlbG9jaXR5ID0gbmV3IHBjLlZlYzMoKTtcclxuXHJcbiAgICAvLyBXb3JsZCBzcGFjZSBhbmd1bGFyIHZlbG9jaXR5IChyYWQvcylcclxuICAgIF9hbmd1bGFyVmVsb2NpdHkgPSBuZXcgcGMuVmVjMygpO1xyXG5cclxuICAgIC8vIE1vdGlvbiB0eXBlLCBkZXRlcm1pbmVzIGlmIHRoZSBvYmplY3QgaXMgc3RhdGljLCBkeW5hbWljIG9yIGtpbmVtYXRpYy5cclxuICAgIF9tb3Rpb25UeXBlID0gcGMuSk9MVF9NT1RJT05fVFlQRV9TVEFUSUM7XHJcblxyXG4gICAgLy8gRW5hYmxlcy9kaXNhYmxlcyB0aGUgdXNlIG9mIG1vdGlvbiBzdGF0ZSBmb3IgdGhpcyBlbnRpdHkuIE5vdCB1c2VkIGJ5IHN0YXRpYyBib2RpZXMuXHJcbiAgICBfdXNlTW90aW9uU3RhdGUgPSB0cnVlO1xyXG5cclxuICAgIC8vIFRoZSBjb2xsaXNpb24gbGF5ZXIgdGhpcyBib2R5IGJlbG9uZ3MgdG8gKGRldGVybWluZXMgaWYgdHdvIG9iamVjdHMgY2FuIGNvbGxpZGUpLlxyXG4gICAgLy8gQWxsb3dzIGNoZWFwIGZpbHRlcmluZy5cclxuICAgIF9vYmplY3RMYXllciA9IDA7XHJcblxyXG4gICAgLy8gVGhlIGNvbGxpc2lvbiBncm91cCB0aGlzIGJvZHkgYmVsb25ncyB0byAoZGV0ZXJtaW5lcyBpZiB0d28gb2JqZWN0cyBjYW4gY29sbGlkZSkuXHJcbiAgICAvLyBFeHBlbnNpdmUsIHNvIGRpc2FibGVkIGJ5IGRlZmF1bHQuXHJcbiAgICBfY29sbGlzaW9uR3JvdXAgPSBudWxsO1xyXG5cclxuICAgIC8vIFN1Yi1ncm91cCAod2l0aGluIHRoZSBjb2xsaXNpb24gZ3JvdXApLiBFeHBlbnNpdmUsIHNvIGRpc2FibGVkIGJ5IGRlZmF1bHQuXHJcbiAgICBfc3ViR3JvdXAgPSBudWxsO1xyXG5cclxuICAgIC8vIFdoaWNoIGRlZ3JlZXMgb2YgZnJlZWRvbSB0aGlzIGJvZHkgaGFzIChjYW4gYmUgdXNlZCB0byBsaW1pdCBzaW11bGF0aW9uIHRvIDJEKVxyXG4gICAgX2FsbG93ZWRET0ZzID0gcGMuSk9MVF9BTExPV0VEX0RPRlNfQUxMO1xyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBib2R5IGlzIGNyZWF0ZWQgYXMgc3RhdGljLCB0aGlzIHNldHRpbmcgdGVsbHMgdGhlIHN5c3RlbSB0byBjcmVhdGUgYVxyXG4gICAgLy8gTW90aW9uUHJvcGVydGllcyBvYmplY3Qgc28gdGhhdCB0aGUgb2JqZWN0IGNhbiBiZSBzd2l0Y2hlZCB0byBraW5lbWF0aWMgb3IgZHluYW1pYy5cclxuICAgIF9hbGxvd0R5bmFtaWNPcktpbmVtYXRpYyA9IGZhbHNlO1xyXG5cclxuICAgIC8vIElmIHRoaXMgYm9keSBpcyBhIHNlbnNvci4gQSBzZW5zb3Igd2lsbCByZWNlaXZlIGNvbGxpc2lvbiBjYWxsYmFja3MsIGJ1dCB3aWxsIG5vdFxyXG4gICAgLy8gY2F1c2UgYW55IGNvbGxpc2lvbiByZXNwb25zZXMgYW5kIGNhbiBiZSB1c2VkIGFzIGEgdHJpZ2dlciB2b2x1bWUuXHJcbiAgICBfaXNTZW5zb3IgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBNb3Rpb24gcXVhbGl0eSwgb3IgaG93IHdlbGwgaXQgZGV0ZWN0cyBjb2xsaXNpb25zIHdoZW4gaXQgaGFzIGEgaGlnaCB2ZWxvY2l0eS5cclxuICAgIF9tb3Rpb25RdWFsaXR5ID0gcGMuSk9MVF9NT1RJT05fUVVBTElUWV9ESVNDUkVURTtcclxuXHJcbiAgICAvLyBJZiB0aGlzIGJvZHkgY2FuIGdvIHRvIHNsZWVwIG9yIG5vdC5cclxuICAgIF9hbGxvd1NsZWVwaW5nID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBGcmljdGlvbiBvZiB0aGUgYm9keSAoZGltZW5zaW9ubGVzcyBudW1iZXIsIHVzdWFsbHkgYmV0d2VlbiAwIGFuZCAxLCAwID0gbm8gZnJpY3Rpb24sXHJcbiAgICAvLyAxID0gZnJpY3Rpb24gZm9yY2UgZXF1YWxzIGZvcmNlIHRoYXQgcHJlc3NlcyB0aGUgdHdvIGJvZGllcyB0b2dldGhlcikuIE5vdGUgdGhhdCBib2RpZXNcclxuICAgIC8vIGNhbiBoYXZlIG5lZ2F0aXZlIGZyaWN0aW9uIGJ1dCB0aGUgY29tYmluZWQgZnJpY3Rpb24gc2hvdWxkIG5ldmVyIGdvIGJlbG93IHplcm8uXHJcbiAgICBfZnJpY3Rpb24gPSAwLjI7XHJcblxyXG4gICAgLy8gUmVzdGl0dXRpb24gb2YgYm9keSAoZGltZW5zaW9ubGVzcyBudW1iZXIsIHVzdWFsbHkgYmV0d2VlbiAwIGFuZCAxLCAwID0gY29tcGxldGVseVxyXG4gICAgLy8gaW5lbGFzdGljIGNvbGxpc2lvbiByZXNwb25zZSwgMSA9IGNvbXBsZXRlbHkgZWxhc3RpYyBjb2xsaXNpb24gcmVzcG9uc2UpLiBOb3RlIHRoYXRcclxuICAgIC8vIGJvZGllcyBjYW4gaGF2ZSBuZWdhdGl2ZSByZXN0aXR1dGlvbiBidXQgdGhlIGNvbWJpbmVkIHJlc3RpdHV0aW9uIHNob3VsZCBuZXZlciBnbyBiZWxvdyB6ZXJvLlxyXG4gICAgX3Jlc3RpdHV0aW9uID0gMDtcclxuXHJcbiAgICAvLyBMaW5lYXIgZGFtcGluZzogZHYvZHQgPSAtYyAqIHYuIGMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEgYnV0IGlzIHVzdWFsbHkgY2xvc2UgdG8gMC5cclxuICAgIF9saW5lYXJEYW1waW5nID0gMDtcclxuXHJcbiAgICAvLyBBbmd1bGFyIGRhbXBpbmc6IGR3L2R0ID0gLWMgKiB3LiBjIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxIGJ1dCBpcyB1c3VhbGx5IGNsb3NlIHRvIDAuXHJcbiAgICBfYW5ndWxhckRhbXBpbmcgPSAwO1xyXG5cclxuICAgIC8vIE1heGltdW0gbGluZWFyIHZlbG9jaXR5IHRoYXQgdGhpcyBib2R5IGNhbiByZWFjaCAobS9zKVxyXG4gICAgX21heExpbmVhclZlbG9jaXR5ID0gNTAwO1xyXG5cclxuICAgIC8vIE1heGltdW0gYW5ndWxhciB2ZWxvY2l0eSB0aGF0IHRoaXMgYm9keSBjYW4gcmVhY2ggKHJhZC9zKVxyXG4gICAgX21heEFuZ3VsYXJWZWxvY2l0eSA9IDAuMjUgKiBNYXRoLlBJICogNjA7XHJcblxyXG4gICAgLy8gVmFsdWUgdG8gbXVsdGlwbHkgZ3Jhdml0eSB3aXRoIGZvciB0aGlzIGJvZHkuXHJcbiAgICBfZ3Jhdml0eUZhY3RvciA9IDE7XHJcblxyXG4gICAgLy8gV2hlbiBjYWxjdWxhdGluZyB0aGUgaW5lcnRpYSAobm90IHdoZW4gaXQgaXMgcHJvdmlkZWQpIHRoZSBjYWxjdWxhdGVkIGluZXJ0aWEgd2lsbCBiZSBtdWx0aXBsaWVkIGJ5IHRoaXMgdmFsdWUuXHJcbiAgICBfaW5lcnRpYU11bHRpcGxpZXIgPSAxO1xyXG5cclxuICAgIC8vIERldGVybWluZXMgaG93IG1NYXNzUHJvcGVydGllc092ZXJyaWRlIHdpbGwgYmUgdXNlZC4gQnkgZGVmYXVsdCB0ZWxscyBKb2x0IHRvXHJcbiAgICAvLyBhdXRvLWNhbGN1bGF0ZSBieSB0aGUgc2hhcGUuXHJcbiAgICBfb3ZlcnJpZGVNYXNzUHJvcGVydGllcyA9IHBjLkpPTFRfT01QX0NBTENVTEFURV9NQVNTX0FORF9JTkVSVElBO1xyXG5cclxuICAgIC8vIFVzZWQgb25seSBpZiBKb2x0LkNhbGN1bGF0ZUluZXJ0aWEgb3IgSm9sdC5NYXNzQW5kSW5lcnRpYVByb3ZpZGVkIGlzIHNlbGVjdGVkIGZvclxyXG4gICAgLy8gbWFzcyBjYWxjdWxhdGlvbiBtZXRob2RcclxuICAgIF9vdmVycmlkZU1hc3MgPSAxO1xyXG5cclxuICAgIC8vIFVzZWQgaWYgSm9sdC5NYXNzQW5kSW5lcnRpYVByb3ZpZGVkIGlzIHNlbGVjdGVkIGZvciBtYXNzIGNhbGN1bGF0aW9uIG1ldGhvZC5cclxuICAgIC8vIEJhY2tlbmQgd2lsbCBjcmVhdGUgaW5lcnRpYSBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gcG9zaXRpb24vcm90YXRpb24uXHJcbiAgICBfb3ZlcnJpZGVJbmVydGlhUG9zaXRpb24gPSBuZXcgcGMuVmVjMygpO1xyXG4gICAgX292ZXJyaWRlSW5lcnRpYVJvdGF0aW9uID0gbmV3IHBjLlF1YXQoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzeXN0ZW0sIGVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKHN5c3RlbSwgZW50aXR5KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbGluZWFyVmVsb2NpdHkodmVjKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrVmVjKHZlYywgYEludmFsaWQgbGluZWFyIHZlbG9jaXR5IHZlY3RvcmApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXZlYy5lcXVhbHModGhpcy5fbGluZWFyVmVsb2NpdHkpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xpbmVhclZlbG9jaXR5LmNvcHkodmVjKTtcclxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfU0VUX0xJTl9WRUwsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICAgICAgdmVjLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBsaW5lYXJWZWxvY2l0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGluZWFyVmVsb2NpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGFuZ3VsYXJWZWxvY2l0eSh2ZWMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tWZWModmVjLCBgSW52YWxpZCBhbmd1bGFyIHZlbG9jaXR5IHZlY3RvcmApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXZlYy5lcXVhbHModGhpcy5fYW5ndWxhclZlbG9jaXR5KSkge1xyXG4gICAgICAgICAgICB0aGlzLl9hbmd1bGFyVmVsb2NpdHkuY29weSh2ZWMpO1xyXG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9TRVRfQU5HX1ZFTCwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgICAgICB2ZWMsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2VcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFuZ3VsYXJWZWxvY2l0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYW5ndWxhclZlbG9jaXR5O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBtb3Rpb25UeXBlKHR5cGUpIHtcclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcuY2hlY2tVaW50KHR5cGUsIGBJbnZhbGlkIG1vdGlvbiB0eXBlOiAkeyB0eXBlIH1gKTtcclxuICAgICAgICB0aGlzLl9tb3Rpb25UeXBlID0gdHlwZTtcclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX1NFVF9NT1RJT05fVFlQRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIHR5cGUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2VcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtb3Rpb25UeXBlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9tb3Rpb25UeXBlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb2xsaXNpb25Hcm91cCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXA7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHN1Ykdyb3VwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdWJHcm91cDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaW5kZXgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB1c2VyRGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHVzZXJEYXRhKG51bSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdChudW0sIGBJbnZhbGlkIHVzZXIgZGF0YSB2YWx1ZS4gU2hvdWxkIGJlIGEgbnVtYmVyOiAkeyBudW0gfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdXNlckRhdGEgPSBudW07XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfU0VUX1VTRVJfREFUQSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIG51bSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlXHJcbiAgICAgICAgKTsgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdXNlTW90aW9uU3RhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZU1vdGlvblN0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB1c2VNb3Rpb25TdGF0ZShib29sKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrQm9vbChib29sLCBgSW52YWxpZCBib29sIHZhbHVlIGZvciB1c2VNb3Rpb25TdGF0ZSBwcm9wZXJ0eTogJHsgYm9vbCB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX1VTRV9NT1RJT05fU1RBVEUsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBib29sLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2VcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEZvcmNlKGZvcmNlLCBvZmZzZXQsIGlzT2Zmc2V0TG9jYWwgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhmb3JjZSwgYEludmFsaWQgYWRkIGZvcmNlIHZlY3RvcmApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKG9mZnNldCwgYEludmFsaWQgYWRkIGZvcmNlIG9mZnNldGApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBfb2Zmc2V0ID0gbnVsbDtcclxuICAgICAgICBpZiAob2Zmc2V0KSB7XHJcbiAgICAgICAgICAgIF9vZmZzZXQgPSB2ZWMzLmNvcHkob2Zmc2V0KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc09mZnNldExvY2FsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFRvV29ybGQoX29mZnNldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQUREX0ZPUkNFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgZm9yY2UsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIF9vZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkRm9yY2VTY2FsYXJzKGZvcmNlWCwgZm9yY2VZLCBmb3JjZVosIG9mZnNldFggPSAwLCBvZmZzZXRZID0gMCwgb2Zmc2V0WiA9IDAsIGlzT2Zmc2V0TG9jYWwgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGZvcmNlWCwgYEludmFsaWQgYWRkIGltcHVsc2UgWCBjb21wb25lbnQ6ICR7IGZvcmNlWCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChmb3JjZVksIGBJbnZhbGlkIGFkZCBpbXB1bHNlIFkgY29tcG9uZW50OiAkeyBmb3JjZVkgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoZm9yY2VaLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBaIGNvbXBvbmVudDogJHsgZm9yY2VaIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KG9mZnNldFgsIGBJbnZhbGlkIGFkZCBpbXB1bHNlIG9mZnNldCBYIGNvbXBvbmVudDogJHsgb2Zmc2V0WCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChvZmZzZXRZLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBvZmZzZXQgWSBjb21wb25lbnQ6ICR7IG9mZnNldFkgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQob2Zmc2V0WiwgYEludmFsaWQgYWRkIGltcHVsc2Ugb2Zmc2V0IFogY29tcG9uZW50OiAkeyBvZmZzZXRaIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgb2Zmc2V0ID0gbnVsbDtcclxuICAgICAgICBpZiAob2Zmc2V0WCAhPT0gMCB8fCBvZmZzZXRZICE9PSAwIHx8IG9mZnNldFogIT09IDApIHtcclxuICAgICAgICAgICAgb2Zmc2V0ID0gdmVjMy5zZXQob2Zmc2V0WCwgb2Zmc2V0WSwgb2Zmc2V0Wik7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNPZmZzZXRMb2NhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxUb1dvcmxkKG9mZnNldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQUREX0ZPUkNFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgZm9yY2VYLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGZvcmNlWSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBmb3JjZVosIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgb2Zmc2V0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIHRydWVcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEltcHVsc2UoaW1wdWxzZSwgb2Zmc2V0LCBpc09mZnNldExvY2FsID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMoaW1wdWxzZSwgYEludmFsaWQgYWRkIGltcHVsc2UgdmVjdG9yOmApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKG9mZnNldCwgYEludmFsaWQgYWRkIGltcHVsc2Ugb2Zmc2V0OmApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBfb2Zmc2V0ID0gbnVsbDtcclxuICAgICAgICBpZiAob2Zmc2V0KSB7XHJcbiAgICAgICAgICAgIF9vZmZzZXQgPSB2ZWMzLmNvcHkob2Zmc2V0KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc09mZnNldExvY2FsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFRvV29ybGQoX29mZnNldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQUREX0lNUFVMU0UsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICBpbXB1bHNlLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBfb2Zmc2V0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIHRydWVcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEltcHVsc2VTY2FsYXJzKGltcHVsc2VYLCBpbXB1bHNlWSwgaW1wdWxzZVosIG9mZnNldFggPSAwLCBvZmZzZXRZID0gMCwgb2Zmc2V0WiA9IDAsIGlzT2Zmc2V0TG9jYWwgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGltcHVsc2VYLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBYIGNvbXBvbmVudDogJHsgaW1wdWxzZVggfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoaW1wdWxzZVksIGBJbnZhbGlkIGFkZCBpbXB1bHNlIFkgY29tcG9uZW50OiAkeyBpbXB1bHNlWSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChpbXB1bHNlWiwgYEludmFsaWQgYWRkIGltcHVsc2UgWiBjb21wb25lbnQ6ICR7IGltcHVsc2VaIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KG9mZnNldFgsIGBJbnZhbGlkIGFkZCBpbXB1bHNlIG9mZnNldCBYIGNvbXBvbmVudDogJHsgb2Zmc2V0WCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChvZmZzZXRZLCBgSW52YWxpZCBhZGQgaW1wdWxzZSBvZmZzZXQgWSBjb21wb25lbnQ6ICR7IG9mZnNldFkgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQob2Zmc2V0WiwgYEludmFsaWQgYWRkIGltcHVsc2Ugb2Zmc2V0IFogY29tcG9uZW50OiAkeyBvZmZzZXRaIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgb2Zmc2V0ID0gbnVsbDtcclxuICAgICAgICBpZiAob2Zmc2V0WCAhPT0gMCB8fCBvZmZzZXRZICE9PSAwIHx8IG9mZnNldFogIT09IDApIHtcclxuICAgICAgICAgICAgb2Zmc2V0ID0gdmVjMy5zZXQob2Zmc2V0WCwgb2Zmc2V0WSwgb2Zmc2V0Wik7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNPZmZzZXRMb2NhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxUb1dvcmxkKG9mZnNldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQUREX0ZPUkNFLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgaW1wdWxzZVgsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgaW1wdWxzZVksIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgaW1wdWxzZVosIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgb2Zmc2V0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIHRydWVcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcGx5QnVveWFuY3lJbXB1bHNlKHdhdGVyU3VyZmFjZVBvc2l0aW9uLCBzdXJmYWNlTm9ybWFsLCBidW95YW5jeSwgbGluZWFyRHJhZywgYW5ndWxhckRyYWcsIGZsdWlkVmVsb2NpdHkpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMod2F0ZXJTdXJmYWNlUG9zaXRpb24sIGBJbnZhbGlkIHdhdGVyIHN1cmZhY2UgcG9zaXRpb24gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMoc3VyZmFjZU5vcm1hbCwgYEludmFsaWQgc3VyZmFjZSBub3JtYWxgKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGJ1b3lhbmN5LCBgSW52YWxpZCBidW95YW5jeSBzY2FsYXI6ICR7IGJ1b3lhbmN5IH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KGxpbmVhckRyYWcsIGBJbnZhbGlkIGxpbmVhciBkcmFnIHNjYWxhcjogJHsgbGluZWFyRHJhZyB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChhbmd1bGFyRHJhZywgYEludmFsaWQgYW5ndWxhciBkcmFnIHNjYWxhcjogJHsgYW5ndWxhckRyYWcgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKGZsdWlkVmVsb2NpdHksIGBJbnZhbGlkIGZsdWlkIHZlbG9jaXR5IHZlY3RvcmApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKSByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX0FQUExZX0JVT1lBTkNZX0lNUFVMU0UsIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICB3YXRlclN1cmZhY2VQb3NpdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSxcclxuICAgICAgICAgICAgc3VyZmFjZU5vcm1hbCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSxcclxuICAgICAgICAgICAgYnVveWFuY3ksIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgbGluZWFyRHJhZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBhbmd1bGFyRHJhZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBmbHVpZFZlbG9jaXR5LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRBbmd1bGFySW1wdWxzZShpbXB1bHNlKSB7XHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9BRERfSU1QVUxTRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIGltcHVsc2UsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2VcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFRvcnF1ZSh0b3JxdWUpIHtcclxuICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICBPUEVSQVRPUl9NT0RJRklFUiwgQ01EX0FERF9GT1JDRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIHRvcnF1ZSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVJc29tZXRyeSgpIHtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eTtcclxuICAgICAgICBpZiAoZW50aXR5Ll9kaXJ0eVdvcmxkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gZW50aXR5LmdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdGF0aW9uID0gZW50aXR5LmdldFJvdGF0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5hZGRDb21tYW5kKFxyXG4gICAgICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9NT1ZFX0JPRFksIHRoaXMuX2luZGV4LFxyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByb3RhdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX21vdGlvblR5cGUgPT09IHBjLkpPTFRfTU9USU9OX1RZUEVfRFlOQU1JQykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldFZlbG9jaXRpZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZUNvbXBvbmVudERhdGEoY2IpIHtcclxuICAgICAgICBjb25zdCBvayA9IFNoYXBlQ29tcG9uZW50LndyaXRlU2hhcGVEYXRhKGNiLCB0aGlzKTtcclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmICFvaykge1xyXG4gICAgICAgICAgICBEZWJ1Zy53YXJuKCdFcnJvciBjcmVhdGluZyBhIHNoYXBlIGRhdGEuJyk7XHJcbiAgICAgICAgICAgIGNiLnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIFdlIGFsd2F5cyB1c2Ugd29ybGQgcG9zaXRpb24gYW5kIHJvdGF0aW9uIGZyb20gdGhlIGN1cnJlbnQgZW50aXR5IHRoZSBjb21wb25lbnRcclxuICAgICAgICAvLyBpcyBhdHRhY2hlZCB0byAoaW5zdGVhZCBvZiBkZWZhdWx0IHplcm8gdmVjdG9ycylcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eTtcclxuICAgICAgICBjb25zdCBwb3MgPSBlbnRpdHkuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICBjb25zdCByb3QgPSBlbnRpdHkuZ2V0Um90YXRpb24oKTtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGdldCByaWQgb2YgZmxhZ3NcclxuXHJcbiAgICAgICAgLy8gTG9zcyBvZiBwcmVjaXNpb24gZm9yIHBvcy9yb3QgKDY0IC0+IDMyKVxyXG4gICAgICAgIGNiLndyaXRlKHBvcywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbW90aW9uVHlwZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fdXNlTW90aW9uU3RhdGUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fb2JqZWN0TGF5ZXIsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9saW5lYXJWZWxvY2l0eSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fYW5ndWxhclZlbG9jaXR5LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhMaW5lYXJWZWxvY2l0eSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhBbmd1bGFyVmVsb2NpdHksIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fZnJpY3Rpb24sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fcmVzdGl0dXRpb24sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbGluZWFyRGFtcGluZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9hbmd1bGFyRGFtcGluZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9ncmF2aXR5RmFjdG9yLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZXJ0aWFNdWx0aXBsaWVyLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FsbG93ZWRET0ZzLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9hbGxvd0R5bmFtaWNPcktpbmVtYXRpYywgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9pc1NlbnNvciwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tb3Rpb25RdWFsaXR5LCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9hbGxvd1NsZWVwaW5nLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2NvbGxpc2lvbkdyb3VwLCBCVUZGRVJfV1JJVEVfVUlOVDMyKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zdWJHcm91cCwgQlVGRkVSX1dSSVRFX1VJTlQzMik7XHJcblxyXG4gICAgICAgIERlYnVnLmRldiAmJiBjYi53cml0ZSh0aGlzLl9kZWJ1Z0RyYXcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1hc3NQcm9wcyA9IHRoaXMuX292ZXJyaWRlTWFzc1Byb3BlcnRpZXM7XHJcbiAgICAgICAgY2Iud3JpdGUobWFzc1Byb3BzLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgaWYgKG1hc3NQcm9wcyAhPT0gcGMuSk9MVF9PTVBfQ0FMQ1VMQVRFX01BU1NfQU5EX0lORVJUSUEpIHtcclxuICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fb3ZlcnJpZGVNYXNzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX292ZXJyaWRlTWFzc1Byb3BlcnRpZXMgPT09IHBjLkpPTFRfT01QX01BU1NfQU5EX0lORVJUSUFfUFJPVklERUQpIHtcclxuICAgICAgICAgICAgICAgIC8vIG92ZXJyaWRlIGluZXJ0aWFcclxuICAgICAgICAgICAgICAgIC8vIFBvdGVudGlhbCBwcmVjaXNpb24gbG9zcyAoNjQgLT4gMzIpXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9vdmVycmlkZUluZXJ0aWFQb3NpdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9vdmVycmlkZUluZXJ0aWFSb3RhdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRWZWxvY2l0aWVzKCkge1xyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9SRVNFVF9WRUxPQ0lUSUVTLCB0aGlzLl9pbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25FbmFibGUoKSB7XHJcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5zeXN0ZW07XHJcbiAgICAgICAgY29uc3Qgc2hhcGUgPSB0aGlzLl9zaGFwZTtcclxuICAgICAgICBjb25zdCBpc0NvbXBvdW5kQ2hpbGQgPSB0aGlzLl9pc0NvbXBvdW5kQ2hpbGQ7XHJcblxyXG4gICAgICAgIHRoaXMuX2luZGV4ID0gc3lzdGVtLmdldEluZGV4KHRoaXMuZW50aXR5KTtcclxuXHJcbiAgICAgICAgaWYgKChzaGFwZSA9PT0gU0hBUEVfTUVTSCB8fCBzaGFwZSA9PT0gU0hBUEVfQ09OVkVYX0hVTEwgfHwgc2hhcGUgPT09IFNIQVBFX0hFSUdIVEZJRUxEKSAmJiBcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyQXNzZXQgJiYgIXRoaXMuX21lc2hlcykge1xyXG4gICAgICAgICAgICB0aGlzLl9hZGRNZXNoZXMoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKCFpc0NvbXBvdW5kQ2hpbGQpIHtcclxuICAgICAgICAgICAgc3lzdGVtLmNyZWF0ZUJvZHkodGhpcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWlzQ29tcG91bmRDaGlsZCkge1xyXG4gICAgICAgICAgICBjb25zdCBtb3Rpb25UeXBlID0gdGhpcy5fbW90aW9uVHlwZTtcclxuICAgICAgICAgICAgaWYgKChtb3Rpb25UeXBlID09PSBwYy5KT0xUX01PVElPTl9UWVBFX0RZTkFNSUMgJiYgdGhpcy5fdHJhY2tEeW5hbWljKSB8fCBtb3Rpb25UeXBlID09PSBwYy5KT0xUX01PVElPTl9UWVBFX0tJTkVNQVRJQykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faXNvbWV0cnlFdmVudCA9IHRoaXMuc3lzdGVtLm9uKCd3cml0ZS1pc29tZXRyeScsIHRoaXMud3JpdGVJc29tZXRyeSwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25EaXNhYmxlKCkge1xyXG4gICAgICAgIHN1cGVyLm9uRGlzYWJsZSgpO1xyXG5cclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLnN5c3RlbTtcclxuICAgICAgICBjb25zdCBjb21wb25lbnRJbmRleCA9IHRoaXMuX2luZGV4O1xyXG5cclxuICAgICAgICBzeXN0ZW0uc2V0SW5kZXhGcmVlKGNvbXBvbmVudEluZGV4KTtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIEpvbHQgY3VycmVudGx5IGV4cG9zZXMgb25seSBzdGF0aWMgY29tcG91bmRzIHRvIFdhc20uIFdoaWNoIG1lYW5zLFxyXG4gICAgICAgIC8vIHRoYXQgYSBjb21wb3VuZCBwYXJlbnQgY2Fubm90IGNoYW5nZSBjaGlsZHJlbi4gU28sIGN1cnJlbnRseVxyXG4gICAgICAgIC8vIGEgY2hpbGQgY2Fubm90IGJlIGFkZGVkL3JlbW92ZWQsIHdlIGNhbiBvbmx5IGRlc3Ryb3kvY3JlYXRlXHJcbiAgICAgICAgLy8gcGFyZW50LlxyXG5cclxuICAgICAgICBpZiAodGhpcy5faXNDb21wb3VuZENoaWxkKSByZXR1cm47XHJcblxyXG4gICAgICAgIHN5c3RlbS5hZGRDb21tYW5kKE9QRVJBVE9SX0NMRUFORVIsIENNRF9ERVNUUk9ZX0JPRFksIGNvbXBvbmVudEluZGV4KTtcclxuXHJcbiAgICAgICAgdGhpcy5faXNvbWV0cnlFdmVudD8ub2ZmKCk7XHJcbiAgICAgICAgdGhpcy5faXNvbWV0cnlFdmVudCA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgX2xvY2FsVG9Xb3JsZCh2ZWMpIHtcclxuICAgICAgICBjb25zdCBtNCA9IHRoaXMuZW50aXR5LmdldFdvcmxkVHJhbnNmb3JtKCk7XHJcbiAgICAgICAgbTQudHJhbnNmb3JtUG9pbnQodmVjLCB2ZWMpO1xyXG4gICAgfVxyXG5cclxuICAgIF9hZGRNZXNoZXMoKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLl9yZW5kZXJBc3NldDtcclxuICAgICAgICBjb25zdCBhc3NldHMgPSB0aGlzLnN5c3RlbS5hcHAuYXNzZXRzO1xyXG5cclxuICAgICAgICBjb25zdCBvbkFzc2V0RnVsbHlSZWFkeSA9IChhc3NldCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9tZXNoZXMgPSBhc3NldC5yZXNvdXJjZS5tZXNoZXM7XHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmNyZWF0ZUJvZHkodGhpcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgbG9hZEFuZEhhbmRsZUFzc2V0ID0gKGFzc2V0KSA9PiB7XHJcbiAgICAgICAgICAgIGFzc2V0LnJlYWR5KChhc3NldCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuY29udGFpbmVyQXNzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJBc3NldCA9IGFzc2V0cy5nZXQoYXNzZXQuZGF0YS5jb250YWluZXJBc3NldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lckFzc2V0LmxvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkFzc2V0RnVsbHlSZWFkeShhc3NldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyQXNzZXQucmVhZHkoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Bc3NldEZ1bGx5UmVhZHkoYXNzZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRzLmxvYWQoY29udGFpbmVyQXNzZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25Bc3NldEZ1bGx5UmVhZHkoYXNzZXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGFzc2V0cy5sb2FkKGFzc2V0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBhc3NldCA9IGFzc2V0cy5nZXQoaWQpO1xyXG4gICAgICAgIGlmIChhc3NldCkge1xyXG4gICAgICAgICAgICBsb2FkQW5kSGFuZGxlQXNzZXQoYXNzZXQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFzc2V0cy5vbmNlKCdhZGQ6JyArIGlkLCBsb2FkQW5kSGFuZGxlQXNzZXQpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBCb2R5Q29tcG9uZW50IH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/body/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/body/system.mjs":
/*!*****************************************************!*\
  !*** ./src/physics/components/jolt/body/system.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BodyComponentSystem: () => (/* binding */ BodyComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../response-handler.mjs */ \"./src/physics/components/jolt/response-handler.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Jolt body\r\n    'position',\r\n    'rotation',\r\n    'linearVelocity',\r\n    'angularVelocity',\r\n    'friction',\r\n    'restitution',\r\n    'linearDamping',\r\n    'angularDamping',\r\n    'maxLinearVelocity',\r\n    'maxAngularVelocity',\r\n    'gravityFactor',\r\n    'inertiaMultiplier',\r\n    'overrideMass',\r\n    'overrideMassProperties',\r\n    'overrideInertiaPosition',\r\n    'overrideInertiaRotation',\r\n    'motionType',\r\n    'objectLayer',\r\n    'collisionGroup',\r\n    'subGroup',\r\n    'allowedDOFs',\r\n    'allowDynamicOrKinematic',\r\n    'isSensor',\r\n    'motionQuality',\r\n    'allowSleeping',\r\n];\r\n\r\nclass BodyComponentSystem extends _system_mjs__WEBPACK_IMPORTED_MODULE_4__.ShapeComponentSystem {\r\n\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'body';\r\n        this.schema = [...this.schema, ...schema];\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_5__.BodyComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_1__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    overrideContacts(callbacks = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            !!callbacks.OnContactValidate && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactValidate === 'function', 'OnContactValidate must be a function', callbacks);\r\n            !!callbacks.OnContactAdded && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactAdded === 'function', 'OnContactAdded must be a function', callbacks);\r\n            !!callbacks.OnContactPersisted && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactPersisted === 'function', 'OnContactPersisted must be a function', callbacks);\r\n            !!callbacks.OnContactRemoved && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(typeof callbacks.OnContactRemoved === 'function', 'OnContactRemoved must be a function', callbacks);\r\n        }\r\n\r\n        const overrides = Object.create(null);\r\n        if (callbacks.OnContactValidate) {\r\n            overrides.OnContactValidate = new String(callbacks.OnContactValidate);\r\n        }\r\n        if (callbacks.OnContactAdded) {\r\n            overrides.OnContactAdded = new String(callbacks.OnContactAdded);\r\n        }\r\n        if (callbacks.OnContactPersisted) {\r\n            overrides.OnContactPersisted = new String(callbacks.OnContactPersisted);\r\n        }\r\n        if (callbacks.OnContactRemoved) {\r\n            overrides.OnContactRemoved = new String(callbacks.OnContactRemoved);\r\n        }\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'override-contacts';\r\n        msg.listener = 'contacts';\r\n        msg.overrides = overrides;\r\n        this._manager.sendUncompressed(msg);\r\n    }\r\n\r\n    createBody(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_BODY);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_UPDATE_TRANSFORMS:\r\n                // TODO\r\n                // move to ResponseHandler\r\n                _system_mjs__WEBPACK_IMPORTED_MODULE_4__.ShapeComponentSystem.updateDynamic(cb);\r\n                break;\r\n\r\n            // TODO\r\n            // handle by manager directly\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CAST_RAY:\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CAST_SHAPE:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__.ResponseHandler.handleQuery(cb, this.entityMap, this._manager.queryMap);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_CONTACTS:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_3__.ResponseHandler.handleContact(cb, this.entityMap, this._manager.config);\r\n                break;\r\n        }\r\n    }\r\n\r\n    requestIsometry() {\r\n        this.fire('write-isometry');\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.verifyProperties(data, this.schema);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        super.initializeComponentData(component, data);\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvYm9keS9zeXN0ZW0ubWpzPzFlMmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi4vLi4vLi4vZGVidWcubWpzXCI7XHJcbmltcG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWwubWpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBDTURfQ0FTVF9SQVksXHJcbiAgICBDTURfQ0FTVF9TSEFQRSxcclxuICAgIENNRF9DUkVBVEVfQk9EWSxcclxuICAgIENNRF9SRVBPUlRfQ09OVEFDVFMsXHJcbiAgICBDTURfVVBEQVRFX1RSQU5TRk9STVMsXHJcbiAgICBDT01QT05FTlRfU1lTVEVNX0JPRFksXHJcbiAgICBPUEVSQVRPUl9DUkVBVE9SXHJcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuaW1wb3J0IHsgUmVzcG9uc2VIYW5kbGVyIH0gZnJvbSBcIi4uL3Jlc3BvbnNlLWhhbmRsZXIubWpzXCI7XHJcbmltcG9ydCB7IFNoYXBlQ29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4uL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgQm9keUNvbXBvbmVudCB9IGZyb20gXCIuL2NvbXBvbmVudC5tanNcIjtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IFtcclxuICAgIC8vIEpvbHQgYm9keVxyXG4gICAgJ3Bvc2l0aW9uJyxcclxuICAgICdyb3RhdGlvbicsXHJcbiAgICAnbGluZWFyVmVsb2NpdHknLFxyXG4gICAgJ2FuZ3VsYXJWZWxvY2l0eScsXHJcbiAgICAnZnJpY3Rpb24nLFxyXG4gICAgJ3Jlc3RpdHV0aW9uJyxcclxuICAgICdsaW5lYXJEYW1waW5nJyxcclxuICAgICdhbmd1bGFyRGFtcGluZycsXHJcbiAgICAnbWF4TGluZWFyVmVsb2NpdHknLFxyXG4gICAgJ21heEFuZ3VsYXJWZWxvY2l0eScsXHJcbiAgICAnZ3Jhdml0eUZhY3RvcicsXHJcbiAgICAnaW5lcnRpYU11bHRpcGxpZXInLFxyXG4gICAgJ292ZXJyaWRlTWFzcycsXHJcbiAgICAnb3ZlcnJpZGVNYXNzUHJvcGVydGllcycsXHJcbiAgICAnb3ZlcnJpZGVJbmVydGlhUG9zaXRpb24nLFxyXG4gICAgJ292ZXJyaWRlSW5lcnRpYVJvdGF0aW9uJyxcclxuICAgICdtb3Rpb25UeXBlJyxcclxuICAgICdvYmplY3RMYXllcicsXHJcbiAgICAnY29sbGlzaW9uR3JvdXAnLFxyXG4gICAgJ3N1Ykdyb3VwJyxcclxuICAgICdhbGxvd2VkRE9GcycsXHJcbiAgICAnYWxsb3dEeW5hbWljT3JLaW5lbWF0aWMnLFxyXG4gICAgJ2lzU2Vuc29yJyxcclxuICAgICdtb3Rpb25RdWFsaXR5JyxcclxuICAgICdhbGxvd1NsZWVwaW5nJyxcclxuXTtcclxuXHJcbmNsYXNzIEJvZHlDb21wb25lbnRTeXN0ZW0gZXh0ZW5kcyBTaGFwZUNvbXBvbmVudFN5c3RlbSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwLCBtYW5hZ2VyLCBpZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgbWFuYWdlcik7XHJcblxyXG4gICAgICAgIHRoaXMuaWQgPSAnYm9keSc7XHJcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBbLi4udGhpcy5zY2hlbWEsIC4uLnNjaGVtYV07XHJcbiAgICAgICAgdGhpcy5Db21wb25lbnRUeXBlID0gQm9keUNvbXBvbmVudDtcclxuXHJcbiAgICAgICAgbWFuYWdlci5zeXN0ZW1zLnNldChpZCwgdGhpcyk7XHJcblxyXG4gICAgICAgIGJ1aWxkQWNjZXNzb3JzKHRoaXMsIHRoaXMuc2NoZW1hKTtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZUNvbnRhY3RzKGNhbGxiYWNrcyA9IHt9KSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSAmJiBEZWJ1Zy5hc3NlcnQodHlwZW9mIGNhbGxiYWNrcy5PbkNvbnRhY3RWYWxpZGF0ZSA9PT0gJ2Z1bmN0aW9uJywgJ09uQ29udGFjdFZhbGlkYXRlIG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgICAgICEhY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkID09PSAnZnVuY3Rpb24nLCAnT25Db250YWN0QWRkZWQgbXVzdCBiZSBhIGZ1bmN0aW9uJywgY2FsbGJhY2tzKTtcclxuICAgICAgICAgICAgISFjYWxsYmFja3MuT25Db250YWN0UGVyc2lzdGVkICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdFBlcnNpc3RlZCA9PT0gJ2Z1bmN0aW9uJywgJ09uQ29udGFjdFBlcnNpc3RlZCBtdXN0IGJlIGEgZnVuY3Rpb24nLCBjYWxsYmFja3MpO1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkNvbnRhY3RSZW1vdmVkICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdFJlbW92ZWQgPT09ICdmdW5jdGlvbicsICdPbkNvbnRhY3RSZW1vdmVkIG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBvdmVycmlkZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25Db250YWN0VmFsaWRhdGUpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQ29udGFjdFZhbGlkYXRlID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0VmFsaWRhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlcy5PbkNvbnRhY3RBZGRlZCA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQ29udGFjdEFkZGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrcy5PbkNvbnRhY3RQZXJzaXN0ZWQpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQ29udGFjdFBlcnNpc3RlZCA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQ29udGFjdFBlcnNpc3RlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25Db250YWN0UmVtb3ZlZCkge1xyXG4gICAgICAgICAgICBvdmVycmlkZXMuT25Db250YWN0UmVtb3ZlZCA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQ29udGFjdFJlbW92ZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbXNnID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICBtc2cudHlwZSA9ICdvdmVycmlkZS1jb250YWN0cyc7XHJcbiAgICAgICAgbXNnLmxpc3RlbmVyID0gJ2NvbnRhY3RzJztcclxuICAgICAgICBtc2cub3ZlcnJpZGVzID0gb3ZlcnJpZGVzO1xyXG4gICAgICAgIHRoaXMuX21hbmFnZXIuc2VuZFVuY29tcHJlc3NlZChtc2cpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJvZHkoY29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9tYW5hZ2VyLmNvbW1hbmRzQnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NSRUFUT1IpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ1JFQVRFX0JPRFkpO1xyXG5cclxuICAgICAgICBjb21wb25lbnQud3JpdGVDb21wb25lbnREYXRhKGNiKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm9jZXNzQ29tbWFuZHMoY2IpIHtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1VQREFURV9UUkFOU0ZPUk1TOlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgICAgICAgICAgLy8gbW92ZSB0byBSZXNwb25zZUhhbmRsZXJcclxuICAgICAgICAgICAgICAgIFNoYXBlQ29tcG9uZW50U3lzdGVtLnVwZGF0ZUR5bmFtaWMoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSBieSBtYW5hZ2VyIGRpcmVjdGx5XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX0NBU1RfUkFZOlxyXG4gICAgICAgICAgICBjYXNlIENNRF9DQVNUX1NIQVBFOlxyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VIYW5kbGVyLmhhbmRsZVF1ZXJ5KGNiLCB0aGlzLmVudGl0eU1hcCwgdGhpcy5fbWFuYWdlci5xdWVyeU1hcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1JFUE9SVF9DT05UQUNUUzpcclxuICAgICAgICAgICAgICAgIFJlc3BvbnNlSGFuZGxlci5oYW5kbGVDb250YWN0KGNiLCB0aGlzLmVudGl0eU1hcCwgdGhpcy5fbWFuYWdlci5jb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlcXVlc3RJc29tZXRyeSgpIHtcclxuICAgICAgICB0aGlzLmZpcmUoJ3dyaXRlLWlzb21ldHJ5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLnZlcmlmeVByb3BlcnRpZXMoZGF0YSwgdGhpcy5zY2hlbWEpO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQm9keUNvbXBvbmVudFN5c3RlbSB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/body/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/char/component.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/char/component.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CharComponent: () => (/* binding */ CharComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\n\r\nclass CharComponent extends _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent {\r\n    // ---- SHAPE PROPS ----\r\n\r\n    // Shape type\r\n    _shape = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CAPSULE;\r\n\r\n    // ---- CHARACTER PROPS ----\r\n\r\n    // Vector indicating the up direction of the character.\r\n    _up = pc.Vec3.UP;\r\n\r\n    // Enables/disables the use of motion state for the character.\r\n    _useMotionState = true;\r\n\r\n    // Character linear velocity. Must be set by user. Backend will use it to calculate next\r\n    // position.\r\n    _linearVelocity = new pc.Vec3();\r\n\r\n    // Plane, defined in local space relative to the character. Every contact \r\n    // behind this plane can support the character, every contact in front of \r\n    // this plane is treated as only colliding with the player. Default: Accept\r\n    // any contact.\r\n    _supportingVolume = new pc.Plane(pc.Vec3.UP, -1);\r\n\r\n    // Maximum angle of slope that character can still walk on (radians).\r\n    _maxSlopeAngle = 45 * pc.math.DEG_TO_RAD;\r\n\r\n    // Character mass (kg). Used to push down objects with gravity when the \r\n    // character is standing on top.\r\n    _mass = 70;\r\n\r\n    // Maximum force with which the character can push other bodies (N).\r\n    _maxStrength = 100;\r\n\r\n    // An extra offset applied to the shape in local space.\r\n    _shapeOffset = pc.Vec3.ZERO;\r\n\r\n    // When colliding with back faces, the character will not be able to move through\r\n    // back facing triangles. Use this if you have triangles that need to collide\r\n    // on both sides.\r\n    _backFaceMode = pc.JOLT_BFM_COLLIDE_BACK_FACES;\r\n\r\n    // How far to scan outside of the shape for predictive contacts. A value of 0 will\r\n    // most likely cause the character to get stuck as it cannot properly calculate a sliding\r\n    // direction anymore. A value that's too high will cause ghost collisions.\r\n    _predictiveContactDistance = 0.1;\r\n\r\n    // Max amount of collision loops\r\n    _maxCollisionIterations = 5;\r\n\r\n    // How often to try stepping in the constraint solving.\r\n    _maxConstraintIterations = 15;\r\n\r\n    // Early out condition: If this much time is left to simulate we are done.\r\n    _minTimeRemaining = 1.0e-4;\r\n\r\n    // How far we're willing to penetrate geometry\r\n    _collisionTolerance = 1.0e-3;\r\n\r\n    // How far we try to stay away from the geometry, this ensures that the sweep will\r\n    // hit as little as possible lowering the collision cost and reducing the risk of\r\n    // getting stuck.\r\n    _characterPadding = 0.02;\r\n\r\n    // Max num hits to collect in order to avoid excess of contact points collection.\r\n    _maxNumHits = 256;\r\n\r\n    // Cos(angle) where angle is the maximum angle between two hits contact normals that \r\n    // are allowed to be merged during hit reduction. Default is around 2.5 degrees. Set \r\n    // to -1 to turn off.\r\n    _hitReductionCosMaxAngle = 0.999;\r\n\r\n    // This value governs how fast a penetration will be resolved, 0 = nothing is resolved,\r\n    // 1 = everything in one update.\r\n    _penetrationRecoverySpeed = 1;\r\n\r\n    // Read-only. True if the character is supported by normal or steep ground.\r\n    _isSupported = false;\r\n\r\n    // Read-only. True if the ground is too steep to walk on.\r\n    _isSlopeTooSteep = false;\r\n\r\n    // Read-only. If the character is supported, this will tell the ground entity.\r\n    _groundEntity = null;\r\n\r\n    // Read-only. If the character is supported, this will tell the ground normal. Otherwise\r\n    // will be a zero vector.\r\n    _groundNormal = new pc.Vec3();\r\n\r\n    // If the character is not supported, will be a zero vector.\r\n    _groundVelocity = new pc.Vec3();\r\n\r\n    // Ground state.\r\n    _state = pc.JOLT_GROUND_STATE_NOT_SUPPORTED;\r\n\r\n    // User data to be associated with a shape.\r\n    _userData = null;\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    get linearVelocity() {\r\n        return this._linearVelocity;\r\n    }\r\n\r\n    set linearVelocity(vel) {\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(vel, `Invalid character linear velocity`, vel);\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CHAR_SET_LIN_VEL, this._index,\r\n            vel, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false\r\n        );\r\n    }\r\n\r\n    get userData() {\r\n        return this._userData;\r\n    }\r\n\r\n    set userData(num) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(num, `Invalid user data value. Should be a number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this._userData = num;\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_USER_DATA, this._index,\r\n            num, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );        \r\n    }\r\n\r\n    setShape(shapeIndex = null, callback = null) {\r\n        const system = this.system;\r\n\r\n        system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CHAR_SET_SHAPE, this._index,\r\n            !!callback, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false,\r\n            shapeIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, true\r\n        );\r\n\r\n        if (callback) {\r\n            this._writeCallback(callback);\r\n        }\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        const ok = _component_mjs__WEBPACK_IMPORTED_MODULE_1__.ShapeComponent.writeShapeData(cb, this, true /* force write rotation */);\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !ok) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Error creating a shape data.');\r\n            return false;\r\n        }\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._useMotionState, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._up, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._supportingVolume, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_PLANE, false);\r\n        cb.write(this._maxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._mass, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxStrength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shapeOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._backFaceMode, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._predictiveContactDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxCollisionIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._maxConstraintIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._minTimeRemaining, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._collisionTolerance, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._characterPadding, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxNumHits, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._hitReductionCosMaxAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._penetrationRecoverySpeed, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n\r\n    updateTransforms(cb, map) {\r\n        const entity = this.entity;\r\n\r\n        entity.setPosition(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        entity.setRotation(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        this._linearVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        const isSupported = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL);\r\n        this._isSupported = isSupported;\r\n        this._state = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT8);\r\n\r\n        if (isSupported && cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL)) {\r\n            const groundIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n            this._groundEntity = map.get(groundIndex) || null;\r\n            this._isSlopeTooSteep = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_BOOL);\r\n            this._groundVelocity.set(\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n            );\r\n            this._groundNormal.set(\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32),\r\n                cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_FLOAT32)\r\n            );\r\n        } else {\r\n            this._groundEntity = null;\r\n            this._groundNormal.set(0, 0, 0);\r\n            this._groundVelocity.set(0, 0, 0);\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        system.createCharacter(this);\r\n    }\r\n\r\n    _writeCallback(callback) {\r\n        if (callback) {\r\n            const system = this.system;\r\n            const callbackIndex = system.getCallbackIndex(callback);\r\n            system.addCommandArgs(callbackIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY2hhci9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L2NoYXIvY29tcG9uZW50Lm1qcz82YjNlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBCVUZGRVJfUkVBRF9CT09MLCBCVUZGRVJfUkVBRF9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDMyLFxyXG4gICAgQlVGRkVSX1JFQURfVUlOVDgsXHJcbiAgICBCVUZGRVJfV1JJVEVfQk9PTCxcclxuICAgIEJVRkZFUl9XUklURV9GTE9BVDMyLFxyXG4gICAgQlVGRkVSX1dSSVRFX1BMQU5FLFxyXG4gICAgQlVGRkVSX1dSSVRFX1VJTlQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UOCxcclxuICAgIEJVRkZFUl9XUklURV9WRUMzMixcclxuICAgIENNRF9DSEFSX1NFVF9MSU5fVkVMLFxyXG4gICAgQ01EX0NIQVJfU0VUX1NIQVBFLFxyXG4gICAgQ01EX1NFVF9VU0VSX0RBVEEsXHJcbiAgICBPUEVSQVRPUl9NT0RJRklFUixcclxuICAgIFNIQVBFX0NBUFNVTEVcclxufSBmcm9tIFwiLi4vY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuLi9zeXN0ZW0ubWpzXCI7XHJcblxyXG5jbGFzcyBDaGFyQ29tcG9uZW50IGV4dGVuZHMgU2hhcGVDb21wb25lbnQge1xyXG4gICAgLy8gLS0tLSBTSEFQRSBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gU2hhcGUgdHlwZVxyXG4gICAgX3NoYXBlID0gU0hBUEVfQ0FQU1VMRTtcclxuXHJcbiAgICAvLyAtLS0tIENIQVJBQ1RFUiBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gVmVjdG9yIGluZGljYXRpbmcgdGhlIHVwIGRpcmVjdGlvbiBvZiB0aGUgY2hhcmFjdGVyLlxyXG4gICAgX3VwID0gcGMuVmVjMy5VUDtcclxuXHJcbiAgICAvLyBFbmFibGVzL2Rpc2FibGVzIHRoZSB1c2Ugb2YgbW90aW9uIHN0YXRlIGZvciB0aGUgY2hhcmFjdGVyLlxyXG4gICAgX3VzZU1vdGlvblN0YXRlID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBDaGFyYWN0ZXIgbGluZWFyIHZlbG9jaXR5LiBNdXN0IGJlIHNldCBieSB1c2VyLiBCYWNrZW5kIHdpbGwgdXNlIGl0IHRvIGNhbGN1bGF0ZSBuZXh0XHJcbiAgICAvLyBwb3NpdGlvbi5cclxuICAgIF9saW5lYXJWZWxvY2l0eSA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG4gICAgLy8gUGxhbmUsIGRlZmluZWQgaW4gbG9jYWwgc3BhY2UgcmVsYXRpdmUgdG8gdGhlIGNoYXJhY3Rlci4gRXZlcnkgY29udGFjdCBcclxuICAgIC8vIGJlaGluZCB0aGlzIHBsYW5lIGNhbiBzdXBwb3J0IHRoZSBjaGFyYWN0ZXIsIGV2ZXJ5IGNvbnRhY3QgaW4gZnJvbnQgb2YgXHJcbiAgICAvLyB0aGlzIHBsYW5lIGlzIHRyZWF0ZWQgYXMgb25seSBjb2xsaWRpbmcgd2l0aCB0aGUgcGxheWVyLiBEZWZhdWx0OiBBY2NlcHRcclxuICAgIC8vIGFueSBjb250YWN0LlxyXG4gICAgX3N1cHBvcnRpbmdWb2x1bWUgPSBuZXcgcGMuUGxhbmUocGMuVmVjMy5VUCwgLTEpO1xyXG5cclxuICAgIC8vIE1heGltdW0gYW5nbGUgb2Ygc2xvcGUgdGhhdCBjaGFyYWN0ZXIgY2FuIHN0aWxsIHdhbGsgb24gKHJhZGlhbnMpLlxyXG4gICAgX21heFNsb3BlQW5nbGUgPSA0NSAqIHBjLm1hdGguREVHX1RPX1JBRDtcclxuXHJcbiAgICAvLyBDaGFyYWN0ZXIgbWFzcyAoa2cpLiBVc2VkIHRvIHB1c2ggZG93biBvYmplY3RzIHdpdGggZ3Jhdml0eSB3aGVuIHRoZSBcclxuICAgIC8vIGNoYXJhY3RlciBpcyBzdGFuZGluZyBvbiB0b3AuXHJcbiAgICBfbWFzcyA9IDcwO1xyXG5cclxuICAgIC8vIE1heGltdW0gZm9yY2Ugd2l0aCB3aGljaCB0aGUgY2hhcmFjdGVyIGNhbiBwdXNoIG90aGVyIGJvZGllcyAoTikuXHJcbiAgICBfbWF4U3RyZW5ndGggPSAxMDA7XHJcblxyXG4gICAgLy8gQW4gZXh0cmEgb2Zmc2V0IGFwcGxpZWQgdG8gdGhlIHNoYXBlIGluIGxvY2FsIHNwYWNlLlxyXG4gICAgX3NoYXBlT2Zmc2V0ID0gcGMuVmVjMy5aRVJPO1xyXG5cclxuICAgIC8vIFdoZW4gY29sbGlkaW5nIHdpdGggYmFjayBmYWNlcywgdGhlIGNoYXJhY3RlciB3aWxsIG5vdCBiZSBhYmxlIHRvIG1vdmUgdGhyb3VnaFxyXG4gICAgLy8gYmFjayBmYWNpbmcgdHJpYW5nbGVzLiBVc2UgdGhpcyBpZiB5b3UgaGF2ZSB0cmlhbmdsZXMgdGhhdCBuZWVkIHRvIGNvbGxpZGVcclxuICAgIC8vIG9uIGJvdGggc2lkZXMuXHJcbiAgICBfYmFja0ZhY2VNb2RlID0gcGMuSk9MVF9CRk1fQ09MTElERV9CQUNLX0ZBQ0VTO1xyXG5cclxuICAgIC8vIEhvdyBmYXIgdG8gc2NhbiBvdXRzaWRlIG9mIHRoZSBzaGFwZSBmb3IgcHJlZGljdGl2ZSBjb250YWN0cy4gQSB2YWx1ZSBvZiAwIHdpbGxcclxuICAgIC8vIG1vc3QgbGlrZWx5IGNhdXNlIHRoZSBjaGFyYWN0ZXIgdG8gZ2V0IHN0dWNrIGFzIGl0IGNhbm5vdCBwcm9wZXJseSBjYWxjdWxhdGUgYSBzbGlkaW5nXHJcbiAgICAvLyBkaXJlY3Rpb24gYW55bW9yZS4gQSB2YWx1ZSB0aGF0J3MgdG9vIGhpZ2ggd2lsbCBjYXVzZSBnaG9zdCBjb2xsaXNpb25zLlxyXG4gICAgX3ByZWRpY3RpdmVDb250YWN0RGlzdGFuY2UgPSAwLjE7XHJcblxyXG4gICAgLy8gTWF4IGFtb3VudCBvZiBjb2xsaXNpb24gbG9vcHNcclxuICAgIF9tYXhDb2xsaXNpb25JdGVyYXRpb25zID0gNTtcclxuXHJcbiAgICAvLyBIb3cgb2Z0ZW4gdG8gdHJ5IHN0ZXBwaW5nIGluIHRoZSBjb25zdHJhaW50IHNvbHZpbmcuXHJcbiAgICBfbWF4Q29uc3RyYWludEl0ZXJhdGlvbnMgPSAxNTtcclxuXHJcbiAgICAvLyBFYXJseSBvdXQgY29uZGl0aW9uOiBJZiB0aGlzIG11Y2ggdGltZSBpcyBsZWZ0IHRvIHNpbXVsYXRlIHdlIGFyZSBkb25lLlxyXG4gICAgX21pblRpbWVSZW1haW5pbmcgPSAxLjBlLTQ7XHJcblxyXG4gICAgLy8gSG93IGZhciB3ZSdyZSB3aWxsaW5nIHRvIHBlbmV0cmF0ZSBnZW9tZXRyeVxyXG4gICAgX2NvbGxpc2lvblRvbGVyYW5jZSA9IDEuMGUtMztcclxuXHJcbiAgICAvLyBIb3cgZmFyIHdlIHRyeSB0byBzdGF5IGF3YXkgZnJvbSB0aGUgZ2VvbWV0cnksIHRoaXMgZW5zdXJlcyB0aGF0IHRoZSBzd2VlcCB3aWxsXHJcbiAgICAvLyBoaXQgYXMgbGl0dGxlIGFzIHBvc3NpYmxlIGxvd2VyaW5nIHRoZSBjb2xsaXNpb24gY29zdCBhbmQgcmVkdWNpbmcgdGhlIHJpc2sgb2ZcclxuICAgIC8vIGdldHRpbmcgc3R1Y2suXHJcbiAgICBfY2hhcmFjdGVyUGFkZGluZyA9IDAuMDI7XHJcblxyXG4gICAgLy8gTWF4IG51bSBoaXRzIHRvIGNvbGxlY3QgaW4gb3JkZXIgdG8gYXZvaWQgZXhjZXNzIG9mIGNvbnRhY3QgcG9pbnRzIGNvbGxlY3Rpb24uXHJcbiAgICBfbWF4TnVtSGl0cyA9IDI1NjtcclxuXHJcbiAgICAvLyBDb3MoYW5nbGUpIHdoZXJlIGFuZ2xlIGlzIHRoZSBtYXhpbXVtIGFuZ2xlIGJldHdlZW4gdHdvIGhpdHMgY29udGFjdCBub3JtYWxzIHRoYXQgXHJcbiAgICAvLyBhcmUgYWxsb3dlZCB0byBiZSBtZXJnZWQgZHVyaW5nIGhpdCByZWR1Y3Rpb24uIERlZmF1bHQgaXMgYXJvdW5kIDIuNSBkZWdyZWVzLiBTZXQgXHJcbiAgICAvLyB0byAtMSB0byB0dXJuIG9mZi5cclxuICAgIF9oaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSA9IDAuOTk5O1xyXG5cclxuICAgIC8vIFRoaXMgdmFsdWUgZ292ZXJucyBob3cgZmFzdCBhIHBlbmV0cmF0aW9uIHdpbGwgYmUgcmVzb2x2ZWQsIDAgPSBub3RoaW5nIGlzIHJlc29sdmVkLFxyXG4gICAgLy8gMSA9IGV2ZXJ5dGhpbmcgaW4gb25lIHVwZGF0ZS5cclxuICAgIF9wZW5ldHJhdGlvblJlY292ZXJ5U3BlZWQgPSAxO1xyXG5cclxuICAgIC8vIFJlYWQtb25seS4gVHJ1ZSBpZiB0aGUgY2hhcmFjdGVyIGlzIHN1cHBvcnRlZCBieSBub3JtYWwgb3Igc3RlZXAgZ3JvdW5kLlxyXG4gICAgX2lzU3VwcG9ydGVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gUmVhZC1vbmx5LiBUcnVlIGlmIHRoZSBncm91bmQgaXMgdG9vIHN0ZWVwIHRvIHdhbGsgb24uXHJcbiAgICBfaXNTbG9wZVRvb1N0ZWVwID0gZmFsc2U7XHJcblxyXG4gICAgLy8gUmVhZC1vbmx5LiBJZiB0aGUgY2hhcmFjdGVyIGlzIHN1cHBvcnRlZCwgdGhpcyB3aWxsIHRlbGwgdGhlIGdyb3VuZCBlbnRpdHkuXHJcbiAgICBfZ3JvdW5kRW50aXR5ID0gbnVsbDtcclxuXHJcbiAgICAvLyBSZWFkLW9ubHkuIElmIHRoZSBjaGFyYWN0ZXIgaXMgc3VwcG9ydGVkLCB0aGlzIHdpbGwgdGVsbCB0aGUgZ3JvdW5kIG5vcm1hbC4gT3RoZXJ3aXNlXHJcbiAgICAvLyB3aWxsIGJlIGEgemVybyB2ZWN0b3IuXHJcbiAgICBfZ3JvdW5kTm9ybWFsID0gbmV3IHBjLlZlYzMoKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzIG5vdCBzdXBwb3J0ZWQsIHdpbGwgYmUgYSB6ZXJvIHZlY3Rvci5cclxuICAgIF9ncm91bmRWZWxvY2l0eSA9IG5ldyBwYy5WZWMzKCk7XHJcblxyXG4gICAgLy8gR3JvdW5kIHN0YXRlLlxyXG4gICAgX3N0YXRlID0gcGMuSk9MVF9HUk9VTkRfU1RBVEVfTk9UX1NVUFBPUlRFRDtcclxuXHJcbiAgICAvLyBVc2VyIGRhdGEgdG8gYmUgYXNzb2NpYXRlZCB3aXRoIGEgc2hhcGUuXHJcbiAgICBfdXNlckRhdGEgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBsaW5lYXJWZWxvY2l0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGluZWFyVmVsb2NpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGxpbmVhclZlbG9jaXR5KHZlbCkge1xyXG4gICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5jaGVja1ZlYyh2ZWwsIGBJbnZhbGlkIGNoYXJhY3RlciBsaW5lYXIgdmVsb2NpdHlgLCB2ZWwpO1xyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfQ0hBUl9TRVRfTElOX1ZFTCwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIHZlbCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVzZXJEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdXNlckRhdGEobnVtKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KG51bSwgYEludmFsaWQgdXNlciBkYXRhIHZhbHVlLiBTaG91bGQgYmUgYSBudW1iZXI6ICR7IG51bSB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91c2VyRGF0YSA9IG51bTtcclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9TRVRfVVNFUl9EQVRBLCB0aGlzLl9pbmRleCxcclxuICAgICAgICAgICAgbnVtLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2VcclxuICAgICAgICApOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2hhcGUoc2hhcGVJbmRleCA9IG51bGwsIGNhbGxiYWNrID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuc3lzdGVtO1xyXG5cclxuICAgICAgICBzeXN0ZW0uYWRkQ29tbWFuZChcclxuICAgICAgICAgICAgT1BFUkFUT1JfTU9ESUZJRVIsIENNRF9DSEFSX1NFVF9TSEFQRSwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgICEhY2FsbGJhY2ssIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSxcclxuICAgICAgICAgICAgc2hhcGVJbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgdHJ1ZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLl93cml0ZUNhbGxiYWNrKGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVDb21wb25lbnREYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3Qgb2sgPSBTaGFwZUNvbXBvbmVudC53cml0ZVNoYXBlRGF0YShjYiwgdGhpcywgdHJ1ZSAvKiBmb3JjZSB3cml0ZSByb3RhdGlvbiAqLyk7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiAhb2spIHtcclxuICAgICAgICAgICAgRGVidWcud2FybignRXJyb3IgY3JlYXRpbmcgYSBzaGFwZSBkYXRhLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9pbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VzZU1vdGlvblN0YXRlLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VwLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zdXBwb3J0aW5nVm9sdW1lLCBCVUZGRVJfV1JJVEVfUExBTkUsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhTbG9wZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21hc3MsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4U3RyZW5ndGgsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fc2hhcGVPZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2JhY2tGYWNlTW9kZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fcHJlZGljdGl2ZUNvbnRhY3REaXN0YW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhDb2xsaXNpb25JdGVyYXRpb25zLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4Q29uc3RyYWludEl0ZXJhdGlvbnMsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9taW5UaW1lUmVtYWluaW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2NvbGxpc2lvblRvbGVyYW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9jaGFyYWN0ZXJQYWRkaW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heE51bUhpdHMsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9oaXRSZWR1Y3Rpb25Db3NNYXhBbmdsZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9wZW5ldHJhdGlvblJlY292ZXJ5U3BlZWQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG4gICAgICAgIGNvbnN0IHBvcyA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IHJvdCA9IGVudGl0eS5nZXRSb3RhdGlvbigpO1xyXG5cclxuICAgICAgICAvLyBMb3NzIG9mIHByZWNpc2lvbiBmb3IgcG9zL3JvdCAoNjQgLT4gMzIpXHJcbiAgICAgICAgY2Iud3JpdGUocG9zLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShyb3QsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBEZWJ1Zy5kZXYgJiYgY2Iud3JpdGUodGhpcy5fZGVidWdEcmF3LCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVRyYW5zZm9ybXMoY2IsIG1hcCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5O1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0UG9zaXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0Um90YXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICB0aGlzLl9saW5lYXJWZWxvY2l0eS5zZXQoXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBpc1N1cHBvcnRlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgdGhpcy5faXNTdXBwb3J0ZWQgPSBpc1N1cHBvcnRlZDtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDgpO1xyXG5cclxuICAgICAgICBpZiAoaXNTdXBwb3J0ZWQgJiYgY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKSkge1xyXG4gICAgICAgICAgICBjb25zdCBncm91bmRJbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgdGhpcy5fZ3JvdW5kRW50aXR5ID0gbWFwLmdldChncm91bmRJbmRleCkgfHwgbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5faXNTbG9wZVRvb1N0ZWVwID0gY2IucmVhZChCVUZGRVJfUkVBRF9CT09MKTtcclxuICAgICAgICAgICAgdGhpcy5fZ3JvdW5kVmVsb2NpdHkuc2V0KFxyXG4gICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyb3VuZE5vcm1hbC5zZXQoXHJcbiAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmRFbnRpdHkgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmROb3JtYWwuc2V0KDAsIDAsIDApO1xyXG4gICAgICAgICAgICB0aGlzLl9ncm91bmRWZWxvY2l0eS5zZXQoMCwgMCwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRW5hYmxlKCkge1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuc3lzdGVtO1xyXG5cclxuICAgICAgICB0aGlzLl9pbmRleCA9IHN5c3RlbS5nZXRJbmRleCh0aGlzLmVudGl0eSk7XHJcblxyXG4gICAgICAgIHN5c3RlbS5jcmVhdGVDaGFyYWN0ZXIodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5zeXN0ZW07XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrSW5kZXggPSBzeXN0ZW0uZ2V0Q2FsbGJhY2tJbmRleChjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIHN5c3RlbS5hZGRDb21tYW5kQXJncyhjYWxsYmFja0luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBDaGFyQ29tcG9uZW50IH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/char/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/char/system.mjs":
/*!*****************************************************!*\
  !*** ./src/physics/components/jolt/char/system.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CharComponentSystem: () => (/* binding */ CharComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/char/component.mjs\");\n/* harmony import */ var _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../response-handler.mjs */ \"./src/physics/components/jolt/response-handler.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Jolt virtual character\r\n    'up',\r\n    'supportingVolume',\r\n    'maxSlopeAngle',\r\n    'mass',\r\n    'maxStrength',\r\n    'shapeOffset',\r\n    'backFaceMode',\r\n    'predictiveContactDistance',\r\n    'maxCollisionIterations',\r\n    'maxConstraintIterations',\r\n    'minTimeRemaining',\r\n    'collisionTolerance',\r\n    'characterPadding',\r\n    'maxNumHits',\r\n    'hitReductionCosMaxAngle',\r\n    'penetrationRecoverySpeed',\r\n    'isSupported',\r\n    'isSlopeTooSteep',\r\n    'groundEntity',\r\n    'groundNormal',\r\n    'groundVelocity',\r\n    'state'\r\n];\r\n\r\nclass CharComponentSystem extends _system_mjs__WEBPACK_IMPORTED_MODULE_6__.ShapeComponentSystem {\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'char';\r\n        this.schema = schema;\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_4__.CharComponent;\r\n\r\n        this._queryMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_3__.IndexedCache();\r\n\r\n        this._exposeConstants();\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    getCallbackIndex(callback) {\r\n        return this._manager.queryMap.add(callback);\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.verifyProperties(data, schema);\r\n            if (!ok) return;\r\n        }\r\n\r\n        super.initializeComponentData(component, data);\r\n    }\r\n\r\n    processCommands(cb) {\r\n        const command = cb.readCommand();\r\n\r\n        switch (command) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_UPDATE_TRANSFORMS:\r\n                this._updateCharTransforms(cb);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_CONTACTS:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__.ResponseHandler.handleCharContacts(cb, this.entityMap);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_REPORT_SET_SHAPE:\r\n                _response_handler_mjs__WEBPACK_IMPORTED_MODULE_5__.ResponseHandler.handleCharSetShape(cb, this._manager.queryMap);\r\n                break;\r\n        }\r\n    }\r\n\r\n    createCharacter(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_CHAR);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n\r\n    overrideContacts(callbacks = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.dev) {\r\n            !!callbacks.OnAdjustBodyVelocity && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnAdjustBodyVelocity === 'function', 'OnAdjustBodyVelocity must be a function', callbacks);\r\n            !!callbacks.OnContactValidate && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactValidate === 'function', 'OnContactValidate must be a function', callbacks);\r\n            !!callbacks.OnContactAdded && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactAdded === 'function', 'OnContactAdded must be a function', callbacks);\r\n            !!callbacks.OnContactSolve && _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.assert(typeof callbacks.OnContactSolve === 'function', 'OnContactSolve must be a function', callbacks);\r\n        }\r\n\r\n        const overrides = Object.create(null);\r\n        if (callbacks.OnAdjustBodyVelocity) {\r\n            overrides.OnAdjustBodyVelocity = new String(callbacks.OnAdjustBodyVelocity);\r\n        }\r\n        if (callbacks.OnContactValidate) {\r\n            overrides.OnContactValidate = new String(callbacks.OnContactValidate);\r\n        }\r\n        if (callbacks.OnContactAdded) {\r\n            overrides.OnContactAdded = new String(callbacks.OnContactAdded);\r\n        }\r\n        if (callbacks.OnContactSolve) {\r\n            overrides.OnContactSolve = new String(callbacks.OnContactSolve);\r\n        }\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'override-contacts';\r\n        msg.listener = 'char';\r\n        msg.overrides = overrides;\r\n        this._manager.sendUncompressed(msg);\r\n    }\r\n\r\n    _exposeConstants() { }\r\n\r\n    _updateCharTransforms(cb) {\r\n        const charsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n\r\n        for (let i = 0; i < charsCount; i++) {\r\n            const index = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_READ_UINT32);\r\n\r\n            const entity = this.entityMap.get(index);\r\n            if (!entity) continue;\r\n\r\n            entity.char.updateTransforms(cb, this.entityMap);\r\n        }\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY2hhci9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jaGFyL3N5c3RlbS5tanM/ZGIxZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZEFjY2Vzc29ycyB9IGZyb20gXCIuLi8uLi8uLi91dGlsLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgQlVGRkVSX1JFQURfVUlOVDMyLCBDTURfQ1JFQVRFX0NIQVIsIENNRF9SRVBPUlRfQ09OVEFDVFMsIENNRF9SRVBPUlRfU0VUX1NIQVBFLCBDTURfVVBEQVRFX1RSQU5TRk9STVMsIENPTVBPTkVOVF9TWVNURU1fQ0hBUiwgT1BFUkFUT1JfQ1JFQVRPUiB9IGZyb20gXCIuLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IEluZGV4ZWRDYWNoZSB9IGZyb20gXCIuLi8uLi8uLi9pbmRleGVkLWNhY2hlLm1qc1wiO1xyXG5pbXBvcnQgeyBDaGFyQ29tcG9uZW50IH0gZnJvbSBcIi4vY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQgeyBSZXNwb25zZUhhbmRsZXIgfSBmcm9tIFwiLi4vcmVzcG9uc2UtaGFuZGxlci5tanNcIjtcclxuaW1wb3J0IHsgU2hhcGVDb21wb25lbnRTeXN0ZW0gfSBmcm9tIFwiLi4vc3lzdGVtLm1qc1wiO1xyXG5cclxuY29uc3Qgc2NoZW1hID0gW1xyXG4gICAgLy8gSm9sdCB2aXJ0dWFsIGNoYXJhY3RlclxyXG4gICAgJ3VwJyxcclxuICAgICdzdXBwb3J0aW5nVm9sdW1lJyxcclxuICAgICdtYXhTbG9wZUFuZ2xlJyxcclxuICAgICdtYXNzJyxcclxuICAgICdtYXhTdHJlbmd0aCcsXHJcbiAgICAnc2hhcGVPZmZzZXQnLFxyXG4gICAgJ2JhY2tGYWNlTW9kZScsXHJcbiAgICAncHJlZGljdGl2ZUNvbnRhY3REaXN0YW5jZScsXHJcbiAgICAnbWF4Q29sbGlzaW9uSXRlcmF0aW9ucycsXHJcbiAgICAnbWF4Q29uc3RyYWludEl0ZXJhdGlvbnMnLFxyXG4gICAgJ21pblRpbWVSZW1haW5pbmcnLFxyXG4gICAgJ2NvbGxpc2lvblRvbGVyYW5jZScsXHJcbiAgICAnY2hhcmFjdGVyUGFkZGluZycsXHJcbiAgICAnbWF4TnVtSGl0cycsXHJcbiAgICAnaGl0UmVkdWN0aW9uQ29zTWF4QW5nbGUnLFxyXG4gICAgJ3BlbmV0cmF0aW9uUmVjb3ZlcnlTcGVlZCcsXHJcbiAgICAnaXNTdXBwb3J0ZWQnLFxyXG4gICAgJ2lzU2xvcGVUb29TdGVlcCcsXHJcbiAgICAnZ3JvdW5kRW50aXR5JyxcclxuICAgICdncm91bmROb3JtYWwnLFxyXG4gICAgJ2dyb3VuZFZlbG9jaXR5JyxcclxuICAgICdzdGF0ZSdcclxuXTtcclxuXHJcbmNsYXNzIENoYXJDb21wb25lbnRTeXN0ZW0gZXh0ZW5kcyBTaGFwZUNvbXBvbmVudFN5c3RlbSB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIG1hbmFnZXIsIGlkKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBtYW5hZ2VyKTtcclxuXHJcbiAgICAgICAgdGhpcy5pZCA9ICdjaGFyJztcclxuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcclxuICAgICAgICB0aGlzLkNvbXBvbmVudFR5cGUgPSBDaGFyQ29tcG9uZW50O1xyXG5cclxuICAgICAgICB0aGlzLl9xdWVyeU1hcCA9IG5ldyBJbmRleGVkQ2FjaGUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fZXhwb3NlQ29uc3RhbnRzKCk7XHJcblxyXG4gICAgICAgIG1hbmFnZXIuc3lzdGVtcy5zZXQoaWQsIHRoaXMpO1xyXG5cclxuICAgICAgICBidWlsZEFjY2Vzc29ycyh0aGlzLCB0aGlzLnNjaGVtYSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2FsbGJhY2tJbmRleChjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9tYW5hZ2VyLnF1ZXJ5TWFwLmFkZChjYWxsYmFjayk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLnZlcmlmeVByb3BlcnRpZXMoZGF0YSwgc2NoZW1hKTtcclxuICAgICAgICAgICAgaWYgKCFvaykgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm9jZXNzQ29tbWFuZHMoY2IpIHtcclxuICAgICAgICBjb25zdCBjb21tYW5kID0gY2IucmVhZENvbW1hbmQoKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1VQREFURV9UUkFOU0ZPUk1TOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ2hhclRyYW5zZm9ybXMoY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENNRF9SRVBPUlRfQ09OVEFDVFM6XHJcbiAgICAgICAgICAgICAgICBSZXNwb25zZUhhbmRsZXIuaGFuZGxlQ2hhckNvbnRhY3RzKGNiLCB0aGlzLmVudGl0eU1hcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ01EX1JFUE9SVF9TRVRfU0hBUEU6XHJcbiAgICAgICAgICAgICAgICBSZXNwb25zZUhhbmRsZXIuaGFuZGxlQ2hhclNldFNoYXBlKGNiLCB0aGlzLl9tYW5hZ2VyLnF1ZXJ5TWFwKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDaGFyYWN0ZXIoY29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9tYW5hZ2VyLmNvbW1hbmRzQnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NSRUFUT1IpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ1JFQVRFX0NIQVIpO1xyXG5cclxuICAgICAgICBjb21wb25lbnQud3JpdGVDb21wb25lbnREYXRhKGNiKTtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZUNvbnRhY3RzKGNhbGxiYWNrcyA9IHt9KSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkFkanVzdEJvZHlWZWxvY2l0eSAmJiBEZWJ1Zy5hc3NlcnQodHlwZW9mIGNhbGxiYWNrcy5PbkFkanVzdEJvZHlWZWxvY2l0eSA9PT0gJ2Z1bmN0aW9uJywgJ09uQWRqdXN0Qm9keVZlbG9jaXR5IG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgICAgICEhY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlICYmIERlYnVnLmFzc2VydCh0eXBlb2YgY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlID09PSAnZnVuY3Rpb24nLCAnT25Db250YWN0VmFsaWRhdGUgbXVzdCBiZSBhIGZ1bmN0aW9uJywgY2FsbGJhY2tzKTtcclxuICAgICAgICAgICAgISFjYWxsYmFja3MuT25Db250YWN0QWRkZWQgJiYgRGVidWcuYXNzZXJ0KHR5cGVvZiBjYWxsYmFja3MuT25Db250YWN0QWRkZWQgPT09ICdmdW5jdGlvbicsICdPbkNvbnRhY3RBZGRlZCBtdXN0IGJlIGEgZnVuY3Rpb24nLCBjYWxsYmFja3MpO1xyXG4gICAgICAgICAgICAhIWNhbGxiYWNrcy5PbkNvbnRhY3RTb2x2ZSAmJiBEZWJ1Zy5hc3NlcnQodHlwZW9mIGNhbGxiYWNrcy5PbkNvbnRhY3RTb2x2ZSA9PT0gJ2Z1bmN0aW9uJywgJ09uQ29udGFjdFNvbHZlIG11c3QgYmUgYSBmdW5jdGlvbicsIGNhbGxiYWNrcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBvdmVycmlkZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25BZGp1c3RCb2R5VmVsb2NpdHkpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQWRqdXN0Qm9keVZlbG9jaXR5ID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25BZGp1c3RCb2R5VmVsb2NpdHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlcy5PbkNvbnRhY3RWYWxpZGF0ZSA9IG5ldyBTdHJpbmcoY2FsbGJhY2tzLk9uQ29udGFjdFZhbGlkYXRlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrcy5PbkNvbnRhY3RBZGRlZCkge1xyXG4gICAgICAgICAgICBvdmVycmlkZXMuT25Db250YWN0QWRkZWQgPSBuZXcgU3RyaW5nKGNhbGxiYWNrcy5PbkNvbnRhY3RBZGRlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYWxsYmFja3MuT25Db250YWN0U29sdmUpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVzLk9uQ29udGFjdFNvbHZlID0gbmV3IFN0cmluZyhjYWxsYmFja3MuT25Db250YWN0U29sdmUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbXNnID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICBtc2cudHlwZSA9ICdvdmVycmlkZS1jb250YWN0cyc7XHJcbiAgICAgICAgbXNnLmxpc3RlbmVyID0gJ2NoYXInO1xyXG4gICAgICAgIG1zZy5vdmVycmlkZXMgPSBvdmVycmlkZXM7XHJcbiAgICAgICAgdGhpcy5fbWFuYWdlci5zZW5kVW5jb21wcmVzc2VkKG1zZyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2V4cG9zZUNvbnN0YW50cygpIHsgfVxyXG5cclxuICAgIF91cGRhdGVDaGFyVHJhbnNmb3JtcyhjYikge1xyXG4gICAgICAgIGNvbnN0IGNoYXJzQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhcnNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5lbnRpdHlNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICAgICAgaWYgKCFlbnRpdHkpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICAgICAgZW50aXR5LmNoYXIudXBkYXRlVHJhbnNmb3JtcyhjYiwgdGhpcy5lbnRpdHlNYXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQ2hhckNvbXBvbmVudFN5c3RlbSB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/char/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/component.mjs":
/*!***************************************************!*\
  !*** ./src/physics/components/jolt/component.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ShapeComponent: () => (/* binding */ ShapeComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nclass ShapeComponent extends pc.EventHandler {\r\n\r\n    // ---- COMPONENT PROPS ----\r\n\r\n    // Shape type\r\n    _shape = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_BOX;\r\n\r\n    // Enable / disable component\r\n    _enabled = true;\r\n\r\n    // Automatically moves dynamic bodies, when the position is set on entity.\r\n    _trackDynamic = true;\r\n\r\n    // Unique body index. This can change during entity lifecycle, e.g. every time entity is enabled, a new\r\n    // index is assigned and a new body is created. The index is used to map entity to body. Indices can be reused.\r\n    _index = -1;\r\n\r\n    // Render asset ID, used for mesh or convex hulls.\r\n    _renderAsset = null;\r\n\r\n    // Meshes used for mesh or convex hulls\r\n    _meshes = null;\r\n\r\n    // Tells if the component describes a compound child\r\n    _isCompoundChild = false;\r\n\r\n    // Applies entity scale on the shape\r\n    _useEntityScale = true;\r\n\r\n    // Read-only. Constraint indices applied on this body.\r\n    _constraints = new Map();    \r\n\r\n    // Debug draw\r\n    _debugDraw = false;\r\n\r\n    // ---- SHAPE PROPS ----\r\n\r\n    // Half extents for a box shape\r\n    _halfExtent = new pc.Vec3(0.5, 0.5, 0.5);\r\n\r\n    // Raidus for radius based shapes\r\n    _radius = 0.5;\r\n\r\n    // Internally the convex radius will be subtracted from the half extent so the total box will not grow with the convex radius\r\n    _convexRadius = 0.05;\r\n\r\n    // Half height of radius based shapes, e.g. cylinder, capsule\r\n    _halfHeight = 0.5;\r\n\r\n    // Density of the object in kg / m^3\r\n    _density = 1000;\r\n\r\n    // Shape local position offset\r\n    _shapePosition = pc.Vec3.ZERO;\r\n\r\n    // Shape local rotation offset\r\n    _shapeRotation = pc.Vec3.ZERO;\r\n\r\n    // Offset center of mass in local space of the body. Does not move the shape.\r\n    _massOffset = pc.Vec3.ZERO;\r\n\r\n    _hfSamples = null;\r\n\r\n    _hfSampleCount = 0;\r\n\r\n    // The HeightField is divided in blocks of hfBlockSize * hfBlockSize * 2 triangles and the\r\n    // acceleration structure culls blocks only, bigger block sizes reduce memory consumption\r\n    // but also reduce query performance. Sensible values are [2, 8], does not need to be a\r\n    // power of 2. Note that at run-time Jolt performs one more grid subdivision, so the effective\r\n    // block size is half of what is provided here.\r\n    _hfBlockSize = 2;\r\n\r\n    // How many bits per sample to use to compress the HeightField. Can be in the range [1, 8].\r\n    // Note that each sample is compressed relative to the min/max value of its block of\r\n    // hfBlockSize * hfBlockSize pixels so the effective precision is higher. Also note that\r\n    // increasing hfBlockSize saves more memory than reducing the amount of bits per sample.\r\n    _hfBitsPerSample = 8;\r\n\r\n    // Cosine of the threshold angle (if the angle between the two triangles in HeightField is\r\n    // bigger than this, the edge is active, note that a concave edge is always inactive). Setting\r\n    // this value too small can cause ghost collisions with edges, setting it too big can cause\r\n    // depenetration artifacts (objects not depenetrating quickly). Valid ranges are between\r\n    // cos(0 degrees) and cos(90 degrees). The default value is cos(5 degrees).\r\n    _hfActiveEdgeCosThresholdAngle = 0.996195;\r\n\r\n    _hfScale = pc.Vec3.ONE;\r\n\r\n    // The height field is a surface defined by: hfOffset + hfScale * (x, hfHeightSamples[y * hfSampleCount + x], y).\r\n    // where x and y are integers in the range x and y e [0, hfSampleCount - 1].\r\n    _hfOffset = pc.Vec3.ZERO;\r\n\r\n    // The ComponentSystem used to create this Component.\r\n    system;\r\n\r\n    // The Entity that this Component is attached to.\r\n    entity;\r\n\r\n    constructor(system, entity) {\r\n        super();\r\n\r\n        this.system = system;\r\n        this.entity = entity;\r\n\r\n        if (system.schema && !this._accessorsBuilt) {\r\n            (0,_util_mjs__WEBPACK_IMPORTED_MODULE_1__.buildAccessors)(this, system.schema);\r\n        }\r\n\r\n        this.on('set', function (name, oldValue, newValue) {\r\n            this.fire('set_' + name, name, oldValue, newValue);\r\n        });\r\n\r\n        this.on('set_enabled', this.onSetEnabled, this);\r\n    }\r\n\r\n\r\n    get constraints() {\r\n        return this._constraints;\r\n    }\r\n    \r\n    onSetEnabled(name, oldValue, newValue) {\r\n        if (oldValue !== newValue) {\r\n            if (this.entity.enabled) {\r\n                if (newValue) {\r\n                    this.onEnable();\r\n                } else {\r\n                    this.onDisable();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onEnable() {}\r\n\r\n    onDisable() {\r\n        const constraints = this._constraints;\r\n\r\n        constraints.forEach((entity2, index) => {\r\n            entity2?.body?.constraints.delete(index);\r\n            this.system.freeConstraintIndex(index);\r\n        });\r\n        constraints.clear();\r\n    }\r\n\r\n    onPostStateChange() {}\r\n\r\n    static writeShapeData(cb, props, forceWriteRotation = false) {\r\n        const shape = props.shape;\r\n        cb.write(shape, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n    \r\n        let useEntityScale = props.useEntityScale;\r\n        let scale;\r\n        if (useEntityScale) {\r\n            scale = props.scale || props.entity.getLocalScale();\r\n            if (scale.x === 1 && scale.y === 1 && scale.z === 1) {\r\n                useEntityScale = false;\r\n            }\r\n        }\r\n\r\n        cb.write(useEntityScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (useEntityScale || (\r\n            shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH ||\r\n            shape === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL)) {\r\n            // Potential precision loss 64 -> 32\r\n            cb.write(scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    \r\n        let ok = true;\r\n        switch (shape) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_BOX:\r\n                cb.write(props.halfExtent, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CAPSULE:\r\n                cb.write(props.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CYLINDER:\r\n                cb.write(props.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(props.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_SPHERE:\r\n                cb.write(props.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n    \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_STATIC_COMPOUND:\r\n                ok = ShapeComponent.addCompoundChildren(cb, props.entity);\r\n                break;\r\n    \r\n            // intentional fall-through\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_CONVEX_HULL:\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_MESH:\r\n                ShapeComponent.addMeshes(props.meshes, cb);\r\n                break;\r\n            \r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.SHAPE_HEIGHTFIELD:\r\n                cb.write(props.hfOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.hfScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(props.hfSampleCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n                cb.write(props.hfBlockSize, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                cb.write(props.hfBitsPerSample, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                cb.write(props.hfActiveEdgeCosThresholdAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.addBuffer(props.hfSamples.buffer);\r\n                break;\r\n    \r\n            default:\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Unsupperted shape type', shape);\r\n                return false;\r\n        }\r\n    \r\n        const isCompoundChild = props.isCompoundChild;\r\n        cb.write(isCompoundChild, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (!isCompoundChild) {\r\n            cb.write(props.density, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    \r\n        const position = props.shapePosition;\r\n        const rotation = props.shapeRotation;\r\n        const massOffset = props.massOffset;\r\n        const hasPositionOffset = !position.equals(pc.Vec3.ZERO);\r\n        const hasRotationOffset = forceWriteRotation || !rotation.equals(pc.Vec3.ZERO);\r\n        const hasShapeOffset = hasPositionOffset || hasRotationOffset;\r\n        const hasMassOffset = !massOffset.equals(pc.Vec3.ZERO);\r\n\r\n        cb.write(hasShapeOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (hasShapeOffset) {\r\n            quat.setFromEulerAngles(rotation);\r\n            cb.write(position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            cb.write(quat, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        cb.write(hasMassOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n        if (hasMassOffset) {\r\n            cb.write(massOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        return ok;\r\n    }\r\n\r\n    static addCompoundChildren(cb, parent) {\r\n        const components = parent.findComponents('body');\r\n        const count = components.length;\r\n        const childrenCount = count - 1; // -1 to exclude the parent\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && childrenCount === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Trying to create a static (immutable) compound body without children shapes. Aborting.');\r\n            return false;\r\n        }\r\n\r\n        cb.write(childrenCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const component = components[i];\r\n            if (component.entity === parent) {\r\n                continue;\r\n            }\r\n\r\n            const ok = ShapeComponent.writeShapeData(cb, component);\r\n            if (!ok) {\r\n                return false;\r\n            }\r\n\r\n            const entity = component.entity;\r\n            const pos = entity.getLocalPosition();\r\n            const rot = entity.getLocalRotation();\r\n\r\n            // Loss of precision for pos/rot (64 -> 32)\r\n            cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n            cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static addMeshes(meshes, cb) {\r\n        for (let i = 0; i < meshes.length; i++) {\r\n            const mesh = meshes[i];\r\n            const vb = mesh.vertexBuffer;\r\n            const ib = mesh.indexBuffer[0];\r\n            const format = vb.getFormat();\r\n\r\n            for (let i = 0; i < format.elements.length; i++) {\r\n                const element = format.elements[i];\r\n                if (element.name === pc.SEMANTIC_POSITION) {\r\n                    cb.write(mesh.primitive[0].base, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                    cb.write(element.offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n                    cb.write(element.stride / _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.FLOAT32_SIZE, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n                    cb.addBuffer(vb.storage);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            cb.write(vb.numVertices, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(ib.numIndices, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // TODO\r\n            // workaround until this is fixed:\r\n            // https://github.com/playcanvas/engine/issues/5869\r\n            // buffer.addBuffer(ib.storage);\r\n\r\n            const storage = ib.storage;\r\n            const isView = ArrayBuffer.isView(storage);\r\n\r\n            let byteLength, byteOffset;\r\n            if (isView) {\r\n                byteLength = storage.byteLength;\r\n                byteOffset = storage.byteOffset;\r\n            } else {\r\n                byteLength = storage.byteLength / ib.bytesPerIndex;\r\n                byteOffset = 0;\r\n            }\r\n\r\n            cb.write(byteLength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.write(byteOffset, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            cb.addBuffer(isView ? storage.buffer : storage);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29tcG9uZW50Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29tcG9uZW50Lm1qcz9lZjFiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBidWlsZEFjY2Vzc29ycyB9IGZyb20gXCIuLi8uLi91dGlsLm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsXHJcbiAgICBCVUZGRVJfV1JJVEVfRkxPQVQzMixcclxuICAgIEJVRkZFUl9XUklURV9VSU5UMzIsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDgsXHJcbiAgICBCVUZGRVJfV1JJVEVfVkVDMzIsXHJcbiAgICBGTE9BVDMyX1NJWkUsXHJcbiAgICBTSEFQRV9CT1gsXHJcbiAgICBTSEFQRV9DQVBTVUxFLFxyXG4gICAgU0hBUEVfQ09OVkVYX0hVTEwsXHJcbiAgICBTSEFQRV9DWUxJTkRFUixcclxuICAgIFNIQVBFX0hFSUdIVEZJRUxELFxyXG4gICAgU0hBUEVfTUVTSCxcclxuICAgIFNIQVBFX1NQSEVSRSxcclxuICAgIFNIQVBFX1NUQVRJQ19DT01QT1VORFxyXG59IGZyb20gXCIuL2NvbnN0YW50cy5tanNcIjtcclxuXHJcbmNsYXNzIFNoYXBlQ29tcG9uZW50IGV4dGVuZHMgcGMuRXZlbnRIYW5kbGVyIHtcclxuXHJcbiAgICAvLyAtLS0tIENPTVBPTkVOVCBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gU2hhcGUgdHlwZVxyXG4gICAgX3NoYXBlID0gU0hBUEVfQk9YO1xyXG5cclxuICAgIC8vIEVuYWJsZSAvIGRpc2FibGUgY29tcG9uZW50XHJcbiAgICBfZW5hYmxlZCA9IHRydWU7XHJcblxyXG4gICAgLy8gQXV0b21hdGljYWxseSBtb3ZlcyBkeW5hbWljIGJvZGllcywgd2hlbiB0aGUgcG9zaXRpb24gaXMgc2V0IG9uIGVudGl0eS5cclxuICAgIF90cmFja0R5bmFtaWMgPSB0cnVlO1xyXG5cclxuICAgIC8vIFVuaXF1ZSBib2R5IGluZGV4LiBUaGlzIGNhbiBjaGFuZ2UgZHVyaW5nIGVudGl0eSBsaWZlY3ljbGUsIGUuZy4gZXZlcnkgdGltZSBlbnRpdHkgaXMgZW5hYmxlZCwgYSBuZXdcclxuICAgIC8vIGluZGV4IGlzIGFzc2lnbmVkIGFuZCBhIG5ldyBib2R5IGlzIGNyZWF0ZWQuIFRoZSBpbmRleCBpcyB1c2VkIHRvIG1hcCBlbnRpdHkgdG8gYm9keS4gSW5kaWNlcyBjYW4gYmUgcmV1c2VkLlxyXG4gICAgX2luZGV4ID0gLTE7XHJcblxyXG4gICAgLy8gUmVuZGVyIGFzc2V0IElELCB1c2VkIGZvciBtZXNoIG9yIGNvbnZleCBodWxscy5cclxuICAgIF9yZW5kZXJBc3NldCA9IG51bGw7XHJcblxyXG4gICAgLy8gTWVzaGVzIHVzZWQgZm9yIG1lc2ggb3IgY29udmV4IGh1bGxzXHJcbiAgICBfbWVzaGVzID0gbnVsbDtcclxuXHJcbiAgICAvLyBUZWxscyBpZiB0aGUgY29tcG9uZW50IGRlc2NyaWJlcyBhIGNvbXBvdW5kIGNoaWxkXHJcbiAgICBfaXNDb21wb3VuZENoaWxkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQXBwbGllcyBlbnRpdHkgc2NhbGUgb24gdGhlIHNoYXBlXHJcbiAgICBfdXNlRW50aXR5U2NhbGUgPSB0cnVlO1xyXG5cclxuICAgIC8vIFJlYWQtb25seS4gQ29uc3RyYWludCBpbmRpY2VzIGFwcGxpZWQgb24gdGhpcyBib2R5LlxyXG4gICAgX2NvbnN0cmFpbnRzID0gbmV3IE1hcCgpOyAgICBcclxuXHJcbiAgICAvLyBEZWJ1ZyBkcmF3XHJcbiAgICBfZGVidWdEcmF3ID0gZmFsc2U7XHJcblxyXG4gICAgLy8gLS0tLSBTSEFQRSBQUk9QUyAtLS0tXHJcblxyXG4gICAgLy8gSGFsZiBleHRlbnRzIGZvciBhIGJveCBzaGFwZVxyXG4gICAgX2hhbGZFeHRlbnQgPSBuZXcgcGMuVmVjMygwLjUsIDAuNSwgMC41KTtcclxuXHJcbiAgICAvLyBSYWlkdXMgZm9yIHJhZGl1cyBiYXNlZCBzaGFwZXNcclxuICAgIF9yYWRpdXMgPSAwLjU7XHJcblxyXG4gICAgLy8gSW50ZXJuYWxseSB0aGUgY29udmV4IHJhZGl1cyB3aWxsIGJlIHN1YnRyYWN0ZWQgZnJvbSB0aGUgaGFsZiBleHRlbnQgc28gdGhlIHRvdGFsIGJveCB3aWxsIG5vdCBncm93IHdpdGggdGhlIGNvbnZleCByYWRpdXNcclxuICAgIF9jb252ZXhSYWRpdXMgPSAwLjA1O1xyXG5cclxuICAgIC8vIEhhbGYgaGVpZ2h0IG9mIHJhZGl1cyBiYXNlZCBzaGFwZXMsIGUuZy4gY3lsaW5kZXIsIGNhcHN1bGVcclxuICAgIF9oYWxmSGVpZ2h0ID0gMC41O1xyXG5cclxuICAgIC8vIERlbnNpdHkgb2YgdGhlIG9iamVjdCBpbiBrZyAvIG1eM1xyXG4gICAgX2RlbnNpdHkgPSAxMDAwO1xyXG5cclxuICAgIC8vIFNoYXBlIGxvY2FsIHBvc2l0aW9uIG9mZnNldFxyXG4gICAgX3NoYXBlUG9zaXRpb24gPSBwYy5WZWMzLlpFUk87XHJcblxyXG4gICAgLy8gU2hhcGUgbG9jYWwgcm90YXRpb24gb2Zmc2V0XHJcbiAgICBfc2hhcGVSb3RhdGlvbiA9IHBjLlZlYzMuWkVSTztcclxuXHJcbiAgICAvLyBPZmZzZXQgY2VudGVyIG9mIG1hc3MgaW4gbG9jYWwgc3BhY2Ugb2YgdGhlIGJvZHkuIERvZXMgbm90IG1vdmUgdGhlIHNoYXBlLlxyXG4gICAgX21hc3NPZmZzZXQgPSBwYy5WZWMzLlpFUk87XHJcblxyXG4gICAgX2hmU2FtcGxlcyA9IG51bGw7XHJcblxyXG4gICAgX2hmU2FtcGxlQ291bnQgPSAwO1xyXG5cclxuICAgIC8vIFRoZSBIZWlnaHRGaWVsZCBpcyBkaXZpZGVkIGluIGJsb2NrcyBvZiBoZkJsb2NrU2l6ZSAqIGhmQmxvY2tTaXplICogMiB0cmlhbmdsZXMgYW5kIHRoZVxyXG4gICAgLy8gYWNjZWxlcmF0aW9uIHN0cnVjdHVyZSBjdWxscyBibG9ja3Mgb25seSwgYmlnZ2VyIGJsb2NrIHNpemVzIHJlZHVjZSBtZW1vcnkgY29uc3VtcHRpb25cclxuICAgIC8vIGJ1dCBhbHNvIHJlZHVjZSBxdWVyeSBwZXJmb3JtYW5jZS4gU2Vuc2libGUgdmFsdWVzIGFyZSBbMiwgOF0sIGRvZXMgbm90IG5lZWQgdG8gYmUgYVxyXG4gICAgLy8gcG93ZXIgb2YgMi4gTm90ZSB0aGF0IGF0IHJ1bi10aW1lIEpvbHQgcGVyZm9ybXMgb25lIG1vcmUgZ3JpZCBzdWJkaXZpc2lvbiwgc28gdGhlIGVmZmVjdGl2ZVxyXG4gICAgLy8gYmxvY2sgc2l6ZSBpcyBoYWxmIG9mIHdoYXQgaXMgcHJvdmlkZWQgaGVyZS5cclxuICAgIF9oZkJsb2NrU2l6ZSA9IDI7XHJcblxyXG4gICAgLy8gSG93IG1hbnkgYml0cyBwZXIgc2FtcGxlIHRvIHVzZSB0byBjb21wcmVzcyB0aGUgSGVpZ2h0RmllbGQuIENhbiBiZSBpbiB0aGUgcmFuZ2UgWzEsIDhdLlxyXG4gICAgLy8gTm90ZSB0aGF0IGVhY2ggc2FtcGxlIGlzIGNvbXByZXNzZWQgcmVsYXRpdmUgdG8gdGhlIG1pbi9tYXggdmFsdWUgb2YgaXRzIGJsb2NrIG9mXHJcbiAgICAvLyBoZkJsb2NrU2l6ZSAqIGhmQmxvY2tTaXplIHBpeGVscyBzbyB0aGUgZWZmZWN0aXZlIHByZWNpc2lvbiBpcyBoaWdoZXIuIEFsc28gbm90ZSB0aGF0XHJcbiAgICAvLyBpbmNyZWFzaW5nIGhmQmxvY2tTaXplIHNhdmVzIG1vcmUgbWVtb3J5IHRoYW4gcmVkdWNpbmcgdGhlIGFtb3VudCBvZiBiaXRzIHBlciBzYW1wbGUuXHJcbiAgICBfaGZCaXRzUGVyU2FtcGxlID0gODtcclxuXHJcbiAgICAvLyBDb3NpbmUgb2YgdGhlIHRocmVzaG9sZCBhbmdsZSAoaWYgdGhlIGFuZ2xlIGJldHdlZW4gdGhlIHR3byB0cmlhbmdsZXMgaW4gSGVpZ2h0RmllbGQgaXNcclxuICAgIC8vIGJpZ2dlciB0aGFuIHRoaXMsIHRoZSBlZGdlIGlzIGFjdGl2ZSwgbm90ZSB0aGF0IGEgY29uY2F2ZSBlZGdlIGlzIGFsd2F5cyBpbmFjdGl2ZSkuIFNldHRpbmdcclxuICAgIC8vIHRoaXMgdmFsdWUgdG9vIHNtYWxsIGNhbiBjYXVzZSBnaG9zdCBjb2xsaXNpb25zIHdpdGggZWRnZXMsIHNldHRpbmcgaXQgdG9vIGJpZyBjYW4gY2F1c2VcclxuICAgIC8vIGRlcGVuZXRyYXRpb24gYXJ0aWZhY3RzIChvYmplY3RzIG5vdCBkZXBlbmV0cmF0aW5nIHF1aWNrbHkpLiBWYWxpZCByYW5nZXMgYXJlIGJldHdlZW5cclxuICAgIC8vIGNvcygwIGRlZ3JlZXMpIGFuZCBjb3MoOTAgZGVncmVlcykuIFRoZSBkZWZhdWx0IHZhbHVlIGlzIGNvcyg1IGRlZ3JlZXMpLlxyXG4gICAgX2hmQWN0aXZlRWRnZUNvc1RocmVzaG9sZEFuZ2xlID0gMC45OTYxOTU7XHJcblxyXG4gICAgX2hmU2NhbGUgPSBwYy5WZWMzLk9ORTtcclxuXHJcbiAgICAvLyBUaGUgaGVpZ2h0IGZpZWxkIGlzIGEgc3VyZmFjZSBkZWZpbmVkIGJ5OiBoZk9mZnNldCArIGhmU2NhbGUgKiAoeCwgaGZIZWlnaHRTYW1wbGVzW3kgKiBoZlNhbXBsZUNvdW50ICsgeF0sIHkpLlxyXG4gICAgLy8gd2hlcmUgeCBhbmQgeSBhcmUgaW50ZWdlcnMgaW4gdGhlIHJhbmdlIHggYW5kIHkgZSBbMCwgaGZTYW1wbGVDb3VudCAtIDFdLlxyXG4gICAgX2hmT2Zmc2V0ID0gcGMuVmVjMy5aRVJPO1xyXG5cclxuICAgIC8vIFRoZSBDb21wb25lbnRTeXN0ZW0gdXNlZCB0byBjcmVhdGUgdGhpcyBDb21wb25lbnQuXHJcbiAgICBzeXN0ZW07XHJcblxyXG4gICAgLy8gVGhlIEVudGl0eSB0aGF0IHRoaXMgQ29tcG9uZW50IGlzIGF0dGFjaGVkIHRvLlxyXG4gICAgZW50aXR5O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy5zeXN0ZW0gPSBzeXN0ZW07XHJcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcblxyXG4gICAgICAgIGlmIChzeXN0ZW0uc2NoZW1hICYmICF0aGlzLl9hY2Nlc3NvcnNCdWlsdCkge1xyXG4gICAgICAgICAgICBidWlsZEFjY2Vzc29ycyh0aGlzLCBzeXN0ZW0uc2NoZW1hKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMub24oJ3NldCcsIGZ1bmN0aW9uIChuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5maXJlKCdzZXRfJyArIG5hbWUsIG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMub24oJ3NldF9lbmFibGVkJywgdGhpcy5vblNldEVuYWJsZWQsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXQgY29uc3RyYWludHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnN0cmFpbnRzO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBvblNldEVuYWJsZWQobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgaWYgKG9sZFZhbHVlICE9PSBuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbnRpdHkuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVuYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRGlzYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRW5hYmxlKCkge31cclxuXHJcbiAgICBvbkRpc2FibGUoKSB7XHJcbiAgICAgICAgY29uc3QgY29uc3RyYWludHMgPSB0aGlzLl9jb25zdHJhaW50cztcclxuXHJcbiAgICAgICAgY29uc3RyYWludHMuZm9yRWFjaCgoZW50aXR5MiwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgZW50aXR5Mj8uYm9keT8uY29uc3RyYWludHMuZGVsZXRlKGluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uZnJlZUNvbnN0cmFpbnRJbmRleChpbmRleCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3RyYWludHMuY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBvc3RTdGF0ZUNoYW5nZSgpIHt9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlU2hhcGVEYXRhKGNiLCBwcm9wcywgZm9yY2VXcml0ZVJvdGF0aW9uID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBzaGFwZSA9IHByb3BzLnNoYXBlO1xyXG4gICAgICAgIGNiLndyaXRlKHNoYXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgIFxyXG4gICAgICAgIGxldCB1c2VFbnRpdHlTY2FsZSA9IHByb3BzLnVzZUVudGl0eVNjYWxlO1xyXG4gICAgICAgIGxldCBzY2FsZTtcclxuICAgICAgICBpZiAodXNlRW50aXR5U2NhbGUpIHtcclxuICAgICAgICAgICAgc2NhbGUgPSBwcm9wcy5zY2FsZSB8fCBwcm9wcy5lbnRpdHkuZ2V0TG9jYWxTY2FsZSgpO1xyXG4gICAgICAgICAgICBpZiAoc2NhbGUueCA9PT0gMSAmJiBzY2FsZS55ID09PSAxICYmIHNjYWxlLnogPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHVzZUVudGl0eVNjYWxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHVzZUVudGl0eVNjYWxlLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGlmICh1c2VFbnRpdHlTY2FsZSB8fCAoXHJcbiAgICAgICAgICAgIHNoYXBlID09PSBTSEFQRV9NRVNIIHx8XHJcbiAgICAgICAgICAgIHNoYXBlID09PSBTSEFQRV9DT05WRVhfSFVMTCkpIHtcclxuICAgICAgICAgICAgLy8gUG90ZW50aWFsIHByZWNpc2lvbiBsb3NzIDY0IC0+IDMyXHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNjYWxlLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBsZXQgb2sgPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaCAoc2hhcGUpIHtcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9CT1g6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5oYWxmRXh0ZW50LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmNvbnZleFJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ0FQU1VMRTpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmhhbGZIZWlnaHQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5yYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0NZTElOREVSOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGFsZkhlaWdodCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLnJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHByb3BzLmNvbnZleFJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfU1BIRVJFOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMucmFkaXVzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9TVEFUSUNfQ09NUE9VTkQ6XHJcbiAgICAgICAgICAgICAgICBvayA9IFNoYXBlQ29tcG9uZW50LmFkZENvbXBvdW5kQ2hpbGRyZW4oY2IsIHByb3BzLmVudGl0eSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICAvLyBpbnRlbnRpb25hbCBmYWxsLXRocm91Z2hcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9DT05WRVhfSFVMTDpcclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9NRVNIOlxyXG4gICAgICAgICAgICAgICAgU2hhcGVDb21wb25lbnQuYWRkTWVzaGVzKHByb3BzLm1lc2hlcywgY2IpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0hFSUdIVEZJRUxEOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZPZmZzZXQsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZTY2FsZSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5oZlNhbXBsZUNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5oZkJsb2NrU2l6ZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShwcm9wcy5oZkJpdHNQZXJTYW1wbGUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUocHJvcHMuaGZBY3RpdmVFZGdlQ29zVGhyZXNob2xkQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi5hZGRCdWZmZXIocHJvcHMuaGZTYW1wbGVzLmJ1ZmZlcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLndhcm4oJ1Vuc3VwcGVydGVkIHNoYXBlIHR5cGUnLCBzaGFwZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgY29uc3QgaXNDb21wb3VuZENoaWxkID0gcHJvcHMuaXNDb21wb3VuZENoaWxkO1xyXG4gICAgICAgIGNiLndyaXRlKGlzQ29tcG91bmRDaGlsZCwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAoIWlzQ29tcG91bmRDaGlsZCkge1xyXG4gICAgICAgICAgICBjYi53cml0ZShwcm9wcy5kZW5zaXR5LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcHJvcHMuc2hhcGVQb3NpdGlvbjtcclxuICAgICAgICBjb25zdCByb3RhdGlvbiA9IHByb3BzLnNoYXBlUm90YXRpb247XHJcbiAgICAgICAgY29uc3QgbWFzc09mZnNldCA9IHByb3BzLm1hc3NPZmZzZXQ7XHJcbiAgICAgICAgY29uc3QgaGFzUG9zaXRpb25PZmZzZXQgPSAhcG9zaXRpb24uZXF1YWxzKHBjLlZlYzMuWkVSTyk7XHJcbiAgICAgICAgY29uc3QgaGFzUm90YXRpb25PZmZzZXQgPSBmb3JjZVdyaXRlUm90YXRpb24gfHwgIXJvdGF0aW9uLmVxdWFscyhwYy5WZWMzLlpFUk8pO1xyXG4gICAgICAgIGNvbnN0IGhhc1NoYXBlT2Zmc2V0ID0gaGFzUG9zaXRpb25PZmZzZXQgfHwgaGFzUm90YXRpb25PZmZzZXQ7XHJcbiAgICAgICAgY29uc3QgaGFzTWFzc09mZnNldCA9ICFtYXNzT2Zmc2V0LmVxdWFscyhwYy5WZWMzLlpFUk8pO1xyXG5cclxuICAgICAgICBjYi53cml0ZShoYXNTaGFwZU9mZnNldCwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAoaGFzU2hhcGVPZmZzZXQpIHtcclxuICAgICAgICAgICAgcXVhdC5zZXRGcm9tRXVsZXJBbmdsZXMocm90YXRpb24pO1xyXG4gICAgICAgICAgICBjYi53cml0ZShwb3NpdGlvbiwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHF1YXQsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2Iud3JpdGUoaGFzTWFzc09mZnNldCwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAoaGFzTWFzc09mZnNldCkge1xyXG4gICAgICAgICAgICBjYi53cml0ZShtYXNzT2Zmc2V0LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYWRkQ29tcG91bmRDaGlsZHJlbihjYiwgcGFyZW50KSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHBhcmVudC5maW5kQ29tcG9uZW50cygnYm9keScpO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gY29tcG9uZW50cy5sZW5ndGg7XHJcbiAgICAgICAgY29uc3QgY2hpbGRyZW5Db3VudCA9IGNvdW50IC0gMTsgLy8gLTEgdG8gZXhjbHVkZSB0aGUgcGFyZW50XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgY2hpbGRyZW5Db3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICBEZWJ1Zy53YXJuKCdUcnlpbmcgdG8gY3JlYXRlIGEgc3RhdGljIChpbW11dGFibGUpIGNvbXBvdW5kIGJvZHkgd2l0aG91dCBjaGlsZHJlbiBzaGFwZXMuIEFib3J0aW5nLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZShjaGlsZHJlbkNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2ldO1xyXG4gICAgICAgICAgICBpZiAoY29tcG9uZW50LmVudGl0eSA9PT0gcGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgb2sgPSBTaGFwZUNvbXBvbmVudC53cml0ZVNoYXBlRGF0YShjYiwgY29tcG9uZW50KTtcclxuICAgICAgICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBjb21wb25lbnQuZW50aXR5O1xyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBlbnRpdHkuZ2V0TG9jYWxQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSBlbnRpdHkuZ2V0TG9jYWxSb3RhdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gTG9zcyBvZiBwcmVjaXNpb24gZm9yIHBvcy9yb3QgKDY0IC0+IDMyKVxyXG4gICAgICAgICAgICBjYi53cml0ZShwb3MsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShyb3QsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFkZE1lc2hlcyhtZXNoZXMsIGNiKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNoZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgbWVzaCA9IG1lc2hlc1tpXTtcclxuICAgICAgICAgICAgY29uc3QgdmIgPSBtZXNoLnZlcnRleEJ1ZmZlcjtcclxuICAgICAgICAgICAgY29uc3QgaWIgPSBtZXNoLmluZGV4QnVmZmVyWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBmb3JtYXQgPSB2Yi5nZXRGb3JtYXQoKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybWF0LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZm9ybWF0LmVsZW1lbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQubmFtZSA9PT0gcGMuU0VNQU5USUNfUE9TSVRJT04pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShtZXNoLnByaW1pdGl2ZVswXS5iYXNlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShlbGVtZW50Lm9mZnNldCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGVsZW1lbnQuc3RyaWRlIC8gRkxPQVQzMl9TSVpFLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi5hZGRCdWZmZXIodmIuc3RvcmFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKHZiLm51bVZlcnRpY2VzLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGliLm51bUluZGljZXMsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRPRE9cclxuICAgICAgICAgICAgLy8gd29ya2Fyb3VuZCB1bnRpbCB0aGlzIGlzIGZpeGVkOlxyXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGxheWNhbnZhcy9lbmdpbmUvaXNzdWVzLzU4NjlcclxuICAgICAgICAgICAgLy8gYnVmZmVyLmFkZEJ1ZmZlcihpYi5zdG9yYWdlKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JhZ2UgPSBpYi5zdG9yYWdlO1xyXG4gICAgICAgICAgICBjb25zdCBpc1ZpZXcgPSBBcnJheUJ1ZmZlci5pc1ZpZXcoc3RvcmFnZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgYnl0ZUxlbmd0aCwgYnl0ZU9mZnNldDtcclxuICAgICAgICAgICAgaWYgKGlzVmlldykge1xyXG4gICAgICAgICAgICAgICAgYnl0ZUxlbmd0aCA9IHN0b3JhZ2UuYnl0ZUxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGJ5dGVPZmZzZXQgPSBzdG9yYWdlLmJ5dGVPZmZzZXQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBieXRlTGVuZ3RoID0gc3RvcmFnZS5ieXRlTGVuZ3RoIC8gaWIuYnl0ZXNQZXJJbmRleDtcclxuICAgICAgICAgICAgICAgIGJ5dGVPZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjYi53cml0ZShieXRlTGVuZ3RoLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGJ5dGVPZmZzZXQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2IuYWRkQnVmZmVyKGlzVmlldyA/IHN0b3JhZ2UuYnVmZmVyIDogc3RvcmFnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBTaGFwZUNvbXBvbmVudCB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/constants.mjs":
/*!***************************************************!*\
  !*** ./src/physics/components/jolt/constants.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BUFFER_READ_BOOL: () => (/* binding */ BUFFER_READ_BOOL),\n/* harmony export */   BUFFER_READ_FLOAT32: () => (/* binding */ BUFFER_READ_FLOAT32),\n/* harmony export */   BUFFER_READ_INT32: () => (/* binding */ BUFFER_READ_INT32),\n/* harmony export */   BUFFER_READ_UINT16: () => (/* binding */ BUFFER_READ_UINT16),\n/* harmony export */   BUFFER_READ_UINT32: () => (/* binding */ BUFFER_READ_UINT32),\n/* harmony export */   BUFFER_READ_UINT8: () => (/* binding */ BUFFER_READ_UINT8),\n/* harmony export */   BUFFER_WRITE_BOOL: () => (/* binding */ BUFFER_WRITE_BOOL),\n/* harmony export */   BUFFER_WRITE_FLOAT32: () => (/* binding */ BUFFER_WRITE_FLOAT32),\n/* harmony export */   BUFFER_WRITE_INT32: () => (/* binding */ BUFFER_WRITE_INT32),\n/* harmony export */   BUFFER_WRITE_JOLTVEC32: () => (/* binding */ BUFFER_WRITE_JOLTVEC32),\n/* harmony export */   BUFFER_WRITE_PLANE: () => (/* binding */ BUFFER_WRITE_PLANE),\n/* harmony export */   BUFFER_WRITE_UINT16: () => (/* binding */ BUFFER_WRITE_UINT16),\n/* harmony export */   BUFFER_WRITE_UINT32: () => (/* binding */ BUFFER_WRITE_UINT32),\n/* harmony export */   BUFFER_WRITE_UINT8: () => (/* binding */ BUFFER_WRITE_UINT8),\n/* harmony export */   BUFFER_WRITE_VEC32: () => (/* binding */ BUFFER_WRITE_VEC32),\n/* harmony export */   CMD_ADD_ANGULAR_IMPULSE: () => (/* binding */ CMD_ADD_ANGULAR_IMPULSE),\n/* harmony export */   CMD_ADD_FORCE: () => (/* binding */ CMD_ADD_FORCE),\n/* harmony export */   CMD_ADD_IMPULSE: () => (/* binding */ CMD_ADD_IMPULSE),\n/* harmony export */   CMD_ADD_TORQUE: () => (/* binding */ CMD_ADD_TORQUE),\n/* harmony export */   CMD_APPLY_BUOYANCY_IMPULSE: () => (/* binding */ CMD_APPLY_BUOYANCY_IMPULSE),\n/* harmony export */   CMD_CAST_RAY: () => (/* binding */ CMD_CAST_RAY),\n/* harmony export */   CMD_CAST_SHAPE: () => (/* binding */ CMD_CAST_SHAPE),\n/* harmony export */   CMD_CHANGE_GRAVITY: () => (/* binding */ CMD_CHANGE_GRAVITY),\n/* harmony export */   CMD_CHAR_SET_LIN_VEL: () => (/* binding */ CMD_CHAR_SET_LIN_VEL),\n/* harmony export */   CMD_CHAR_SET_SHAPE: () => (/* binding */ CMD_CHAR_SET_SHAPE),\n/* harmony export */   CMD_CREATE_BODY: () => (/* binding */ CMD_CREATE_BODY),\n/* harmony export */   CMD_CREATE_CHAR: () => (/* binding */ CMD_CREATE_CHAR),\n/* harmony export */   CMD_CREATE_CONSTRAINT: () => (/* binding */ CMD_CREATE_CONSTRAINT),\n/* harmony export */   CMD_CREATE_GROUPS: () => (/* binding */ CMD_CREATE_GROUPS),\n/* harmony export */   CMD_CREATE_SHAPE: () => (/* binding */ CMD_CREATE_SHAPE),\n/* harmony export */   CMD_CREATE_SOFT_BODY: () => (/* binding */ CMD_CREATE_SOFT_BODY),\n/* harmony export */   CMD_CREATE_VEHICLE: () => (/* binding */ CMD_CREATE_VEHICLE),\n/* harmony export */   CMD_DESTROY_BODY: () => (/* binding */ CMD_DESTROY_BODY),\n/* harmony export */   CMD_DESTROY_CONSTRAINT: () => (/* binding */ CMD_DESTROY_CONSTRAINT),\n/* harmony export */   CMD_DESTROY_SHAPE: () => (/* binding */ CMD_DESTROY_SHAPE),\n/* harmony export */   CMD_MOVE_BODY: () => (/* binding */ CMD_MOVE_BODY),\n/* harmony export */   CMD_REPORT_CONTACTS: () => (/* binding */ CMD_REPORT_CONTACTS),\n/* harmony export */   CMD_REPORT_SET_SHAPE: () => (/* binding */ CMD_REPORT_SET_SHAPE),\n/* harmony export */   CMD_RESET_VELOCITIES: () => (/* binding */ CMD_RESET_VELOCITIES),\n/* harmony export */   CMD_SET_ANG_VEL: () => (/* binding */ CMD_SET_ANG_VEL),\n/* harmony export */   CMD_SET_CONSTRAINT_ENABLED: () => (/* binding */ CMD_SET_CONSTRAINT_ENABLED),\n/* harmony export */   CMD_SET_DRIVER_INPUT: () => (/* binding */ CMD_SET_DRIVER_INPUT),\n/* harmony export */   CMD_SET_LIN_VEL: () => (/* binding */ CMD_SET_LIN_VEL),\n/* harmony export */   CMD_SET_MOTION_TYPE: () => (/* binding */ CMD_SET_MOTION_TYPE),\n/* harmony export */   CMD_SET_USER_DATA: () => (/* binding */ CMD_SET_USER_DATA),\n/* harmony export */   CMD_TOGGLE_GROUP_PAIR: () => (/* binding */ CMD_TOGGLE_GROUP_PAIR),\n/* harmony export */   CMD_UPDATE_TRANSFORMS: () => (/* binding */ CMD_UPDATE_TRANSFORMS),\n/* harmony export */   CMD_USE_MOTION_STATE: () => (/* binding */ CMD_USE_MOTION_STATE),\n/* harmony export */   COMPONENT_SYSTEM_BODY: () => (/* binding */ COMPONENT_SYSTEM_BODY),\n/* harmony export */   COMPONENT_SYSTEM_CHAR: () => (/* binding */ COMPONENT_SYSTEM_CHAR),\n/* harmony export */   COMPONENT_SYSTEM_SOFT_BODY: () => (/* binding */ COMPONENT_SYSTEM_SOFT_BODY),\n/* harmony export */   COMPONENT_SYSTEM_VEHICLE: () => (/* binding */ COMPONENT_SYSTEM_VEHICLE),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_X: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_X),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_Y: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_Y),\n/* harmony export */   CONSTRAINT_SIX_DOF_ROTATION_Z: () => (/* binding */ CONSTRAINT_SIX_DOF_ROTATION_Z),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_X: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_X),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_Y: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_Y),\n/* harmony export */   CONSTRAINT_SIX_DOF_TRANSLATION_Z: () => (/* binding */ CONSTRAINT_SIX_DOF_TRANSLATION_Z),\n/* harmony export */   CONSTRAINT_SPACE_LOCAL: () => (/* binding */ CONSTRAINT_SPACE_LOCAL),\n/* harmony export */   CONSTRAINT_SPACE_WORLD: () => (/* binding */ CONSTRAINT_SPACE_WORLD),\n/* harmony export */   CONSTRAINT_TYPE_CONE: () => (/* binding */ CONSTRAINT_TYPE_CONE),\n/* harmony export */   CONSTRAINT_TYPE_DISTANCE: () => (/* binding */ CONSTRAINT_TYPE_DISTANCE),\n/* harmony export */   CONSTRAINT_TYPE_FIXED: () => (/* binding */ CONSTRAINT_TYPE_FIXED),\n/* harmony export */   CONSTRAINT_TYPE_HINGE: () => (/* binding */ CONSTRAINT_TYPE_HINGE),\n/* harmony export */   CONSTRAINT_TYPE_POINT: () => (/* binding */ CONSTRAINT_TYPE_POINT),\n/* harmony export */   CONSTRAINT_TYPE_SIX_DOF: () => (/* binding */ CONSTRAINT_TYPE_SIX_DOF),\n/* harmony export */   CONSTRAINT_TYPE_SLIDER: () => (/* binding */ CONSTRAINT_TYPE_SLIDER),\n/* harmony export */   CONSTRAINT_TYPE_SWING_TWIST: () => (/* binding */ CONSTRAINT_TYPE_SWING_TWIST),\n/* harmony export */   CONTACT_TYPE_ADDED: () => (/* binding */ CONTACT_TYPE_ADDED),\n/* harmony export */   CONTACT_TYPE_PERSISTED: () => (/* binding */ CONTACT_TYPE_PERSISTED),\n/* harmony export */   CONTACT_TYPE_REMOVED: () => (/* binding */ CONTACT_TYPE_REMOVED),\n/* harmony export */   FLOAT32_SIZE: () => (/* binding */ FLOAT32_SIZE),\n/* harmony export */   INT32_SIZE: () => (/* binding */ INT32_SIZE),\n/* harmony export */   OBJECT_LAYER_MOVING: () => (/* binding */ OBJECT_LAYER_MOVING),\n/* harmony export */   OBJECT_LAYER_NON_MOVING: () => (/* binding */ OBJECT_LAYER_NON_MOVING),\n/* harmony export */   OPERATOR_CLEANER: () => (/* binding */ OPERATOR_CLEANER),\n/* harmony export */   OPERATOR_CREATOR: () => (/* binding */ OPERATOR_CREATOR),\n/* harmony export */   OPERATOR_MODIFIER: () => (/* binding */ OPERATOR_MODIFIER),\n/* harmony export */   OPERATOR_QUERIER: () => (/* binding */ OPERATOR_QUERIER),\n/* harmony export */   SHAPE_BOX: () => (/* binding */ SHAPE_BOX),\n/* harmony export */   SHAPE_CAPSULE: () => (/* binding */ SHAPE_CAPSULE),\n/* harmony export */   SHAPE_CONVEX_HULL: () => (/* binding */ SHAPE_CONVEX_HULL),\n/* harmony export */   SHAPE_CYLINDER: () => (/* binding */ SHAPE_CYLINDER),\n/* harmony export */   SHAPE_HEIGHTFIELD: () => (/* binding */ SHAPE_HEIGHTFIELD),\n/* harmony export */   SHAPE_MESH: () => (/* binding */ SHAPE_MESH),\n/* harmony export */   SHAPE_SPHERE: () => (/* binding */ SHAPE_SPHERE),\n/* harmony export */   SHAPE_STATIC_COMPOUND: () => (/* binding */ SHAPE_STATIC_COMPOUND),\n/* harmony export */   SPRING_MODE_FREQUENCY: () => (/* binding */ SPRING_MODE_FREQUENCY),\n/* harmony export */   SPRING_MODE_STIFFNESS: () => (/* binding */ SPRING_MODE_STIFFNESS),\n/* harmony export */   UINT16_SIZE: () => (/* binding */ UINT16_SIZE),\n/* harmony export */   UINT32_SIZE: () => (/* binding */ UINT32_SIZE),\n/* harmony export */   UINT8_SIZE: () => (/* binding */ UINT8_SIZE),\n/* harmony export */   VEHICLE_CAST_TYPE_CYLINDER: () => (/* binding */ VEHICLE_CAST_TYPE_CYLINDER),\n/* harmony export */   VEHICLE_CAST_TYPE_RAY: () => (/* binding */ VEHICLE_CAST_TYPE_RAY),\n/* harmony export */   VEHICLE_CAST_TYPE_SPHERE: () => (/* binding */ VEHICLE_CAST_TYPE_SPHERE),\n/* harmony export */   VEHICLE_TYPE_MOTORCYCLE: () => (/* binding */ VEHICLE_TYPE_MOTORCYCLE),\n/* harmony export */   VEHICLE_TYPE_TRACK: () => (/* binding */ VEHICLE_TYPE_TRACK),\n/* harmony export */   VEHICLE_TYPE_WHEEL: () => (/* binding */ VEHICLE_TYPE_WHEEL)\n/* harmony export */ });\nconst OPERATOR_CREATOR = 0;\r\nconst OPERATOR_MODIFIER = 1;\r\nconst OPERATOR_QUERIER = 2;\r\nconst OPERATOR_CLEANER = 3;\r\n\r\nconst CONSTRAINT_TYPE_FIXED = 0;\r\nconst CONSTRAINT_TYPE_POINT = 1;\r\nconst CONSTRAINT_TYPE_DISTANCE = 2;\r\nconst CONSTRAINT_TYPE_HINGE = 3;\r\nconst CONSTRAINT_TYPE_SLIDER = 4;\r\nconst CONSTRAINT_TYPE_CONE = 5;\r\nconst CONSTRAINT_TYPE_SWING_TWIST = 6;\r\nconst CONSTRAINT_TYPE_SIX_DOF = 7;\r\n\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_X = 0;\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_Y = 1;\r\nconst CONSTRAINT_SIX_DOF_TRANSLATION_Z = 2;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_X = 3;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_Y = 4;\r\nconst CONSTRAINT_SIX_DOF_ROTATION_Z = 5;\r\n\r\nconst CONSTRAINT_SPACE_LOCAL = 0;\r\nconst CONSTRAINT_SPACE_WORLD = 1;\r\n\r\nconst SPRING_MODE_FREQUENCY = 0;\r\nconst SPRING_MODE_STIFFNESS = 1;\r\n\r\nconst VEHICLE_CAST_TYPE_RAY = 0;\r\nconst VEHICLE_CAST_TYPE_SPHERE = 1;\r\nconst VEHICLE_CAST_TYPE_CYLINDER = 2;\r\n\r\nconst OBJECT_LAYER_NON_MOVING = 0;\r\nconst OBJECT_LAYER_MOVING = 1;\r\n\r\nconst SHAPE_BOX = 0;\r\nconst SHAPE_CAPSULE = 1;\r\nconst SHAPE_CYLINDER = 2;\r\nconst SHAPE_SPHERE = 3;\r\nconst SHAPE_MESH = 4;\r\nconst SHAPE_CONVEX_HULL = 5;\r\nconst SHAPE_STATIC_COMPOUND = 6;\r\nconst SHAPE_HEIGHTFIELD = 7;\r\n\r\nconst VEHICLE_TYPE_WHEEL = 0;\r\nconst VEHICLE_TYPE_TRACK = 1;\r\nconst VEHICLE_TYPE_MOTORCYCLE = 2;\r\n\r\nconst CONTACT_TYPE_ADDED = 0;\r\nconst CONTACT_TYPE_PERSISTED = 1;\r\nconst CONTACT_TYPE_REMOVED = 2;\r\n\r\nconst COMPONENT_SYSTEM_BODY = 0;\r\nconst COMPONENT_SYSTEM_CHAR = 1;\r\nconst COMPONENT_SYSTEM_VEHICLE = 2;\r\nconst COMPONENT_SYSTEM_SOFT_BODY = 3;\r\n\r\nconst FLOAT32_SIZE = Float32Array.BYTES_PER_ELEMENT;\r\nconst INT32_SIZE = Int32Array.BYTES_PER_ELEMENT;\r\nconst UINT32_SIZE = Uint32Array.BYTES_PER_ELEMENT;\r\nconst UINT16_SIZE = Uint16Array.BYTES_PER_ELEMENT;\r\nconst UINT8_SIZE = Uint8Array.BYTES_PER_ELEMENT;\r\n\r\nconst BUFFER_WRITE_UINT8 = 'writeUint8';\r\nconst BUFFER_WRITE_UINT16 = 'writeUint16';\r\nconst BUFFER_WRITE_UINT32 = 'writeUint32';\r\nconst BUFFER_WRITE_INT32 = 'writeInt32';\r\nconst BUFFER_WRITE_VEC32 = 'writeVector32';\r\nconst BUFFER_WRITE_FLOAT32 = 'writeFloat32';\r\nconst BUFFER_WRITE_BOOL = 'writeBool';\r\nconst BUFFER_WRITE_PLANE = 'writePlane';\r\nconst BUFFER_WRITE_JOLTVEC32 = 'writeJoltVec32';\r\n\r\nconst BUFFER_READ_UINT8 = 'readUint8';\r\nconst BUFFER_READ_UINT16 = 'readUint16';\r\nconst BUFFER_READ_UINT32 = 'readUint32';\r\nconst BUFFER_READ_INT32 = 'readInt32';\r\nconst BUFFER_READ_FLOAT32 = 'readFloat32';\r\nconst BUFFER_READ_BOOL = 'readBool';\r\n\r\n\r\nlet i = 0;\r\n// frontend -> backend\r\nconst CMD_CREATE_BODY = i++;\r\nconst CMD_CREATE_CHAR = i++;\r\nconst CMD_CREATE_SHAPE = i++;\r\nconst CMD_CREATE_VEHICLE = i++;\r\nconst CMD_CREATE_SOFT_BODY = i++;\r\nconst CMD_ADD_FORCE = i++;\r\nconst CMD_ADD_IMPULSE = i++;\r\nconst CMD_APPLY_BUOYANCY_IMPULSE = i++;\r\nconst CMD_ADD_ANGULAR_IMPULSE = i++;\r\nconst CMD_ADD_TORQUE = i++;\r\nconst CMD_CAST_RAY = i++;\r\nconst CMD_CAST_SHAPE = i++;\r\nconst CMD_DESTROY_BODY = i++;\r\nconst CMD_DESTROY_SHAPE = i++;\r\nconst CMD_MOVE_BODY = i++;\r\nconst CMD_SET_LIN_VEL = i++;\r\nconst CMD_SET_ANG_VEL = i++;\r\nconst CMD_SET_MOTION_TYPE = i++;\r\nconst CMD_RESET_VELOCITIES = i++;\r\nconst CMD_TOGGLE_GROUP_PAIR = i++;\r\nconst CMD_CREATE_GROUPS = i++;\r\nconst CMD_CREATE_CONSTRAINT = i++;\r\nconst CMD_CHANGE_GRAVITY = i++;\r\nconst CMD_CHAR_SET_LIN_VEL = i++;\r\nconst CMD_CHAR_SET_SHAPE = i++;\r\nconst CMD_SET_USER_DATA = i++;\r\nconst CMD_USE_MOTION_STATE = i++;\r\nconst CMD_SET_CONSTRAINT_ENABLED = i++;\r\nconst CMD_DESTROY_CONSTRAINT = i++;\r\nconst CMD_SET_DRIVER_INPUT = i++;\r\n// backend -> frontend\r\nconst CMD_UPDATE_TRANSFORMS = i++;\r\nconst CMD_REPORT_CONTACTS = i++;\r\nconst CMD_REPORT_SET_SHAPE = i++;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9jb25zdGFudHMubWpzPzAxMWUiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IE9QRVJBVE9SX0NSRUFUT1IgPSAwO1xyXG5leHBvcnQgY29uc3QgT1BFUkFUT1JfTU9ESUZJRVIgPSAxO1xyXG5leHBvcnQgY29uc3QgT1BFUkFUT1JfUVVFUklFUiA9IDI7XHJcbmV4cG9ydCBjb25zdCBPUEVSQVRPUl9DTEVBTkVSID0gMztcclxuXHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfRklYRUQgPSAwO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9UWVBFX1BPSU5UID0gMTtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfVFlQRV9ESVNUQU5DRSA9IDI7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfSElOR0UgPSAzO1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9UWVBFX1NMSURFUiA9IDQ7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfQ09ORSA9IDU7XHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1RZUEVfU1dJTkdfVFdJU1QgPSA2O1xyXG5leHBvcnQgY29uc3QgQ09OU1RSQUlOVF9UWVBFX1NJWF9ET0YgPSA3O1xyXG5cclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9YID0gMDtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9ZID0gMTtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9UUkFOU0xBVElPTl9aID0gMjtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9YID0gMztcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9ZID0gNDtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU0lYX0RPRl9ST1RBVElPTl9aID0gNTtcclxuXHJcbmV4cG9ydCBjb25zdCBDT05TVFJBSU5UX1NQQUNFX0xPQ0FMID0gMDtcclxuZXhwb3J0IGNvbnN0IENPTlNUUkFJTlRfU1BBQ0VfV09STEQgPSAxO1xyXG5cclxuZXhwb3J0IGNvbnN0IFNQUklOR19NT0RFX0ZSRVFVRU5DWSA9IDA7XHJcbmV4cG9ydCBjb25zdCBTUFJJTkdfTU9ERV9TVElGRk5FU1MgPSAxO1xyXG5cclxuZXhwb3J0IGNvbnN0IFZFSElDTEVfQ0FTVF9UWVBFX1JBWSA9IDA7XHJcbmV4cG9ydCBjb25zdCBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkUgPSAxO1xyXG5leHBvcnQgY29uc3QgVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVIgPSAyO1xyXG5cclxuZXhwb3J0IGNvbnN0IE9CSkVDVF9MQVlFUl9OT05fTU9WSU5HID0gMDtcclxuZXhwb3J0IGNvbnN0IE9CSkVDVF9MQVlFUl9NT1ZJTkcgPSAxO1xyXG5cclxuZXhwb3J0IGNvbnN0IFNIQVBFX0JPWCA9IDA7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9DQVBTVUxFID0gMTtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX0NZTElOREVSID0gMjtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX1NQSEVSRSA9IDM7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9NRVNIID0gNDtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX0NPTlZFWF9IVUxMID0gNTtcclxuZXhwb3J0IGNvbnN0IFNIQVBFX1NUQVRJQ19DT01QT1VORCA9IDY7XHJcbmV4cG9ydCBjb25zdCBTSEFQRV9IRUlHSFRGSUVMRCA9IDc7XHJcblxyXG5leHBvcnQgY29uc3QgVkVISUNMRV9UWVBFX1dIRUVMID0gMDtcclxuZXhwb3J0IGNvbnN0IFZFSElDTEVfVFlQRV9UUkFDSyA9IDE7XHJcbmV4cG9ydCBjb25zdCBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRSA9IDI7XHJcblxyXG5leHBvcnQgY29uc3QgQ09OVEFDVF9UWVBFX0FEREVEID0gMDtcclxuZXhwb3J0IGNvbnN0IENPTlRBQ1RfVFlQRV9QRVJTSVNURUQgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09OVEFDVF9UWVBFX1JFTU9WRUQgPSAyO1xyXG5cclxuZXhwb3J0IGNvbnN0IENPTVBPTkVOVF9TWVNURU1fQk9EWSA9IDA7XHJcbmV4cG9ydCBjb25zdCBDT01QT05FTlRfU1lTVEVNX0NIQVIgPSAxO1xyXG5leHBvcnQgY29uc3QgQ09NUE9ORU5UX1NZU1RFTV9WRUhJQ0xFID0gMjtcclxuZXhwb3J0IGNvbnN0IENPTVBPTkVOVF9TWVNURU1fU09GVF9CT0RZID0gMztcclxuXHJcbmV4cG9ydCBjb25zdCBGTE9BVDMyX1NJWkUgPSBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XHJcbmV4cG9ydCBjb25zdCBJTlQzMl9TSVpFID0gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDtcclxuZXhwb3J0IGNvbnN0IFVJTlQzMl9TSVpFID0gVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XHJcbmV4cG9ydCBjb25zdCBVSU5UMTZfU0laRSA9IFVpbnQxNkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xyXG5leHBvcnQgY29uc3QgVUlOVDhfU0laRSA9IFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XHJcblxyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX1VJTlQ4ID0gJ3dyaXRlVWludDgnO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX1VJTlQxNiA9ICd3cml0ZVVpbnQxNic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfV1JJVEVfVUlOVDMyID0gJ3dyaXRlVWludDMyJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9JTlQzMiA9ICd3cml0ZUludDMyJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9WRUMzMiA9ICd3cml0ZVZlY3RvcjMyJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9XUklURV9GTE9BVDMyID0gJ3dyaXRlRmxvYXQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfV1JJVEVfQk9PTCA9ICd3cml0ZUJvb2wnO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX1BMQU5FID0gJ3dyaXRlUGxhbmUnO1xyXG5leHBvcnQgY29uc3QgQlVGRkVSX1dSSVRFX0pPTFRWRUMzMiA9ICd3cml0ZUpvbHRWZWMzMic7XHJcblxyXG5leHBvcnQgY29uc3QgQlVGRkVSX1JFQURfVUlOVDggPSAncmVhZFVpbnQ4JztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9SRUFEX1VJTlQxNiA9ICdyZWFkVWludDE2JztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9SRUFEX1VJTlQzMiA9ICdyZWFkVWludDMyJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9SRUFEX0lOVDMyID0gJ3JlYWRJbnQzMic7XHJcbmV4cG9ydCBjb25zdCBCVUZGRVJfUkVBRF9GTE9BVDMyID0gJ3JlYWRGbG9hdDMyJztcclxuZXhwb3J0IGNvbnN0IEJVRkZFUl9SRUFEX0JPT0wgPSAncmVhZEJvb2wnO1xyXG5cclxuXHJcbmxldCBpID0gMDtcclxuLy8gZnJvbnRlbmQgLT4gYmFja2VuZFxyXG5leHBvcnQgY29uc3QgQ01EX0NSRUFURV9CT0RZID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NSRUFURV9DSEFSID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NSRUFURV9TSEFQRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfVkVISUNMRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfU09GVF9CT0RZID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0FERF9GT1JDRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9BRERfSU1QVUxTRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9BUFBMWV9CVU9ZQU5DWV9JTVBVTFNFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0FERF9BTkdVTEFSX0lNUFVMU0UgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQUREX1RPUlFVRSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DQVNUX1JBWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DQVNUX1NIQVBFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0RFU1RST1lfQk9EWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9ERVNUUk9ZX1NIQVBFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX01PVkVfQk9EWSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9TRVRfTElOX1ZFTCA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9TRVRfQU5HX1ZFTCA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9TRVRfTU9USU9OX1RZUEUgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfUkVTRVRfVkVMT0NJVElFUyA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9UT0dHTEVfR1JPVVBfUEFJUiA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9DUkVBVEVfR1JPVVBTID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NSRUFURV9DT05TVFJBSU5UID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NIQU5HRV9HUkFWSVRZID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX0NIQVJfU0VUX0xJTl9WRUwgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfQ0hBUl9TRVRfU0hBUEUgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfU0VUX1VTRVJfREFUQSA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9VU0VfTU9USU9OX1NUQVRFID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX1NFVF9DT05TVFJBSU5UX0VOQUJMRUQgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfREVTVFJPWV9DT05TVFJBSU5UID0gaSsrO1xyXG5leHBvcnQgY29uc3QgQ01EX1NFVF9EUklWRVJfSU5QVVQgPSBpKys7XHJcbi8vIGJhY2tlbmQgLT4gZnJvbnRlbmRcclxuZXhwb3J0IGNvbnN0IENNRF9VUERBVEVfVFJBTlNGT1JNUyA9IGkrKztcclxuZXhwb3J0IGNvbnN0IENNRF9SRVBPUlRfQ09OVEFDVFMgPSBpKys7XHJcbmV4cG9ydCBjb25zdCBDTURfUkVQT1JUX1NFVF9TSEFQRSA9IGkrKztcclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/constants.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/manager.mjs":
/*!*************************************************!*\
  !*** ./src/physics/components/jolt/manager.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JoltManager: () => (/* binding */ JoltManager)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _manager_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../manager.mjs */ \"./src/physics/manager.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _system_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./system.mjs */ \"./src/physics/components/jolt/system.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass JoltManager extends _manager_mjs__WEBPACK_IMPORTED_MODULE_2__.PhysicsManager {\r\n    // https://jrouwe.github.io/JoltPhysics/class_fixed_constraint_settings.html\r\n    static writeFixedConstraint(cb, opts) {\r\n        cb.write(opts.autoDetectPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        if (!opts.autoDetectPoint) {\r\n            cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n            cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        }\r\n        cb.write(opts.axisX1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_point_constraint_settings.html\r\n    static writePointConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_distance_constraint_settings.html\r\n    static writeDistanceConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.minDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxDistance, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_hinge_constraint_settings.html\r\n    static writeHingeConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.hingeAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.hingeAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_slider_constraint_settings.html\r\n    static writeSliderConstraint(cb, opts) {\r\n        cb.write(opts.autoDetectPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        if (!opts.autoDetectPoint) {\r\n            cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n            cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        }\r\n        cb.write(opts.sliderAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.sliderAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionForce, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_cone_constraint_settings.html\r\n    static writeConeConstraint(cb, opts) {\r\n        cb.write(opts.point1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.point2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.halfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_swing_twist_constraint_settings.html\r\n    static writeSwingTwistConstraint(cb, opts) {\r\n        cb.write(opts.position1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.planeAxis1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.position2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.twistAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.planeAxis2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.normalHalfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.planeHalfConeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.twistMinAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.twistMaxAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.maxFrictionTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeMotorSettings(cb, opts.swingMotorSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.twistMotorSettings);\r\n    }\r\n\r\n    // https://jrouwe.github.io/JoltPhysics/class_six_d_o_f_constraint_settings.html\r\n    static writeSixDofConstraint(cb, opts) {\r\n        JoltManager.writeAxes(cb, opts.freeAxes);\r\n        JoltManager.writeAxes(cb, opts.fixedAxes);\r\n        JoltManager.writeAxes(cb, opts.limitedAxes, true);\r\n\r\n        cb.write(opts.position1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.position2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisX2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.axisY2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts.maxFriction, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMin, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        cb.write(opts.limitsMax, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n\r\n        JoltManager.writeSpringSettings(cb, opts.springSettings);\r\n        JoltManager.writeMotorSettings(cb, opts.motorSettings);\r\n    }\r\n\r\n    static writeAxes(cb, axes, limits) {\r\n        cb.write(!!axes, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n        if (axes) {\r\n            const count = axes.length;\r\n            if (limits) {\r\n                cb.write(count / 3, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n                for (let i = 0; i < count; i += 3) {\r\n                    cb.write(axes[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n                    cb.write(axes[i + 1], _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32, false);\r\n                    cb.write(axes[i + 2], _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32, false);\r\n                }\r\n            } else {\r\n                cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n                for (let i = 0; i < count; i++) {\r\n                    cb.write(axes[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static writeSpringSettings(cb, springSettings) {\r\n        cb.write(!!springSettings, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n        if (springSettings != null) {\r\n            cb.write(springSettings.springMode, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n            cb.write(springSettings.frequency, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(springSettings.stiffness, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(springSettings.damping, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        }\r\n    }\r\n\r\n    static writeMotorSettings(cb, motorSettings) {\r\n        cb.write(!!motorSettings, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n        if (motorSettings != null) {\r\n            this._writeSpringSettings(cb, motorSettings.springSettings);\r\n            cb.write(motorSettings.minForceLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.maxForceLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.minTorqueLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n            cb.write(motorSettings.maxTorqueLimit, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n        }\r\n    }\r\n\r\n    constructor(app, backendName, opts) {\r\n        super(app, backendName, opts);\r\n\r\n        this._queryMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._constraintMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._shapeMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_1__.IndexedCache();\r\n        this._gravity = new pc.Vec3(0, -9.81, 0);\r\n    }\r\n\r\n    set gravity(gravity) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(gravity, `Invalid gravity vector`, gravity);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        if (!this._gravity.equals(gravity)) {\r\n            this._gravity.copy(gravity);\r\n\r\n            const cb = this._outBuffer;\r\n\r\n            cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_MODIFIER);\r\n            cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CHANGE_GRAVITY);\r\n            cb.write(gravity, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    }\r\n\r\n    get gravity() {\r\n        return this._gravity;\r\n    }\r\n\r\n    get queryMap() {\r\n        return this._queryMap;\r\n    }\r\n\r\n    onMessage(msg) {\r\n        super.onMessage(msg);\r\n\r\n        if (msg.drawViews) {\r\n            _system_mjs__WEBPACK_IMPORTED_MODULE_5__.ShapeComponentSystem.debugDraw(this._app, msg.drawViews, this._config);\r\n        }\r\n    }\r\n\r\n    createShape(type, options = {}) {\r\n        const cb = this._outBuffer;\r\n\r\n        const opts = {\r\n            // defaults\r\n            density: 1000,\r\n            shapePosition: new pc.Vec3(),\r\n            shapeRotation: new pc.Vec3(),\r\n            scale: new pc.Vec3(1, 1, 1),\r\n            halfExtent: new pc.Vec3(0.5, 0.5, 0.5),\r\n            convexRadius: 0.05,\r\n            halfHeight: 0.5,\r\n            radius: 0.5,\r\n\r\n            // user overrides\r\n            ...options,\r\n\r\n            // hard rules\r\n            shape: type,\r\n            useEntityScale: false,\r\n            isCompoundChild: false,\r\n        };\r\n\r\n        const index = this._shapeMap.add(opts);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CREATE_SHAPE);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n\r\n        _component_mjs__WEBPACK_IMPORTED_MODULE_3__.ShapeComponent.writeShapeData(cb, opts, true /* force write rotation */);\r\n\r\n        return index;\r\n    }\r\n\r\n    destroyShape(index) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid shape number: ${ num }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_CLEANER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_DESTROY_SHAPE);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n\r\n        this._shapeMap.free(index);\r\n    }    \r\n\r\n    createFilterGroups(groups) {\r\n        const cb = this._outBuffer;\r\n        const groupsCount = groups.length;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CREATE_GROUPS);\r\n        cb.write(groupsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < groupsCount; i++) {\r\n            // sub groups count\r\n            cb.write(groups[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n\r\n    toggleGroupPair(group, subGroup1, subGroup2, enable) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(group, `Invalid group 1: ${ group }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(subGroup1, `Invalid group 1: ${ subGroup1 }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(subGroup2, `Invalid group 2: ${ subGroup2 }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enable, `Invalid toggle flag: ${ enable }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_MODIFIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_TOGGLE_GROUP_PAIR);\r\n        cb.write(enable, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(group, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(subGroup1, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(subGroup2, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT16, false);\r\n    }    \r\n\r\n    castRay(origin, dir, callback, opts) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(origin,`Invalid origin vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(dir, `Invalid direction vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(callback, 'castRay requires a callback function castRay(origin, dir, callback, opts)');\r\n            if (ok && opts?.firstOnly != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.firstOnly);\r\n            if (ok && opts?.calculateNormal != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.calculateNormal);\r\n            if (ok && opts?.ignoreBackFaces != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.ignoreBackFaces);\r\n            if (ok && opts?.treatConvexAsSolid != null) ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(opts.treatConvexAsSolid);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const callbackIndex = this._queryMap.add(callback);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_QUERIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CAST_RAY);\r\n        cb.write(callbackIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(origin, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(dir, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(opts?.firstOnly, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.calculateNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.ignoreBackFaces, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.treatConvexAsSolid, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n    }\r\n\r\n    castShape(shape, pos, rot, dir, callback, opts) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(pos, `Invalid cast shape position vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkVec(dir, `Invalid cast shape direction vector`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkQuat(rot, `Invalid cast shape rotation`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const queryIndex = this._queryMap.add(callback);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_QUERIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CAST_SHAPE);\r\n        cb.write(queryIndex, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(shape, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(dir, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(opts?.scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts?.offset, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n        cb.write(opts?.backFaceModeTriangles, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts?.backFaceModeConvex, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts?.useShrunkenShapeAndConvexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.returnDeepestPoint, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.firstOnly, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n        cb.write(opts?.calculateNormal, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL);\r\n\r\n        switch (shape) {\r\n            case SHAPE_SPHERE:\r\n                cb.write(opts?.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                break;\r\n\r\n            case SHAPE_BOX:\r\n                cb.write(opts?.halfExtent, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n                cb.write(opts?.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                break;\r\n\r\n            case SHAPE_CAPSULE:\r\n                cb.write(opts?.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                cb.write(opts?.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                break;\r\n\r\n            case SHAPE_CYLINDER:\r\n                cb.write(opts?.halfHeight, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                cb.write(opts?.radius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_FLOAT32);\r\n                cb.write(opts?.convexRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_VEC32);\r\n                break;\r\n\r\n            default:\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce(`Invalid shape for casting: ${ shape }`);\r\n                break;\r\n        }\r\n    }    \r\n\r\n    createConstraint(type, entity1, entity2, opts = {}) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(!!entity1.c.body, `Entity has no Body Component. Cannot create constraint.`, entity1);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(!!entity2.c.body, `Entity has no Body Component. Cannot create constraint.`, entity2);\r\n            if (!ok) return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n        const index = this._constraintMap.add({ entity1, entity2 });\r\n\r\n        entity1.body.constraints.set(index, entity2);\r\n        entity2.body.constraints.set(index, entity1);\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_CREATE_CONSTRAINT);\r\n        cb.write(type, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8, false);\r\n\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(entity1.c.body.index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(entity2.c.body.index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n\r\n        switch (type) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_FIXED:\r\n                JoltManager.writeFixedConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_POINT:\r\n                JoltManager.writePointConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_DISTANCE:\r\n                JoltManager.writeDistanceConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_HINGE:\r\n                JoltManager.writeHingeConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_SLIDER:\r\n                JoltManager.writeSliderConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_CONE:\r\n                JoltManager.writeConeConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_SWING_TWIST:\r\n                JoltManager.writeSwingTwistConstraint(cb, opts);\r\n                break;\r\n\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CONSTRAINT_TYPE_SIX_DOF:\r\n                JoltManager.writeSixDofConstraint(cb, opts);\r\n                break;\r\n\r\n            default:\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.error(`Unrecognized constraint type: ${ type }`);\r\n                return;\r\n        }\r\n\r\n        cb.write(opts.numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts.numPositionStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n        cb.write(opts.space, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT8);\r\n\r\n        return index;\r\n    }\r\n\r\n    destroyConstraint(index) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid index of a constraint trying to destroy: ${ index }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_CLEANER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_DESTROY_CONSTRAINT);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n\r\n        this.freeConstraintIndex(index);\r\n    }\r\n\r\n    freeConstraintIndex(index) {\r\n        this._constraintMap.free(index);\r\n    }\r\n\r\n    setConstraintEnabled(index, enabled, activate = true) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkUint(index, `Invalid constraint index: ${ index }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enabled, `Invalid constraint enable bool: ${ enabled }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkBool(enabled, `Invalid activate bool: ${ enabled }`);\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        const cb = this._outBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.OPERATOR_MODIFIER);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_4__.CMD_SET_CONSTRAINT_ENABLED);\r\n        cb.write(index, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(enabled, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(activate, _constants_mjs__WEBPACK_IMPORTED_MODULE_4__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvbWFuYWdlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2NvbXBvbmVudHMvam9sdC9tYW5hZ2VyLm1qcz9jYzM4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBJbmRleGVkQ2FjaGUgfSBmcm9tIFwiLi4vLi4vaW5kZXhlZC1jYWNoZS5tanNcIjtcclxuaW1wb3J0IHsgUGh5c2ljc01hbmFnZXIgfSBmcm9tIFwiLi4vLi4vbWFuYWdlci5tanNcIjtcclxuaW1wb3J0IHsgU2hhcGVDb21wb25lbnQgfSBmcm9tIFwiLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7XHJcbiAgICBCVUZGRVJfV1JJVEVfQk9PTCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIEJVRkZFUl9XUklURV9VSU5UMTYsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDMyLCBCVUZGRVJfV1JJVEVfVUlOVDgsIEJVRkZFUl9XUklURV9WRUMzMixcclxuICAgIENNRF9DQVNUX1JBWSwgQ01EX0NBU1RfU0hBUEUsIENNRF9DSEFOR0VfR1JBVklUWSwgQ01EX0NSRUFURV9DT05TVFJBSU5ULFxyXG4gICAgQ01EX0NSRUFURV9HUk9VUFMsIENNRF9DUkVBVEVfU0hBUEUsIENNRF9ERVNUUk9ZX0NPTlNUUkFJTlQsIENNRF9ERVNUUk9ZX1NIQVBFLCBDTURfU0VUX0NPTlNUUkFJTlRfRU5BQkxFRCwgQ01EX1RPR0dMRV9HUk9VUF9QQUlSLCBDT05TVFJBSU5UX1RZUEVfQ09ORSxcclxuICAgIENPTlNUUkFJTlRfVFlQRV9ESVNUQU5DRSwgQ09OU1RSQUlOVF9UWVBFX0ZJWEVELCBDT05TVFJBSU5UX1RZUEVfSElOR0UsXHJcbiAgICBDT05TVFJBSU5UX1RZUEVfUE9JTlQsIENPTlNUUkFJTlRfVFlQRV9TSVhfRE9GLCBDT05TVFJBSU5UX1RZUEVfU0xJREVSLFxyXG4gICAgQ09OU1RSQUlOVF9UWVBFX1NXSU5HX1RXSVNULCBPUEVSQVRPUl9DTEVBTkVSLCBPUEVSQVRPUl9DUkVBVE9SLCBPUEVSQVRPUl9NT0RJRklFUiwgT1BFUkFUT1JfUVVFUklFUlxyXG59IGZyb20gXCIuL2NvbnN0YW50cy5tanNcIjtcclxuaW1wb3J0IHsgU2hhcGVDb21wb25lbnRTeXN0ZW0gfSBmcm9tIFwiLi9zeXN0ZW0ubWpzXCI7XHJcblxyXG5jbGFzcyBKb2x0TWFuYWdlciBleHRlbmRzIFBoeXNpY3NNYW5hZ2VyIHtcclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19maXhlZF9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZUZpeGVkQ29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXV0b0RldGVjdFBvaW50LCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgaWYgKCFvcHRzLmF1dG9EZXRlY3RQb2ludCkge1xyXG4gICAgICAgICAgICBjYi53cml0ZShvcHRzLnBvaW50MSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1gxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1kxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1gyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXhpc1kyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19wb2ludF9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZVBvaW50Q29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19kaXN0YW5jZV9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZURpc3RhbmNlQ29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWluRGlzdGFuY2UsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm1heERpc3RhbmNlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIG9wdHMuc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19oaW5nZV9jb25zdHJhaW50X3NldHRpbmdzLmh0bWxcclxuICAgIHN0YXRpYyB3cml0ZUhpbmdlQ29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuaGluZ2VBeGlzMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm5vcm1hbEF4aXMxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuaGluZ2VBeGlzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm5vcm1hbEF4aXMyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubGltaXRzTWluLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5saW1pdHNNYXgsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm1heEZyaWN0aW9uVG9ycXVlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3ByaW5nU2V0dGluZ3MoY2IsIG9wdHMuc3ByaW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlTW90b3JTZXR0aW5ncyhjYiwgb3B0cy5tb3RvclNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBodHRwczovL2pyb3V3ZS5naXRodWIuaW8vSm9sdFBoeXNpY3MvY2xhc3Nfc2xpZGVyX2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlU2xpZGVyQ29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuYXV0b0RldGVjdFBvaW50LCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgaWYgKCFvcHRzLmF1dG9EZXRlY3RQb2ludCkge1xyXG4gICAgICAgICAgICBjYi53cml0ZShvcHRzLnBvaW50MSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUob3B0cy5wb2ludDIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNiLndyaXRlKG9wdHMuc2xpZGVyQXhpczEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5ub3JtYWxBeGlzMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnNsaWRlckF4aXMyLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubm9ybWFsQXhpczIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5saW1pdHNNaW4sIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmxpbWl0c01heCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMubWF4RnJpY3Rpb25Gb3JjZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZVNwcmluZ1NldHRpbmdzKGNiLCBvcHRzLnNwcmluZ1NldHRpbmdzKTtcclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZU1vdG9yU2V0dGluZ3MoY2IsIG9wdHMubW90b3JTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX2NvbmVfY29uc3RyYWludF9zZXR0aW5ncy5odG1sXHJcbiAgICBzdGF0aWMgd3JpdGVDb25lQ29uc3RyYWludChjYiwgb3B0cykge1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9pbnQxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RBeGlzMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBvaW50MiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnR3aXN0QXhpczIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5oYWxmQ29uZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9qcm91d2UuZ2l0aHViLmlvL0pvbHRQaHlzaWNzL2NsYXNzX3N3aW5nX3R3aXN0X2NvbnN0cmFpbnRfc2V0dGluZ3MuaHRtbFxyXG4gICAgc3RhdGljIHdyaXRlU3dpbmdUd2lzdENvbnN0cmFpbnQoY2IsIG9wdHMpIHtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBvc2l0aW9uMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnR3aXN0QXhpczEsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wbGFuZUF4aXMxLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMucG9zaXRpb24yLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHMudHdpc3RBeGlzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBsYW5lQXhpczIsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5ub3JtYWxIYWxmQ29uZUFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5wbGFuZUhhbGZDb25lQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnR3aXN0TWluQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnR3aXN0TWF4QW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm1heEZyaWN0aW9uVG9ycXVlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcblxyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlTW90b3JTZXR0aW5ncyhjYiwgb3B0cy5zd2luZ01vdG9yU2V0dGluZ3MpO1xyXG4gICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlTW90b3JTZXR0aW5ncyhjYiwgb3B0cy50d2lzdE1vdG9yU2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGh0dHBzOi8vanJvdXdlLmdpdGh1Yi5pby9Kb2x0UGh5c2ljcy9jbGFzc19zaXhfZF9vX2ZfY29uc3RyYWludF9zZXR0aW5ncy5odG1sXHJcbiAgICBzdGF0aWMgd3JpdGVTaXhEb2ZDb25zdHJhaW50KGNiLCBvcHRzKSB7XHJcbiAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVBeGVzKGNiLCBvcHRzLmZyZWVBeGVzKTtcclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZUF4ZXMoY2IsIG9wdHMuZml4ZWRBeGVzKTtcclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZUF4ZXMoY2IsIG9wdHMubGltaXRlZEF4ZXMsIHRydWUpO1xyXG5cclxuICAgICAgICBjYi53cml0ZShvcHRzLnBvc2l0aW9uMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmF4aXNYMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmF4aXNZMSwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnBvc2l0aW9uMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmF4aXNYMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmF4aXNZMiwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm1heEZyaWN0aW9uLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cy5saW1pdHNNaW4sIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLmxpbWl0c01heCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZVNwcmluZ1NldHRpbmdzKGNiLCBvcHRzLnNwcmluZ1NldHRpbmdzKTtcclxuICAgICAgICBKb2x0TWFuYWdlci53cml0ZU1vdG9yU2V0dGluZ3MoY2IsIG9wdHMubW90b3JTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlQXhlcyhjYiwgYXhlcywgbGltaXRzKSB7XHJcbiAgICAgICAgY2Iud3JpdGUoISFheGVzLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGlmIChheGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gYXhlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGlmIChsaW1pdHMpIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGNvdW50IC8gMywgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpICs9IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShheGVzW2ldLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShheGVzW2kgKyAxXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjYi53cml0ZShheGVzW2kgKyAyXSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiLndyaXRlKGF4ZXNbaV0sIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3cml0ZVNwcmluZ1NldHRpbmdzKGNiLCBzcHJpbmdTZXR0aW5ncykge1xyXG4gICAgICAgIGNiLndyaXRlKCEhc3ByaW5nU2V0dGluZ3MsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKHNwcmluZ1NldHRpbmdzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgY2Iud3JpdGUoc3ByaW5nU2V0dGluZ3Muc3ByaW5nTW9kZSwgQlVGRkVSX1dSSVRFX1VJTlQ4KTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoc3ByaW5nU2V0dGluZ3MuZnJlcXVlbmN5LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNwcmluZ1NldHRpbmdzLnN0aWZmbmVzcywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmdTZXR0aW5ncy5kYW1waW5nLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3cml0ZU1vdG9yU2V0dGluZ3MoY2IsIG1vdG9yU2V0dGluZ3MpIHtcclxuICAgICAgICBjYi53cml0ZSghIW1vdG9yU2V0dGluZ3MsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKG1vdG9yU2V0dGluZ3MgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl93cml0ZVNwcmluZ1NldHRpbmdzKGNiLCBtb3RvclNldHRpbmdzLnNwcmluZ1NldHRpbmdzKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUobW90b3JTZXR0aW5ncy5taW5Gb3JjZUxpbWl0LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKG1vdG9yU2V0dGluZ3MubWF4Rm9yY2VMaW1pdCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShtb3RvclNldHRpbmdzLm1pblRvcnF1ZUxpbWl0LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKG1vdG9yU2V0dGluZ3MubWF4VG9ycXVlTGltaXQsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwLCBiYWNrZW5kTmFtZSwgb3B0cykge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgYmFja2VuZE5hbWUsIG9wdHMpO1xyXG5cclxuICAgICAgICB0aGlzLl9xdWVyeU1hcCA9IG5ldyBJbmRleGVkQ2FjaGUoKTtcclxuICAgICAgICB0aGlzLl9jb25zdHJhaW50TWFwID0gbmV3IEluZGV4ZWRDYWNoZSgpO1xyXG4gICAgICAgIHRoaXMuX3NoYXBlTWFwID0gbmV3IEluZGV4ZWRDYWNoZSgpO1xyXG4gICAgICAgIHRoaXMuX2dyYXZpdHkgPSBuZXcgcGMuVmVjMygwLCAtOS44MSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGdyYXZpdHkoZ3Jhdml0eSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5jaGVja1ZlYyhncmF2aXR5LCBgSW52YWxpZCBncmF2aXR5IHZlY3RvcmAsIGdyYXZpdHkpO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9ncmF2aXR5LmVxdWFscyhncmF2aXR5KSkge1xyXG4gICAgICAgICAgICB0aGlzLl9ncmF2aXR5LmNvcHkoZ3Jhdml0eSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuX291dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfTU9ESUZJRVIpO1xyXG4gICAgICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NIQU5HRV9HUkFWSVRZKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoZ3Jhdml0eSwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBncmF2aXR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ncmF2aXR5O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBxdWVyeU1hcCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnlNYXA7XHJcbiAgICB9XHJcblxyXG4gICAgb25NZXNzYWdlKG1zZykge1xyXG4gICAgICAgIHN1cGVyLm9uTWVzc2FnZShtc2cpO1xyXG5cclxuICAgICAgICBpZiAobXNnLmRyYXdWaWV3cykge1xyXG4gICAgICAgICAgICBTaGFwZUNvbXBvbmVudFN5c3RlbS5kZWJ1Z0RyYXcodGhpcy5fYXBwLCBtc2cuZHJhd1ZpZXdzLCB0aGlzLl9jb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVTaGFwZSh0eXBlLCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX291dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgY29uc3Qgb3B0cyA9IHtcclxuICAgICAgICAgICAgLy8gZGVmYXVsdHNcclxuICAgICAgICAgICAgZGVuc2l0eTogMTAwMCxcclxuICAgICAgICAgICAgc2hhcGVQb3NpdGlvbjogbmV3IHBjLlZlYzMoKSxcclxuICAgICAgICAgICAgc2hhcGVSb3RhdGlvbjogbmV3IHBjLlZlYzMoKSxcclxuICAgICAgICAgICAgc2NhbGU6IG5ldyBwYy5WZWMzKDEsIDEsIDEpLFxyXG4gICAgICAgICAgICBoYWxmRXh0ZW50OiBuZXcgcGMuVmVjMygwLjUsIDAuNSwgMC41KSxcclxuICAgICAgICAgICAgY29udmV4UmFkaXVzOiAwLjA1LFxyXG4gICAgICAgICAgICBoYWxmSGVpZ2h0OiAwLjUsXHJcbiAgICAgICAgICAgIHJhZGl1czogMC41LFxyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBvdmVycmlkZXNcclxuICAgICAgICAgICAgLi4ub3B0aW9ucyxcclxuXHJcbiAgICAgICAgICAgIC8vIGhhcmQgcnVsZXNcclxuICAgICAgICAgICAgc2hhcGU6IHR5cGUsXHJcbiAgICAgICAgICAgIHVzZUVudGl0eVNjYWxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNDb21wb3VuZENoaWxkOiBmYWxzZSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3NoYXBlTWFwLmFkZChvcHRzKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9TSEFQRSk7XHJcbiAgICAgICAgY2Iud3JpdGUoaW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgU2hhcGVDb21wb25lbnQud3JpdGVTaGFwZURhdGEoY2IsIG9wdHMsIHRydWUgLyogZm9yY2Ugd3JpdGUgcm90YXRpb24gKi8pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveVNoYXBlKGluZGV4KSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBvayA9IERlYnVnLmNoZWNrVWludChpbmRleCwgYEludmFsaWQgc2hhcGUgbnVtYmVyOiAkeyBudW0gfWApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9vdXRCdWZmZXI7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfQ0xFQU5FUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9ERVNUUk9ZX1NIQVBFKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLl9zaGFwZU1hcC5mcmVlKGluZGV4KTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgY3JlYXRlRmlsdGVyR3JvdXBzKGdyb3Vwcykge1xyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGdyb3Vwc0NvdW50ID0gZ3JvdXBzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9HUk9VUFMpO1xyXG4gICAgICAgIGNiLndyaXRlKGdyb3Vwc0NvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBzdWIgZ3JvdXBzIGNvdW50XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGdyb3Vwc1tpXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVHcm91cFBhaXIoZ3JvdXAsIHN1Ykdyb3VwMSwgc3ViR3JvdXAyLCBlbmFibGUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVWludChncm91cCwgYEludmFsaWQgZ3JvdXAgMTogJHsgZ3JvdXAgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVWludChzdWJHcm91cDEsIGBJbnZhbGlkIGdyb3VwIDE6ICR7IHN1Ykdyb3VwMSB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tVaW50KHN1Ykdyb3VwMiwgYEludmFsaWQgZ3JvdXAgMjogJHsgc3ViR3JvdXAyIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Jvb2woZW5hYmxlLCBgSW52YWxpZCB0b2dnbGUgZmxhZzogJHsgZW5hYmxlIH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX01PRElGSUVSKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX1RPR0dMRV9HUk9VUF9QQUlSKTtcclxuICAgICAgICBjYi53cml0ZShlbmFibGUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUoZ3JvdXAsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShzdWJHcm91cDEsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShzdWJHcm91cDIsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgIH0gICAgXHJcblxyXG4gICAgY2FzdFJheShvcmlnaW4sIGRpciwgY2FsbGJhY2ssIG9wdHMpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVmVjKG9yaWdpbixgSW52YWxpZCBvcmlnaW4gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tWZWMoZGlyLCBgSW52YWxpZCBkaXJlY3Rpb24gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KGNhbGxiYWNrLCAnY2FzdFJheSByZXF1aXJlcyBhIGNhbGxiYWNrIGZ1bmN0aW9uIGNhc3RSYXkob3JpZ2luLCBkaXIsIGNhbGxiYWNrLCBvcHRzKScpO1xyXG4gICAgICAgICAgICBpZiAob2sgJiYgb3B0cz8uZmlyc3RPbmx5ICE9IG51bGwpIG9rID0gRGVidWcuY2hlY2tCb29sKG9wdHMuZmlyc3RPbmx5KTtcclxuICAgICAgICAgICAgaWYgKG9rICYmIG9wdHM/LmNhbGN1bGF0ZU5vcm1hbCAhPSBudWxsKSBvayA9IERlYnVnLmNoZWNrQm9vbChvcHRzLmNhbGN1bGF0ZU5vcm1hbCk7XHJcbiAgICAgICAgICAgIGlmIChvayAmJiBvcHRzPy5pZ25vcmVCYWNrRmFjZXMgIT0gbnVsbCkgb2sgPSBEZWJ1Zy5jaGVja0Jvb2wob3B0cy5pZ25vcmVCYWNrRmFjZXMpO1xyXG4gICAgICAgICAgICBpZiAob2sgJiYgb3B0cz8udHJlYXRDb252ZXhBc1NvbGlkICE9IG51bGwpIG9rID0gRGVidWcuY2hlY2tCb29sKG9wdHMudHJlYXRDb252ZXhBc1NvbGlkKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrSW5kZXggPSB0aGlzLl9xdWVyeU1hcC5hZGQoY2FsbGJhY2spO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX1FVRVJJRVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfQ0FTVF9SQVkpO1xyXG4gICAgICAgIGNiLndyaXRlKGNhbGxiYWNrSW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShvcmlnaW4sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGRpciwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uZmlyc3RPbmx5LCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uY2FsY3VsYXRlTm9ybWFsLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uaWdub3JlQmFja0ZhY2VzLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8udHJlYXRDb252ZXhBc1NvbGlkLCBCVUZGRVJfV1JJVEVfQk9PTCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FzdFNoYXBlKHNoYXBlLCBwb3MsIHJvdCwgZGlyLCBjYWxsYmFjaywgb3B0cykge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tWZWMocG9zLCBgSW52YWxpZCBjYXN0IHNoYXBlIHBvc2l0aW9uIHZlY3RvcmApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrVmVjKGRpciwgYEludmFsaWQgY2FzdCBzaGFwZSBkaXJlY3Rpb24gdmVjdG9yYCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tRdWF0KHJvdCwgYEludmFsaWQgY2FzdCBzaGFwZSByb3RhdGlvbmApO1xyXG4gICAgICAgICAgICBpZiAoIW9rKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2IgPSB0aGlzLl9vdXRCdWZmZXI7XHJcbiAgICAgICAgY29uc3QgcXVlcnlJbmRleCA9IHRoaXMuX3F1ZXJ5TWFwLmFkZChjYWxsYmFjayk7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfUVVFUklFUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9DQVNUX1NIQVBFKTtcclxuICAgICAgICBjYi53cml0ZShxdWVyeUluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUoc2hhcGUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHBvcywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShkaXIsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LnNjYWxlLCBCVUZGRVJfV1JJVEVfVkVDMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/Lm9mZnNldCwgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5iYWNrRmFjZU1vZGVUcmlhbmdsZXMsIEJVRkZFUl9XUklURV9VSU5UOCk7XHJcbiAgICAgICAgY2Iud3JpdGUob3B0cz8uYmFja0ZhY2VNb2RlQ29udmV4LCBCVUZGRVJfV1JJVEVfVUlOVDgpO1xyXG4gICAgICAgIGNiLndyaXRlKG9wdHM/LnVzZVNocnVua2VuU2hhcGVBbmRDb252ZXhSYWRpdXMsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5yZXR1cm5EZWVwZXN0UG9pbnQsIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5maXJzdE9ubHksIEJVRkZFUl9XUklURV9CT09MKTtcclxuICAgICAgICBjYi53cml0ZShvcHRzPy5jYWxjdWxhdGVOb3JtYWwsIEJVRkZFUl9XUklURV9CT09MKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChzaGFwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX1NQSEVSRTpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKG9wdHM/LnJhZGl1cywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFNIQVBFX0JPWDpcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKG9wdHM/LmhhbGZFeHRlbnQsIEJVRkZFUl9XUklURV9WRUMzMik7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShvcHRzPy5jb252ZXhSYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBTSEFQRV9DQVBTVUxFOlxyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUob3B0cz8uaGFsZkhlaWdodCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUob3B0cz8ucmFkaXVzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgU0hBUEVfQ1lMSU5ERVI6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShvcHRzPy5oYWxmSGVpZ2h0LCBCVUZGRVJfV1JJVEVfRkxPQVQzMik7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShvcHRzPy5yYWRpdXMsIEJVRkZFUl9XUklURV9GTE9BVDMyKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKG9wdHM/LmNvbnZleFJhZGl1cywgQlVGRkVSX1dSSVRFX1ZFQzMyKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy53YXJuT25jZShgSW52YWxpZCBzaGFwZSBmb3IgY2FzdGluZzogJHsgc2hhcGUgfWApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfSAgICBcclxuXHJcbiAgICBjcmVhdGVDb25zdHJhaW50KHR5cGUsIGVudGl0eTEsIGVudGl0eTIsIG9wdHMgPSB7fSkge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuYXNzZXJ0KCEhZW50aXR5MS5jLmJvZHksIGBFbnRpdHkgaGFzIG5vIEJvZHkgQ29tcG9uZW50LiBDYW5ub3QgY3JlYXRlIGNvbnN0cmFpbnQuYCwgZW50aXR5MSk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KCEhZW50aXR5Mi5jLmJvZHksIGBFbnRpdHkgaGFzIG5vIEJvZHkgQ29tcG9uZW50LiBDYW5ub3QgY3JlYXRlIGNvbnN0cmFpbnQuYCwgZW50aXR5Mik7XHJcbiAgICAgICAgICAgIGlmICghb2spIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fY29uc3RyYWludE1hcC5hZGQoeyBlbnRpdHkxLCBlbnRpdHkyIH0pO1xyXG5cclxuICAgICAgICBlbnRpdHkxLmJvZHkuY29uc3RyYWludHMuc2V0KGluZGV4LCBlbnRpdHkyKTtcclxuICAgICAgICBlbnRpdHkyLmJvZHkuY29uc3RyYWludHMuc2V0KGluZGV4LCBlbnRpdHkxKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9DUkVBVE9SKTtcclxuICAgICAgICBjYi53cml0ZUNvbW1hbmQoQ01EX0NSRUFURV9DT05TVFJBSU5UKTtcclxuICAgICAgICBjYi53cml0ZSh0eXBlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUoaW5kZXgsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZShlbnRpdHkxLmMuYm9keS5pbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGVudGl0eTIuYy5ib2R5LmluZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9GSVhFRDpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlRml4ZWRDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfUE9JTlQ6XHJcbiAgICAgICAgICAgICAgICBKb2x0TWFuYWdlci53cml0ZVBvaW50Q29uc3RyYWludChjYiwgb3B0cyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ09OU1RSQUlOVF9UWVBFX0RJU1RBTkNFOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVEaXN0YW5jZUNvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9ISU5HRTpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlSGluZ2VDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfU0xJREVSOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTbGlkZXJDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBDT05TVFJBSU5UX1RZUEVfQ09ORTpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlQ29uZUNvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TV0lOR19UV0lTVDpcclxuICAgICAgICAgICAgICAgIEpvbHRNYW5hZ2VyLndyaXRlU3dpbmdUd2lzdENvbnN0cmFpbnQoY2IsIG9wdHMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENPTlNUUkFJTlRfVFlQRV9TSVhfRE9GOlxyXG4gICAgICAgICAgICAgICAgSm9sdE1hbmFnZXIud3JpdGVTaXhEb2ZDb25zdHJhaW50KGNiLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIERlYnVnLmRldiAmJiBEZWJ1Zy5lcnJvcihgVW5yZWNvZ25pemVkIGNvbnN0cmFpbnQgdHlwZTogJHsgdHlwZSB9YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZShvcHRzLm51bVZlbG9jaXR5U3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQ4KTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLm51bVBvc2l0aW9uU3RlcHNPdmVycmlkZSwgQlVGRkVSX1dSSVRFX1VJTlQ4KTtcclxuICAgICAgICBjYi53cml0ZShvcHRzLnNwYWNlLCBCVUZGRVJfV1JJVEVfVUlOVDgpO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveUNvbnN0cmFpbnQoaW5kZXgpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9rID0gRGVidWcuY2hlY2tVaW50KGluZGV4LCBgSW52YWxpZCBpbmRleCBvZiBhIGNvbnN0cmFpbnQgdHJ5aW5nIHRvIGRlc3Ryb3k6ICR7IGluZGV4IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNiID0gdGhpcy5fb3V0QnVmZmVyO1xyXG5cclxuICAgICAgICBjYi53cml0ZU9wZXJhdG9yKE9QRVJBVE9SX0NMRUFORVIpO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChDTURfREVTVFJPWV9DT05TVFJBSU5UKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLmZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpIHtcclxuICAgICAgICB0aGlzLl9jb25zdHJhaW50TWFwLmZyZWUoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbnN0cmFpbnRFbmFibGVkKGluZGV4LCBlbmFibGVkLCBhY3RpdmF0ZSA9IHRydWUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrVWludChpbmRleCwgYEludmFsaWQgY29uc3RyYWludCBpbmRleDogJHsgaW5kZXggfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrQm9vbChlbmFibGVkLCBgSW52YWxpZCBjb25zdHJhaW50IGVuYWJsZSBib29sOiAkeyBlbmFibGVkIH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Jvb2woZW5hYmxlZCwgYEludmFsaWQgYWN0aXZhdGUgYm9vbDogJHsgZW5hYmxlZCB9YCk7XHJcbiAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX291dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihPUEVSQVRPUl9NT0RJRklFUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9TRVRfQ09OU1RSQUlOVF9FTkFCTEVEKTtcclxuICAgICAgICBjYi53cml0ZShpbmRleCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKGVuYWJsZWQsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUoYWN0aXZhdGUsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEpvbHRNYW5hZ2VyIH07XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/manager.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/response-handler.mjs":
/*!**********************************************************!*\
  !*** ./src/physics/components/jolt/response-handler.mjs ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ResponseHandler: () => (/* binding */ ResponseHandler)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\nclass ContactResult {\r\n    constructor(entity, normal, depth, point = null, offset = null, points1 = null, points2 = null) {\r\n        this.entity = entity;\r\n        this.normal = normal;\r\n        this.penetrationDepth = depth;\r\n        if (point) this.point = point;\r\n        if (offset) this.offset = offset;\r\n        if (points1) this.points1 = points1;\r\n        if (points2) this.points2 = points2;\r\n    }\r\n}\r\n\r\nclass CharContactResult {\r\n    constructor(entity, contactPosition, contactNormal, contactVelocity, newCharVelocity) {\r\n        this.entity = entity;\r\n        this.contactPosition = contactPosition;\r\n        this.contactNormal = contactNormal;\r\n        this.contactVelocity = contactVelocity;\r\n        this.newCharVelocity = newCharVelocity;\r\n    }\r\n}\r\n\r\nclass RaycastResult {\r\n    constructor(entity, point, normal) {\r\n        this.entity = entity;\r\n        this.point = point;\r\n        if (normal) {\r\n            this.normal = normal;\r\n        }\r\n    }\r\n}\r\n\r\nclass ResponseHandler {\r\n    static handleContact(cb, map) {\r\n        const count = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const type = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT8);\r\n            const isValidBody1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n            const isValidBody2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n\r\n            let idx1 = null;\r\n            if (isValidBody1) {\r\n                idx1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            }\r\n\r\n            let idx2 = null;\r\n            if (isValidBody2) {\r\n                idx2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            }\r\n\r\n            const entity1 = map.get(idx1);\r\n            const entity2 = map.get(idx2);\r\n\r\n            switch (type) {\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_ADDED: {\r\n                    const normal = pc.Vec3.fromBuffer(cb);\r\n                    const depth = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n                    const contactPoints = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n                    let point, points1, points2, offset;\r\n\r\n                    if (contactPoints) {\r\n                        const averaged = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n\r\n                        if (averaged) {\r\n                            point = pc.Vec3.fromBuffer(cb);\r\n                        } else {\r\n                            offset = pc.Vec3.fromBuffer(cb);\r\n                            const count1 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n                            const count2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n                            points1 = [];\r\n                            points2 = [];\r\n                            for (let i = 0; i < count1; i++) {\r\n                                points1.push(pc.Vec3.fromBuffer(cb));\r\n                            }\r\n                            for (let i = 0; i < count2; i++) {\r\n                                points2.push(pc.Vec3.fromBuffer(cb));\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    const event = 'contact:added';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        const contactResult = new ContactResult(entity2, normal, depth, point, offset, points1, points2);\r\n                        entity1.fire(event, contactResult);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        const contactResult = new ContactResult(entity1, normal, depth, point, offset, points1, points2);\r\n                        entity2.fire(event, contactResult);\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_PERSISTED: {\r\n                    const event = 'contact:persisted';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        entity1.fire(event, entity2);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        entity2.fire(event, entity1);\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                case _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.CONTACT_TYPE_REMOVED: {\r\n                    const event = 'contact:removed';\r\n                    if (entity1?.hasEvent(event)) {\r\n                        entity1.fire(event, entity2);\r\n                    }\r\n                    if (entity2?.hasEvent(event)) {\r\n                        entity2.fire(event, entity1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static handleCharContacts(cb, map) {\r\n        const charsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n        for (let c = 0; c < charsCount; c++) {\r\n            const charIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            const contactsCount = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n            const charEntity = map.get(charIndex);\r\n            const results = [];\r\n\r\n            if (!charEntity.hasEvent('contact:char')) {\r\n                cb.skip(1 * contactsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.UINT8_SIZE);\r\n                cb.skip(13 * contactsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n                continue;\r\n            }\r\n\r\n            for (let i = 0; i < contactsCount; i++) {\r\n                const isValidBody2 = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_BOOL);\r\n                const otherIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n                let otherEntity = null;\r\n                if (isValidBody2) {\r\n                    otherEntity = map.get(otherIndex) || null;\r\n                }\r\n    \r\n                const cp = pc.Vec3.fromBuffer(cb); // contact position\r\n                const cn = pc.Vec3.fromBuffer(cb); // contact normal\r\n                const cv = pc.Vec3.fromBuffer(cb); // contact velocity\r\n                const nv = pc.Vec3.fromBuffer(cb); // new char velocity\r\n    \r\n                const result = new CharContactResult(otherEntity, cp, cn, cv, nv);    \r\n                results.push(result);\r\n            }\r\n\r\n            charEntity.fire('contact:char', results);\r\n        }\r\n    }\r\n\r\n    static handleQuery(buffer, entityMap, queryMap) {\r\n        const results = [];\r\n\r\n        const queryIndex = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16);\r\n        const hitsCount = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT16);\r\n\r\n        for (let i = 0; i < hitsCount; i++) {\r\n            const bodyIndex = buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n\r\n            const point = new pc.Vec3(\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n\r\n            let normal;\r\n            if (buffer.flag) {\r\n                normal = new pc.Vec3(\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    buffer.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n            }\r\n\r\n            const entity = entityMap.get(bodyIndex);\r\n            if (!entity) {\r\n                // Entity could have been deleted by the time the raycast result arrived.\r\n                // We just ignore this result then.\r\n                continue;\r\n            }\r\n\r\n            results.push(new RaycastResult(entity, point, normal));\r\n        }\r\n\r\n        const callback = queryMap.get(queryIndex);\r\n        queryMap.free(queryIndex);\r\n        callback?.(results);\r\n    }\r\n\r\n    static handleCharSetShape(cb, queryMap) {\r\n        const cbIndex = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n        const callback = queryMap.get(cbIndex);\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && !callback) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn(`Unable to locate callback with index: ${ cbIndex }`);\r\n            return;\r\n        }\r\n\r\n        queryMap.free(cbIndex);\r\n        callback();\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvcmVzcG9uc2UtaGFuZGxlci5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvcmVzcG9uc2UtaGFuZGxlci5tanM/ODYzNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHtcclxuICAgIENPTlRBQ1RfVFlQRV9BRERFRCwgQ09OVEFDVF9UWVBFX1BFUlNJU1RFRCwgQ09OVEFDVF9UWVBFX1JFTU9WRUQsXHJcbiAgICBCVUZGRVJfUkVBRF9CT09MLCBCVUZGRVJfUkVBRF9GTE9BVDMyLCBCVUZGRVJfUkVBRF9VSU5UMTYsXHJcbiAgICBCVUZGRVJfUkVBRF9VSU5UMzIsIEJVRkZFUl9SRUFEX1VJTlQ4LCBGTE9BVDMyX1NJWkUsIFVJTlQ4X1NJWkVcclxufSBmcm9tIFwiLi9jb25zdGFudHMubWpzXCI7XHJcblxyXG5jbGFzcyBDb250YWN0UmVzdWx0IHtcclxuICAgIGNvbnN0cnVjdG9yKGVudGl0eSwgbm9ybWFsLCBkZXB0aCwgcG9pbnQgPSBudWxsLCBvZmZzZXQgPSBudWxsLCBwb2ludHMxID0gbnVsbCwgcG9pbnRzMiA9IG51bGwpIHtcclxuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICB0aGlzLm5vcm1hbCA9IG5vcm1hbDtcclxuICAgICAgICB0aGlzLnBlbmV0cmF0aW9uRGVwdGggPSBkZXB0aDtcclxuICAgICAgICBpZiAocG9pbnQpIHRoaXMucG9pbnQgPSBwb2ludDtcclxuICAgICAgICBpZiAob2Zmc2V0KSB0aGlzLm9mZnNldCA9IG9mZnNldDtcclxuICAgICAgICBpZiAocG9pbnRzMSkgdGhpcy5wb2ludHMxID0gcG9pbnRzMTtcclxuICAgICAgICBpZiAocG9pbnRzMikgdGhpcy5wb2ludHMyID0gcG9pbnRzMjtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQ2hhckNvbnRhY3RSZXN1bHQge1xyXG4gICAgY29uc3RydWN0b3IoZW50aXR5LCBjb250YWN0UG9zaXRpb24sIGNvbnRhY3ROb3JtYWwsIGNvbnRhY3RWZWxvY2l0eSwgbmV3Q2hhclZlbG9jaXR5KSB7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICAgICAgdGhpcy5jb250YWN0UG9zaXRpb24gPSBjb250YWN0UG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5jb250YWN0Tm9ybWFsID0gY29udGFjdE5vcm1hbDtcclxuICAgICAgICB0aGlzLmNvbnRhY3RWZWxvY2l0eSA9IGNvbnRhY3RWZWxvY2l0eTtcclxuICAgICAgICB0aGlzLm5ld0NoYXJWZWxvY2l0eSA9IG5ld0NoYXJWZWxvY2l0eTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUmF5Y2FzdFJlc3VsdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbnRpdHksIHBvaW50LCBub3JtYWwpIHtcclxuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICB0aGlzLnBvaW50ID0gcG9pbnQ7XHJcbiAgICAgICAgaWYgKG5vcm1hbCkge1xyXG4gICAgICAgICAgICB0aGlzLm5vcm1hbCA9IG5vcm1hbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFJlc3BvbnNlSGFuZGxlciB7XHJcbiAgICBzdGF0aWMgaGFuZGxlQ29udGFjdChjYiwgbWFwKSB7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UOCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRCb2R5MSA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRCb2R5MiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgaWR4MSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQm9keTEpIHtcclxuICAgICAgICAgICAgICAgIGlkeDEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBpZHgyID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKGlzVmFsaWRCb2R5Mikge1xyXG4gICAgICAgICAgICAgICAgaWR4MiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgZW50aXR5MSA9IG1hcC5nZXQoaWR4MSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eTIgPSBtYXAuZ2V0KGlkeDIpO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIENPTlRBQ1RfVFlQRV9BRERFRDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IHBjLlZlYzMuZnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVwdGggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhY3RQb2ludHMgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX0JPT0wpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwb2ludCwgcG9pbnRzMSwgcG9pbnRzMiwgb2Zmc2V0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdFBvaW50cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdmVyYWdlZCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXZlcmFnZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ID0gcGMuVmVjMy5mcm9tQnVmZmVyKGNiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IHBjLlZlYzMuZnJvbUJ1ZmZlcihjYik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudDEgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudDIgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMxID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMyID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50MTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzMS5wdXNoKHBjLlZlYzMuZnJvbUJ1ZmZlcihjYikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDI7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50czIucHVzaChwYy5WZWMzLmZyb21CdWZmZXIoY2IpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSAnY29udGFjdDphZGRlZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eTE/Lmhhc0V2ZW50KGV2ZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWN0UmVzdWx0ID0gbmV3IENvbnRhY3RSZXN1bHQoZW50aXR5Miwgbm9ybWFsLCBkZXB0aCwgcG9pbnQsIG9mZnNldCwgcG9pbnRzMSwgcG9pbnRzMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eTEuZmlyZShldmVudCwgY29udGFjdFJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkyPy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGFjdFJlc3VsdCA9IG5ldyBDb250YWN0UmVzdWx0KGVudGl0eTEsIG5vcm1hbCwgZGVwdGgsIHBvaW50LCBvZmZzZXQsIHBvaW50czEsIHBvaW50czIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkyLmZpcmUoZXZlbnQsIGNvbnRhY3RSZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIENPTlRBQ1RfVFlQRV9QRVJTSVNURUQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9ICdjb250YWN0OnBlcnNpc3RlZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eTE/Lmhhc0V2ZW50KGV2ZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkxLmZpcmUoZXZlbnQsIGVudGl0eTIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5Mj8uaGFzRXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eTIuZmlyZShldmVudCwgZW50aXR5MSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQ09OVEFDVF9UWVBFX1JFTU9WRUQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9ICdjb250YWN0OnJlbW92ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkxPy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5MS5maXJlKGV2ZW50LCBlbnRpdHkyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eTI/Lmhhc0V2ZW50KGV2ZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkyLmZpcmUoZXZlbnQsIGVudGl0eTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaGFuZGxlQ2hhckNvbnRhY3RzKGNiLCBtYXApIHtcclxuICAgICAgICBjb25zdCBjaGFyc0NvdW50ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGNoYXJzQ291bnQ7IGMrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjaGFySW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhY3RzQ291bnQgPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYXJFbnRpdHkgPSBtYXAuZ2V0KGNoYXJJbmRleCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY2hhckVudGl0eS5oYXNFdmVudCgnY29udGFjdDpjaGFyJykpIHtcclxuICAgICAgICAgICAgICAgIGNiLnNraXAoMSAqIGNvbnRhY3RzQ291bnQsIFVJTlQ4X1NJWkUpO1xyXG4gICAgICAgICAgICAgICAgY2Iuc2tpcCgxMyAqIGNvbnRhY3RzQ291bnQsIEZMT0FUMzJfU0laRSk7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb250YWN0c0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzVmFsaWRCb2R5MiA9IGNiLnJlYWQoQlVGRkVSX1JFQURfQk9PTCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckluZGV4ID0gY2IucmVhZChCVUZGRVJfUkVBRF9VSU5UMzIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvdGhlckVudGl0eSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNWYWxpZEJvZHkyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXJFbnRpdHkgPSBtYXAuZ2V0KG90aGVySW5kZXgpIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNwID0gcGMuVmVjMy5mcm9tQnVmZmVyKGNiKTsgLy8gY29udGFjdCBwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgY29uc3QgY24gPSBwYy5WZWMzLmZyb21CdWZmZXIoY2IpOyAvLyBjb250YWN0IG5vcm1hbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3YgPSBwYy5WZWMzLmZyb21CdWZmZXIoY2IpOyAvLyBjb250YWN0IHZlbG9jaXR5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBudiA9IHBjLlZlYzMuZnJvbUJ1ZmZlcihjYik7IC8vIG5ldyBjaGFyIHZlbG9jaXR5XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBDaGFyQ29udGFjdFJlc3VsdChvdGhlckVudGl0eSwgY3AsIGNuLCBjdiwgbnYpOyAgICBcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjaGFyRW50aXR5LmZpcmUoJ2NvbnRhY3Q6Y2hhcicsIHJlc3VsdHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaGFuZGxlUXVlcnkoYnVmZmVyLCBlbnRpdHlNYXAsIHF1ZXJ5TWFwKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdCBxdWVyeUluZGV4ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfVUlOVDE2KTtcclxuICAgICAgICBjb25zdCBoaXRzQ291bnQgPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9VSU5UMTYpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHlJbmRleCA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwb2ludCA9IG5ldyBwYy5WZWMzKFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBsZXQgbm9ybWFsO1xyXG4gICAgICAgICAgICBpZiAoYnVmZmVyLmZsYWcpIHtcclxuICAgICAgICAgICAgICAgIG5vcm1hbCA9IG5ldyBwYy5WZWMzKFxyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBlbnRpdHlNYXAuZ2V0KGJvZHlJbmRleCk7XHJcbiAgICAgICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBFbnRpdHkgY291bGQgaGF2ZSBiZWVuIGRlbGV0ZWQgYnkgdGhlIHRpbWUgdGhlIHJheWNhc3QgcmVzdWx0IGFycml2ZWQuXHJcbiAgICAgICAgICAgICAgICAvLyBXZSBqdXN0IGlnbm9yZSB0aGlzIHJlc3VsdCB0aGVuLlxyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChuZXcgUmF5Y2FzdFJlc3VsdChlbnRpdHksIHBvaW50LCBub3JtYWwpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrID0gcXVlcnlNYXAuZ2V0KHF1ZXJ5SW5kZXgpO1xyXG4gICAgICAgIHF1ZXJ5TWFwLmZyZWUocXVlcnlJbmRleCk7XHJcbiAgICAgICAgY2FsbGJhY2s/LihyZXN1bHRzKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaGFuZGxlQ2hhclNldFNoYXBlKGNiLCBxdWVyeU1hcCkge1xyXG4gICAgICAgIGNvbnN0IGNiSW5kZXggPSBjYi5yZWFkKEJVRkZFUl9SRUFEX1VJTlQzMik7XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBxdWVyeU1hcC5nZXQoY2JJbmRleCk7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYgJiYgIWNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm4oYFVuYWJsZSB0byBsb2NhdGUgY2FsbGJhY2sgd2l0aCBpbmRleDogJHsgY2JJbmRleCB9YCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHF1ZXJ5TWFwLmZyZWUoY2JJbmRleCk7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgUmVzcG9uc2VIYW5kbGVyIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/response-handler.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/softbody/component.mjs":
/*!************************************************************!*\
  !*** ./src/physics/components/jolt/softbody/component.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SoftBodyComponent: () => (/* binding */ SoftBodyComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../component.mjs */ \"./src/physics/components/jolt/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\n\r\nclass SoftBodyComponent extends _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponent {\r\n    // amount of substance * ideal gass constant * absolute temperature\r\n    // n * R * T\r\n    // see https://en.wikipedia.org/wiki/Pressure\r\n    _pressure = 0;\r\n\r\n    // Update the position of the body while simulating (set to false for something\r\n    // that is attached to the static world)\r\n    _updatePosition = true;\r\n\r\n    // Bake specified mRotation in the vertices and set the body rotation to identity (simulation is slightly more accurate if the rotation of a soft body is kept to identity)\r\n    _makeRotationIdentity = true;\r\n\r\n    // Number of solver iterations\r\n    _numIterations = 5;\r\n\r\n    // Inverse of the stiffness of the spring.\r\n    _compliance = 0;\r\n\r\n    // Number of cells comprising a row. Think of a grid divided plane.\r\n    _width = 0;\r\n\r\n    // Number of cells comprising a column. Think of a grid divided plane.\r\n    _length = 0;\r\n\r\n    _fixedIndices = [];\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    writeComponentData(cb) {\r\n        this._writeShapeData(cb, this);\r\n\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n\r\n        // We always use world position and rotation from the current entity the component\r\n        // is attached to (instead of default zero vectors)\r\n        const entity = this.entity;\r\n        const pos = entity.getPosition();\r\n        const rot = entity.getRotation();\r\n\r\n        // TODO\r\n        // get rid of flags\r\n\r\n        // Loss of precision for pos/rot (64 -> 32)\r\n        cb.write(pos, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(rot, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n\r\n        cb.write(this._collisionGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32);\r\n        cb.write(this._subGroup, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32);\r\n\r\n        cb.write(this._objectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._numIterations, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._linearDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxLinearVelocity, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._restitution, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._friction, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._pressure, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._gravityFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._updatePosition, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._makeRotationIdentity, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        cb.write(this._allowSleeping, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n\r\n        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && cb.write(this._debugDraw, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n    }\r\n\r\n    onEnable() {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            if (!this._renderAsset && !this._meshes) {\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Unable to locate mesh data for a soft body', this);\r\n                return;\r\n            }\r\n        }\r\n\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        if (this._renderAsset && !this._meshes) {\r\n            this._addMeshes();\r\n        } else {\r\n            system.createBody(this);\r\n        }\r\n    }\r\n\r\n    _writeShapeData(cb) {\r\n        let useEntityScale = this._useEntityScale;\r\n        let scale;\r\n        if (useEntityScale) {\r\n            scale = this.entity.getLocalScale();\r\n            if (scale.x === 1 && scale.y === 1 && scale.z === 1) {\r\n                useEntityScale = false;\r\n            }\r\n        }\r\n\r\n        cb.write(useEntityScale, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_BOOL, false);\r\n        if (useEntityScale) {\r\n            // Potential precision loss 64 -> 32\r\n            cb.write(scale, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_VEC32, false);\r\n        }\r\n    \r\n        _component_mjs__WEBPACK_IMPORTED_MODULE_2__.ShapeComponent.addMeshes(this._meshes, cb);\r\n\r\n        cb.write(this._width, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._length, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(this._compliance, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        const fixed = this._fixedIndices;\r\n        const count = fixed.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        for (let i = 0; i < count; i++) {\r\n            cb.write(fixed[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_3__.BUFFER_WRITE_UINT32, false);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvY29tcG9uZW50Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvY29tcG9uZW50Lm1qcz8wOGJjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCb2R5Q29tcG9uZW50IH0gZnJvbSBcIi4uL2JvZHkvY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUNvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnQubWpzXCI7XHJcbmltcG9ydCB7IEJVRkZFUl9XUklURV9CT09MLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgQlVGRkVSX1dSSVRFX1VJTlQxNiwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgQlVGRkVSX1dSSVRFX1ZFQzMyIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5tanNcIjtcclxuXHJcbmNsYXNzIFNvZnRCb2R5Q29tcG9uZW50IGV4dGVuZHMgQm9keUNvbXBvbmVudCB7XHJcbiAgICAvLyBhbW91bnQgb2Ygc3Vic3RhbmNlICogaWRlYWwgZ2FzcyBjb25zdGFudCAqIGFic29sdXRlIHRlbXBlcmF0dXJlXHJcbiAgICAvLyBuICogUiAqIFRcclxuICAgIC8vIHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QcmVzc3VyZVxyXG4gICAgX3ByZXNzdXJlID0gMDtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5IHdoaWxlIHNpbXVsYXRpbmcgKHNldCB0byBmYWxzZSBmb3Igc29tZXRoaW5nXHJcbiAgICAvLyB0aGF0IGlzIGF0dGFjaGVkIHRvIHRoZSBzdGF0aWMgd29ybGQpXHJcbiAgICBfdXBkYXRlUG9zaXRpb24gPSB0cnVlO1xyXG5cclxuICAgIC8vIEJha2Ugc3BlY2lmaWVkIG1Sb3RhdGlvbiBpbiB0aGUgdmVydGljZXMgYW5kIHNldCB0aGUgYm9keSByb3RhdGlvbiB0byBpZGVudGl0eSAoc2ltdWxhdGlvbiBpcyBzbGlnaHRseSBtb3JlIGFjY3VyYXRlIGlmIHRoZSByb3RhdGlvbiBvZiBhIHNvZnQgYm9keSBpcyBrZXB0IHRvIGlkZW50aXR5KVxyXG4gICAgX21ha2VSb3RhdGlvbklkZW50aXR5ID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBOdW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnNcclxuICAgIF9udW1JdGVyYXRpb25zID0gNTtcclxuXHJcbiAgICAvLyBJbnZlcnNlIG9mIHRoZSBzdGlmZm5lc3Mgb2YgdGhlIHNwcmluZy5cclxuICAgIF9jb21wbGlhbmNlID0gMDtcclxuXHJcbiAgICAvLyBOdW1iZXIgb2YgY2VsbHMgY29tcHJpc2luZyBhIHJvdy4gVGhpbmsgb2YgYSBncmlkIGRpdmlkZWQgcGxhbmUuXHJcbiAgICBfd2lkdGggPSAwO1xyXG5cclxuICAgIC8vIE51bWJlciBvZiBjZWxscyBjb21wcmlzaW5nIGEgY29sdW1uLiBUaGluayBvZiBhIGdyaWQgZGl2aWRlZCBwbGFuZS5cclxuICAgIF9sZW5ndGggPSAwO1xyXG5cclxuICAgIF9maXhlZEluZGljZXMgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzeXN0ZW0sIGVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKHN5c3RlbSwgZW50aXR5KTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZUNvbXBvbmVudERhdGEoY2IpIHtcclxuICAgICAgICB0aGlzLl93cml0ZVNoYXBlRGF0YShjYiwgdGhpcyk7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIFdlIGFsd2F5cyB1c2Ugd29ybGQgcG9zaXRpb24gYW5kIHJvdGF0aW9uIGZyb20gdGhlIGN1cnJlbnQgZW50aXR5IHRoZSBjb21wb25lbnRcclxuICAgICAgICAvLyBpcyBhdHRhY2hlZCB0byAoaW5zdGVhZCBvZiBkZWZhdWx0IHplcm8gdmVjdG9ycylcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eTtcclxuICAgICAgICBjb25zdCBwb3MgPSBlbnRpdHkuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICBjb25zdCByb3QgPSBlbnRpdHkuZ2V0Um90YXRpb24oKTtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGdldCByaWQgb2YgZmxhZ3NcclxuXHJcbiAgICAgICAgLy8gTG9zcyBvZiBwcmVjaXNpb24gZm9yIHBvcy9yb3QgKDY0IC0+IDMyKVxyXG4gICAgICAgIGNiLndyaXRlKHBvcywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUocm90LCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY29sbGlzaW9uR3JvdXAsIEJVRkZFUl9XUklURV9VSU5UMzIpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3N1Ykdyb3VwLCBCVUZGRVJfV1JJVEVfVUlOVDMyKTtcclxuXHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fb2JqZWN0TGF5ZXIsIEJVRkZFUl9XUklURV9VSU5UMTYsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9udW1JdGVyYXRpb25zLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbGluZWFyRGFtcGluZywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tYXhMaW5lYXJWZWxvY2l0eSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9yZXN0aXR1dGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9mcmljdGlvbiwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9wcmVzc3VyZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9ncmF2aXR5RmFjdG9yLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3VwZGF0ZVBvc2l0aW9uLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21ha2VSb3RhdGlvbklkZW50aXR5LCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2FsbG93U2xlZXBpbmcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIERlYnVnLmRldiAmJiBjYi53cml0ZSh0aGlzLl9kZWJ1Z0RyYXcsIEJVRkZFUl9XUklURV9CT09MLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25FbmFibGUoKSB7XHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3JlbmRlckFzc2V0ICYmICF0aGlzLl9tZXNoZXMpIHtcclxuICAgICAgICAgICAgICAgIERlYnVnLndhcm4oJ1VuYWJsZSB0byBsb2NhdGUgbWVzaCBkYXRhIGZvciBhIHNvZnQgYm9keScsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLnN5c3RlbTtcclxuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSBzeXN0ZW0uZ2V0SW5kZXgodGhpcy5lbnRpdHkpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcmVuZGVyQXNzZXQgJiYgIXRoaXMuX21lc2hlcykge1xyXG4gICAgICAgICAgICB0aGlzLl9hZGRNZXNoZXMoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzeXN0ZW0uY3JlYXRlQm9keSh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3dyaXRlU2hhcGVEYXRhKGNiKSB7XHJcbiAgICAgICAgbGV0IHVzZUVudGl0eVNjYWxlID0gdGhpcy5fdXNlRW50aXR5U2NhbGU7XHJcbiAgICAgICAgbGV0IHNjYWxlO1xyXG4gICAgICAgIGlmICh1c2VFbnRpdHlTY2FsZSkge1xyXG4gICAgICAgICAgICBzY2FsZSA9IHRoaXMuZW50aXR5LmdldExvY2FsU2NhbGUoKTtcclxuICAgICAgICAgICAgaWYgKHNjYWxlLnggPT09IDEgJiYgc2NhbGUueSA9PT0gMSAmJiBzY2FsZS56ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB1c2VFbnRpdHlTY2FsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZSh1c2VFbnRpdHlTY2FsZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuICAgICAgICBpZiAodXNlRW50aXR5U2NhbGUpIHtcclxuICAgICAgICAgICAgLy8gUG90ZW50aWFsIHByZWNpc2lvbiBsb3NzIDY0IC0+IDMyXHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNjYWxlLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBTaGFwZUNvbXBvbmVudC5hZGRNZXNoZXModGhpcy5fbWVzaGVzLCBjYik7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3dpZHRoLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVuZ3RoLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY29tcGxpYW5jZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLl9maXhlZEluZGljZXM7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBmaXhlZC5sZW5ndGg7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKGZpeGVkW2ldLCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgU29mdEJvZHlDb21wb25lbnQgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/softbody/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/softbody/system.mjs":
/*!*********************************************************!*\
  !*** ./src/physics/components/jolt/softbody/system.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SoftBodyComponentSystem: () => (/* binding */ SoftBodyComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/softbody/component.mjs\");\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    // Component\r\n    'enabled',\r\n    'debugDraw',\r\n    'renderAsset',\r\n    'meshes',\r\n    'useEntityScale',\r\n\r\n    // Soft Body\r\n\t'position',\r\n\t'rotation',\r\n\t'objectLayer',\r\n\t'collisionGroup',\r\n    'subGroup',\r\n\t'numIterations',\r\n\t'linearDamping',\r\n\t'maxLinearVelocity',\r\n\t'restitution',\r\n\t'friction',\r\n\t'pressure',\r\n\t'gravityFactor',\r\n\t'updatePosition',\r\n\t'makeRotationIdentity',\r\n    'allowSleeping',\r\n\r\n    // Shape Data\r\n    'width',\r\n    'length',\r\n    'fixedIndices',\r\n    'compliance'\r\n];\r\n\r\nclass SoftBodyComponentSystem extends _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponentSystem {\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'softbody';\r\n        this.schema = schema;\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_3__.SoftBodyComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    createBody(component) {\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_SOFT_BODY);\r\n\r\n        component.writeComponentData(cb);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc29mdGJvZHkvc3lzdGVtLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3NvZnRib2R5L3N5c3RlbS5tanM/NjdhMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZEFjY2Vzc29ycyB9IGZyb20gXCIuLi8uLi8uLi91dGlsLm1qc1wiO1xyXG5pbXBvcnQgeyBCb2R5Q29tcG9uZW50U3lzdGVtIH0gZnJvbSBcIi4uL2JvZHkvc3lzdGVtLm1qc1wiO1xyXG5pbXBvcnQgeyBDTURfQ1JFQVRFX1NPRlRfQk9EWSwgT1BFUkFUT1JfQ1JFQVRPUiB9IGZyb20gXCIuLi9jb25zdGFudHMubWpzXCI7XHJcbmltcG9ydCB7IFNvZnRCb2R5Q29tcG9uZW50IH0gZnJvbSBcIi4vY29tcG9uZW50Lm1qc1wiO1xyXG5cclxuY29uc3Qgc2NoZW1hID0gW1xyXG4gICAgLy8gQ29tcG9uZW50XHJcbiAgICAnZW5hYmxlZCcsXHJcbiAgICAnZGVidWdEcmF3JyxcclxuICAgICdyZW5kZXJBc3NldCcsXHJcbiAgICAnbWVzaGVzJyxcclxuICAgICd1c2VFbnRpdHlTY2FsZScsXHJcblxyXG4gICAgLy8gU29mdCBCb2R5XHJcblx0J3Bvc2l0aW9uJyxcclxuXHQncm90YXRpb24nLFxyXG5cdCdvYmplY3RMYXllcicsXHJcblx0J2NvbGxpc2lvbkdyb3VwJyxcclxuICAgICdzdWJHcm91cCcsXHJcblx0J251bUl0ZXJhdGlvbnMnLFxyXG5cdCdsaW5lYXJEYW1waW5nJyxcclxuXHQnbWF4TGluZWFyVmVsb2NpdHknLFxyXG5cdCdyZXN0aXR1dGlvbicsXHJcblx0J2ZyaWN0aW9uJyxcclxuXHQncHJlc3N1cmUnLFxyXG5cdCdncmF2aXR5RmFjdG9yJyxcclxuXHQndXBkYXRlUG9zaXRpb24nLFxyXG5cdCdtYWtlUm90YXRpb25JZGVudGl0eScsXHJcbiAgICAnYWxsb3dTbGVlcGluZycsXHJcblxyXG4gICAgLy8gU2hhcGUgRGF0YVxyXG4gICAgJ3dpZHRoJyxcclxuICAgICdsZW5ndGgnLFxyXG4gICAgJ2ZpeGVkSW5kaWNlcycsXHJcbiAgICAnY29tcGxpYW5jZSdcclxuXTtcclxuXHJcbmNsYXNzIFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQm9keUNvbXBvbmVudFN5c3RlbSB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIG1hbmFnZXIsIGlkKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBtYW5hZ2VyKTtcclxuXHJcbiAgICAgICAgdGhpcy5pZCA9ICdzb2Z0Ym9keSc7XHJcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XHJcbiAgICAgICAgdGhpcy5Db21wb25lbnRUeXBlID0gU29mdEJvZHlDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIG1hbmFnZXIuc3lzdGVtcy5zZXQoaWQsIHRoaXMpO1xyXG5cclxuICAgICAgICBidWlsZEFjY2Vzc29ycyh0aGlzLCB0aGlzLnNjaGVtYSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQm9keShjb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX21hbmFnZXIuY29tbWFuZHNCdWZmZXI7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfQ1JFQVRPUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9DUkVBVEVfU09GVF9CT0RZKTtcclxuXHJcbiAgICAgICAgY29tcG9uZW50LndyaXRlQ29tcG9uZW50RGF0YShjYik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/softbody/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/system.mjs":
/*!************************************************!*\
  !*** ./src/physics/components/jolt/system.mjs ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ShapeComponentSystem: () => (/* binding */ ShapeComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\n\r\n// TODO\r\n// convert to statics\r\nconst entityMap = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_0__.IndexedCache();\r\nconst quat = new pc.Quat();\r\nlet v1, v2, v3;\r\n\r\nfunction getColor(type, config) {\r\n    switch (type) {\r\n        case pc.JOLT_MOTION_TYPE_STATIC:\r\n            return config.debugColorStatic;\r\n        case pc.JOLT_MOTION_TYPE_KINEMATIC:\r\n            return config.debugColorKinematic;\r\n        case pc.JOLT_MOTION_TYPE_DYNAMIC:\r\n            return config.debugColorDynamic;\r\n        default:\r\n            return pc.Color.WHITE;\r\n    }\r\n}\r\n\r\nclass ShapeComponentSystem extends pc.ComponentSystem {\r\n    constructor(app, manager) {\r\n        super();\r\n\r\n        this.app = app;\r\n\r\n        // The store where all ComponentData objects are kept\r\n        this.store = {};\r\n        this.schema = [\r\n            // component\r\n            'enabled',\r\n            'index',\r\n            'trackDynamic',\r\n            'renderAsset',\r\n            'meshes',\r\n            'isCompoundChild',\r\n            'useEntityScale',\r\n            'useMotionState',\r\n            'debugDraw',\r\n\r\n            // Jolt shape\r\n            'shape',\r\n            'halfExtent',\r\n            'radius',\r\n            'convexRadius',\r\n            'halfHeight',\r\n            'density',\r\n            'shapePosition',\r\n            'shapeRotation',\r\n            'massOffset',\r\n            'hfScale',\r\n            'hfOffset',\r\n            'hfSamples',\r\n            'hfSampleCount',\r\n            'hfBlockSize',\r\n            'hfBitsPerSample',\r\n            'hfActiveEdgeCosThresholdAngle'\r\n        ];\r\n\r\n        this._manager = manager;\r\n\r\n        this.entityMap = entityMap;\r\n\r\n        this._exposeConstants();\r\n    }\r\n\r\n    static updateDynamic(cb) {\r\n        const index = cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_UINT32);\r\n        const entity = entityMap.get(index);\r\n        const vehicleComponent = entity?.c.vehicle;\r\n\r\n        if (!entity) {\r\n            cb.skip(13 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n            if (vehicleComponent) {\r\n                cb.skip(vehicleComponent.wheels.length * 7 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n            }\r\n            return;\r\n        }\r\n\r\n        entity.setPosition(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        entity.setRotation(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        const component = entity.c.body || vehicleComponent;\r\n        component._linearVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n        component._angularVelocity.set(\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n\r\n        if (vehicleComponent) {\r\n            const wheels = vehicleComponent.wheels;\r\n            const wheelsCount = wheels.length;\r\n\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                const wheel = wheels[i];\r\n                const entity = wheel.entity;\r\n\r\n                if (!entity) {\r\n                    cb.skip(7 * _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.FLOAT32_SIZE);\r\n                    continue;\r\n                }\r\n\r\n                entity.setLocalPosition(\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n\r\n                entity.setLocalRotation(\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                    cb.read(_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    static debugDraw(app, data, config) {\r\n        const useDepth = config.debugDrawDepth;\r\n        const layer = app.scene.layers.getLayerById(config.debugDrawLayerId);\r\n\r\n        if (!v1) {\r\n            v1 = new pc.Vec3();\r\n            v2 = new pc.Vec3();\r\n            v3 = new pc.Vec3();\r\n        }\r\n    \r\n        for (let d = 0, total = data.length; d < total; d += 5) {\r\n            const index = data[d];\r\n            const length = data[d + 1];\r\n            const byteOffset = data[d + 2];\r\n            const motionType = data[d + 3];\r\n            const buffer = data[d + 4];\r\n    \r\n            const view = new Float32Array(buffer, byteOffset, length);\r\n            const entity = entityMap.get(index);\r\n            const color = getColor(motionType, config);\r\n    \r\n            const p = entity.getPosition();\r\n            const r = entity.getRotation();\r\n    \r\n            for (let i = 0, end = view.length; i < end; i += 9) {\r\n                v1.set(view[i], view[i + 1], view[i + 2]);\r\n                v2.set(view[i + 3], view[i + 4], view[i + 5]);\r\n                v3.set(view[i + 6], view[i + 7], view[i + 8]);\r\n    \r\n                r.transformVector(v1, v1);\r\n                r.transformVector(v2, v2);\r\n                r.transformVector(v3, v3);\r\n                v1.add(p);\r\n                v2.add(p);\r\n                v3.add(p);\r\n    \r\n                app.drawLine(v1, v2, color, useDepth, layer);\r\n                app.drawLine(v2, v3, color, useDepth, layer);\r\n                app.drawLine(v3, v1, color, useDepth, layer);\r\n            }\r\n        }\r\n    }\r\n\r\n    addCommand() {\r\n        const cb = this._manager.commandsBuffer;\r\n        \r\n        cb.writeOperator(arguments[0]);\r\n        cb.writeCommand(arguments[1]);\r\n\r\n        // component index\r\n        cb.write(arguments[2], _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 3, end = arguments.length; i < end; i += 3) {\r\n            cb.write(arguments[i], arguments[i + 1], arguments[i + 2]);\r\n        }\r\n    }\r\n\r\n    addCommandArgs() {\r\n        const cb = this._manager.commandsBuffer;\r\n        for (let i = 0, end = arguments.length; i < end; i += 3) {\r\n            cb.write(arguments[i], arguments[i + 1], arguments[i + 2]);\r\n        }\r\n    }\r\n\r\n    addComponent(entity, data = {}) {\r\n        const component = new this.ComponentType(this, entity);\r\n\r\n        this.store[entity.getGuid()] = { entity };\r\n\r\n        entity[this.id] = component;\r\n        entity.c[this.id] = component;\r\n\r\n        this.initializeComponentData(component, data);\r\n\r\n        return component;\r\n    }\r\n\r\n    initializeComponentData(component, data) {\r\n        component.enabled = true;\r\n\r\n        for (const [key, value] of Object.entries(data)) {\r\n            component[`_${ key }`] = value;\r\n        }\r\n\r\n        if (component.entity.enabled && !component.isCompoundChild) {\r\n            component.onEnable();\r\n        }\r\n    }\r\n\r\n    freeConstraintIndex(index) {\r\n        this._manager.freeConstraintIndex(index);\r\n    }\r\n\r\n    getIndex(entity) {\r\n        return entityMap.add(entity);\r\n    }\r\n\r\n    setIndexFree(index) {\r\n        entityMap.free(index);\r\n    } \r\n\r\n    _exposeConstants() {\r\n        if (typeof window !== 'undefined' && window.pc) {\r\n            pc.JOLT_SHAPE_BOX = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_BOX;\r\n            pc.JOLT_SHAPE_CAPSULE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CAPSULE;\r\n            pc.JOLT_SHAPE_CYLINDER = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CYLINDER;\r\n            pc.JOLT_SHAPE_SPHERE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_SPHERE;\r\n            pc.JOLT_SHAPE_MESH = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_MESH;\r\n            pc.JOLT_SHAPE_CONVEX_HULL = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_CONVEX_HULL;\r\n            pc.JOLT_SHAPE_STATIC_COMPOUND = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_STATIC_COMPOUND;\r\n            pc.JOLT_SHAPE_HEIGHTFIELD = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.SHAPE_HEIGHTFIELD;\r\n            pc.JOLT_OBJECT_LAYER_NON_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJECT_LAYER_NON_MOVING;\r\n            pc.JOLT_OBJECT_LAYER_MOVING = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.OBJECT_LAYER_MOVING;\r\n            pc.JOLT_VEHICLE_TYPE_WHEEL = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_WHEEL;\r\n            pc.JOLT_VEHICLE_TYPE_TRACK = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_TRACK;\r\n            pc.JOLT_VEHICLE_TYPE_MOTORCYCLE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_TYPE_MOTORCYCLE;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_RAY = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_RAY;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_CYLINDER = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_CYLINDER;\r\n            pc.JOLT_VEHICLE_CAST_TYPE_SPHERE = _constants_mjs__WEBPACK_IMPORTED_MODULE_1__.VEHICLE_CAST_TYPE_SPHERE;\r\n        }\r\n    }   \r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvc3lzdGVtLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3N5c3RlbS5tanM/NjBjZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmRleGVkQ2FjaGUgfSBmcm9tIFwiLi4vLi4vaW5kZXhlZC1jYWNoZS5tanNcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgICBCVUZGRVJfUkVBRF9GTE9BVDMyLCBCVUZGRVJfUkVBRF9VSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UMzIsXHJcbiAgICBGTE9BVDMyX1NJWkUsIE9CSkVDVF9MQVlFUl9NT1ZJTkcsIE9CSkVDVF9MQVlFUl9OT05fTU9WSU5HLCBTSEFQRV9CT1gsIFNIQVBFX0NBUFNVTEUsXHJcbiAgICBTSEFQRV9DT05WRVhfSFVMTCwgU0hBUEVfQ1lMSU5ERVIsIFNIQVBFX0hFSUdIVEZJRUxELCBTSEFQRV9NRVNILCBTSEFQRV9TUEhFUkUsXHJcbiAgICBTSEFQRV9TVEFUSUNfQ09NUE9VTkQsIFZFSElDTEVfQ0FTVF9UWVBFX0NZTElOREVSLCBWRUhJQ0xFX0NBU1RfVFlQRV9SQVksXHJcbiAgICBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkUsIFZFSElDTEVfVFlQRV9NT1RPUkNZQ0xFLCBWRUhJQ0xFX1RZUEVfVFJBQ0ssIFZFSElDTEVfVFlQRV9XSEVFTFxyXG59IGZyb20gXCIuL2NvbnN0YW50cy5tanNcIjtcclxuXHJcblxyXG4vLyBUT0RPXHJcbi8vIGNvbnZlcnQgdG8gc3RhdGljc1xyXG5jb25zdCBlbnRpdHlNYXAgPSBuZXcgSW5kZXhlZENhY2hlKCk7XHJcbmNvbnN0IHF1YXQgPSBuZXcgcGMuUXVhdCgpO1xyXG5sZXQgdjEsIHYyLCB2MztcclxuXHJcbmZ1bmN0aW9uIGdldENvbG9yKHR5cGUsIGNvbmZpZykge1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgY2FzZSBwYy5KT0xUX01PVElPTl9UWVBFX1NUQVRJQzpcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kZWJ1Z0NvbG9yU3RhdGljO1xyXG4gICAgICAgIGNhc2UgcGMuSk9MVF9NT1RJT05fVFlQRV9LSU5FTUFUSUM6XHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZGVidWdDb2xvcktpbmVtYXRpYztcclxuICAgICAgICBjYXNlIHBjLkpPTFRfTU9USU9OX1RZUEVfRFlOQU1JQzpcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kZWJ1Z0NvbG9yRHluYW1pYztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gcGMuQ29sb3IuV0hJVEU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFNoYXBlQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgcGMuQ29tcG9uZW50U3lzdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKGFwcCwgbWFuYWdlcikge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG5cclxuICAgICAgICAvLyBUaGUgc3RvcmUgd2hlcmUgYWxsIENvbXBvbmVudERhdGEgb2JqZWN0cyBhcmUga2VwdFxyXG4gICAgICAgIHRoaXMuc3RvcmUgPSB7fTtcclxuICAgICAgICB0aGlzLnNjaGVtYSA9IFtcclxuICAgICAgICAgICAgLy8gY29tcG9uZW50XHJcbiAgICAgICAgICAgICdlbmFibGVkJyxcclxuICAgICAgICAgICAgJ2luZGV4JyxcclxuICAgICAgICAgICAgJ3RyYWNrRHluYW1pYycsXHJcbiAgICAgICAgICAgICdyZW5kZXJBc3NldCcsXHJcbiAgICAgICAgICAgICdtZXNoZXMnLFxyXG4gICAgICAgICAgICAnaXNDb21wb3VuZENoaWxkJyxcclxuICAgICAgICAgICAgJ3VzZUVudGl0eVNjYWxlJyxcclxuICAgICAgICAgICAgJ3VzZU1vdGlvblN0YXRlJyxcclxuICAgICAgICAgICAgJ2RlYnVnRHJhdycsXHJcblxyXG4gICAgICAgICAgICAvLyBKb2x0IHNoYXBlXHJcbiAgICAgICAgICAgICdzaGFwZScsXHJcbiAgICAgICAgICAgICdoYWxmRXh0ZW50JyxcclxuICAgICAgICAgICAgJ3JhZGl1cycsXHJcbiAgICAgICAgICAgICdjb252ZXhSYWRpdXMnLFxyXG4gICAgICAgICAgICAnaGFsZkhlaWdodCcsXHJcbiAgICAgICAgICAgICdkZW5zaXR5JyxcclxuICAgICAgICAgICAgJ3NoYXBlUG9zaXRpb24nLFxyXG4gICAgICAgICAgICAnc2hhcGVSb3RhdGlvbicsXHJcbiAgICAgICAgICAgICdtYXNzT2Zmc2V0JyxcclxuICAgICAgICAgICAgJ2hmU2NhbGUnLFxyXG4gICAgICAgICAgICAnaGZPZmZzZXQnLFxyXG4gICAgICAgICAgICAnaGZTYW1wbGVzJyxcclxuICAgICAgICAgICAgJ2hmU2FtcGxlQ291bnQnLFxyXG4gICAgICAgICAgICAnaGZCbG9ja1NpemUnLFxyXG4gICAgICAgICAgICAnaGZCaXRzUGVyU2FtcGxlJyxcclxuICAgICAgICAgICAgJ2hmQWN0aXZlRWRnZUNvc1RocmVzaG9sZEFuZ2xlJ1xyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyO1xyXG5cclxuICAgICAgICB0aGlzLmVudGl0eU1hcCA9IGVudGl0eU1hcDtcclxuXHJcbiAgICAgICAgdGhpcy5fZXhwb3NlQ29uc3RhbnRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHVwZGF0ZUR5bmFtaWMoY2IpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGNiLnJlYWQoQlVGRkVSX1JFQURfVUlOVDMyKTtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSBlbnRpdHlNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICBjb25zdCB2ZWhpY2xlQ29tcG9uZW50ID0gZW50aXR5Py5jLnZlaGljbGU7XHJcblxyXG4gICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgIGNiLnNraXAoMTMgKiBGTE9BVDMyX1NJWkUpO1xyXG4gICAgICAgICAgICBpZiAodmVoaWNsZUNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAgICAgY2Iuc2tpcCh2ZWhpY2xlQ29tcG9uZW50LndoZWVscy5sZW5ndGggKiA3ICogRkxPQVQzMl9TSVpFKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlbnRpdHkuc2V0UG9zaXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBlbnRpdHkuc2V0Um90YXRpb24oXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlbnRpdHkuYy5ib2R5IHx8IHZlaGljbGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29tcG9uZW50Ll9saW5lYXJWZWxvY2l0eS5zZXQoXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbXBvbmVudC5fYW5ndWxhclZlbG9jaXR5LnNldChcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICh2ZWhpY2xlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHdoZWVscyA9IHZlaGljbGVDb21wb25lbnQud2hlZWxzO1xyXG4gICAgICAgICAgICBjb25zdCB3aGVlbHNDb3VudCA9IHdoZWVscy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsc0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxzW2ldO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gd2hlZWwuZW50aXR5O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Iuc2tpcCg3ICogRkxPQVQzMl9TSVpFKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc2V0TG9jYWxQb3NpdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc2V0TG9jYWxSb3RhdGlvbihcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNiLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2IucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgICAgICBjYi5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWJ1Z0RyYXcoYXBwLCBkYXRhLCBjb25maWcpIHtcclxuICAgICAgICBjb25zdCB1c2VEZXB0aCA9IGNvbmZpZy5kZWJ1Z0RyYXdEZXB0aDtcclxuICAgICAgICBjb25zdCBsYXllciA9IGFwcC5zY2VuZS5sYXllcnMuZ2V0TGF5ZXJCeUlkKGNvbmZpZy5kZWJ1Z0RyYXdMYXllcklkKTtcclxuXHJcbiAgICAgICAgaWYgKCF2MSkge1xyXG4gICAgICAgICAgICB2MSA9IG5ldyBwYy5WZWMzKCk7XHJcbiAgICAgICAgICAgIHYyID0gbmV3IHBjLlZlYzMoKTtcclxuICAgICAgICAgICAgdjMgPSBuZXcgcGMuVmVjMygpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGZvciAobGV0IGQgPSAwLCB0b3RhbCA9IGRhdGEubGVuZ3RoOyBkIDwgdG90YWw7IGQgKz0gNSkge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGRhdGFbZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGRhdGFbZCArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gZGF0YVtkICsgMl07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vdGlvblR5cGUgPSBkYXRhW2QgKyAzXTtcclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gZGF0YVtkICsgNF07XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgdmlldyA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGgpO1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBlbnRpdHlNYXAuZ2V0KGluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBnZXRDb2xvcihtb3Rpb25UeXBlLCBjb25maWcpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBlbnRpdHkuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3QgciA9IGVudGl0eS5nZXRSb3RhdGlvbigpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBlbmQgPSB2aWV3Lmxlbmd0aDsgaSA8IGVuZDsgaSArPSA5KSB7XHJcbiAgICAgICAgICAgICAgICB2MS5zZXQodmlld1tpXSwgdmlld1tpICsgMV0sIHZpZXdbaSArIDJdKTtcclxuICAgICAgICAgICAgICAgIHYyLnNldCh2aWV3W2kgKyAzXSwgdmlld1tpICsgNF0sIHZpZXdbaSArIDVdKTtcclxuICAgICAgICAgICAgICAgIHYzLnNldCh2aWV3W2kgKyA2XSwgdmlld1tpICsgN10sIHZpZXdbaSArIDhdKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgci50cmFuc2Zvcm1WZWN0b3IodjEsIHYxKTtcclxuICAgICAgICAgICAgICAgIHIudHJhbnNmb3JtVmVjdG9yKHYyLCB2Mik7XHJcbiAgICAgICAgICAgICAgICByLnRyYW5zZm9ybVZlY3Rvcih2MywgdjMpO1xyXG4gICAgICAgICAgICAgICAgdjEuYWRkKHApO1xyXG4gICAgICAgICAgICAgICAgdjIuYWRkKHApO1xyXG4gICAgICAgICAgICAgICAgdjMuYWRkKHApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBhcHAuZHJhd0xpbmUodjEsIHYyLCBjb2xvciwgdXNlRGVwdGgsIGxheWVyKTtcclxuICAgICAgICAgICAgICAgIGFwcC5kcmF3TGluZSh2MiwgdjMsIGNvbG9yLCB1c2VEZXB0aCwgbGF5ZXIpO1xyXG4gICAgICAgICAgICAgICAgYXBwLmRyYXdMaW5lKHYzLCB2MSwgY29sb3IsIHVzZURlcHRoLCBsYXllcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWRkQ29tbWFuZCgpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX21hbmFnZXIuY29tbWFuZHNCdWZmZXI7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY2Iud3JpdGVPcGVyYXRvcihhcmd1bWVudHNbMF0pO1xyXG4gICAgICAgIGNiLndyaXRlQ29tbWFuZChhcmd1bWVudHNbMV0pO1xyXG5cclxuICAgICAgICAvLyBjb21wb25lbnQgaW5kZXhcclxuICAgICAgICBjYi53cml0ZShhcmd1bWVudHNbMl0sIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDMsIGVuZCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBlbmQ7IGkgKz0gMykge1xyXG4gICAgICAgICAgICBjYi53cml0ZShhcmd1bWVudHNbaV0sIGFyZ3VtZW50c1tpICsgMV0sIGFyZ3VtZW50c1tpICsgMl0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRDb21tYW5kQXJncygpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX21hbmFnZXIuY29tbWFuZHNCdWZmZXI7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGVuZCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBlbmQ7IGkgKz0gMykge1xyXG4gICAgICAgICAgICBjYi53cml0ZShhcmd1bWVudHNbaV0sIGFyZ3VtZW50c1tpICsgMV0sIGFyZ3VtZW50c1tpICsgMl0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRDb21wb25lbnQoZW50aXR5LCBkYXRhID0ge30pIHtcclxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBuZXcgdGhpcy5Db21wb25lbnRUeXBlKHRoaXMsIGVudGl0eSk7XHJcblxyXG4gICAgICAgIHRoaXMuc3RvcmVbZW50aXR5LmdldEd1aWQoKV0gPSB7IGVudGl0eSB9O1xyXG5cclxuICAgICAgICBlbnRpdHlbdGhpcy5pZF0gPSBjb21wb25lbnQ7XHJcbiAgICAgICAgZW50aXR5LmNbdGhpcy5pZF0gPSBjb21wb25lbnQ7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudDtcclxuICAgIH1cclxuXHJcbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEpIHtcclxuICAgICAgICBjb21wb25lbnQuZW5hYmxlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XHJcbiAgICAgICAgICAgIGNvbXBvbmVudFtgXyR7IGtleSB9YF0gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb21wb25lbnQuZW50aXR5LmVuYWJsZWQgJiYgIWNvbXBvbmVudC5pc0NvbXBvdW5kQ2hpbGQpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50Lm9uRW5hYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpIHtcclxuICAgICAgICB0aGlzLl9tYW5hZ2VyLmZyZWVDb25zdHJhaW50SW5kZXgoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluZGV4KGVudGl0eSkge1xyXG4gICAgICAgIHJldHVybiBlbnRpdHlNYXAuYWRkKGVudGl0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0SW5kZXhGcmVlKGluZGV4KSB7XHJcbiAgICAgICAgZW50aXR5TWFwLmZyZWUoaW5kZXgpO1xyXG4gICAgfSBcclxuXHJcbiAgICBfZXhwb3NlQ29uc3RhbnRzKCkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cucGMpIHtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9CT1ggPSBTSEFQRV9CT1g7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfU0hBUEVfQ0FQU1VMRSA9IFNIQVBFX0NBUFNVTEU7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfU0hBUEVfQ1lMSU5ERVIgPSBTSEFQRV9DWUxJTkRFUjtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9TUEhFUkUgPSBTSEFQRV9TUEhFUkU7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfU0hBUEVfTUVTSCA9IFNIQVBFX01FU0g7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfU0hBUEVfQ09OVkVYX0hVTEwgPSBTSEFQRV9DT05WRVhfSFVMTDtcclxuICAgICAgICAgICAgcGMuSk9MVF9TSEFQRV9TVEFUSUNfQ09NUE9VTkQgPSBTSEFQRV9TVEFUSUNfQ09NUE9VTkQ7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfU0hBUEVfSEVJR0hURklFTEQgPSBTSEFQRV9IRUlHSFRGSUVMRDtcclxuICAgICAgICAgICAgcGMuSk9MVF9PQkpFQ1RfTEFZRVJfTk9OX01PVklORyA9IE9CSkVDVF9MQVlFUl9OT05fTU9WSU5HO1xyXG4gICAgICAgICAgICBwYy5KT0xUX09CSkVDVF9MQVlFUl9NT1ZJTkcgPSBPQkpFQ1RfTEFZRVJfTU9WSU5HO1xyXG4gICAgICAgICAgICBwYy5KT0xUX1ZFSElDTEVfVFlQRV9XSEVFTCA9IFZFSElDTEVfVFlQRV9XSEVFTDtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX1RZUEVfVFJBQ0sgPSBWRUhJQ0xFX1RZUEVfVFJBQ0s7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUgPSBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRTtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX0NBU1RfVFlQRV9SQVkgPSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVk7XHJcbiAgICAgICAgICAgIHBjLkpPTFRfVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVIgPSBWRUhJQ0xFX0NBU1RfVFlQRV9DWUxJTkRFUjtcclxuICAgICAgICAgICAgcGMuSk9MVF9WRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkUgPSBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkU7XHJcbiAgICAgICAgfVxyXG4gICAgfSAgIFxyXG59XHJcblxyXG5leHBvcnQgeyBTaGFwZUNvbXBvbmVudFN5c3RlbSB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/system.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/vehicle/component.mjs":
/*!***********************************************************!*\
  !*** ./src/physics/components/jolt/vehicle/component.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VehicleComponent: () => (/* binding */ VehicleComponent)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/component.mjs */ \"./src/physics/components/jolt/body/component.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\n\r\nclass VehicleComponent extends _body_component_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponent {\r\n    // Used only when the constraint is active. Override for the number of solver \r\n    // velocity iterations to run, 0 means use the default in PhysicsSettings.numVelocitySteps.\r\n    // The number of iterations to use is the max of all contacts and constraints in the island.\r\n    _numVelocityStepsOverride = 0;\r\n\r\n    // Used only when the constraint is active. Override for the number of solver\r\n    // position iterations to run, 0 means use the default in PhysicsSettings.numPositionSteps.\r\n    // The number of iterations to use is the max of all contacts and constraints in the island.\r\n    _numPositionStepsOverride = 0;\r\n\r\n    // Vector indicating the up direction of the vehicle (in local space to the body)\r\n    _up = pc.Vec3.UP;\r\n\r\n    // Vector indicating forward direction of the vehicle (in local space to the body)\r\n    _forward = pc.Vec3.BACK;\r\n\r\n    // Defines the maximum pitch/roll angle (rad), can be used to avoid the car from getting upside\r\n    // down. The vehicle up direction will stay within a cone centered around the up axis with half\r\n    // top angle maxPitchRollAngle, set to pi to turn off. Defaults to ~1.04 rad (60 degrees)\r\n    _maxPitchRollAngle = 1.0471975511965976;\r\n\r\n    // An array of arrays. Each array represents a track and lists indices of wheels that are inside\r\n    // that track. The last element in each track array will become a driven wheel (an index that points\r\n    // to a wheel that is connected to the engine).\r\n    // Example with 2 tracks, and each having 4 wheels: [[0, 1, 2, 3], [4, 5, 6, 7]]\r\n    _tracks = [];\r\n\r\n    // An array of objects that describe each wheel. See _writeWheelsData().\r\n    _wheels = [];\r\n\r\n    // Vehicle type. Can be wheeled (VEHICLE_TYPE_WHEEL) or tracked (VEHICLE_TYPE_TRACK).\r\n    _type = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL;\r\n\r\n    // Max amount of torque (Nm) that the engine can deliver.\r\n    _maxTorque = 500;\r\n    \r\n    // Min amount of revolutions per minute (rpm) the engine can produce without stalling.\r\n    _minRPM = 1000;\r\n\r\n    // Max amount of revolutions per minute (rpm) the engine can generate.\r\n    _maxRPM = 6000;\r\n\r\n    // Moment of inertia (kg m^2) of the engine.\r\n    _inertia = 0.5;\r\n\r\n    // Angular damping factor of the wheel: dw/dt = -c * w.\r\n    _angularDamping = 0.2;\r\n\r\n    // Curve that describes a ratio of the max torque the engine can produce vs the fraction of the max RPM of the engine.\r\n    _normalizedTorque = new pc.Curve([0, 0.8, 0, 0.8]);\r\n\r\n    // How to switch gears.\r\n    _mode = pc.JOLT_TRANSMISSION_AUTO;\r\n\r\n    // Ratio in rotation rate between engine and gear box, first element is 1st gear, 2nd element 2nd gear etc.\r\n    _gearRatios = [2.66, 1.78, 1.3, 1, 0.74];\r\n\r\n    // Ratio in rotation rate between engine and gear box when driving in reverse.\r\n    _reverseGearRatios = [-2.9];\r\n\r\n    // How long it takes to switch gears (s), only used in auto mode.\r\n    _switchTime = 0.5;\r\n\r\n    // How long it takes to release the clutch (go to full friction), only used in auto mode\r\n    _clutchReleaseTime = 0.3;\r\n\r\n    // How long to wait after releasing the clutch before another switch is attempted (s), only used in auto mode.\r\n    _switchLatency = 0.5;\r\n\r\n    // If RPM of engine is bigger then this we will shift a gear up, only used in auto mode.\r\n    _shiftUpRPM = 4000;\r\n\r\n    // If RPM of engine is smaller then this we will shift a gear down, only used in auto mode.\r\n    _shiftDownRPM = 2000;\r\n\r\n    // Strength of the clutch when fully engaged. Total torque a clutch applies is \r\n    // Torque = ClutchStrength * (Velocity Engine - Avg Velocity Wheels At Clutch) (units: k m^2 s^-1)\r\n    _clutchStrength = 10;\r\n\r\n    // List of differentials and their properties\r\n    _differentials = [];\r\n\r\n    // Used when vehicle is of wheeled type. Ratio max / min average wheel speed of each differential\r\n    // (measured at the clutch). When the ratio is exceeded all torque gets distributed to the differential\r\n    // with the minimal average velocity. This allows implementing a limited slip differential between\r\n    // differentials. Set to Number.MAX_VALUE for an open differential. Value should be > 1.\r\n    _differentialLimitedSlipRatio = 1.4;\r\n\r\n    // An anti rollbar is a stiff spring that connects two wheels to reduce the amount of roll the\r\n    // vehicle makes in sharp corners See: https://en.wikipedia.org/wiki/Anti-roll_bar\r\n    _antiRollBars = [];    \r\n\r\n    // Collision tester that tests wheels collision.\r\n    // - VEHICLE_CAST_TYPE_RAY\r\n    // - VEHICLE_CAST_TYPE_SPHERE\r\n    // - VEHICLE_CAST_TYPE_CYLINDER \r\n    _castType = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_RAY;\r\n\r\n    // Object layer to test collision with.\r\n    _castObjectLayer = _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OBJECT_LAYER_MOVING;\r\n\r\n    // World space up vector, used to avoid colliding with vertical walls.\r\n    _castUp = pc.Vec3.UP;\r\n\r\n    // Max angle (rad) that is considered for colliding wheels. This is to avoid colliding\r\n    // with vertical walls. Defaults to ~1.4 rad (80 degrees).\r\n    _castMaxSlopeAngle = 1.3962634015954636;\r\n\r\n    // Sets the radius of the sphere used in cast.\r\n    _castRadius = 0.3;\r\n\r\n    // Fraction of half the wheel width (or wheel radius if it is smaller) that is used as the convex radius\r\n    _castFraction = 0.1;\r\n\r\n    // How far we're willing to make the bike lean over in turns (in radians)\r\n    _maxLeanAngle = 45;\r\n    \r\n    // Spring constant for the lean spring.\r\n    _leanSpringConstant = 5000;\r\n\r\n    // Spring damping constant for the lean spring.\r\n    _leanSpringDamping = 1000;\r\n\r\n    // The lean spring applies an additional force equal to this coefficient * Integral(delta angle, 0, t),\r\n    // this effectively makes the lean spring a PID controller.\r\n    _leanSpringIntegrationCoefficient = 0;\r\n\r\n    // How much to decay the angle integral when the wheels are not touching the floor:\r\n    // new_value = e^(-decay * t) * initial_value.\r\n    _leanSpringIntegrationCoefficientDecay = 4;\r\n\r\n    // How much to smooth the lean angle (0 = no smoothing, 1 = lean angle never changes). Note that this\r\n    // is frame rate dependent because the formula is: smoothing_factor * previous + (1 - smoothing_factor) * current\r\n    _leanSmoothingFactor = 0.8;\r\n\r\n    constructor(system, entity) {\r\n        super(system, entity);\r\n    }\r\n\r\n    writeVehicleData(cb) {\r\n        const type = this._type;\r\n\r\n        // general vehicle data\r\n        cb.write(this._index, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        cb.write(type, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._numVelocityStepsOverride, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT16, false);\r\n        cb.write(this._up, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._forward, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n        cb.write(this._maxPitchRollAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n        // engine data\r\n        cb.write(this._maxTorque, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._minRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._maxRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._inertia, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._angularDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        VehicleComponent.writeCurvePoints(cb, this._normalizedTorque);\r\n\r\n        // transmission data\r\n        cb.write(this._mode, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._switchTime, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._clutchReleaseTime, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._switchLatency, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shiftUpRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._shiftDownRPM, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        cb.write(this._clutchStrength, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        VehicleComponent.writeGears(cb, this._gearRatios);\r\n        VehicleComponent.writeGears(cb, this._reverseGearRatios);\r\n\r\n        // wheels data\r\n        const isWheeled = type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE;\r\n        if (isWheeled) {\r\n            this._writeWheelsData(cb);\r\n        } else {\r\n            this._writeTracksData(cb);\r\n        }\r\n\r\n        if (isWheeled) {\r\n            // differentials\r\n            this._writeDifferentials(cb);\r\n            cb.write(this._differentialLimitedSlipRatio, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            if (type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                cb.write(this._maxLeanAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringConstant, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringDamping, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringIntegrationCoefficient, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSpringIntegrationCoefficientDecay, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._leanSmoothingFactor, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n\r\n        this._writeAntiRollBars(cb);\r\n\r\n        // cast type\r\n        const castType = this._castType;\r\n        cb.write(castType, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n        cb.write(this._castObjectLayer, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        switch (castType) {\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_RAY:\r\n                cb.write(this._castUp, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._castMaxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_SPHERE:\r\n                cb.write(this._castUp, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n                cb.write(this._castMaxSlopeAngle, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(this._castRadius, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n            case _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_CAST_TYPE_CYLINDER:\r\n                cb.write(this._castFraction, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Any type:\r\n    //      input0 - Value between -1 and 1 for auto transmission and value between 0 and 1 indicating \r\n    //              desired driving direction and amount the gas pedal is pressed\r\n    // Wheeled:\r\n    //      input1 - Value between -1 and 1 indicating desired steering angle (1 = right)\r\n    //      input2 - Value between 0 and 1 indicating how strong the brake pedal is pressed\r\n    //      input3 - Value between 0 and 1 indicating how strong the hand brake is pulled\r\n    // Tracked:\r\n    //      input1 - Value between -1 and 1 indicating an extra multiplier to the rotation rate of the left track (used for steering)\r\n    //      input2 - Value between -1 and 1 indicating an extra multiplier to the rotation rate of the right track (used for steering)\r\n    //      input3 - Value between 0 and 1 indicating how strong the brake pedal is pressed\r\n    setDriverInput(input0, input1, input2, input3) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input0, -1, 1, `Invalid driver input for forward (input0). Expected a number in [-1:1] range. Received: ${ input0 }`);\r\n            if (this._type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || this._type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input1, -1, 1, `Invalid driver input for right (input1). Expected a number in [-1:1] range. Received: ${ input1 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input2, 0, 1, `Invalid driver input for brake (input2). Expected a number in [0:1] range. Received: ${ input2 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input3, 0, 1, `Invalid driver input for hand brake (input3). Expected a number in [0:1] range. Received: ${ input3 }`);\r\n            } else {\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input1, -1, 1, `Invalid driver input for left ratio (input1). Expected a number in [-1:1] range. Received: ${ input1 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input2, -1, 1, `Invalid driver input for right ratio (input2). Expected a number in [-1:1] range. Received: ${ input2 }`);\r\n                ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkRange(input3, 0, 1, `Invalid driver input for brake (input3). Expected a number in [0:1] range. Received: ${ input3 }`);\r\n            }\r\n            if (!ok)\r\n                return;\r\n        }\r\n\r\n        this.system.addCommand(\r\n            _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_MODIFIER, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_SET_DRIVER_INPUT, this._index,\r\n            input0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input2, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false,\r\n            input3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false\r\n        );\r\n    }\r\n\r\n    onEnable() {\r\n        const system = this.system;\r\n\r\n        this._index = system.getIndex(this.entity);\r\n\r\n        system.createVehicle(this);\r\n    }\r\n\r\n    _writeTracksData(cb) {\r\n        const tracks = this._tracks;\r\n        const count = tracks.length;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && count === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warn('Invalid tracks data. Need at least one track.', tracks);\r\n            return;\r\n        }\r\n\r\n        this._writeWheelsData(cb);\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        \r\n        for (let t = 0; t < count; t++) {\r\n            const track = tracks[t];\r\n            const wheelsCount = track.length;\r\n\r\n            cb.write(wheelsCount, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0; i < wheelsCount; i++) {\r\n                cb.write(track[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeWheelsData(cb) {\r\n        const wheels = this._wheels;\r\n        const count = wheels.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const desc = wheels[i];\r\n\r\n            if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n                let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(desc.position, \r\n                    'A wheel description requires an attachment position of wheel' +\r\n                    'suspension in local space of the vehicle', desc);\r\n                const spring = desc.spring;\r\n                if (spring) {\r\n                    const { stiffness, frequency } = spring;\r\n                    if (stiffness != null) {\r\n                        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(stiffness !== 0, 'Wheel spring stiffness cannot be zero', spring);\r\n                    }\r\n                    if (frequency != null) {\r\n                        _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.assert(frequency !== 0, 'Wheel spring frequency cannot be zero', spring);\r\n                    }\r\n                }\r\n                if (!ok)\r\n                    return;\r\n            }\r\n\r\n            // Attachment point of wheel suspension in local space of the body.\r\n            cb.write(desc.position, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Where tire forces (suspension and traction) are applied, in local space of the body. \r\n            // A good default is the center of the wheel in its neutral pose. See enableSuspensionForcePoint.\r\n            cb.write(desc.suspensionForcePoint || pc.Vec3.ZERO, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Direction of the suspension in local space of the body, should point down.\r\n            cb.write(desc.suspensionDirection || pc.Vec3.DOWN, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Direction of the steering axis in local space of the body, should point up (e.g. for a \r\n            // bike would be -suspensionDirection)\r\n            cb.write(desc.steeringAxis || pc.Vec3.UP, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Up direction when the wheel is in the neutral steering position (usually \r\n            // component.up but can be used to give the wheel camber or for a bike would be -suspensionDirection)\r\n            cb.write(desc.wheelUp || pc.Vec3.UP, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // Forward direction when the wheel is in the neutral steering position (usually \r\n            // component.forward but can be used to give the wheel toe, does not need to be perpendicular\r\n            // to wheelUp)\r\n            cb.write(desc.wheelForward || pc.Vec3.BACK, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_VEC32, false);\r\n\r\n            // How long the suspension is in max raised position relative to the attachment point (m)\r\n            cb.write(desc.suspensionMinLength ?? 0.3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // How long the suspension is in max droop position relative to the attachment point (m)\r\n            cb.write(desc.suspensionMaxLength ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // The natural length (m) of the suspension spring is defined as suspensionMaxLength + \r\n            // suspensionPreloadLength. Can be used to preload the suspension as the spring is compressed\r\n            // by suspensionPreloadLength when the suspension is in max droop position. Note that this means\r\n            // when the vehicle touches the ground there is a discontinuity so it will also make the vehicle\r\n            // more bouncy as we're updating with discrete time steps.\r\n            cb.write(desc.suspensionPreloadLength ?? 0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Radius of the wheel (m)\r\n            cb.write(desc.radius ?? 0.3, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Width of the wheel (m)\r\n            cb.write(desc.width ?? 0.1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // If disabled, the forces are applied at the collision contact point. This leads to a more\r\n            // accurate simulation when interacting with dynamic objects but makes the vehicle less stable.\r\n            // When setting this to true, all forces will be applied to a fixed point on the vehicle body.\r\n            cb.write(desc.enableSuspensionForcePoint ?? false, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n            // wheel spring data\r\n            const spring = desc.spring || {};\r\n            cb.write(spring.mode ?? pc.JOLT_SPRING_MODE_FREQUENCY, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT8, false);\r\n            cb.write(spring.frequency ?? 1.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            cb.write(spring.stiffness ?? 1.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            cb.write(spring.damping ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Friction in forward direction of tire as a function of the slip ratio (fraction):\r\n            // (omega_wheel * r_wheel - v_longitudinal) / |v_longitudinal|.\r\n            // Slip ratio here is a ratio of wheel spinning relative to the floor. At 0 the wheel has full\r\n            // traction and is rolling perfectly in sync with the ground. At 1 the wheel is locked and\r\n            // is sliding over the ground.\r\n            VehicleComponent.writeCurvePoints(cb, desc.longitudinalFriction);\r\n\r\n            // Friction in sideway direction of tire as a function of the slip angle (degrees):\r\n            // angle between relative contact velocity and vehicle direction.\r\n            // If tire forward matches the vehicle direction, then the angle is 0 degrees. If the \r\n            // vehicle is sliding sideways, e.g. on ice, then the angle is 90 degrees. Example curve keys could\r\n            // be: [[0, 1], [90, 0.3]] - full friction at zero degrees, and 0.3 friction at 90.\r\n            VehicleComponent.writeCurvePoints(cb, desc.lateralFriction);\r\n\r\n            const type = this._type;\r\n            if (type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_WHEEL || type === _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.VEHICLE_TYPE_MOTORCYCLE) {\r\n\r\n                // Moment of inertia (kg m^2), for a cylinder this would be 0.5 * M * R^2 which is \r\n                // 0.9 for a wheel with a mass of 20 kg and radius 0.3 m.\r\n                cb.write(desc.inertia ?? 0.9, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // Angular damping factor of the wheel: dw/dt = -c * w.\r\n                cb.write(desc.angularDamping ?? 0.2, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // How much this wheel can steer (radians). Defaults to ~1.22 rad (70 degrees).\r\n                cb.write(desc.maxSteerAngle ?? 1.2217304763960306, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                \r\n                // How much torque (Nm) the brakes can apply to this wheel.\r\n                cb.write(desc.maxBrakeTorque ?? 1500, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n                // How much torque (Nm) the hand brake can apply to this wheel (usually only applied\r\n                // to the rear wheels)\r\n                cb.write(desc.maxHandBrakeTorque ?? 4000, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    _writeDifferentials(cb) {\r\n        const differentials = this._differentials;\r\n        const count = differentials.length;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev && count === 0) {\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.warnOnce('Vehicle component is missing wheels differentials.' +\r\n                'Default values will make a vehicle without wheels.');\r\n        }\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const diff = differentials[i];\r\n\r\n            // Index (in mWheels) that represents the left wheel of this \r\n            // differential (can be -1 to indicate no wheel)\r\n            cb.write(diff.leftWheel ?? -1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_INT32, false);\r\n\r\n            // Same as leftWheel, but for the right one.\r\n            cb.write(diff.rightWheel ?? -1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_INT32, false);\r\n\r\n            // Ratio between rotation speed of gear box and wheels.\r\n            cb.write(diff.differentialRatio ?? 3.42, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Defines how the engine torque is split across the left and right \r\n            // wheel (0 = left, 0.5 = center, 1 = right)\r\n            cb.write(diff.leftRightSplit ?? 0.5, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // Ratio max / min wheel speed. When this ratio is exceeded, all\r\n            // torque gets distributed to the slowest moving wheel. This allows\r\n            // implementing a limited slip differential. Set to Number.MAX_VALUE\r\n            // for an open differential. Value should be > 1.\r\n            cb.write(diff.limitedSlipRatio ?? 1.4, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n\r\n            // How much of the engines torque is applied to this differential\r\n            // (0 = none, 1 = full), make sure the sum of all differentials is 1.\r\n            cb.write(diff.engineTorqueRatio ?? 1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }\r\n\r\n    _writeAntiRollBars(cb) {\r\n        const bars = this._antiRollBars;\r\n        const count = bars.length;\r\n\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const bar = bars[i];\r\n\r\n            // Index (in wheels) that represents the left wheel of this anti-rollbar.\r\n            cb.write(bar.leftWheel ?? 0, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // Index (in wheels) that represents the right wheel of this anti-rollbar.\r\n            cb.write(bar.rightWheel ?? 1, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            // Stiffness (spring constant in N/m) of anti rollbar, can be 0 to disable the anti-rollbar.\r\n            cb.write(bar.stiffness ?? 1000, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }\r\n\r\n    static writeCurvePoints(cb, curve) {\r\n        cb.write(!!curve, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_BOOL, false);\r\n\r\n        if (curve) {\r\n            const keys = curve.keys;\r\n            const count = keys.length;\r\n\r\n            cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n\r\n            for (let i = 0; i < keys.length; i++) {\r\n                const key = keys[i];\r\n\r\n                cb.write(key[0], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n                cb.write(key[1], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    static writeGears(cb, gears) {\r\n        const count = gears.length;\r\n        cb.write(count, _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_UINT32, false);\r\n        for (let i = 0; i < count; i++) {\r\n            cb.write(gears[i], _constants_mjs__WEBPACK_IMPORTED_MODULE_2__.BUFFER_WRITE_FLOAT32, false);\r\n        }\r\n    }    \r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvdmVoaWNsZS9jb21wb25lbnQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvY29tcG9uZW50cy9qb2x0L3ZlaGljbGUvY29tcG9uZW50Lm1qcz9iMmQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uLy4uL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCb2R5Q29tcG9uZW50IH0gZnJvbSBcIi4uL2JvZHkvY29tcG9uZW50Lm1qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQlVGRkVSX1dSSVRFX0JPT0wsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBCVUZGRVJfV1JJVEVfSU5UMzIsIEJVRkZFUl9XUklURV9VSU5UMTYsXHJcbiAgICBCVUZGRVJfV1JJVEVfVUlOVDMyLCBCVUZGRVJfV1JJVEVfVUlOVDgsIEJVRkZFUl9XUklURV9WRUMzMiwgQ01EX1NFVF9EUklWRVJfSU5QVVQsXHJcbiAgICBPQkpFQ1RfTEFZRVJfTU9WSU5HLCBPUEVSQVRPUl9NT0RJRklFUiwgVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVIsIFZFSElDTEVfQ0FTVF9UWVBFX1JBWSxcclxuICAgIFZFSElDTEVfQ0FTVF9UWVBFX1NQSEVSRSwgVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUsIFZFSElDTEVfVFlQRV9XSEVFTFxyXG59IGZyb20gXCIuLi9jb25zdGFudHMubWpzXCI7XHJcblxyXG5jbGFzcyBWZWhpY2xlQ29tcG9uZW50IGV4dGVuZHMgQm9keUNvbXBvbmVudCB7XHJcbiAgICAvLyBVc2VkIG9ubHkgd2hlbiB0aGUgY29uc3RyYWludCBpcyBhY3RpdmUuIE92ZXJyaWRlIGZvciB0aGUgbnVtYmVyIG9mIHNvbHZlciBcclxuICAgIC8vIHZlbG9jaXR5IGl0ZXJhdGlvbnMgdG8gcnVuLCAwIG1lYW5zIHVzZSB0aGUgZGVmYXVsdCBpbiBQaHlzaWNzU2V0dGluZ3MubnVtVmVsb2NpdHlTdGVwcy5cclxuICAgIC8vIFRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byB1c2UgaXMgdGhlIG1heCBvZiBhbGwgY29udGFjdHMgYW5kIGNvbnN0cmFpbnRzIGluIHRoZSBpc2xhbmQuXHJcbiAgICBfbnVtVmVsb2NpdHlTdGVwc092ZXJyaWRlID0gMDtcclxuXHJcbiAgICAvLyBVc2VkIG9ubHkgd2hlbiB0aGUgY29uc3RyYWludCBpcyBhY3RpdmUuIE92ZXJyaWRlIGZvciB0aGUgbnVtYmVyIG9mIHNvbHZlclxyXG4gICAgLy8gcG9zaXRpb24gaXRlcmF0aW9ucyB0byBydW4sIDAgbWVhbnMgdXNlIHRoZSBkZWZhdWx0IGluIFBoeXNpY3NTZXR0aW5ncy5udW1Qb3NpdGlvblN0ZXBzLlxyXG4gICAgLy8gVGhlIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIHVzZSBpcyB0aGUgbWF4IG9mIGFsbCBjb250YWN0cyBhbmQgY29uc3RyYWludHMgaW4gdGhlIGlzbGFuZC5cclxuICAgIF9udW1Qb3NpdGlvblN0ZXBzT3ZlcnJpZGUgPSAwO1xyXG5cclxuICAgIC8vIFZlY3RvciBpbmRpY2F0aW5nIHRoZSB1cCBkaXJlY3Rpb24gb2YgdGhlIHZlaGljbGUgKGluIGxvY2FsIHNwYWNlIHRvIHRoZSBib2R5KVxyXG4gICAgX3VwID0gcGMuVmVjMy5VUDtcclxuXHJcbiAgICAvLyBWZWN0b3IgaW5kaWNhdGluZyBmb3J3YXJkIGRpcmVjdGlvbiBvZiB0aGUgdmVoaWNsZSAoaW4gbG9jYWwgc3BhY2UgdG8gdGhlIGJvZHkpXHJcbiAgICBfZm9yd2FyZCA9IHBjLlZlYzMuQkFDSztcclxuXHJcbiAgICAvLyBEZWZpbmVzIHRoZSBtYXhpbXVtIHBpdGNoL3JvbGwgYW5nbGUgKHJhZCksIGNhbiBiZSB1c2VkIHRvIGF2b2lkIHRoZSBjYXIgZnJvbSBnZXR0aW5nIHVwc2lkZVxyXG4gICAgLy8gZG93bi4gVGhlIHZlaGljbGUgdXAgZGlyZWN0aW9uIHdpbGwgc3RheSB3aXRoaW4gYSBjb25lIGNlbnRlcmVkIGFyb3VuZCB0aGUgdXAgYXhpcyB3aXRoIGhhbGZcclxuICAgIC8vIHRvcCBhbmdsZSBtYXhQaXRjaFJvbGxBbmdsZSwgc2V0IHRvIHBpIHRvIHR1cm4gb2ZmLiBEZWZhdWx0cyB0byB+MS4wNCByYWQgKDYwIGRlZ3JlZXMpXHJcbiAgICBfbWF4UGl0Y2hSb2xsQW5nbGUgPSAxLjA0NzE5NzU1MTE5NjU5NzY7XHJcblxyXG4gICAgLy8gQW4gYXJyYXkgb2YgYXJyYXlzLiBFYWNoIGFycmF5IHJlcHJlc2VudHMgYSB0cmFjayBhbmQgbGlzdHMgaW5kaWNlcyBvZiB3aGVlbHMgdGhhdCBhcmUgaW5zaWRlXHJcbiAgICAvLyB0aGF0IHRyYWNrLiBUaGUgbGFzdCBlbGVtZW50IGluIGVhY2ggdHJhY2sgYXJyYXkgd2lsbCBiZWNvbWUgYSBkcml2ZW4gd2hlZWwgKGFuIGluZGV4IHRoYXQgcG9pbnRzXHJcbiAgICAvLyB0byBhIHdoZWVsIHRoYXQgaXMgY29ubmVjdGVkIHRvIHRoZSBlbmdpbmUpLlxyXG4gICAgLy8gRXhhbXBsZSB3aXRoIDIgdHJhY2tzLCBhbmQgZWFjaCBoYXZpbmcgNCB3aGVlbHM6IFtbMCwgMSwgMiwgM10sIFs0LCA1LCA2LCA3XV1cclxuICAgIF90cmFja3MgPSBbXTtcclxuXHJcbiAgICAvLyBBbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgZGVzY3JpYmUgZWFjaCB3aGVlbC4gU2VlIF93cml0ZVdoZWVsc0RhdGEoKS5cclxuICAgIF93aGVlbHMgPSBbXTtcclxuXHJcbiAgICAvLyBWZWhpY2xlIHR5cGUuIENhbiBiZSB3aGVlbGVkIChWRUhJQ0xFX1RZUEVfV0hFRUwpIG9yIHRyYWNrZWQgKFZFSElDTEVfVFlQRV9UUkFDSykuXHJcbiAgICBfdHlwZSA9IFZFSElDTEVfVFlQRV9XSEVFTDtcclxuXHJcbiAgICAvLyBNYXggYW1vdW50IG9mIHRvcnF1ZSAoTm0pIHRoYXQgdGhlIGVuZ2luZSBjYW4gZGVsaXZlci5cclxuICAgIF9tYXhUb3JxdWUgPSA1MDA7XHJcbiAgICBcclxuICAgIC8vIE1pbiBhbW91bnQgb2YgcmV2b2x1dGlvbnMgcGVyIG1pbnV0ZSAocnBtKSB0aGUgZW5naW5lIGNhbiBwcm9kdWNlIHdpdGhvdXQgc3RhbGxpbmcuXHJcbiAgICBfbWluUlBNID0gMTAwMDtcclxuXHJcbiAgICAvLyBNYXggYW1vdW50IG9mIHJldm9sdXRpb25zIHBlciBtaW51dGUgKHJwbSkgdGhlIGVuZ2luZSBjYW4gZ2VuZXJhdGUuXHJcbiAgICBfbWF4UlBNID0gNjAwMDtcclxuXHJcbiAgICAvLyBNb21lbnQgb2YgaW5lcnRpYSAoa2cgbV4yKSBvZiB0aGUgZW5naW5lLlxyXG4gICAgX2luZXJ0aWEgPSAwLjU7XHJcblxyXG4gICAgLy8gQW5ndWxhciBkYW1waW5nIGZhY3RvciBvZiB0aGUgd2hlZWw6IGR3L2R0ID0gLWMgKiB3LlxyXG4gICAgX2FuZ3VsYXJEYW1waW5nID0gMC4yO1xyXG5cclxuICAgIC8vIEN1cnZlIHRoYXQgZGVzY3JpYmVzIGEgcmF0aW8gb2YgdGhlIG1heCB0b3JxdWUgdGhlIGVuZ2luZSBjYW4gcHJvZHVjZSB2cyB0aGUgZnJhY3Rpb24gb2YgdGhlIG1heCBSUE0gb2YgdGhlIGVuZ2luZS5cclxuICAgIF9ub3JtYWxpemVkVG9ycXVlID0gbmV3IHBjLkN1cnZlKFswLCAwLjgsIDAsIDAuOF0pO1xyXG5cclxuICAgIC8vIEhvdyB0byBzd2l0Y2ggZ2VhcnMuXHJcbiAgICBfbW9kZSA9IHBjLkpPTFRfVFJBTlNNSVNTSU9OX0FVVE87XHJcblxyXG4gICAgLy8gUmF0aW8gaW4gcm90YXRpb24gcmF0ZSBiZXR3ZWVuIGVuZ2luZSBhbmQgZ2VhciBib3gsIGZpcnN0IGVsZW1lbnQgaXMgMXN0IGdlYXIsIDJuZCBlbGVtZW50IDJuZCBnZWFyIGV0Yy5cclxuICAgIF9nZWFyUmF0aW9zID0gWzIuNjYsIDEuNzgsIDEuMywgMSwgMC43NF07XHJcblxyXG4gICAgLy8gUmF0aW8gaW4gcm90YXRpb24gcmF0ZSBiZXR3ZWVuIGVuZ2luZSBhbmQgZ2VhciBib3ggd2hlbiBkcml2aW5nIGluIHJldmVyc2UuXHJcbiAgICBfcmV2ZXJzZUdlYXJSYXRpb3MgPSBbLTIuOV07XHJcblxyXG4gICAgLy8gSG93IGxvbmcgaXQgdGFrZXMgdG8gc3dpdGNoIGdlYXJzIChzKSwgb25seSB1c2VkIGluIGF1dG8gbW9kZS5cclxuICAgIF9zd2l0Y2hUaW1lID0gMC41O1xyXG5cclxuICAgIC8vIEhvdyBsb25nIGl0IHRha2VzIHRvIHJlbGVhc2UgdGhlIGNsdXRjaCAoZ28gdG8gZnVsbCBmcmljdGlvbiksIG9ubHkgdXNlZCBpbiBhdXRvIG1vZGVcclxuICAgIF9jbHV0Y2hSZWxlYXNlVGltZSA9IDAuMztcclxuXHJcbiAgICAvLyBIb3cgbG9uZyB0byB3YWl0IGFmdGVyIHJlbGVhc2luZyB0aGUgY2x1dGNoIGJlZm9yZSBhbm90aGVyIHN3aXRjaCBpcyBhdHRlbXB0ZWQgKHMpLCBvbmx5IHVzZWQgaW4gYXV0byBtb2RlLlxyXG4gICAgX3N3aXRjaExhdGVuY3kgPSAwLjU7XHJcblxyXG4gICAgLy8gSWYgUlBNIG9mIGVuZ2luZSBpcyBiaWdnZXIgdGhlbiB0aGlzIHdlIHdpbGwgc2hpZnQgYSBnZWFyIHVwLCBvbmx5IHVzZWQgaW4gYXV0byBtb2RlLlxyXG4gICAgX3NoaWZ0VXBSUE0gPSA0MDAwO1xyXG5cclxuICAgIC8vIElmIFJQTSBvZiBlbmdpbmUgaXMgc21hbGxlciB0aGVuIHRoaXMgd2Ugd2lsbCBzaGlmdCBhIGdlYXIgZG93biwgb25seSB1c2VkIGluIGF1dG8gbW9kZS5cclxuICAgIF9zaGlmdERvd25SUE0gPSAyMDAwO1xyXG5cclxuICAgIC8vIFN0cmVuZ3RoIG9mIHRoZSBjbHV0Y2ggd2hlbiBmdWxseSBlbmdhZ2VkLiBUb3RhbCB0b3JxdWUgYSBjbHV0Y2ggYXBwbGllcyBpcyBcclxuICAgIC8vIFRvcnF1ZSA9IENsdXRjaFN0cmVuZ3RoICogKFZlbG9jaXR5IEVuZ2luZSAtIEF2ZyBWZWxvY2l0eSBXaGVlbHMgQXQgQ2x1dGNoKSAodW5pdHM6IGsgbV4yIHNeLTEpXHJcbiAgICBfY2x1dGNoU3RyZW5ndGggPSAxMDtcclxuXHJcbiAgICAvLyBMaXN0IG9mIGRpZmZlcmVudGlhbHMgYW5kIHRoZWlyIHByb3BlcnRpZXNcclxuICAgIF9kaWZmZXJlbnRpYWxzID0gW107XHJcblxyXG4gICAgLy8gVXNlZCB3aGVuIHZlaGljbGUgaXMgb2Ygd2hlZWxlZCB0eXBlLiBSYXRpbyBtYXggLyBtaW4gYXZlcmFnZSB3aGVlbCBzcGVlZCBvZiBlYWNoIGRpZmZlcmVudGlhbFxyXG4gICAgLy8gKG1lYXN1cmVkIGF0IHRoZSBjbHV0Y2gpLiBXaGVuIHRoZSByYXRpbyBpcyBleGNlZWRlZCBhbGwgdG9ycXVlIGdldHMgZGlzdHJpYnV0ZWQgdG8gdGhlIGRpZmZlcmVudGlhbFxyXG4gICAgLy8gd2l0aCB0aGUgbWluaW1hbCBhdmVyYWdlIHZlbG9jaXR5LiBUaGlzIGFsbG93cyBpbXBsZW1lbnRpbmcgYSBsaW1pdGVkIHNsaXAgZGlmZmVyZW50aWFsIGJldHdlZW5cclxuICAgIC8vIGRpZmZlcmVudGlhbHMuIFNldCB0byBOdW1iZXIuTUFYX1ZBTFVFIGZvciBhbiBvcGVuIGRpZmZlcmVudGlhbC4gVmFsdWUgc2hvdWxkIGJlID4gMS5cclxuICAgIF9kaWZmZXJlbnRpYWxMaW1pdGVkU2xpcFJhdGlvID0gMS40O1xyXG5cclxuICAgIC8vIEFuIGFudGkgcm9sbGJhciBpcyBhIHN0aWZmIHNwcmluZyB0aGF0IGNvbm5lY3RzIHR3byB3aGVlbHMgdG8gcmVkdWNlIHRoZSBhbW91bnQgb2Ygcm9sbCB0aGVcclxuICAgIC8vIHZlaGljbGUgbWFrZXMgaW4gc2hhcnAgY29ybmVycyBTZWU6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0FudGktcm9sbF9iYXJcclxuICAgIF9hbnRpUm9sbEJhcnMgPSBbXTsgICAgXHJcblxyXG4gICAgLy8gQ29sbGlzaW9uIHRlc3RlciB0aGF0IHRlc3RzIHdoZWVscyBjb2xsaXNpb24uXHJcbiAgICAvLyAtIFZFSElDTEVfQ0FTVF9UWVBFX1JBWVxyXG4gICAgLy8gLSBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkVcclxuICAgIC8vIC0gVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVIgXHJcbiAgICBfY2FzdFR5cGUgPSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVk7XHJcblxyXG4gICAgLy8gT2JqZWN0IGxheWVyIHRvIHRlc3QgY29sbGlzaW9uIHdpdGguXHJcbiAgICBfY2FzdE9iamVjdExheWVyID0gT0JKRUNUX0xBWUVSX01PVklORztcclxuXHJcbiAgICAvLyBXb3JsZCBzcGFjZSB1cCB2ZWN0b3IsIHVzZWQgdG8gYXZvaWQgY29sbGlkaW5nIHdpdGggdmVydGljYWwgd2FsbHMuXHJcbiAgICBfY2FzdFVwID0gcGMuVmVjMy5VUDtcclxuXHJcbiAgICAvLyBNYXggYW5nbGUgKHJhZCkgdGhhdCBpcyBjb25zaWRlcmVkIGZvciBjb2xsaWRpbmcgd2hlZWxzLiBUaGlzIGlzIHRvIGF2b2lkIGNvbGxpZGluZ1xyXG4gICAgLy8gd2l0aCB2ZXJ0aWNhbCB3YWxscy4gRGVmYXVsdHMgdG8gfjEuNCByYWQgKDgwIGRlZ3JlZXMpLlxyXG4gICAgX2Nhc3RNYXhTbG9wZUFuZ2xlID0gMS4zOTYyNjM0MDE1OTU0NjM2O1xyXG5cclxuICAgIC8vIFNldHMgdGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlIHVzZWQgaW4gY2FzdC5cclxuICAgIF9jYXN0UmFkaXVzID0gMC4zO1xyXG5cclxuICAgIC8vIEZyYWN0aW9uIG9mIGhhbGYgdGhlIHdoZWVsIHdpZHRoIChvciB3aGVlbCByYWRpdXMgaWYgaXQgaXMgc21hbGxlcikgdGhhdCBpcyB1c2VkIGFzIHRoZSBjb252ZXggcmFkaXVzXHJcbiAgICBfY2FzdEZyYWN0aW9uID0gMC4xO1xyXG5cclxuICAgIC8vIEhvdyBmYXIgd2UncmUgd2lsbGluZyB0byBtYWtlIHRoZSBiaWtlIGxlYW4gb3ZlciBpbiB0dXJucyAoaW4gcmFkaWFucylcclxuICAgIF9tYXhMZWFuQW5nbGUgPSA0NTtcclxuICAgIFxyXG4gICAgLy8gU3ByaW5nIGNvbnN0YW50IGZvciB0aGUgbGVhbiBzcHJpbmcuXHJcbiAgICBfbGVhblNwcmluZ0NvbnN0YW50ID0gNTAwMDtcclxuXHJcbiAgICAvLyBTcHJpbmcgZGFtcGluZyBjb25zdGFudCBmb3IgdGhlIGxlYW4gc3ByaW5nLlxyXG4gICAgX2xlYW5TcHJpbmdEYW1waW5nID0gMTAwMDtcclxuXHJcbiAgICAvLyBUaGUgbGVhbiBzcHJpbmcgYXBwbGllcyBhbiBhZGRpdGlvbmFsIGZvcmNlIGVxdWFsIHRvIHRoaXMgY29lZmZpY2llbnQgKiBJbnRlZ3JhbChkZWx0YSBhbmdsZSwgMCwgdCksXHJcbiAgICAvLyB0aGlzIGVmZmVjdGl2ZWx5IG1ha2VzIHRoZSBsZWFuIHNwcmluZyBhIFBJRCBjb250cm9sbGVyLlxyXG4gICAgX2xlYW5TcHJpbmdJbnRlZ3JhdGlvbkNvZWZmaWNpZW50ID0gMDtcclxuXHJcbiAgICAvLyBIb3cgbXVjaCB0byBkZWNheSB0aGUgYW5nbGUgaW50ZWdyYWwgd2hlbiB0aGUgd2hlZWxzIGFyZSBub3QgdG91Y2hpbmcgdGhlIGZsb29yOlxyXG4gICAgLy8gbmV3X3ZhbHVlID0gZV4oLWRlY2F5ICogdCkgKiBpbml0aWFsX3ZhbHVlLlxyXG4gICAgX2xlYW5TcHJpbmdJbnRlZ3JhdGlvbkNvZWZmaWNpZW50RGVjYXkgPSA0O1xyXG5cclxuICAgIC8vIEhvdyBtdWNoIHRvIHNtb290aCB0aGUgbGVhbiBhbmdsZSAoMCA9IG5vIHNtb290aGluZywgMSA9IGxlYW4gYW5nbGUgbmV2ZXIgY2hhbmdlcykuIE5vdGUgdGhhdCB0aGlzXHJcbiAgICAvLyBpcyBmcmFtZSByYXRlIGRlcGVuZGVudCBiZWNhdXNlIHRoZSBmb3JtdWxhIGlzOiBzbW9vdGhpbmdfZmFjdG9yICogcHJldmlvdXMgKyAoMSAtIHNtb290aGluZ19mYWN0b3IpICogY3VycmVudFxyXG4gICAgX2xlYW5TbW9vdGhpbmdGYWN0b3IgPSAwLjg7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc3lzdGVtLCBlbnRpdHkpIHtcclxuICAgICAgICBzdXBlcihzeXN0ZW0sIGVudGl0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVWZWhpY2xlRGF0YShjYikge1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLl90eXBlO1xyXG5cclxuICAgICAgICAvLyBnZW5lcmFsIHZlaGljbGUgZGF0YVxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZGV4LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodHlwZSwgQlVGRkVSX1dSSVRFX1VJTlQ4LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbnVtVmVsb2NpdHlTdGVwc092ZXJyaWRlLCBCVUZGRVJfV1JJVEVfVUlOVDE2LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbnVtVmVsb2NpdHlTdGVwc092ZXJyaWRlLCBCVUZGRVJfV1JJVEVfVUlOVDE2LCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fdXAsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2ZvcndhcmQsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heFBpdGNoUm9sbEFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAvLyBlbmdpbmUgZGF0YVxyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX21heFRvcnF1ZSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9taW5SUE0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4UlBNLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2luZXJ0aWEsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fYW5ndWxhckRhbXBpbmcsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgVmVoaWNsZUNvbXBvbmVudC53cml0ZUN1cnZlUG9pbnRzKGNiLCB0aGlzLl9ub3JtYWxpemVkVG9ycXVlKTtcclxuXHJcbiAgICAgICAgLy8gdHJhbnNtaXNzaW9uIGRhdGFcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9tb2RlLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zd2l0Y2hUaW1lLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2NsdXRjaFJlbGVhc2VUaW1lLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX3N3aXRjaExhdGVuY3ksIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fc2hpZnRVcFJQTSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICBjYi53cml0ZSh0aGlzLl9zaGlmdERvd25SUE0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgY2Iud3JpdGUodGhpcy5fY2x1dGNoU3RyZW5ndGgsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgVmVoaWNsZUNvbXBvbmVudC53cml0ZUdlYXJzKGNiLCB0aGlzLl9nZWFyUmF0aW9zKTtcclxuICAgICAgICBWZWhpY2xlQ29tcG9uZW50LndyaXRlR2VhcnMoY2IsIHRoaXMuX3JldmVyc2VHZWFyUmF0aW9zKTtcclxuXHJcbiAgICAgICAgLy8gd2hlZWxzIGRhdGFcclxuICAgICAgICBjb25zdCBpc1doZWVsZWQgPSB0eXBlID09PSBWRUhJQ0xFX1RZUEVfV0hFRUwgfHwgdHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEU7XHJcbiAgICAgICAgaWYgKGlzV2hlZWxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLl93cml0ZVdoZWVsc0RhdGEoY2IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3dyaXRlVHJhY2tzRGF0YShjYik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaXNXaGVlbGVkKSB7XHJcbiAgICAgICAgICAgIC8vIGRpZmZlcmVudGlhbHNcclxuICAgICAgICAgICAgdGhpcy5fd3JpdGVEaWZmZXJlbnRpYWxzKGNiKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fZGlmZmVyZW50aWFsTGltaXRlZFNsaXBSYXRpbywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBWRUhJQ0xFX1RZUEVfTU9UT1JDWUNMRSkge1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fbWF4TGVhbkFuZ2xlLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVhblNwcmluZ0NvbnN0YW50LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fbGVhblNwcmluZ0RhbXBpbmcsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9sZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKHRoaXMuX2xlYW5TcHJpbmdJbnRlZ3JhdGlvbkNvZWZmaWNpZW50RGVjYXksIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9sZWFuU21vb3RoaW5nRmFjdG9yLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl93cml0ZUFudGlSb2xsQmFycyhjYik7XHJcblxyXG4gICAgICAgIC8vIGNhc3QgdHlwZVxyXG4gICAgICAgIGNvbnN0IGNhc3RUeXBlID0gdGhpcy5fY2FzdFR5cGU7XHJcbiAgICAgICAgY2Iud3JpdGUoY2FzdFR5cGUsIEJVRkZFUl9XUklURV9VSU5UOCwgZmFsc2UpO1xyXG4gICAgICAgIGNiLndyaXRlKHRoaXMuX2Nhc3RPYmplY3RMYXllciwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIHN3aXRjaCAoY2FzdFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBWRUhJQ0xFX0NBU1RfVFlQRV9SQVk6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9jYXN0VXAsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdE1heFNsb3BlQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBWRUhJQ0xFX0NBU1RfVFlQRV9TUEhFUkU6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9jYXN0VXAsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY2Iud3JpdGUodGhpcy5fY2FzdE1heFNsb3BlQW5nbGUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9jYXN0UmFkaXVzLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVkVISUNMRV9DQVNUX1RZUEVfQ1lMSU5ERVI6XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0aGlzLl9jYXN0RnJhY3Rpb24sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQW55IHR5cGU6XHJcbiAgICAvLyAgICAgIGlucHV0MCAtIFZhbHVlIGJldHdlZW4gLTEgYW5kIDEgZm9yIGF1dG8gdHJhbnNtaXNzaW9uIGFuZCB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEgaW5kaWNhdGluZyBcclxuICAgIC8vICAgICAgICAgICAgICBkZXNpcmVkIGRyaXZpbmcgZGlyZWN0aW9uIGFuZCBhbW91bnQgdGhlIGdhcyBwZWRhbCBpcyBwcmVzc2VkXHJcbiAgICAvLyBXaGVlbGVkOlxyXG4gICAgLy8gICAgICBpbnB1dDEgLSBWYWx1ZSBiZXR3ZWVuIC0xIGFuZCAxIGluZGljYXRpbmcgZGVzaXJlZCBzdGVlcmluZyBhbmdsZSAoMSA9IHJpZ2h0KVxyXG4gICAgLy8gICAgICBpbnB1dDIgLSBWYWx1ZSBiZXR3ZWVuIDAgYW5kIDEgaW5kaWNhdGluZyBob3cgc3Ryb25nIHRoZSBicmFrZSBwZWRhbCBpcyBwcmVzc2VkXHJcbiAgICAvLyAgICAgIGlucHV0MyAtIFZhbHVlIGJldHdlZW4gMCBhbmQgMSBpbmRpY2F0aW5nIGhvdyBzdHJvbmcgdGhlIGhhbmQgYnJha2UgaXMgcHVsbGVkXHJcbiAgICAvLyBUcmFja2VkOlxyXG4gICAgLy8gICAgICBpbnB1dDEgLSBWYWx1ZSBiZXR3ZWVuIC0xIGFuZCAxIGluZGljYXRpbmcgYW4gZXh0cmEgbXVsdGlwbGllciB0byB0aGUgcm90YXRpb24gcmF0ZSBvZiB0aGUgbGVmdCB0cmFjayAodXNlZCBmb3Igc3RlZXJpbmcpXHJcbiAgICAvLyAgICAgIGlucHV0MiAtIFZhbHVlIGJldHdlZW4gLTEgYW5kIDEgaW5kaWNhdGluZyBhbiBleHRyYSBtdWx0aXBsaWVyIHRvIHRoZSByb3RhdGlvbiByYXRlIG9mIHRoZSByaWdodCB0cmFjayAodXNlZCBmb3Igc3RlZXJpbmcpXHJcbiAgICAvLyAgICAgIGlucHV0MyAtIFZhbHVlIGJldHdlZW4gMCBhbmQgMSBpbmRpY2F0aW5nIGhvdyBzdHJvbmcgdGhlIGJyYWtlIHBlZGFsIGlzIHByZXNzZWRcclxuICAgIHNldERyaXZlcklucHV0KGlucHV0MCwgaW5wdXQxLCBpbnB1dDIsIGlucHV0Mykge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tSYW5nZShpbnB1dDAsIC0xLCAxLCBgSW52YWxpZCBkcml2ZXIgaW5wdXQgZm9yIGZvcndhcmQgKGlucHV0MCkuIEV4cGVjdGVkIGEgbnVtYmVyIGluIFstMToxXSByYW5nZS4gUmVjZWl2ZWQ6ICR7IGlucHV0MCB9YCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl90eXBlID09PSBWRUhJQ0xFX1RZUEVfV0hFRUwgfHwgdGhpcy5fdHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUpIHtcclxuICAgICAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tSYW5nZShpbnB1dDEsIC0xLCAxLCBgSW52YWxpZCBkcml2ZXIgaW5wdXQgZm9yIHJpZ2h0IChpbnB1dDEpLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbLTE6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDEgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1JhbmdlKGlucHV0MiwgMCwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciBicmFrZSAoaW5wdXQyKS4gRXhwZWN0ZWQgYSBudW1iZXIgaW4gWzA6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDIgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1JhbmdlKGlucHV0MywgMCwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciBoYW5kIGJyYWtlIChpbnB1dDMpLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbMDoxXSByYW5nZS4gUmVjZWl2ZWQ6ICR7IGlucHV0MyB9YCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrUmFuZ2UoaW5wdXQxLCAtMSwgMSwgYEludmFsaWQgZHJpdmVyIGlucHV0IGZvciBsZWZ0IHJhdGlvIChpbnB1dDEpLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbLTE6MV0gcmFuZ2UuIFJlY2VpdmVkOiAkeyBpbnB1dDEgfWApO1xyXG4gICAgICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1JhbmdlKGlucHV0MiwgLTEsIDEsIGBJbnZhbGlkIGRyaXZlciBpbnB1dCBmb3IgcmlnaHQgcmF0aW8gKGlucHV0MikuIEV4cGVjdGVkIGEgbnVtYmVyIGluIFstMToxXSByYW5nZS4gUmVjZWl2ZWQ6ICR7IGlucHV0MiB9YCk7XHJcbiAgICAgICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrUmFuZ2UoaW5wdXQzLCAwLCAxLCBgSW52YWxpZCBkcml2ZXIgaW5wdXQgZm9yIGJyYWtlIChpbnB1dDMpLiBFeHBlY3RlZCBhIG51bWJlciBpbiBbMDoxXSByYW5nZS4gUmVjZWl2ZWQ6ICR7IGlucHV0MyB9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFvaylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3lzdGVtLmFkZENvbW1hbmQoXHJcbiAgICAgICAgICAgIE9QRVJBVE9SX01PRElGSUVSLCBDTURfU0VUX0RSSVZFUl9JTlBVVCwgdGhpcy5faW5kZXgsXHJcbiAgICAgICAgICAgIGlucHV0MCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlLFxyXG4gICAgICAgICAgICBpbnB1dDEsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSxcclxuICAgICAgICAgICAgaW5wdXQyLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UsXHJcbiAgICAgICAgICAgIGlucHV0MywgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkVuYWJsZSgpIHtcclxuICAgICAgICBjb25zdCBzeXN0ZW0gPSB0aGlzLnN5c3RlbTtcclxuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSBzeXN0ZW0uZ2V0SW5kZXgodGhpcy5lbnRpdHkpO1xyXG5cclxuICAgICAgICBzeXN0ZW0uY3JlYXRlVmVoaWNsZSh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVUcmFja3NEYXRhKGNiKSB7XHJcbiAgICAgICAgY29uc3QgdHJhY2tzID0gdGhpcy5fdHJhY2tzO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gdHJhY2tzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldiAmJiBjb3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICBEZWJ1Zy53YXJuKCdJbnZhbGlkIHRyYWNrcyBkYXRhLiBOZWVkIGF0IGxlYXN0IG9uZSB0cmFjay4nLCB0cmFja3MpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl93cml0ZVdoZWVsc0RhdGEoY2IpO1xyXG5cclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgY291bnQ7IHQrKykge1xyXG4gICAgICAgICAgICBjb25zdCB0cmFjayA9IHRyYWNrc1t0XTtcclxuICAgICAgICAgICAgY29uc3Qgd2hlZWxzQ291bnQgPSB0cmFjay5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBjYi53cml0ZSh3aGVlbHNDb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbHNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZSh0cmFja1tpXSwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF93cml0ZVdoZWVsc0RhdGEoY2IpIHtcclxuICAgICAgICBjb25zdCB3aGVlbHMgPSB0aGlzLl93aGVlbHM7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSB3aGVlbHMubGVuZ3RoO1xyXG5cclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZGVzYyA9IHdoZWVsc1tpXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvayA9IERlYnVnLmFzc2VydChkZXNjLnBvc2l0aW9uLCBcclxuICAgICAgICAgICAgICAgICAgICAnQSB3aGVlbCBkZXNjcmlwdGlvbiByZXF1aXJlcyBhbiBhdHRhY2htZW50IHBvc2l0aW9uIG9mIHdoZWVsJyArXHJcbiAgICAgICAgICAgICAgICAgICAgJ3N1c3BlbnNpb24gaW4gbG9jYWwgc3BhY2Ugb2YgdGhlIHZlaGljbGUnLCBkZXNjKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNwcmluZyA9IGRlc2Muc3ByaW5nO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNwcmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgc3RpZmZuZXNzLCBmcmVxdWVuY3kgfSA9IHNwcmluZztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RpZmZuZXNzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuYXNzZXJ0KHN0aWZmbmVzcyAhPT0gMCwgJ1doZWVsIHNwcmluZyBzdGlmZm5lc3MgY2Fubm90IGJlIHplcm8nLCBzcHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJlcXVlbmN5ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGZyZXF1ZW5jeSAhPT0gMCwgJ1doZWVsIHNwcmluZyBmcmVxdWVuY3kgY2Fubm90IGJlIHplcm8nLCBzcHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2spXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBdHRhY2htZW50IHBvaW50IG9mIHdoZWVsIHN1c3BlbnNpb24gaW4gbG9jYWwgc3BhY2Ugb2YgdGhlIGJvZHkuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2MucG9zaXRpb24sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gV2hlcmUgdGlyZSBmb3JjZXMgKHN1c3BlbnNpb24gYW5kIHRyYWN0aW9uKSBhcmUgYXBwbGllZCwgaW4gbG9jYWwgc3BhY2Ugb2YgdGhlIGJvZHkuIFxyXG4gICAgICAgICAgICAvLyBBIGdvb2QgZGVmYXVsdCBpcyB0aGUgY2VudGVyIG9mIHRoZSB3aGVlbCBpbiBpdHMgbmV1dHJhbCBwb3NlLiBTZWUgZW5hYmxlU3VzcGVuc2lvbkZvcmNlUG9pbnQuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2Muc3VzcGVuc2lvbkZvcmNlUG9pbnQgfHwgcGMuVmVjMy5aRVJPLCBCVUZGRVJfV1JJVEVfVkVDMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIERpcmVjdGlvbiBvZiB0aGUgc3VzcGVuc2lvbiBpbiBsb2NhbCBzcGFjZSBvZiB0aGUgYm9keSwgc2hvdWxkIHBvaW50IGRvd24uXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2Muc3VzcGVuc2lvbkRpcmVjdGlvbiB8fCBwYy5WZWMzLkRPV04sIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gRGlyZWN0aW9uIG9mIHRoZSBzdGVlcmluZyBheGlzIGluIGxvY2FsIHNwYWNlIG9mIHRoZSBib2R5LCBzaG91bGQgcG9pbnQgdXAgKGUuZy4gZm9yIGEgXHJcbiAgICAgICAgICAgIC8vIGJpa2Ugd291bGQgYmUgLXN1c3BlbnNpb25EaXJlY3Rpb24pXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2Muc3RlZXJpbmdBeGlzIHx8IHBjLlZlYzMuVVAsIEJVRkZFUl9XUklURV9WRUMzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gVXAgZGlyZWN0aW9uIHdoZW4gdGhlIHdoZWVsIGlzIGluIHRoZSBuZXV0cmFsIHN0ZWVyaW5nIHBvc2l0aW9uICh1c3VhbGx5IFxyXG4gICAgICAgICAgICAvLyBjb21wb25lbnQudXAgYnV0IGNhbiBiZSB1c2VkIHRvIGdpdmUgdGhlIHdoZWVsIGNhbWJlciBvciBmb3IgYSBiaWtlIHdvdWxkIGJlIC1zdXNwZW5zaW9uRGlyZWN0aW9uKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLndoZWVsVXAgfHwgcGMuVmVjMy5VUCwgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBGb3J3YXJkIGRpcmVjdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBpbiB0aGUgbmV1dHJhbCBzdGVlcmluZyBwb3NpdGlvbiAodXN1YWxseSBcclxuICAgICAgICAgICAgLy8gY29tcG9uZW50LmZvcndhcmQgYnV0IGNhbiBiZSB1c2VkIHRvIGdpdmUgdGhlIHdoZWVsIHRvZSwgZG9lcyBub3QgbmVlZCB0byBiZSBwZXJwZW5kaWN1bGFyXHJcbiAgICAgICAgICAgIC8vIHRvIHdoZWVsVXApXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRlc2Mud2hlZWxGb3J3YXJkIHx8IHBjLlZlYzMuQkFDSywgQlVGRkVSX1dSSVRFX1ZFQzMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBIb3cgbG9uZyB0aGUgc3VzcGVuc2lvbiBpcyBpbiBtYXggcmFpc2VkIHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBhdHRhY2htZW50IHBvaW50IChtKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnN1c3BlbnNpb25NaW5MZW5ndGggPz8gMC4zLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gSG93IGxvbmcgdGhlIHN1c3BlbnNpb24gaXMgaW4gbWF4IGRyb29wIHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBhdHRhY2htZW50IHBvaW50IChtKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLnN1c3BlbnNpb25NYXhMZW5ndGggPz8gMC41LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGhlIG5hdHVyYWwgbGVuZ3RoIChtKSBvZiB0aGUgc3VzcGVuc2lvbiBzcHJpbmcgaXMgZGVmaW5lZCBhcyBzdXNwZW5zaW9uTWF4TGVuZ3RoICsgXHJcbiAgICAgICAgICAgIC8vIHN1c3BlbnNpb25QcmVsb2FkTGVuZ3RoLiBDYW4gYmUgdXNlZCB0byBwcmVsb2FkIHRoZSBzdXNwZW5zaW9uIGFzIHRoZSBzcHJpbmcgaXMgY29tcHJlc3NlZFxyXG4gICAgICAgICAgICAvLyBieSBzdXNwZW5zaW9uUHJlbG9hZExlbmd0aCB3aGVuIHRoZSBzdXNwZW5zaW9uIGlzIGluIG1heCBkcm9vcCBwb3NpdGlvbi4gTm90ZSB0aGF0IHRoaXMgbWVhbnNcclxuICAgICAgICAgICAgLy8gd2hlbiB0aGUgdmVoaWNsZSB0b3VjaGVzIHRoZSBncm91bmQgdGhlcmUgaXMgYSBkaXNjb250aW51aXR5IHNvIGl0IHdpbGwgYWxzbyBtYWtlIHRoZSB2ZWhpY2xlXHJcbiAgICAgICAgICAgIC8vIG1vcmUgYm91bmN5IGFzIHdlJ3JlIHVwZGF0aW5nIHdpdGggZGlzY3JldGUgdGltZSBzdGVwcy5cclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5zdXNwZW5zaW9uUHJlbG9hZExlbmd0aCA/PyAwLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmFkaXVzIG9mIHRoZSB3aGVlbCAobSlcclxuICAgICAgICAgICAgY2Iud3JpdGUoZGVzYy5yYWRpdXMgPz8gMC4zLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gV2lkdGggb2YgdGhlIHdoZWVsIChtKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLndpZHRoID8/IDAuMSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIElmIGRpc2FibGVkLCB0aGUgZm9yY2VzIGFyZSBhcHBsaWVkIGF0IHRoZSBjb2xsaXNpb24gY29udGFjdCBwb2ludC4gVGhpcyBsZWFkcyB0byBhIG1vcmVcclxuICAgICAgICAgICAgLy8gYWNjdXJhdGUgc2ltdWxhdGlvbiB3aGVuIGludGVyYWN0aW5nIHdpdGggZHluYW1pYyBvYmplY3RzIGJ1dCBtYWtlcyB0aGUgdmVoaWNsZSBsZXNzIHN0YWJsZS5cclxuICAgICAgICAgICAgLy8gV2hlbiBzZXR0aW5nIHRoaXMgdG8gdHJ1ZSwgYWxsIGZvcmNlcyB3aWxsIGJlIGFwcGxpZWQgdG8gYSBmaXhlZCBwb2ludCBvbiB0aGUgdmVoaWNsZSBib2R5LlxyXG4gICAgICAgICAgICBjYi53cml0ZShkZXNjLmVuYWJsZVN1c3BlbnNpb25Gb3JjZVBvaW50ID8/IGZhbHNlLCBCVUZGRVJfV1JJVEVfQk9PTCwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gd2hlZWwgc3ByaW5nIGRhdGFcclxuICAgICAgICAgICAgY29uc3Qgc3ByaW5nID0gZGVzYy5zcHJpbmcgfHwge307XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNwcmluZy5tb2RlID8/IHBjLkpPTFRfU1BSSU5HX01PREVfRlJFUVVFTkNZLCBCVUZGRVJfV1JJVEVfVUlOVDgsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2Iud3JpdGUoc3ByaW5nLmZyZXF1ZW5jeSA/PyAxLjUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNiLndyaXRlKHNwcmluZy5zdGlmZm5lc3MgPz8gMS41LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYi53cml0ZShzcHJpbmcuZGFtcGluZyA/PyAwLjUsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBGcmljdGlvbiBpbiBmb3J3YXJkIGRpcmVjdGlvbiBvZiB0aXJlIGFzIGEgZnVuY3Rpb24gb2YgdGhlIHNsaXAgcmF0aW8gKGZyYWN0aW9uKTpcclxuICAgICAgICAgICAgLy8gKG9tZWdhX3doZWVsICogcl93aGVlbCAtIHZfbG9uZ2l0dWRpbmFsKSAvIHx2X2xvbmdpdHVkaW5hbHwuXHJcbiAgICAgICAgICAgIC8vIFNsaXAgcmF0aW8gaGVyZSBpcyBhIHJhdGlvIG9mIHdoZWVsIHNwaW5uaW5nIHJlbGF0aXZlIHRvIHRoZSBmbG9vci4gQXQgMCB0aGUgd2hlZWwgaGFzIGZ1bGxcclxuICAgICAgICAgICAgLy8gdHJhY3Rpb24gYW5kIGlzIHJvbGxpbmcgcGVyZmVjdGx5IGluIHN5bmMgd2l0aCB0aGUgZ3JvdW5kLiBBdCAxIHRoZSB3aGVlbCBpcyBsb2NrZWQgYW5kXHJcbiAgICAgICAgICAgIC8vIGlzIHNsaWRpbmcgb3ZlciB0aGUgZ3JvdW5kLlxyXG4gICAgICAgICAgICBWZWhpY2xlQ29tcG9uZW50LndyaXRlQ3VydmVQb2ludHMoY2IsIGRlc2MubG9uZ2l0dWRpbmFsRnJpY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgLy8gRnJpY3Rpb24gaW4gc2lkZXdheSBkaXJlY3Rpb24gb2YgdGlyZSBhcyBhIGZ1bmN0aW9uIG9mIHRoZSBzbGlwIGFuZ2xlIChkZWdyZWVzKTpcclxuICAgICAgICAgICAgLy8gYW5nbGUgYmV0d2VlbiByZWxhdGl2ZSBjb250YWN0IHZlbG9jaXR5IGFuZCB2ZWhpY2xlIGRpcmVjdGlvbi5cclxuICAgICAgICAgICAgLy8gSWYgdGlyZSBmb3J3YXJkIG1hdGNoZXMgdGhlIHZlaGljbGUgZGlyZWN0aW9uLCB0aGVuIHRoZSBhbmdsZSBpcyAwIGRlZ3JlZXMuIElmIHRoZSBcclxuICAgICAgICAgICAgLy8gdmVoaWNsZSBpcyBzbGlkaW5nIHNpZGV3YXlzLCBlLmcuIG9uIGljZSwgdGhlbiB0aGUgYW5nbGUgaXMgOTAgZGVncmVlcy4gRXhhbXBsZSBjdXJ2ZSBrZXlzIGNvdWxkXHJcbiAgICAgICAgICAgIC8vIGJlOiBbWzAsIDFdLCBbOTAsIDAuM11dIC0gZnVsbCBmcmljdGlvbiBhdCB6ZXJvIGRlZ3JlZXMsIGFuZCAwLjMgZnJpY3Rpb24gYXQgOTAuXHJcbiAgICAgICAgICAgIFZlaGljbGVDb21wb25lbnQud3JpdGVDdXJ2ZVBvaW50cyhjYiwgZGVzYy5sYXRlcmFsRnJpY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMuX3R5cGU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBWRUhJQ0xFX1RZUEVfV0hFRUwgfHwgdHlwZSA9PT0gVkVISUNMRV9UWVBFX01PVE9SQ1lDTEUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNb21lbnQgb2YgaW5lcnRpYSAoa2cgbV4yKSwgZm9yIGEgY3lsaW5kZXIgdGhpcyB3b3VsZCBiZSAwLjUgKiBNICogUl4yIHdoaWNoIGlzIFxyXG4gICAgICAgICAgICAgICAgLy8gMC45IGZvciBhIHdoZWVsIHdpdGggYSBtYXNzIG9mIDIwIGtnIGFuZCByYWRpdXMgMC4zIG0uXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkZXNjLmluZXJ0aWEgPz8gMC45LCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFuZ3VsYXIgZGFtcGluZyBmYWN0b3Igb2YgdGhlIHdoZWVsOiBkdy9kdCA9IC1jICogdy5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRlc2MuYW5ndWxhckRhbXBpbmcgPz8gMC4yLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEhvdyBtdWNoIHRoaXMgd2hlZWwgY2FuIHN0ZWVyIChyYWRpYW5zKS4gRGVmYXVsdHMgdG8gfjEuMjIgcmFkICg3MCBkZWdyZWVzKS5cclxuICAgICAgICAgICAgICAgIGNiLndyaXRlKGRlc2MubWF4U3RlZXJBbmdsZSA/PyAxLjIyMTczMDQ3NjM5NjAzMDYsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIEhvdyBtdWNoIHRvcnF1ZSAoTm0pIHRoZSBicmFrZXMgY2FuIGFwcGx5IHRvIHRoaXMgd2hlZWwuXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkZXNjLm1heEJyYWtlVG9ycXVlID8/IDE1MDAsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSG93IG11Y2ggdG9ycXVlIChObSkgdGhlIGhhbmQgYnJha2UgY2FuIGFwcGx5IHRvIHRoaXMgd2hlZWwgKHVzdWFsbHkgb25seSBhcHBsaWVkXHJcbiAgICAgICAgICAgICAgICAvLyB0byB0aGUgcmVhciB3aGVlbHMpXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShkZXNjLm1heEhhbmRCcmFrZVRvcnF1ZSA/PyA0MDAwLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF93cml0ZURpZmZlcmVudGlhbHMoY2IpIHtcclxuICAgICAgICBjb25zdCBkaWZmZXJlbnRpYWxzID0gdGhpcy5fZGlmZmVyZW50aWFscztcclxuICAgICAgICBjb25zdCBjb3VudCA9IGRpZmZlcmVudGlhbHMubGVuZ3RoO1xyXG5cclxuICAgICAgICBpZiAoRGVidWcuZGV2ICYmIGNvdW50ID09PSAwKSB7XHJcbiAgICAgICAgICAgIERlYnVnLndhcm5PbmNlKCdWZWhpY2xlIGNvbXBvbmVudCBpcyBtaXNzaW5nIHdoZWVscyBkaWZmZXJlbnRpYWxzLicgK1xyXG4gICAgICAgICAgICAgICAgJ0RlZmF1bHQgdmFsdWVzIHdpbGwgbWFrZSBhIHZlaGljbGUgd2l0aG91dCB3aGVlbHMuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYi53cml0ZShjb3VudCwgQlVGRkVSX1dSSVRFX1VJTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZGlmZiA9IGRpZmZlcmVudGlhbHNbaV07XHJcblxyXG4gICAgICAgICAgICAvLyBJbmRleCAoaW4gbVdoZWVscykgdGhhdCByZXByZXNlbnRzIHRoZSBsZWZ0IHdoZWVsIG9mIHRoaXMgXHJcbiAgICAgICAgICAgIC8vIGRpZmZlcmVudGlhbCAoY2FuIGJlIC0xIHRvIGluZGljYXRlIG5vIHdoZWVsKVxyXG4gICAgICAgICAgICBjYi53cml0ZShkaWZmLmxlZnRXaGVlbCA/PyAtMSwgQlVGRkVSX1dSSVRFX0lOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBTYW1lIGFzIGxlZnRXaGVlbCwgYnV0IGZvciB0aGUgcmlnaHQgb25lLlxyXG4gICAgICAgICAgICBjYi53cml0ZShkaWZmLnJpZ2h0V2hlZWwgPz8gLTEsIEJVRkZFUl9XUklURV9JTlQzMiwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmF0aW8gYmV0d2VlbiByb3RhdGlvbiBzcGVlZCBvZiBnZWFyIGJveCBhbmQgd2hlZWxzLlxyXG4gICAgICAgICAgICBjYi53cml0ZShkaWZmLmRpZmZlcmVudGlhbFJhdGlvID8/IDMuNDIsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBEZWZpbmVzIGhvdyB0aGUgZW5naW5lIHRvcnF1ZSBpcyBzcGxpdCBhY3Jvc3MgdGhlIGxlZnQgYW5kIHJpZ2h0IFxyXG4gICAgICAgICAgICAvLyB3aGVlbCAoMCA9IGxlZnQsIDAuNSA9IGNlbnRlciwgMSA9IHJpZ2h0KVxyXG4gICAgICAgICAgICBjYi53cml0ZShkaWZmLmxlZnRSaWdodFNwbGl0ID8/IDAuNSwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJhdGlvIG1heCAvIG1pbiB3aGVlbCBzcGVlZC4gV2hlbiB0aGlzIHJhdGlvIGlzIGV4Y2VlZGVkLCBhbGxcclxuICAgICAgICAgICAgLy8gdG9ycXVlIGdldHMgZGlzdHJpYnV0ZWQgdG8gdGhlIHNsb3dlc3QgbW92aW5nIHdoZWVsLiBUaGlzIGFsbG93c1xyXG4gICAgICAgICAgICAvLyBpbXBsZW1lbnRpbmcgYSBsaW1pdGVkIHNsaXAgZGlmZmVyZW50aWFsLiBTZXQgdG8gTnVtYmVyLk1BWF9WQUxVRVxyXG4gICAgICAgICAgICAvLyBmb3IgYW4gb3BlbiBkaWZmZXJlbnRpYWwuIFZhbHVlIHNob3VsZCBiZSA+IDEuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGRpZmYubGltaXRlZFNsaXBSYXRpbyA/PyAxLjQsIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBIb3cgbXVjaCBvZiB0aGUgZW5naW5lcyB0b3JxdWUgaXMgYXBwbGllZCB0byB0aGlzIGRpZmZlcmVudGlhbFxyXG4gICAgICAgICAgICAvLyAoMCA9IG5vbmUsIDEgPSBmdWxsKSwgbWFrZSBzdXJlIHRoZSBzdW0gb2YgYWxsIGRpZmZlcmVudGlhbHMgaXMgMS5cclxuICAgICAgICAgICAgY2Iud3JpdGUoZGlmZi5lbmdpbmVUb3JxdWVSYXRpbyA/PyAxLCBCVUZGRVJfV1JJVEVfRkxPQVQzMiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfd3JpdGVBbnRpUm9sbEJhcnMoY2IpIHtcclxuICAgICAgICBjb25zdCBiYXJzID0gdGhpcy5fYW50aVJvbGxCYXJzO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gYmFycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGNiLndyaXRlKGNvdW50LCBCVUZGRVJfV1JJVEVfVUlOVDMyLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBiYXIgPSBiYXJzW2ldO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5kZXggKGluIHdoZWVscykgdGhhdCByZXByZXNlbnRzIHRoZSBsZWZ0IHdoZWVsIG9mIHRoaXMgYW50aS1yb2xsYmFyLlxyXG4gICAgICAgICAgICBjYi53cml0ZShiYXIubGVmdFdoZWVsID8/IDAsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluZGV4IChpbiB3aGVlbHMpIHRoYXQgcmVwcmVzZW50cyB0aGUgcmlnaHQgd2hlZWwgb2YgdGhpcyBhbnRpLXJvbGxiYXIuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGJhci5yaWdodFdoZWVsID8/IDEsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN0aWZmbmVzcyAoc3ByaW5nIGNvbnN0YW50IGluIE4vbSkgb2YgYW50aSByb2xsYmFyLCBjYW4gYmUgMCB0byBkaXNhYmxlIHRoZSBhbnRpLXJvbGxiYXIuXHJcbiAgICAgICAgICAgIGNiLndyaXRlKGJhci5zdGlmZm5lc3MgPz8gMTAwMCwgQlVGRkVSX1dSSVRFX0ZMT0FUMzIsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlQ3VydmVQb2ludHMoY2IsIGN1cnZlKSB7XHJcbiAgICAgICAgY2Iud3JpdGUoISFjdXJ2ZSwgQlVGRkVSX1dSSVRFX0JPT0wsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgaWYgKGN1cnZlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBjdXJ2ZS5rZXlzO1xyXG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IGtleXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShrZXlbMF0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBjYi53cml0ZShrZXlbMV0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdyaXRlR2VhcnMoY2IsIGdlYXJzKSB7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBnZWFycy5sZW5ndGg7XHJcbiAgICAgICAgY2Iud3JpdGUoY291bnQsIEJVRkZFUl9XUklURV9VSU5UMzIsIGZhbHNlKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY2Iud3JpdGUoZ2VhcnNbaV0sIEJVRkZFUl9XUklURV9GTE9BVDMyLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSAgICBcclxufVxyXG5cclxuZXhwb3J0IHsgVmVoaWNsZUNvbXBvbmVudCB9O1xyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/vehicle/component.mjs\n");

/***/ }),

/***/ "./src/physics/components/jolt/vehicle/system.mjs":
/*!********************************************************!*\
  !*** ./src/physics/components/jolt/vehicle/system.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VehicleComponentSystem: () => (/* binding */ VehicleComponentSystem)\n/* harmony export */ });\n/* harmony import */ var _util_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util.mjs */ \"./src/physics/util.mjs\");\n/* harmony import */ var _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _constants_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _component_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./component.mjs */ \"./src/physics/components/jolt/vehicle/component.mjs\");\n\r\n\r\n\r\n\r\n\r\nconst schema = [\r\n    'antiRollBars',\r\n    'angularDamping',\r\n    'castFraction',\r\n    'castMaxSlopeAngle',\r\n    'castObjectLayer',\r\n    'castRadius',\r\n    'castType',\r\n    'castUp',\r\n    'clutchReleaseTime',\r\n    'clutchStrength',\r\n    'differentialLimitedSlipRatio',\r\n    'differentials',\r\n    'forward',\r\n    'gearRatios',\r\n    'inertia',\r\n    'numVelocityStepsOverride',\r\n    'leanSmoothingFactor',\r\n    'leanSpringConstant',\r\n    'leanSpringDamping',\r\n    'leanSpringIntegrationCoefficient',\r\n    'leanSpringIntegrationCoefficientDecay',\r\n    'maxLeanAngle',\r\n    'numPositionStepsOverride',\r\n    'maxPitchRollAngle',\r\n    'maxTorque',\r\n    'maxRPM',\r\n    'minRPM',\r\n    'mode',\r\n    'normalizedTorque',\r\n    'reverseGearRatios',\r\n    'shiftDownRPM',\r\n    'shiftUpRPM',\r\n    'switchLatency',\r\n    'switchTime',\r\n    'tracks',\r\n    'type',\r\n    'wheels',\r\n    'up'\r\n\r\n];\r\n\r\nclass VehicleComponentSystem extends _body_system_mjs__WEBPACK_IMPORTED_MODULE_1__.BodyComponentSystem {\r\n    constructor(app, manager, id) {\r\n        super(app, manager);\r\n\r\n        this.id = 'vehicle';\r\n        this.schema = [...this.schema, ...schema];\r\n        this.ComponentType = _component_mjs__WEBPACK_IMPORTED_MODULE_3__.VehicleComponent;\r\n\r\n        manager.systems.set(id, this);\r\n\r\n        (0,_util_mjs__WEBPACK_IMPORTED_MODULE_0__.buildAccessors)(this, this.schema);\r\n    }\r\n\r\n    createVehicle(component) {\r\n        super.createBody(component);\r\n\r\n        const cb = this._manager.commandsBuffer;\r\n\r\n        cb.writeOperator(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.OPERATOR_CREATOR);\r\n        cb.writeCommand(_constants_mjs__WEBPACK_IMPORTED_MODULE_2__.CMD_CREATE_VEHICLE);\r\n\r\n        component.writeVehicleData(cb);\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvdmVoaWNsZS9zeXN0ZW0ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUGh5c2ljc0NvbXBvbmVudHMvLi9zcmMvcGh5c2ljcy9jb21wb25lbnRzL2pvbHQvdmVoaWNsZS9zeXN0ZW0ubWpzPzQ4MTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRBY2Nlc3NvcnMgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbC5tanNcIjtcclxuaW1wb3J0IHsgQm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuLi9ib2R5L3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgQ01EX0NSRUFURV9WRUhJQ0xFLCBDT01QT05FTlRfU1lTVEVNX1ZFSElDTEUsIE9QRVJBVE9SX0NSRUFUT1IgfSBmcm9tIFwiLi4vY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBWZWhpY2xlQ29tcG9uZW50IH0gZnJvbSBcIi4vY29tcG9uZW50Lm1qc1wiO1xyXG5cclxuY29uc3Qgc2NoZW1hID0gW1xyXG4gICAgJ2FudGlSb2xsQmFycycsXHJcbiAgICAnYW5ndWxhckRhbXBpbmcnLFxyXG4gICAgJ2Nhc3RGcmFjdGlvbicsXHJcbiAgICAnY2FzdE1heFNsb3BlQW5nbGUnLFxyXG4gICAgJ2Nhc3RPYmplY3RMYXllcicsXHJcbiAgICAnY2FzdFJhZGl1cycsXHJcbiAgICAnY2FzdFR5cGUnLFxyXG4gICAgJ2Nhc3RVcCcsXHJcbiAgICAnY2x1dGNoUmVsZWFzZVRpbWUnLFxyXG4gICAgJ2NsdXRjaFN0cmVuZ3RoJyxcclxuICAgICdkaWZmZXJlbnRpYWxMaW1pdGVkU2xpcFJhdGlvJyxcclxuICAgICdkaWZmZXJlbnRpYWxzJyxcclxuICAgICdmb3J3YXJkJyxcclxuICAgICdnZWFyUmF0aW9zJyxcclxuICAgICdpbmVydGlhJyxcclxuICAgICdudW1WZWxvY2l0eVN0ZXBzT3ZlcnJpZGUnLFxyXG4gICAgJ2xlYW5TbW9vdGhpbmdGYWN0b3InLFxyXG4gICAgJ2xlYW5TcHJpbmdDb25zdGFudCcsXHJcbiAgICAnbGVhblNwcmluZ0RhbXBpbmcnLFxyXG4gICAgJ2xlYW5TcHJpbmdJbnRlZ3JhdGlvbkNvZWZmaWNpZW50JyxcclxuICAgICdsZWFuU3ByaW5nSW50ZWdyYXRpb25Db2VmZmljaWVudERlY2F5JyxcclxuICAgICdtYXhMZWFuQW5nbGUnLFxyXG4gICAgJ251bVBvc2l0aW9uU3RlcHNPdmVycmlkZScsXHJcbiAgICAnbWF4UGl0Y2hSb2xsQW5nbGUnLFxyXG4gICAgJ21heFRvcnF1ZScsXHJcbiAgICAnbWF4UlBNJyxcclxuICAgICdtaW5SUE0nLFxyXG4gICAgJ21vZGUnLFxyXG4gICAgJ25vcm1hbGl6ZWRUb3JxdWUnLFxyXG4gICAgJ3JldmVyc2VHZWFyUmF0aW9zJyxcclxuICAgICdzaGlmdERvd25SUE0nLFxyXG4gICAgJ3NoaWZ0VXBSUE0nLFxyXG4gICAgJ3N3aXRjaExhdGVuY3knLFxyXG4gICAgJ3N3aXRjaFRpbWUnLFxyXG4gICAgJ3RyYWNrcycsXHJcbiAgICAndHlwZScsXHJcbiAgICAnd2hlZWxzJyxcclxuICAgICd1cCdcclxuXHJcbl07XHJcblxyXG5jbGFzcyBWZWhpY2xlQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQm9keUNvbXBvbmVudFN5c3RlbSB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHAsIG1hbmFnZXIsIGlkKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBtYW5hZ2VyKTtcclxuXHJcbiAgICAgICAgdGhpcy5pZCA9ICd2ZWhpY2xlJztcclxuICAgICAgICB0aGlzLnNjaGVtYSA9IFsuLi50aGlzLnNjaGVtYSwgLi4uc2NoZW1hXTtcclxuICAgICAgICB0aGlzLkNvbXBvbmVudFR5cGUgPSBWZWhpY2xlQ29tcG9uZW50O1xyXG5cclxuICAgICAgICBtYW5hZ2VyLnN5c3RlbXMuc2V0KGlkLCB0aGlzKTtcclxuXHJcbiAgICAgICAgYnVpbGRBY2Nlc3NvcnModGhpcywgdGhpcy5zY2hlbWEpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVZlaGljbGUoY29tcG9uZW50KSB7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlQm9keShjb21wb25lbnQpO1xyXG5cclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX21hbmFnZXIuY29tbWFuZHNCdWZmZXI7XHJcblxyXG4gICAgICAgIGNiLndyaXRlT3BlcmF0b3IoT1BFUkFUT1JfQ1JFQVRPUik7XHJcbiAgICAgICAgY2Iud3JpdGVDb21tYW5kKENNRF9DUkVBVEVfVkVISUNMRSk7XHJcblxyXG4gICAgICAgIGNvbXBvbmVudC53cml0ZVZlaGljbGVEYXRhKGNiKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgVmVoaWNsZUNvbXBvbmVudFN5c3RlbSB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/components/jolt/vehicle/system.mjs\n");

/***/ }),

/***/ "./src/physics/debug.mjs":
/*!*******************************!*\
  !*** ./src/physics/debug.mjs ***!
  \*******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Debug: () => (/* binding */ Debug)\n/* harmony export */ });\nclass Debug {\r\n    static _logged = new Set();\r\n\r\n    static dev = (\"development\" === 'development');\r\n\r\n    static log(...attr) {\r\n        console.log(...attr);\r\n    }\r\n\r\n    static logOnce(msg, ...attr) {\r\n        if (!Debug._logged.has(msg)) {\r\n            Debug._logged.add(msg);\r\n            console.log(msg, ...attr);\r\n        }\r\n    }\r\n\r\n    static warn(...attr) {\r\n        console.warn(...attr);\r\n    }\r\n\r\n    static warnOnce(msg, ...attr) {\r\n        if (!Debug._logged.has(msg)) {\r\n            Debug._logged.add(msg);\r\n            console.warn(msg, ...attr);\r\n        }\r\n    }\r\n\r\n    static error(...attr) {\r\n        console.error(...attr);\r\n    }\r\n    \r\n    static errorOnce(...attr) {\r\n        if (!Debug._logged.has(attr[0])) {\r\n            Debug._logged.add(attr[0]);\r\n            Debug.error(...attr);\r\n        }\r\n    }\r\n\r\n    static assert(test, ...attr) {\r\n        if (!test) {\r\n            Debug.errorOnce('Assert Error:', test, ...attr);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    static checkRange(number, min, max, msg) {\r\n        let ok = Debug.checkFloat(number, msg);\r\n        ok = ok && Debug.assert(number >= min, msg);\r\n        ok = ok && Debug.assert(number <= max, msg);\r\n        return ok;\r\n    }   \r\n\r\n    static checkInt(number, msg) {\r\n        const ok = Debug.assert(Number.isInteger(number), msg);\r\n        return ok;\r\n    }    \r\n\r\n    static checkUint(number, msg) {\r\n        let ok = Debug.checkInt(number, msg);\r\n        ok = ok && Debug.assert(number >= 0, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkFloat(number, msg) {\r\n        let ok = Debug.assert(typeof number === 'number', msg);\r\n        ok = ok && Debug.assert(!isNaN(number), msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkFloatPositive(number, msg) {\r\n        let ok = Debug.checkFloat(number, msg);\r\n        ok = ok && Debug.assert(number >= 0, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkBool(bool, msg) {\r\n        return Debug.assert((bool === true || bool === false), msg);\r\n    }\r\n\r\n    static checkVec(vec, msg) {\r\n        let ok = Debug.checkFloat(vec.x, msg);\r\n        ok = ok && Debug.checkFloat(vec.y, msg);\r\n        ok = ok && Debug.checkFloat(vec.z, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkVecPositive(vec, msg) {\r\n        let ok = Debug.checkFloatPositive(vec.x, msg);\r\n        ok = ok && Debug.checkFloatPositive(vec.y, msg);\r\n        ok = ok && Debug.checkFloatPositive(vec.z, msg);\r\n        return ok;\r\n    }\r\n\r\n    static checkQuat(quat, msg) {\r\n        let ok = true;\r\n        ok = ok && Debug.checkVec(quat, msg);\r\n        ok = ok && Debug.checkFloat(quat.w, msg);\r\n        return ok;\r\n    }\r\n\r\n    static verifyProperties(data, schema) {\r\n        let ok = true;\r\n        Object.entries(data).forEach(entry => {\r\n            let found = false;\r\n            for (let i = 0, end = schema.length; i < end; i++) {\r\n                if (entry[0] === schema[i]) {\r\n                    found = true;\r\n                }\r\n            }\r\n            ok = ok && Debug.assert(found, `Component: Unrecognized options property: ${ entry }`);\r\n        });\r\n\r\n        return ok;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9kZWJ1Zy5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvZGVidWcubWpzPzY1MTIiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRGVidWcge1xyXG4gICAgc3RhdGljIF9sb2dnZWQgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgc3RhdGljIGRldiA9IChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jyk7XHJcblxyXG4gICAgc3RhdGljIGxvZyguLi5hdHRyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coLi4uYXR0cik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGxvZ09uY2UobXNnLCAuLi5hdHRyKSB7XHJcbiAgICAgICAgaWYgKCFEZWJ1Zy5fbG9nZ2VkLmhhcyhtc2cpKSB7XHJcbiAgICAgICAgICAgIERlYnVnLl9sb2dnZWQuYWRkKG1zZyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZywgLi4uYXR0cik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB3YXJuKC4uLmF0dHIpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oLi4uYXR0cik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHdhcm5PbmNlKG1zZywgLi4uYXR0cikge1xyXG4gICAgICAgIGlmICghRGVidWcuX2xvZ2dlZC5oYXMobXNnKSkge1xyXG4gICAgICAgICAgICBEZWJ1Zy5fbG9nZ2VkLmFkZChtc2cpO1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4obXNnLCAuLi5hdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGVycm9yKC4uLmF0dHIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKC4uLmF0dHIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBzdGF0aWMgZXJyb3JPbmNlKC4uLmF0dHIpIHtcclxuICAgICAgICBpZiAoIURlYnVnLl9sb2dnZWQuaGFzKGF0dHJbMF0pKSB7XHJcbiAgICAgICAgICAgIERlYnVnLl9sb2dnZWQuYWRkKGF0dHJbMF0pO1xyXG4gICAgICAgICAgICBEZWJ1Zy5lcnJvciguLi5hdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzc2VydCh0ZXN0LCAuLi5hdHRyKSB7XHJcbiAgICAgICAgaWYgKCF0ZXN0KSB7XHJcbiAgICAgICAgICAgIERlYnVnLmVycm9yT25jZSgnQXNzZXJ0IEVycm9yOicsIHRlc3QsIC4uLmF0dHIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja1JhbmdlKG51bWJlciwgbWluLCBtYXgsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrRmxvYXQobnVtYmVyLCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuYXNzZXJ0KG51bWJlciA+PSBtaW4sIG1zZyk7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQobnVtYmVyIDw9IG1heCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9ICAgXHJcblxyXG4gICAgc3RhdGljIGNoZWNrSW50KG51bWJlciwgbXNnKSB7XHJcbiAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5hc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihudW1iZXIpLCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH0gICAgXHJcblxyXG4gICAgc3RhdGljIGNoZWNrVWludChudW1iZXIsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IERlYnVnLmNoZWNrSW50KG51bWJlciwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChudW1iZXIgPj0gMCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNoZWNrRmxvYXQobnVtYmVyLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5hc3NlcnQodHlwZW9mIG51bWJlciA9PT0gJ251bWJlcicsIG1zZyk7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5hc3NlcnQoIWlzTmFOKG51bWJlciksIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja0Zsb2F0UG9zaXRpdmUobnVtYmVyLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KG51bWJlciwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChudW1iZXIgPj0gMCwgbXNnKTtcclxuICAgICAgICByZXR1cm4gb2s7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNoZWNrQm9vbChib29sLCBtc2cpIHtcclxuICAgICAgICByZXR1cm4gRGVidWcuYXNzZXJ0KChib29sID09PSB0cnVlIHx8IGJvb2wgPT09IGZhbHNlKSwgbXNnKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY2hlY2tWZWModmVjLCBtc2cpIHtcclxuICAgICAgICBsZXQgb2sgPSBEZWJ1Zy5jaGVja0Zsb2F0KHZlYy54LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdCh2ZWMueSwgbXNnKTtcclxuICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQodmVjLnosIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjaGVja1ZlY1Bvc2l0aXZlKHZlYywgbXNnKSB7XHJcbiAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy54LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy55LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdFBvc2l0aXZlKHZlYy56LCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBvaztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY2hlY2tRdWF0KHF1YXQsIG1zZykge1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja1ZlYyhxdWF0LCBtc2cpO1xyXG4gICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdChxdWF0LncsIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB2ZXJpZnlQcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSkge1xyXG4gICAgICAgIGxldCBvayA9IHRydWU7XHJcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoZGF0YSkuZm9yRWFjaChlbnRyeSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gc2NoZW1hLmxlbmd0aDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50cnlbMF0gPT09IHNjaGVtYVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmFzc2VydChmb3VuZCwgYENvbXBvbmVudDogVW5yZWNvZ25pemVkIG9wdGlvbnMgcHJvcGVydHk6ICR7IGVudHJ5IH1gKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9rO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBEZWJ1ZyB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/debug.mjs\n");

/***/ }),

/***/ "./src/physics/dispatcher.mjs":
/*!************************************!*\
  !*** ./src/physics/dispatcher.mjs ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Dispatcher: () => (/* binding */ Dispatcher)\n/* harmony export */ });\n/* harmony import */ var _backends_jolt_backend_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../backends/jolt/backend.mjs */ \"./src/backends/jolt/backend.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n\r\n\r\n\r\nlet backend = null;\r\n\r\nfunction createBackend(name, messenger, config) {\r\n    switch (name) {\r\n        case 'jolt':\r\n            backend = new _backends_jolt_backend_mjs__WEBPACK_IMPORTED_MODULE_0__.JoltBackend(messenger, config);\r\n            break;\r\n\r\n        // intentional fall-through\r\n        case 'ammo':\r\n        case 'rapier':\r\n        case 'physx':\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Invalid backend selection: ${ backend }`);\r\n            break;\r\n\r\n        default:\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_1__.Debug.warn(`Invalid backend selection: ${ backend }`);\r\n    }\r\n}\r\n\r\nclass Dispatcher {\r\n    constructor(manager = null, useWebWorker = false) {\r\n        this._useWebWorker = useWebWorker;\r\n        this._manager = manager;\r\n        this._destroying = false;\r\n\r\n        if (useWebWorker) {\r\n            this.postMessage = self.postMessage;\r\n        }\r\n    }\r\n\r\n    postMessage(msg) {\r\n        this.handleMessage(msg);\r\n    }\r\n\r\n    handleMessage(data) {\r\n        if (this._destroying) return;\r\n\r\n        switch (data.type) {\r\n            case 'step':\r\n                backend.step(data);\r\n                break;\r\n\r\n            case 'create-backend':\r\n                createBackend(data.backendName, this, data.config);\r\n                // If we don't use a Web Worker, expose the backend instance to main thread for dev convenience\r\n                if (this._manager) {\r\n                    this._manager.backend = backend;\r\n                }\r\n                break;\r\n\r\n            case 'override-contacts':\r\n                backend.overrideContacts(data.listener, data.overrides);\r\n                break;\r\n\r\n            case 'destroy':\r\n                this.destroy();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this._destroying = true;\r\n\r\n        backend.destroy();\r\n        backend = null;\r\n        self.onmessage = (e) => {};\r\n        dispatcher = null;\r\n    }\r\n\r\n    respond(msg) {\r\n        msg.origin = 'physics-worker';\r\n        if (this._useWebWorker) {\r\n            self.postMessage(msg);\r\n        } else {\r\n            this._manager.onMessage(msg);\r\n        }\r\n    }\r\n}\r\n\r\nlet dispatcher = new Dispatcher();\r\n\r\nself.onmessage = function(event) {\r\n    if (event.origin !== 'physics-manager') return;\r\n    dispatcher.handleMessage(event);\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9kaXNwYXRjaGVyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2Rpc3BhdGNoZXIubWpzPzM1NDAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSm9sdEJhY2tlbmQgfSBmcm9tIFwiLi4vYmFja2VuZHMvam9sdC9iYWNrZW5kLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuL2RlYnVnLm1qc1wiO1xyXG5cclxubGV0IGJhY2tlbmQgPSBudWxsO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQmFja2VuZChuYW1lLCBtZXNzZW5nZXIsIGNvbmZpZykge1xyXG4gICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgY2FzZSAnam9sdCc6XHJcbiAgICAgICAgICAgIGJhY2tlbmQgPSBuZXcgSm9sdEJhY2tlbmQobWVzc2VuZ2VyLCBjb25maWcpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgLy8gaW50ZW50aW9uYWwgZmFsbC10aHJvdWdoXHJcbiAgICAgICAgY2FzZSAnYW1tbyc6XHJcbiAgICAgICAgY2FzZSAncmFwaWVyJzpcclxuICAgICAgICBjYXNlICdwaHlzeCc6XHJcbiAgICAgICAgICAgIERlYnVnLndhcm4oYEludmFsaWQgYmFja2VuZCBzZWxlY3Rpb246ICR7IGJhY2tlbmQgfWApO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgRGVidWcud2FybihgSW52YWxpZCBiYWNrZW5kIHNlbGVjdGlvbjogJHsgYmFja2VuZCB9YCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIERpc3BhdGNoZXIge1xyXG4gICAgY29uc3RydWN0b3IobWFuYWdlciA9IG51bGwsIHVzZVdlYldvcmtlciA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5fdXNlV2ViV29ya2VyID0gdXNlV2ViV29ya2VyO1xyXG4gICAgICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyO1xyXG4gICAgICAgIHRoaXMuX2Rlc3Ryb3lpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKHVzZVdlYldvcmtlcikge1xyXG4gICAgICAgICAgICB0aGlzLnBvc3RNZXNzYWdlID0gc2VsZi5wb3N0TWVzc2FnZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcG9zdE1lc3NhZ2UobXNnKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlKG1zZyk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlTWVzc2FnZShkYXRhKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2Rlc3Ryb3lpbmcpIHJldHVybjtcclxuXHJcbiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnc3RlcCc6XHJcbiAgICAgICAgICAgICAgICBiYWNrZW5kLnN0ZXAoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZS1iYWNrZW5kJzpcclxuICAgICAgICAgICAgICAgIGNyZWF0ZUJhY2tlbmQoZGF0YS5iYWNrZW5kTmFtZSwgdGhpcywgZGF0YS5jb25maWcpO1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgZG9uJ3QgdXNlIGEgV2ViIFdvcmtlciwgZXhwb3NlIHRoZSBiYWNrZW5kIGluc3RhbmNlIHRvIG1haW4gdGhyZWFkIGZvciBkZXYgY29udmVuaWVuY2VcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tYW5hZ2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5iYWNrZW5kID0gYmFja2VuZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnb3ZlcnJpZGUtY29udGFjdHMnOlxyXG4gICAgICAgICAgICAgICAgYmFja2VuZC5vdmVycmlkZUNvbnRhY3RzKGRhdGEubGlzdGVuZXIsIGRhdGEub3ZlcnJpZGVzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnZGVzdHJveSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuX2Rlc3Ryb3lpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICBiYWNrZW5kLmRlc3Ryb3koKTtcclxuICAgICAgICBiYWNrZW5kID0gbnVsbDtcclxuICAgICAgICBzZWxmLm9ubWVzc2FnZSA9IChlKSA9PiB7fTtcclxuICAgICAgICBkaXNwYXRjaGVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXNwb25kKG1zZykge1xyXG4gICAgICAgIG1zZy5vcmlnaW4gPSAncGh5c2ljcy13b3JrZXInO1xyXG4gICAgICAgIGlmICh0aGlzLl91c2VXZWJXb3JrZXIpIHtcclxuICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIub25NZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5sZXQgZGlzcGF0Y2hlciA9IG5ldyBEaXNwYXRjaGVyKCk7XHJcblxyXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQub3JpZ2luICE9PSAncGh5c2ljcy1tYW5hZ2VyJykgcmV0dXJuO1xyXG4gICAgZGlzcGF0Y2hlci5oYW5kbGVNZXNzYWdlKGV2ZW50KTtcclxufVxyXG5cclxuZXhwb3J0IHsgRGlzcGF0Y2hlciB9OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/physics/dispatcher.mjs\n");

/***/ }),

/***/ "./src/physics/indexed-cache.mjs":
/*!***************************************!*\
  !*** ./src/physics/indexed-cache.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   IndexedCache: () => (/* binding */ IndexedCache)\n/* harmony export */ });\nclass IndexedCache {\r\n    constructor() {\r\n        this._index = 0;\r\n        this._freed = [];\r\n        this._storage = [];\r\n    }\r\n\r\n    add(element) {\r\n        const index = this._freed.pop() ?? this._index++; \r\n        this._storage[index] = element;\r\n        return index;\r\n    }\r\n\r\n    get(index) {\r\n        return this._storage[index];\r\n    }\r\n\r\n    free(index) {\r\n        this._storage[index] = null;\r\n        this._freed.push(index);\r\n    }\r\n\r\n    clear() {\r\n        this._index = 0;\r\n        this._freed.length = 0;\r\n        this._storage.length = 0;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9pbmRleGVkLWNhY2hlLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvaW5kZXhlZC1jYWNoZS5tanM/NWEwZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBJbmRleGVkQ2FjaGUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMuX2ZyZWVkID0gW107XHJcbiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZChlbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9mcmVlZC5wb3AoKSA/PyB0aGlzLl9pbmRleCsrOyBcclxuICAgICAgICB0aGlzLl9zdG9yYWdlW2luZGV4XSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlW2luZGV4XTtcclxuICAgIH1cclxuXHJcbiAgICBmcmVlKGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5fc3RvcmFnZVtpbmRleF0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2ZyZWVkLnB1c2goaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuX2luZGV4ID0gMDtcclxuICAgICAgICB0aGlzLl9mcmVlZC5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX3N0b3JhZ2UubGVuZ3RoID0gMDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgSW5kZXhlZENhY2hlIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/indexed-cache.mjs\n");

/***/ }),

/***/ "./src/physics/init.mjs":
/*!******************************!*\
  !*** ./src/physics/init.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   init: () => (/* binding */ init)\n/* harmony export */ });\n/* harmony import */ var _components_jolt_body_system_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/jolt/body/system.mjs */ \"./src/physics/components/jolt/body/system.mjs\");\n/* harmony import */ var _components_jolt_char_system_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./components/jolt/char/system.mjs */ \"./src/physics/components/jolt/char/system.mjs\");\n/* harmony import */ var _components_jolt_vehicle_system_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/jolt/vehicle/system.mjs */ \"./src/physics/components/jolt/vehicle/system.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _components_jolt_manager_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./components/jolt/manager.mjs */ \"./src/physics/components/jolt/manager.mjs\");\n/* harmony import */ var _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n/* harmony import */ var _components_jolt_softbody_system_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./components/jolt/softbody/system.mjs */ \"./src/physics/components/jolt/softbody/system.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// TODO\r\n// Once we add webworker support, init should be changed to async\r\n// function and wait for worker response to resolve.\r\n\r\nfunction init(app = pc.Application.getApplication(), opts = {}) {\r\n    const options = {\r\n        backend: 'jolt',\r\n        propertyName: 'physics',\r\n        ...opts\r\n    };\r\n\r\n    const { backend, propertyName } = options;\r\n\r\n    switch(backend) {\r\n        case 'jolt': {\r\n            if (app[propertyName]) {\r\n                _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.warn(`Unable to initialize Physics Manager. Application has an existing property name that conflicts. ` + \r\n                    `Tried to use \"app.${ propertyName }\". Use { propertyName: string } in init options to use a custom property name. Aborting.`);\r\n                return;\r\n            }\r\n\r\n            const manager = new _components_jolt_manager_mjs__WEBPACK_IMPORTED_MODULE_4__.JoltManager(app, backend, options);\r\n            app[propertyName] = manager;\r\n\r\n            app.systems.add(new _components_jolt_body_system_mjs__WEBPACK_IMPORTED_MODULE_0__.BodyComponentSystem(app, manager, _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__.COMPONENT_SYSTEM_BODY));\r\n            app.systems.add(new _components_jolt_char_system_mjs__WEBPACK_IMPORTED_MODULE_1__.CharComponentSystem(app, manager, _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__.COMPONENT_SYSTEM_CHAR));\r\n            app.systems.add(new _components_jolt_vehicle_system_mjs__WEBPACK_IMPORTED_MODULE_2__.VehicleComponentSystem(app, manager, _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__.COMPONENT_SYSTEM_VEHICLE));\r\n            app.systems.add(new _components_jolt_softbody_system_mjs__WEBPACK_IMPORTED_MODULE_6__.SoftBodyComponentSystem(app, manager, _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_5__.COMPONENT_SYSTEM_SOFT_BODY));\r\n            break;\r\n        }\r\n\r\n        default:\r\n            _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.dev && _debug_mjs__WEBPACK_IMPORTED_MODULE_3__.Debug.warn(`Backend not implemented: ${ backend }`);\r\n            return destroy();\r\n    }\r\n\r\n    app.on('destroy', () => destroy());\r\n\r\n    function destroy() {\r\n        app[propertyName].destroy();\r\n        app[propertyName] = null;\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9pbml0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL2luaXQubWpzP2EwYzIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9ib2R5L3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgQ2hhckNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9jaGFyL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgVmVoaWNsZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC92ZWhpY2xlL3N5c3RlbS5tanNcIjtcclxuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi9kZWJ1Zy5tanNcIjtcclxuaW1wb3J0IHsgSm9sdE1hbmFnZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL2pvbHQvbWFuYWdlci5tanNcIjtcclxuaW1wb3J0IHsgQ09NUE9ORU5UX1NZU1RFTV9CT0RZLCBDT01QT05FTlRfU1lTVEVNX0NIQVIsIENPTVBPTkVOVF9TWVNURU1fU09GVF9CT0RZLCBDT01QT05FTlRfU1lTVEVNX1ZFSElDTEUgfSBmcm9tIFwiLi9jb21wb25lbnRzL2pvbHQvY29uc3RhbnRzLm1qc1wiO1xyXG5pbXBvcnQgeyBTb2Z0Qm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gXCIuL2NvbXBvbmVudHMvam9sdC9zb2Z0Ym9keS9zeXN0ZW0ubWpzXCI7XHJcblxyXG5cclxuLy8gVE9ET1xyXG4vLyBPbmNlIHdlIGFkZCB3ZWJ3b3JrZXIgc3VwcG9ydCwgaW5pdCBzaG91bGQgYmUgY2hhbmdlZCB0byBhc3luY1xyXG4vLyBmdW5jdGlvbiBhbmQgd2FpdCBmb3Igd29ya2VyIHJlc3BvbnNlIHRvIHJlc29sdmUuXHJcblxyXG5mdW5jdGlvbiBpbml0KGFwcCA9IHBjLkFwcGxpY2F0aW9uLmdldEFwcGxpY2F0aW9uKCksIG9wdHMgPSB7fSkge1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICBiYWNrZW5kOiAnam9sdCcsXHJcbiAgICAgICAgcHJvcGVydHlOYW1lOiAncGh5c2ljcycsXHJcbiAgICAgICAgLi4ub3B0c1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB7IGJhY2tlbmQsIHByb3BlcnR5TmFtZSB9ID0gb3B0aW9ucztcclxuXHJcbiAgICBzd2l0Y2goYmFja2VuZCkge1xyXG4gICAgICAgIGNhc2UgJ2pvbHQnOiB7XHJcbiAgICAgICAgICAgIGlmIChhcHBbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgRGVidWcuZGV2ICYmIERlYnVnLndhcm4oYFVuYWJsZSB0byBpbml0aWFsaXplIFBoeXNpY3MgTWFuYWdlci4gQXBwbGljYXRpb24gaGFzIGFuIGV4aXN0aW5nIHByb3BlcnR5IG5hbWUgdGhhdCBjb25mbGljdHMuIGAgKyBcclxuICAgICAgICAgICAgICAgICAgICBgVHJpZWQgdG8gdXNlIFwiYXBwLiR7IHByb3BlcnR5TmFtZSB9XCIuIFVzZSB7IHByb3BlcnR5TmFtZTogc3RyaW5nIH0gaW4gaW5pdCBvcHRpb25zIHRvIHVzZSBhIGN1c3RvbSBwcm9wZXJ0eSBuYW1lLiBBYm9ydGluZy5gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBKb2x0TWFuYWdlcihhcHAsIGJhY2tlbmQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBhcHBbcHJvcGVydHlOYW1lXSA9IG1hbmFnZXI7XHJcblxyXG4gICAgICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IEJvZHlDb21wb25lbnRTeXN0ZW0oYXBwLCBtYW5hZ2VyLCBDT01QT05FTlRfU1lTVEVNX0JPRFkpKTtcclxuICAgICAgICAgICAgYXBwLnN5c3RlbXMuYWRkKG5ldyBDaGFyQ29tcG9uZW50U3lzdGVtKGFwcCwgbWFuYWdlciwgQ09NUE9ORU5UX1NZU1RFTV9DSEFSKSk7XHJcbiAgICAgICAgICAgIGFwcC5zeXN0ZW1zLmFkZChuZXcgVmVoaWNsZUNvbXBvbmVudFN5c3RlbShhcHAsIG1hbmFnZXIsIENPTVBPTkVOVF9TWVNURU1fVkVISUNMRSkpO1xyXG4gICAgICAgICAgICBhcHAuc3lzdGVtcy5hZGQobmV3IFNvZnRCb2R5Q29tcG9uZW50U3lzdGVtKGFwcCwgbWFuYWdlciwgQ09NUE9ORU5UX1NZU1RFTV9TT0ZUX0JPRFkpKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBEZWJ1Zy5kZXYgJiYgRGVidWcud2FybihgQmFja2VuZCBub3QgaW1wbGVtZW50ZWQ6ICR7IGJhY2tlbmQgfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVzdHJveSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcC5vbignZGVzdHJveScsICgpID0+IGRlc3Ryb3koKSk7XHJcblxyXG4gICAgZnVuY3Rpb24gZGVzdHJveSgpIHtcclxuICAgICAgICBhcHBbcHJvcGVydHlOYW1lXS5kZXN0cm95KCk7XHJcbiAgICAgICAgYXBwW3Byb3BlcnR5TmFtZV0gPSBudWxsO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBpbml0IH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/init.mjs\n");

/***/ }),

/***/ "./src/physics/manager.mjs":
/*!*********************************!*\
  !*** ./src/physics/manager.mjs ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PhysicsManager: () => (/* binding */ PhysicsManager)\n/* harmony export */ });\n/* harmony import */ var _package_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../package.json */ \"./package.json\");\n/* harmony import */ var _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../backends/jolt/commands-buffer.mjs */ \"./src/backends/jolt/commands-buffer.mjs\");\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _dispatcher_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dispatcher.mjs */ \"./src/physics/dispatcher.mjs\");\n/* harmony import */ var _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./indexed-cache.mjs */ \"./src/physics/indexed-cache.mjs\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst stepMessage = { type: 'step', buffer: null };\r\n\r\nclass PhysicsManager {\r\n    constructor(app, backendName, opts = {}) {\r\n        const config = {\r\n            useSharedArrayBuffer: true,\r\n            commandsBufferSize: 10000, // bytes, 10k is enough to update about 150 active dynamic objects\r\n            allowCommandsBufferResize: true,\r\n            useWebWorker: false,\r\n            fixedStep: 1 / 30,\r\n            subSteps: 1,\r\n            useMotionStates: true,\r\n            debugColorStatic: pc.Color.GRAY,\r\n            debugColorKinematic: pc.Color.MAGENTA,\r\n            debugColorDynamic: pc.Color.YELLOW,\r\n            debugDrawLayerId: pc.LAYERID_IMMEDIATE,\r\n            debugDrawDepth: true,\r\n            ...opts\r\n        };\r\n\r\n        // Make sure requested features are supported\r\n        config.useSharedArrayBuffer = config.useSharedArrayBuffer && typeof SharedArrayBuffer !== 'undefined';\r\n        config.useWebWorker = config.useWebWorker && typeof Worker !== 'undefined';\r\n\r\n        this._createDispatcher(config);\r\n\r\n        this._backend = null\r\n        const msg = Object.create(null);\r\n        msg.type = 'create-backend';\r\n        msg.backendName = backendName;\r\n        msg.config = config;\r\n        this.sendUncompressed(msg);\r\n\r\n        this._outBuffer = new _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__.CommandsBuffer(config);\r\n        this._inBuffer = null;\r\n\r\n        this._systems = new Map();\r\n        this._paused = false;\r\n        this._steps = 0;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            this._perfCache = new _indexed_cache_mjs__WEBPACK_IMPORTED_MODULE_4__.IndexedCache();\r\n        }\r\n\r\n        this._frame = app.stats.frame;\r\n        this._updateEvent = app.systems.on('postUpdate', this.onUpdate, this);\r\n\r\n        this.version = _package_json__WEBPACK_IMPORTED_MODULE_0__.version;\r\n\r\n        this._config = config;\r\n        this._app = app;\r\n    }\r\n\r\n    set backend(instance) {\r\n        this._backend = instance;\r\n    }\r\n    get backend() {\r\n        return this._backend;\r\n    }\r\n\r\n    get systems() {\r\n        return this._systems;\r\n    }\r\n\r\n    set paused(bool) {\r\n        this._paused = bool;\r\n    }\r\n    get paused() {\r\n        return this._paused;\r\n    }\r\n\r\n    get commandsBuffer() {\r\n        return this._outBuffer;\r\n    }\r\n\r\n    get config() {\r\n        return this._config;\r\n    }\r\n\r\n    get steps() {\r\n        return this._steps;\r\n    }\r\n\r\n    onUpdate() {\r\n        if (this._paused) return;\r\n\r\n        let index;\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            const startTime = performance.now();\r\n            index = this._perfCache.add(startTime);\r\n        }\r\n        \r\n        this._writeIsometry();\r\n        this._dispatchCommands(this._frame.dt, index);\r\n    }\r\n\r\n    sendUncompressed(msg) {\r\n        msg.origin = 'physics-manager';\r\n        this._dispatcher.postMessage(msg);\r\n    }\r\n\r\n    onMessage(msg) {\r\n        if (this._paused || msg.origin !== 'physics-worker') return;\r\n\r\n        const systems = this._systems;\r\n        let inBuffer = this._inBuffer;\r\n\r\n        if (msg.buffer) {\r\n            if (!inBuffer) {\r\n                inBuffer = this._inBuffer = new _backends_jolt_commands_buffer_mjs__WEBPACK_IMPORTED_MODULE_1__.CommandsBuffer();\r\n            }\r\n\r\n            // Make sure to use the incoming buffer, as the old one could\r\n            // have been destroyed during resize.\r\n            inBuffer.buffer = msg.buffer;\r\n\r\n            const count = inBuffer.commandsCount;\r\n            for (let i = 0; i < count; i++) {\r\n                const operator = inBuffer.readOperator();\r\n                if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n                    const ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.assert(!!systems.get(operator), `Invalid component system: ${ operator }`);\r\n                    if (!ok) {\r\n                        this._updateEvent.off();\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                systems.get(operator).processCommands(inBuffer);\r\n            }\r\n\r\n            inBuffer.reset();\r\n        }\r\n\r\n        this._steps = msg.steps ?? 0;\r\n\r\n        // TODO\r\n        // handle properly when we are in a module, e.g. engine only\r\n        const constants = msg.constants;\r\n        if (constants) {\r\n            for (let i = 0, end = constants.length; i < end; i += 2) {\r\n                const key = constants[i];\r\n                const value = constants[i + 1];\r\n\r\n                window.pc[key] = value;\r\n            }\r\n        }\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            const perfIndex = msg.perfIndex;\r\n            if (perfIndex == null) return;\r\n\r\n            const cache = this._perfCache;\r\n            const startTime = cache.get(perfIndex);\r\n            const frame = this._app.stats.frame;\r\n            \r\n            cache.free(perfIndex);\r\n            frame.physicsTime = performance.now() - startTime + msg.time;\r\n        }        \r\n    }\r\n\r\n    destroy() {\r\n        this._systems.forEach(system => {\r\n            system.destroy();\r\n        });\r\n        this._systems.clear();\r\n\r\n        const msg = Object.create(null);\r\n        msg.type = 'destroy';\r\n        this.sendUncompressed(msg);\r\n        this._backend = null;\r\n\r\n        this._commandsBuffer.destroy();\r\n        this._commandsBuffer = null;\r\n\r\n        this._dispatcher = null;\r\n        this._frame = null;\r\n\r\n        this._updateEvent?.off();\r\n        this._updateEvent = null;\r\n\r\n        this._app[this._config.propertyName] = null;\r\n    }\r\n\r\n    _writeIsometry() {\r\n        this._systems.forEach(system => {\r\n            system.requestIsometry?.();\r\n        })\r\n    }\r\n\r\n    _dispatchCommands(dt, perfIndex) {\r\n        const cb = this._outBuffer;\r\n\r\n        stepMessage.dt = dt;\r\n\r\n        if (!cb.dirty) {\r\n            stepMessage.buffer = null;\r\n            this._dispatcher.postMessage(stepMessage);\r\n            return;\r\n        }\r\n\r\n        const buffer = cb.buffer;\r\n        const buffers = [ buffer ];\r\n        stepMessage.buffer = buffer;\r\n\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_2__.Debug.dev) {\r\n            stepMessage.perfIndex = perfIndex;\r\n        }\r\n\r\n        // Also add any potential mesh and convex hull shapes buffers\r\n        const meshBuffers = cb.meshBuffers;\r\n        if (meshBuffers.length > 0) {\r\n            stepMessage.meshBuffers = meshBuffers;\r\n            buffers.push(...meshBuffers);\r\n        } else {\r\n            stepMessage.meshBuffers = null;\r\n        }\r\n\r\n        this._dispatcher.postMessage(stepMessage, buffers);\r\n\r\n        cb.meshBuffers.length = 0;\r\n        cb.reset();\r\n    }\r\n\r\n    _createDispatcher(config) {\r\n        if (config.useWebWorker) {\r\n            // TODO\r\n            // This will generate a chunk, which will not be able to be found correctly, when\r\n            // using PlayCanvas Editor. Revisit when ESMScripts are supported.\r\n            // this._dispatcher = new Worker(new URL('./dispatcher.mjs', import.meta.url));\r\n        } else {\r\n            this._dispatcher = new _dispatcher_mjs__WEBPACK_IMPORTED_MODULE_3__.Dispatcher(this, false);\r\n        }\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9tYW5hZ2VyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvbWFuYWdlci5tanM/NTdiYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgaW5mbyBmcm9tIFwiLi4vLi4vcGFja2FnZS5qc29uXCI7XHJcbmltcG9ydCB7IENvbW1hbmRzQnVmZmVyIH0gZnJvbSBcIi4uL2JhY2tlbmRzL2pvbHQvY29tbWFuZHMtYnVmZmVyLm1qc1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBEaXNwYXRjaGVyIH0gZnJvbSBcIi4vZGlzcGF0Y2hlci5tanNcIjtcclxuaW1wb3J0IHsgSW5kZXhlZENhY2hlIH0gZnJvbSBcIi4vaW5kZXhlZC1jYWNoZS5tanNcIjtcclxuXHJcbmNvbnN0IHN0ZXBNZXNzYWdlID0geyB0eXBlOiAnc3RlcCcsIGJ1ZmZlcjogbnVsbCB9O1xyXG5cclxuY2xhc3MgUGh5c2ljc01hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBiYWNrZW5kTmFtZSwgb3B0cyA9IHt9KSB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICAgICAgICB1c2VTaGFyZWRBcnJheUJ1ZmZlcjogdHJ1ZSxcclxuICAgICAgICAgICAgY29tbWFuZHNCdWZmZXJTaXplOiAxMDAwMCwgLy8gYnl0ZXMsIDEwayBpcyBlbm91Z2ggdG8gdXBkYXRlIGFib3V0IDE1MCBhY3RpdmUgZHluYW1pYyBvYmplY3RzXHJcbiAgICAgICAgICAgIGFsbG93Q29tbWFuZHNCdWZmZXJSZXNpemU6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZVdlYldvcmtlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIGZpeGVkU3RlcDogMSAvIDMwLFxyXG4gICAgICAgICAgICBzdWJTdGVwczogMSxcclxuICAgICAgICAgICAgdXNlTW90aW9uU3RhdGVzOiB0cnVlLFxyXG4gICAgICAgICAgICBkZWJ1Z0NvbG9yU3RhdGljOiBwYy5Db2xvci5HUkFZLFxyXG4gICAgICAgICAgICBkZWJ1Z0NvbG9yS2luZW1hdGljOiBwYy5Db2xvci5NQUdFTlRBLFxyXG4gICAgICAgICAgICBkZWJ1Z0NvbG9yRHluYW1pYzogcGMuQ29sb3IuWUVMTE9XLFxyXG4gICAgICAgICAgICBkZWJ1Z0RyYXdMYXllcklkOiBwYy5MQVlFUklEX0lNTUVESUFURSxcclxuICAgICAgICAgICAgZGVidWdEcmF3RGVwdGg6IHRydWUsXHJcbiAgICAgICAgICAgIC4uLm9wdHNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBNYWtlIHN1cmUgcmVxdWVzdGVkIGZlYXR1cmVzIGFyZSBzdXBwb3J0ZWRcclxuICAgICAgICBjb25maWcudXNlU2hhcmVkQXJyYXlCdWZmZXIgPSBjb25maWcudXNlU2hhcmVkQXJyYXlCdWZmZXIgJiYgdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJztcclxuICAgICAgICBjb25maWcudXNlV2ViV29ya2VyID0gY29uZmlnLnVzZVdlYldvcmtlciAmJiB0eXBlb2YgV29ya2VyICE9PSAndW5kZWZpbmVkJztcclxuXHJcbiAgICAgICAgdGhpcy5fY3JlYXRlRGlzcGF0Y2hlcihjb25maWcpO1xyXG5cclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gbnVsbFxyXG4gICAgICAgIGNvbnN0IG1zZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgbXNnLnR5cGUgPSAnY3JlYXRlLWJhY2tlbmQnO1xyXG4gICAgICAgIG1zZy5iYWNrZW5kTmFtZSA9IGJhY2tlbmROYW1lO1xyXG4gICAgICAgIG1zZy5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgdGhpcy5zZW5kVW5jb21wcmVzc2VkKG1zZyk7XHJcblxyXG4gICAgICAgIHRoaXMuX291dEJ1ZmZlciA9IG5ldyBDb21tYW5kc0J1ZmZlcihjb25maWcpO1xyXG4gICAgICAgIHRoaXMuX2luQnVmZmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fc3lzdGVtcyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLl9wYXVzZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9zdGVwcyA9IDA7XHJcblxyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgdGhpcy5fcGVyZkNhY2hlID0gbmV3IEluZGV4ZWRDYWNoZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fZnJhbWUgPSBhcHAuc3RhdHMuZnJhbWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlRXZlbnQgPSBhcHAuc3lzdGVtcy5vbigncG9zdFVwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLnZlcnNpb24gPSBpbmZvLnZlcnNpb247XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGJhY2tlbmQoaW5zdGFuY2UpIHtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gaW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICBnZXQgYmFja2VuZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYmFja2VuZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc3lzdGVtcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3lzdGVtcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcGF1c2VkKGJvb2wpIHtcclxuICAgICAgICB0aGlzLl9wYXVzZWQgPSBib29sO1xyXG4gICAgfVxyXG4gICAgZ2V0IHBhdXNlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcGF1c2VkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb21tYW5kc0J1ZmZlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3V0QnVmZmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb25maWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc3RlcHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0ZXBzO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVXBkYXRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXVzZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgbGV0IGluZGV4O1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIGluZGV4ID0gdGhpcy5fcGVyZkNhY2hlLmFkZChzdGFydFRpbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLl93cml0ZUlzb21ldHJ5KCk7XHJcbiAgICAgICAgdGhpcy5fZGlzcGF0Y2hDb21tYW5kcyh0aGlzLl9mcmFtZS5kdCwgaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRVbmNvbXByZXNzZWQobXNnKSB7XHJcbiAgICAgICAgbXNnLm9yaWdpbiA9ICdwaHlzaWNzLW1hbmFnZXInO1xyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIucG9zdE1lc3NhZ2UobXNnKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk1lc3NhZ2UobXNnKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BhdXNlZCB8fCBtc2cub3JpZ2luICE9PSAncGh5c2ljcy13b3JrZXInKSByZXR1cm47XHJcblxyXG4gICAgICAgIGNvbnN0IHN5c3RlbXMgPSB0aGlzLl9zeXN0ZW1zO1xyXG4gICAgICAgIGxldCBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyO1xyXG5cclxuICAgICAgICBpZiAobXNnLmJ1ZmZlcikge1xyXG4gICAgICAgICAgICBpZiAoIWluQnVmZmVyKSB7XHJcbiAgICAgICAgICAgICAgICBpbkJ1ZmZlciA9IHRoaXMuX2luQnVmZmVyID0gbmV3IENvbW1hbmRzQnVmZmVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0byB1c2UgdGhlIGluY29taW5nIGJ1ZmZlciwgYXMgdGhlIG9sZCBvbmUgY291bGRcclxuICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIGRlc3Ryb3llZCBkdXJpbmcgcmVzaXplLlxyXG4gICAgICAgICAgICBpbkJ1ZmZlci5idWZmZXIgPSBtc2cuYnVmZmVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBpbkJ1ZmZlci5jb21tYW5kc0NvdW50O1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yID0gaW5CdWZmZXIucmVhZE9wZXJhdG9yKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2sgPSBEZWJ1Zy5hc3NlcnQoISFzeXN0ZW1zLmdldChvcGVyYXRvciksIGBJbnZhbGlkIGNvbXBvbmVudCBzeXN0ZW06ICR7IG9wZXJhdG9yIH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUV2ZW50Lm9mZigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHN5c3RlbXMuZ2V0KG9wZXJhdG9yKS5wcm9jZXNzQ29tbWFuZHMoaW5CdWZmZXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpbkJ1ZmZlci5yZXNldCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc3RlcHMgPSBtc2cuc3RlcHMgPz8gMDtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIGhhbmRsZSBwcm9wZXJseSB3aGVuIHdlIGFyZSBpbiBhIG1vZHVsZSwgZS5nLiBlbmdpbmUgb25seVxyXG4gICAgICAgIGNvbnN0IGNvbnN0YW50cyA9IG1zZy5jb25zdGFudHM7XHJcbiAgICAgICAgaWYgKGNvbnN0YW50cykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgZW5kID0gY29uc3RhbnRzLmxlbmd0aDsgaSA8IGVuZDsgaSArPSAyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBjb25zdGFudHNbaV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnN0YW50c1tpICsgMV07XHJcblxyXG4gICAgICAgICAgICAgICAgd2luZG93LnBjW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBjb25zdCBwZXJmSW5kZXggPSBtc2cucGVyZkluZGV4O1xyXG4gICAgICAgICAgICBpZiAocGVyZkluZGV4ID09IG51bGwpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fcGVyZkNhY2hlO1xyXG4gICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBjYWNoZS5nZXQocGVyZkluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLl9hcHAuc3RhdHMuZnJhbWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYWNoZS5mcmVlKHBlcmZJbmRleCk7XHJcbiAgICAgICAgICAgIGZyYW1lLnBoeXNpY3NUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUgKyBtc2cudGltZTtcclxuICAgICAgICB9ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuX3N5c3RlbXMuZm9yRWFjaChzeXN0ZW0gPT4ge1xyXG4gICAgICAgICAgICBzeXN0ZW0uZGVzdHJveSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX3N5c3RlbXMuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgY29uc3QgbXNnID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICBtc2cudHlwZSA9ICdkZXN0cm95JztcclxuICAgICAgICB0aGlzLnNlbmRVbmNvbXByZXNzZWQobXNnKTtcclxuICAgICAgICB0aGlzLl9iYWNrZW5kID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fY29tbWFuZHNCdWZmZXIuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuX2NvbW1hbmRzQnVmZmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fZGlzcGF0Y2hlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fZnJhbWUgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGVFdmVudD8ub2ZmKCk7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlRXZlbnQgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9hcHBbdGhpcy5fY29uZmlnLnByb3BlcnR5TmFtZV0gPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIF93cml0ZUlzb21ldHJ5KCkge1xyXG4gICAgICAgIHRoaXMuX3N5c3RlbXMuZm9yRWFjaChzeXN0ZW0gPT4ge1xyXG4gICAgICAgICAgICBzeXN0ZW0ucmVxdWVzdElzb21ldHJ5Py4oKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIF9kaXNwYXRjaENvbW1hbmRzKGR0LCBwZXJmSW5kZXgpIHtcclxuICAgICAgICBjb25zdCBjYiA9IHRoaXMuX291dEJ1ZmZlcjtcclxuXHJcbiAgICAgICAgc3RlcE1lc3NhZ2UuZHQgPSBkdDtcclxuXHJcbiAgICAgICAgaWYgKCFjYi5kaXJ0eSkge1xyXG4gICAgICAgICAgICBzdGVwTWVzc2FnZS5idWZmZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLnBvc3RNZXNzYWdlKHN0ZXBNZXNzYWdlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gY2IuYnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSBbIGJ1ZmZlciBdO1xyXG4gICAgICAgIHN0ZXBNZXNzYWdlLmJ1ZmZlciA9IGJ1ZmZlcjtcclxuXHJcbiAgICAgICAgaWYgKERlYnVnLmRldikge1xyXG4gICAgICAgICAgICBzdGVwTWVzc2FnZS5wZXJmSW5kZXggPSBwZXJmSW5kZXg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBbHNvIGFkZCBhbnkgcG90ZW50aWFsIG1lc2ggYW5kIGNvbnZleCBodWxsIHNoYXBlcyBidWZmZXJzXHJcbiAgICAgICAgY29uc3QgbWVzaEJ1ZmZlcnMgPSBjYi5tZXNoQnVmZmVycztcclxuICAgICAgICBpZiAobWVzaEJ1ZmZlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBzdGVwTWVzc2FnZS5tZXNoQnVmZmVycyA9IG1lc2hCdWZmZXJzO1xyXG4gICAgICAgICAgICBidWZmZXJzLnB1c2goLi4ubWVzaEJ1ZmZlcnMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0ZXBNZXNzYWdlLm1lc2hCdWZmZXJzID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIucG9zdE1lc3NhZ2Uoc3RlcE1lc3NhZ2UsIGJ1ZmZlcnMpO1xyXG5cclxuICAgICAgICBjYi5tZXNoQnVmZmVycy5sZW5ndGggPSAwO1xyXG4gICAgICAgIGNiLnJlc2V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NyZWF0ZURpc3BhdGNoZXIoY29uZmlnKSB7XHJcbiAgICAgICAgaWYgKGNvbmZpZy51c2VXZWJXb3JrZXIpIHtcclxuICAgICAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgICAgICAvLyBUaGlzIHdpbGwgZ2VuZXJhdGUgYSBjaHVuaywgd2hpY2ggd2lsbCBub3QgYmUgYWJsZSB0byBiZSBmb3VuZCBjb3JyZWN0bHksIHdoZW5cclxuICAgICAgICAgICAgLy8gdXNpbmcgUGxheUNhbnZhcyBFZGl0b3IuIFJldmlzaXQgd2hlbiBFU01TY3JpcHRzIGFyZSBzdXBwb3J0ZWQuXHJcbiAgICAgICAgICAgIC8vIHRoaXMuX2Rpc3BhdGNoZXIgPSBuZXcgV29ya2VyKG5ldyBVUkwoJy4vZGlzcGF0Y2hlci5tanMnLCBpbXBvcnQubWV0YS51cmwpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyID0gbmV3IERpc3BhdGNoZXIodGhpcywgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgUGh5c2ljc01hbmFnZXIgfTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/physics/manager.mjs\n");

/***/ }),

/***/ "./src/physics/math.mjs":
/*!******************************!*\
  !*** ./src/physics/math.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extendMath: () => (/* binding */ extendMath)\n/* harmony export */ });\n/* harmony import */ var _debug_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./debug.mjs */ \"./src/physics/debug.mjs\");\n/* harmony import */ var _components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./components/jolt/constants.mjs */ \"./src/physics/components/jolt/constants.mjs\");\n\r\n\r\n\r\nfunction extendMath() {\r\n    pc.Vec3.fromBuffer = function(buffer) {\r\n        return new pc.Vec3(\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n            buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n        );\r\n    };\r\n\r\n    Jolt.Vec3.prototype.FromBuffer = function(buffer, isPositive) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const x = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const y = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const z = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n\r\n            const test = isPositive ? _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloatPositive : _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat;\r\n\r\n            let ok = test(x, `invalid vector X component: ${ x }`);\r\n            ok = ok && test(y, `invalid vector Y component: ${ y }`);\r\n            ok = ok && test(z, `invalid vector Z component: ${ z }`);\r\n            if (!ok) return this;\r\n\r\n            this.Set(x, y, z);\r\n        } else {\r\n            this.Set(\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    Jolt.Vec3.prototype.set = function(x, y, z) {\r\n        this.Set(x, y, z);\r\n        return this;\r\n    };\r\n\r\n    Jolt.Vec3.prototype.print = function() {\r\n        console.log(this.GetX(), this.GetY(), this.GetZ());\r\n    };\r\n\r\n    Jolt.Quat.prototype.FromBuffer = function(buffer) {\r\n        if (_debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.dev) {\r\n            const x = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const y = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const z = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n            const w = buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32);\r\n\r\n            let ok = _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(x, `invalid quaternion X component: ${ x }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(y, `invalid quaternion Y component: ${ y }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(z, `invalid quaternion Z component: ${ z }`);\r\n            ok = ok && _debug_mjs__WEBPACK_IMPORTED_MODULE_0__.Debug.checkFloat(w, `invalid quaternion W component: ${ w }`);\r\n            if (!ok) return this;\r\n\r\n            this.Set(x, y, z, w);\r\n        } else {\r\n            this.Set(\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32),\r\n                buffer.read(_components_jolt_constants_mjs__WEBPACK_IMPORTED_MODULE_1__.BUFFER_READ_FLOAT32)\r\n            );\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    Jolt.Quat.prototype.set = function(x, y, z, w) {\r\n        this.Set(x, y, z, w);\r\n        return this;\r\n    };\r\n\r\n    Jolt.Quat.prototype.print = function() {\r\n        console.log(this.GetX(), this.GetY(), this.GetZ(), this.GetW());\r\n    };\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy9tYXRoLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL1BoeXNpY3NDb21wb25lbnRzLy4vc3JjL3BoeXNpY3MvbWF0aC5tanM/ODRiZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuL2RlYnVnLm1qc1wiO1xyXG5pbXBvcnQgeyBCVUZGRVJfUkVBRF9GTE9BVDMyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9qb2x0L2NvbnN0YW50cy5tanNcIjtcclxuXHJcbmZ1bmN0aW9uIGV4dGVuZE1hdGgoKSB7XHJcbiAgICBwYy5WZWMzLmZyb21CdWZmZXIgPSBmdW5jdGlvbihidWZmZXIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IHBjLlZlYzMoXHJcbiAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMilcclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICBKb2x0LlZlYzMucHJvdG90eXBlLkZyb21CdWZmZXIgPSBmdW5jdGlvbihidWZmZXIsIGlzUG9zaXRpdmUpIHtcclxuICAgICAgICBpZiAoRGVidWcuZGV2KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHggPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgeSA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjb25zdCB6ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0ZXN0ID0gaXNQb3NpdGl2ZSA/IERlYnVnLmNoZWNrRmxvYXRQb3NpdGl2ZSA6IERlYnVnLmNoZWNrRmxvYXQ7XHJcblxyXG4gICAgICAgICAgICBsZXQgb2sgPSB0ZXN0KHgsIGBpbnZhbGlkIHZlY3RvciBYIGNvbXBvbmVudDogJHsgeCB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgdGVzdCh5LCBgaW52YWxpZCB2ZWN0b3IgWSBjb21wb25lbnQ6ICR7IHkgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIHRlc3QoeiwgYGludmFsaWQgdmVjdG9yIFogY29tcG9uZW50OiAkeyB6IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykgcmV0dXJuIHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLlNldCh4LCB5LCB6KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLlNldChcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG5cclxuICAgIEpvbHQuVmVjMy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24oeCwgeSwgeikge1xyXG4gICAgICAgIHRoaXMuU2V0KHgsIHksIHopO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuXHJcbiAgICBKb2x0LlZlYzMucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5HZXRYKCksIHRoaXMuR2V0WSgpLCB0aGlzLkdldFooKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIEpvbHQuUXVhdC5wcm90b3R5cGUuRnJvbUJ1ZmZlciA9IGZ1bmN0aW9uKGJ1ZmZlcikge1xyXG4gICAgICAgIGlmIChEZWJ1Zy5kZXYpIHtcclxuICAgICAgICAgICAgY29uc3QgeCA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG4gICAgICAgICAgICBjb25zdCB5ID0gYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMik7XHJcbiAgICAgICAgICAgIGNvbnN0IHogPSBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKTtcclxuICAgICAgICAgICAgY29uc3QgdyA9IGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpO1xyXG5cclxuICAgICAgICAgICAgbGV0IG9rID0gRGVidWcuY2hlY2tGbG9hdCh4LCBgaW52YWxpZCBxdWF0ZXJuaW9uIFggY29tcG9uZW50OiAkeyB4IH1gKTtcclxuICAgICAgICAgICAgb2sgPSBvayAmJiBEZWJ1Zy5jaGVja0Zsb2F0KHksIGBpbnZhbGlkIHF1YXRlcm5pb24gWSBjb21wb25lbnQ6ICR7IHkgfWApO1xyXG4gICAgICAgICAgICBvayA9IG9rICYmIERlYnVnLmNoZWNrRmxvYXQoeiwgYGludmFsaWQgcXVhdGVybmlvbiBaIGNvbXBvbmVudDogJHsgeiB9YCk7XHJcbiAgICAgICAgICAgIG9rID0gb2sgJiYgRGVidWcuY2hlY2tGbG9hdCh3LCBgaW52YWxpZCBxdWF0ZXJuaW9uIFcgY29tcG9uZW50OiAkeyB3IH1gKTtcclxuICAgICAgICAgICAgaWYgKCFvaykgcmV0dXJuIHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLlNldCh4LCB5LCB6LCB3KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLlNldChcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpLFxyXG4gICAgICAgICAgICAgICAgYnVmZmVyLnJlYWQoQlVGRkVSX1JFQURfRkxPQVQzMiksXHJcbiAgICAgICAgICAgICAgICBidWZmZXIucmVhZChCVUZGRVJfUkVBRF9GTE9BVDMyKSxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlci5yZWFkKEJVRkZFUl9SRUFEX0ZMT0FUMzIpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcblxyXG4gICAgSm9sdC5RdWF0LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbih4LCB5LCB6LCB3KSB7XHJcbiAgICAgICAgdGhpcy5TZXQoeCwgeSwgeiwgdyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG5cclxuICAgIEpvbHQuUXVhdC5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLkdldFgoKSwgdGhpcy5HZXRZKCksIHRoaXMuR2V0WigpLCB0aGlzLkdldFcoKSk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgeyBleHRlbmRNYXRoIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/math.mjs\n");

/***/ }),

/***/ "./src/physics/util.mjs":
/*!******************************!*\
  !*** ./src/physics/util.mjs ***!
  \******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildAccessors: () => (/* binding */ buildAccessors)\n/* harmony export */ });\nfunction buildAccessors(obj, schema) {\r\n    // Create getter/setter pairs for each property defined in the schema\r\n    for (let i = 0, end = schema.length; i < end; i++) {\r\n        const property = schema[i];\r\n\r\n        // Don't override existing getters/setters\r\n        const etter = Object.getOwnPropertyDescriptor(obj, property);\r\n        if (etter != null) continue;\r\n\r\n        Object.defineProperty(obj, property, {\r\n            get: function () {\r\n                return this[`_${ property }`];\r\n            },\r\n            set: function (value) {\r\n                const oldValue = this[`_${ property }`];\r\n                this[`_${ property }`] = value;\r\n                this.fire('set', property, oldValue, value);\r\n            },\r\n            configurable: true\r\n        });\r\n    }\r\n\r\n    obj._accessorsBuilt = true;\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGh5c2ljcy91dGlsLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QaHlzaWNzQ29tcG9uZW50cy8uL3NyYy9waHlzaWNzL3V0aWwubWpzP2VjNjkiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYnVpbGRBY2Nlc3NvcnMob2JqLCBzY2hlbWEpIHtcclxuICAgIC8vIENyZWF0ZSBnZXR0ZXIvc2V0dGVyIHBhaXJzIGZvciBlYWNoIHByb3BlcnR5IGRlZmluZWQgaW4gdGhlIHNjaGVtYVxyXG4gICAgZm9yIChsZXQgaSA9IDAsIGVuZCA9IHNjaGVtYS5sZW5ndGg7IGkgPCBlbmQ7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5ID0gc2NoZW1hW2ldO1xyXG5cclxuICAgICAgICAvLyBEb24ndCBvdmVycmlkZSBleGlzdGluZyBnZXR0ZXJzL3NldHRlcnNcclxuICAgICAgICBjb25zdCBldHRlciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wZXJ0eSk7XHJcbiAgICAgICAgaWYgKGV0dGVyICE9IG51bGwpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wZXJ0eSwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2BfJHsgcHJvcGVydHkgfWBdO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzW2BfJHsgcHJvcGVydHkgfWBdO1xyXG4gICAgICAgICAgICAgICAgdGhpc1tgXyR7IHByb3BlcnR5IH1gXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdzZXQnLCBwcm9wZXJ0eSwgb2xkVmFsdWUsIHZhbHVlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb2JqLl9hY2Nlc3NvcnNCdWlsdCA9IHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCB7IGJ1aWxkQWNjZXNzb3JzIH07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/physics/util.mjs\n");

/***/ }),

/***/ "./node_modules/jolt-physics/package.json":
/*!************************************************!*\
  !*** ./node_modules/jolt-physics/package.json ***!
  \************************************************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"jolt-physics","version":"0.13.0","description":"A WebAssembly port of JoltPhysics, a rigid body physics and collision detection library, suitable for games and VR applications","type":"module","main":"dist/jolt-physics.wasm-compat.js","types":"dist/jolt-physics.wasm-compat.d.ts","exports":{".":{"types":"./dist/jolt-physics.wasm-compat.d.ts","default":"./dist/jolt-physics.wasm-compat.js"},"./wasm":{"types":"./dist/jolt-physics.wasm.d.ts","default":"./dist/jolt-physics.wasm.js"},"./wasm-compat":{"types":"./dist/jolt-physics.wasm-compat.d.ts","default":"./dist/jolt-physics.wasm-compat.js"},"./asm":{"types":"./dist/jolt-physics.d.ts","default":"./dist/jolt-physics.js"},"./jolt-physics.wasm.wasm":"./dist/jolt-physics.wasm.wasm","./package.json":"./package.json"},"scripts":{"build":"sh build.sh","examples":"http-server ./Examples"},"homepage":"https://github.com/jrouwe/JoltPhysics.js","repository":"https://github.com/jrouwe/JoltPhysics.js.git","author":"jrouwe","license":"MIT","files":["README.md","LICENSE","./dist/jolt-physics.js","./dist/jolt-physics.d.ts","./dist/jolt-physics.wasm-compat.js","./dist/jolt-physics.wasm-compat.d.ts","./dist/jolt-physics.wasm.js","./dist/jolt-physics.wasm.d.ts","./dist/jolt-physics.wasm.wasm","./dist/types.d.ts","asm","wasm","wasm-compat"],"keywords":["physics","physics-engine","physics-simulation","simulation","game-engine","vr","game-development","webassembly","wasm"],"devDependencies":{"http-server":"^14.1.1","webidl-dts-gen":"^1.7.0"}}');

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"jolt","version":"0.1.0","main":"index.js","license":"MIT","type":"module","scripts":{"build":"rimraf dist && webpack --mode=production && webpack --mode=development","build:dev":"rimraf dist && webpack --mode=development","build:prod":"rimraf dist && webpack --mode=production"},"dependencies":{"jolt-physics":"^0.13.0","playcanvas":"^1.66.1"},"devDependencies":{"rimraf":"^5.0.5","webpack":"^5.89.0","webpack-cli":"^5.1.4"}}');

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.mjs");
/******/ 	PhysicsComponents = __webpack_exports__;
/******/ 	
/******/ })()
;